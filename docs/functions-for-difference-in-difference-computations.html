<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>B Functions for difference-in-difference computations | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="B Functions for difference-in-difference computations | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="vuillota/EVA-impact-aires-protegees.git" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="B Functions for difference-in-difference computations | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Antoine Vuillot" />
<meta name="author" content="Ingrid Dallmann" />
<meta name="author" content="Léa Poulin" />
<meta name="author" content="Pierre-Yves Durand" />


<meta name="date" content="2023-11-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functions-for-matching-pre--and-post-processing.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Impact analysis of protected areas funded by the AFD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this website</a></li>
<li class="chapter" data-level="1" data-path="building-the-datasets.html"><a href="building-the-datasets.html"><i class="fa fa-check"></i><b>1</b> Building the datasets</a>
<ul>
<li class="chapter" data-level="1.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#initial-settings"><i class="fa fa-check"></i><b>1.1</b> Initial settings</a></li>
<li class="chapter" data-level="1.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-analysis"><i class="fa fa-check"></i><b>1.2</b> Datasets for analysis</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-pas-reporting-by-afd-technical-departments"><i class="fa fa-check"></i><b>1.2.1</b> Merge PAs reporting by AFD technical departments</a></li>
<li class="chapter" data-level="1.2.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-the-list-of-pas-to-afd-project-information-and-wdpa"><i class="fa fa-check"></i><b>1.2.2</b> Merge the list of PAs to AFD project information and WDPA</a></li>
<li class="chapter" data-level="1.2.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#correct-errors"><i class="fa fa-check"></i><b>1.2.3</b> Correct errors</a></li>
<li class="chapter" data-level="1.2.4" data-path="building-the-datasets.html"><a href="building-the-datasets.html#tidy-the-datasets"><i class="fa fa-check"></i><b>1.2.4</b> Tidy the datasets</a></li>
<li class="chapter" data-level="1.2.5" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-with-only-afd-project-variables"><i class="fa fa-check"></i><b>1.2.5</b> Dataset with only AFD project variables</a></li>
<li class="chapter" data-level="1.2.6" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-for-non-confidential-analysis"><i class="fa fa-check"></i><b>1.2.6</b> Dataset for non-confidential analysis</a></li>
<li class="chapter" data-level="1.2.7" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-confidential-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Datasets for confidential analysis</a></li>
<li class="chapter" data-level="1.2.8" data-path="building-the-datasets.html"><a href="building-the-datasets.html#a-polygon-dataset-for-specific-use"><i class="fa fa-check"></i><b>1.2.8</b> A polygon dataset for specific use</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample"><i class="fa fa-check"></i><b>1.3</b> Computing total areas covered by PAs in the sample</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computations-of-polygons-area"><i class="fa fa-check"></i><b>1.3.1</b> Computations of polygons’ area</a></li>
<li class="chapter" data-level="1.3.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level"><i class="fa fa-check"></i><b>1.3.2</b> Computing the intersection at country, region, world level</a></li>
<li class="chapter" data-level="1.3.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-without-intersection"><i class="fa fa-check"></i><b>1.3.3</b> Computing total areas without intersection</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Descriptive statistics</b></span></li>
<li class="chapter" data-level="2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html"><i class="fa fa-check"></i><b>2</b> Projects funded by the AFD</a>
<ul>
<li class="chapter" data-level="2.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#initial-settings-1"><i class="fa fa-check"></i><b>2.1</b> Initial settings</a></li>
<li class="chapter" data-level="2.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#importing-the-datasets"><i class="fa fa-check"></i><b>2.2</b> Importing the datasets</a></li>
<li class="chapter" data-level="2.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#performing-descriptive-statistics"><i class="fa fa-check"></i><b>2.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#iucn-categories"><i class="fa fa-check"></i><b>2.3.1</b> IUCN categories</a></li>
<li class="chapter" data-level="2.3.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#ecosystems-excluding-non-referenced-pas"><i class="fa fa-check"></i><b>2.3.2</b> Ecosystems (excluding non-referenced PAs)</a></li>
<li class="chapter" data-level="2.3.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#distribution-and-surface-of-pas-across-countries-and-regions"><i class="fa fa-check"></i><b>2.3.3</b> Distribution (# and surface) of PAs across countries and regions</a></li>
<li class="chapter" data-level="2.3.4" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#surface-of-pas"><i class="fa fa-check"></i><b>2.3.4</b> Surface of PAs</a></li>
<li class="chapter" data-level="2.3.5" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#temporal-evolution"><i class="fa fa-check"></i><b>2.3.5</b> Temporal evolution</a></li>
<li class="chapter" data-level="2.3.6" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#governance"><i class="fa fa-check"></i><b>2.3.6</b> Governance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html"><i class="fa fa-check"></i><b>3</b> Miscellaneous statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#initial-settings-2"><i class="fa fa-check"></i><b>3.1</b> Initial settings</a></li>
<li class="chapter" data-level="3.2" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#importing-datasets"><i class="fa fa-check"></i><b>3.2</b> Importing datasets</a></li>
<li class="chapter" data-level="3.3" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#performing-descriptive-statistics-1"><i class="fa fa-check"></i><b>3.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#pa-of-interest-other-pa-and-all-pa-in-a-given-sample"><i class="fa fa-check"></i><b>3.3.1</b> PA of interest, other PA and all PA in a given sample</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#evolution-of-tree-cover-and-deforestation"><i class="fa fa-check"></i><b>3.4</b> Evolution of tree cover and deforestation</a></li>
<li class="chapter" data-level="3.5" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#forest-cover-by-country"><i class="fa fa-check"></i><b>3.5</b> Forest cover by country</a></li>
<li class="chapter" data-level="3.6" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#mapping-of-sample"><i class="fa fa-check"></i><b>3.6</b> Mapping of sample</a></li>
<li class="chapter" data-level="3.7" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#mapping-of-results"><i class="fa fa-check"></i><b>3.7</b> Mapping of results</a></li>
<li class="chapter" data-level="3.8" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#evolution-of-forest-cover-for-specific-polygons"><i class="fa fa-check"></i><b>3.8</b> Evolution of forest cover for specific polygons</a></li>
</ul></li>
<li class="part"><span><b>Impact analysis</b></span></li>
<li class="chapter" data-level="4" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>4</b> Matching</a>
<ul>
<li class="chapter" data-level="4.1" data-path="matching.html"><a href="matching.html#initial-settings-3"><i class="fa fa-check"></i><b>4.1</b> Initial settings</a></li>
<li class="chapter" data-level="4.2" data-path="matching.html"><a href="matching.html#datasets-and-critical-parameters"><i class="fa fa-check"></i><b>4.2</b> Datasets and critical parameters</a></li>
<li class="chapter" data-level="4.3" data-path="matching.html"><a href="matching.html#matching-process"><i class="fa fa-check"></i><b>4.3</b> Matching process</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="difference-in-difference.html"><a href="difference-in-difference.html"><i class="fa fa-check"></i><b>5</b> Difference-in-difference</a>
<ul>
<li class="chapter" data-level="5.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#initial-settings-4"><i class="fa fa-check"></i><b>5.1</b> Initial settings</a></li>
<li class="chapter" data-level="5.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#load-datasets-and-define-critical-parameters"><i class="fa fa-check"></i><b>5.2</b> Load datasets and define critical parameters</a></li>
<li class="chapter" data-level="5.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#computing-treatment-effects-at-protected-area-level"><i class="fa fa-check"></i><b>5.3</b> Computing treatment effects at protected area level</a></li>
<li class="chapter" data-level="5.4" data-path="difference-in-difference.html"><a href="difference-in-difference.html#assess-the-quality-of-matching-and-pre-test"><i class="fa fa-check"></i><b>5.4</b> Assess the quality of matching and pre-test</a></li>
<li class="chapter" data-level="5.5" data-path="difference-in-difference.html"><a href="difference-in-difference.html#tidy-datasets-with-acceptable-quality"><i class="fa fa-check"></i><b>5.5</b> Tidy datasets with acceptable quality</a></li>
<li class="chapter" data-level="5.6" data-path="difference-in-difference.html"><a href="difference-in-difference.html#assess-the-loss-of-observations"><i class="fa fa-check"></i><b>5.6</b> Assess the loss of observations</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#compute-overlap-removal"><i class="fa fa-check"></i><b>5.6.1</b> Compute overlap removal</a></li>
<li class="chapter" data-level="5.6.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#compute-losses-for-each-steps"><i class="fa fa-check"></i><b>5.6.2</b> Compute losses for each steps</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="difference-in-difference.html"><a href="difference-in-difference.html#compute-aggregated-metrics-at-country-and-region-level"><i class="fa fa-check"></i><b>5.7</b> Compute aggregated metrics at country and region level</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-treatment-effects"><i class="fa fa-check"></i><b>5.7.1</b> Aggregation of treatment effects</a></li>
<li class="chapter" data-level="5.7.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-annual-deforestation-rates"><i class="fa fa-check"></i><b>5.7.2</b> Aggregation of annual deforestation rates</a></li>
<li class="chapter" data-level="5.7.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#average-and-total-forest-loss-on-the-period-at-country-and-region-level"><i class="fa fa-check"></i><b>5.7.3</b> Average and total forest loss on the period, at country and region level</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="difference-in-difference.html"><a href="difference-in-difference.html#display-treatment-effects"><i class="fa fa-check"></i><b>5.8</b> Display treatment effects</a></li>
<li class="chapter" data-level="5.9" data-path="difference-in-difference.html"><a href="difference-in-difference.html#in-figures-and-tables"><i class="fa fa-check"></i><b>5.9</b> In figures and tables</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#on-a-map"><i class="fa fa-check"></i><b>5.9.1</b> On a map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="functions-for-matching-pre--and-post-processing.html"><a href="functions-for-matching-pre--and-post-processing.html"><i class="fa fa-check"></i><b>A</b> Functions for matching pre- and post-processing</a></li>
<li class="chapter" data-level="B" data-path="functions-for-difference-in-difference-computations.html"><a href="functions-for-difference-in-difference-computations.html"><i class="fa fa-check"></i><b>B</b> Functions for difference-in-difference computations</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions-for-difference-in-difference-computations" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">B</span> Functions for difference-in-difference computations<a href="functions-for-difference-in-difference-computations.html#functions-for-difference-in-difference-computations" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="functions-for-difference-in-difference-computations.html#cb148-1" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb148-2"><a href="functions-for-difference-in-difference-computations.html#cb148-2" tabindex="-1"></a><span class="co">#Functions to perform difference-in-difference and plot results</span></span>
<span id="cb148-3"><a href="functions-for-difference-in-difference-computations.html#cb148-3" tabindex="-1"></a><span class="do">#####</span></span>
<span id="cb148-4"><a href="functions-for-difference-in-difference-computations.html#cb148-4" tabindex="-1"></a></span>
<span id="cb148-5"><a href="functions-for-difference-in-difference-computations.html#cb148-5" tabindex="-1"></a><span class="co">#For each function, the aim of the function, inputs, outputs, data saved and notes are detailed. This takes the following form :</span></span>
<span id="cb148-6"><a href="functions-for-difference-in-difference-computations.html#cb148-6" tabindex="-1"></a><span class="co">#Aim of the function</span></span>
<span id="cb148-7"><a href="functions-for-difference-in-difference-computations.html#cb148-7" tabindex="-1"></a><span class="do">##INPUTS : the arguments needed in the function</span></span>
<span id="cb148-8"><a href="functions-for-difference-in-difference-computations.html#cb148-8" tabindex="-1"></a><span class="do">###INPUT 1 to N</span></span>
<span id="cb148-9"><a href="functions-for-difference-in-difference-computations.html#cb148-9" tabindex="-1"></a><span class="do">##OUTPUTS : the information returned by the function (data frames, numeric, characters, etc.) and necessary to pursue to processing</span></span>
<span id="cb148-10"><a href="functions-for-difference-in-difference-computations.html#cb148-10" tabindex="-1"></a><span class="do">### OUTPUT 1 to N</span></span>
<span id="cb148-11"><a href="functions-for-difference-in-difference-computations.html#cb148-11" tabindex="-1"></a><span class="do">##DATA SAVED : information put in the storage but not necessarily need to pursue the processing (figures, tables, data frames, etc.)</span></span>
<span id="cb148-12"><a href="functions-for-difference-in-difference-computations.html#cb148-12" tabindex="-1"></a><span class="do">### ...</span></span>
<span id="cb148-13"><a href="functions-for-difference-in-difference-computations.html#cb148-13" tabindex="-1"></a><span class="do">##NOTES : any useful remark</span></span>
<span id="cb148-14"><a href="functions-for-difference-in-difference-computations.html#cb148-14" tabindex="-1"></a><span class="do">### ...</span></span>
<span id="cb148-15"><a href="functions-for-difference-in-difference-computations.html#cb148-15" tabindex="-1"></a></span>
<span id="cb148-16"><a href="functions-for-difference-in-difference-computations.html#cb148-16" tabindex="-1"></a><span class="co">#Remarks :</span></span>
<span id="cb148-17"><a href="functions-for-difference-in-difference-computations.html#cb148-17" tabindex="-1"></a><span class="do">##most functions are adapted for errors handling using base::withCallingHandlers(). Basically, the computation steps are declared in a block of withCallingHandlers function, while two other blocks specify what to do in case the first block face a warning or error. In our case, errors led to return a boolean indicating an error has occured and append the log with the error message. Warnings return a boolean but do not block the iteration. They also edit the log with the warning message.</span></span>
<span id="cb148-18"><a href="functions-for-difference-in-difference-computations.html#cb148-18" tabindex="-1"></a><span class="do">##PA is used for &quot;protected area(s)&quot;.</span></span>
<span id="cb148-19"><a href="functions-for-difference-in-difference-computations.html#cb148-19" tabindex="-1"></a><span class="do">##To save plots and tables : save on temporary folder in the R session then put the saved object in the storage. Indeed print() and ggplot::ggsave() cannot write directly on s3 storage</span></span>
<span id="cb148-20"><a href="functions-for-difference-in-difference-computations.html#cb148-20" tabindex="-1"></a><span class="do">###</span></span>
<span id="cb148-21"><a href="functions-for-difference-in-difference-computations.html#cb148-21" tabindex="-1"></a></span>
<span id="cb148-22"><a href="functions-for-difference-in-difference-computations.html#cb148-22" tabindex="-1"></a></span>
<span id="cb148-23"><a href="functions-for-difference-in-difference-computations.html#cb148-23" tabindex="-1"></a><span class="co">#Load the list of PA matched during the matchign process</span></span>
<span id="cb148-24"><a href="functions-for-difference-in-difference-computations.html#cb148-24" tabindex="-1"></a><span class="do">##INPUTS :</span></span>
<span id="cb148-25"><a href="functions-for-difference-in-difference-computations.html#cb148-25" tabindex="-1"></a><span class="do">### iso : the ISO code of the country considered</span></span>
<span id="cb148-26"><a href="functions-for-difference-in-difference-computations.html#cb148-26" tabindex="-1"></a><span class="do">##OUTPUTS :</span></span>
<span id="cb148-27"><a href="functions-for-difference-in-difference-computations.html#cb148-27" tabindex="-1"></a><span class="do">### list_pa : a dataframe with the PA matched</span></span>
<span id="cb148-28"><a href="functions-for-difference-in-difference-computations.html#cb148-28" tabindex="-1"></a><span class="do">### is_ok : a boolean indicating whether or not an error occured inside the function</span></span>
<span id="cb148-29"><a href="functions-for-difference-in-difference-computations.html#cb148-29" tabindex="-1"></a>fn_did_list_pa <span class="ot">=</span> <span class="cf">function</span>(iso, load_dir)</span>
<span id="cb148-30"><a href="functions-for-difference-in-difference-computations.html#cb148-30" tabindex="-1"></a>{</span>
<span id="cb148-31"><a href="functions-for-difference-in-difference-computations.html#cb148-31" tabindex="-1"></a>  output <span class="ot">=</span> <span class="fu">tryCatch</span>(</span>
<span id="cb148-32"><a href="functions-for-difference-in-difference-computations.html#cb148-32" tabindex="-1"></a>    </span>
<span id="cb148-33"><a href="functions-for-difference-in-difference-computations.html#cb148-33" tabindex="-1"></a>    {</span>
<span id="cb148-34"><a href="functions-for-difference-in-difference-computations.html#cb148-34" tabindex="-1"></a>      </span>
<span id="cb148-35"><a href="functions-for-difference-in-difference-computations.html#cb148-35" tabindex="-1"></a>  list_pa <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-36"><a href="functions-for-difference-in-difference-computations.html#cb148-36" tabindex="-1"></a>                         <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-37"><a href="functions-for-difference-in-difference-computations.html#cb148-37" tabindex="-1"></a>                         <span class="at">object =</span> <span class="fu">paste</span>(load_dir, iso, <span class="fu">paste0</span>(<span class="st">&quot;list_pa_matched_&quot;</span>, iso, <span class="st">&quot;.csv&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-38"><a href="functions-for-difference-in-difference-computations.html#cb148-38" tabindex="-1"></a>                         <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb148-39"><a href="functions-for-difference-in-difference-computations.html#cb148-39" tabindex="-1"></a>  list_pa <span class="ot">=</span> <span class="fu">unique</span>(list_pa<span class="sc">$</span>wdpaid)</span>
<span id="cb148-40"><a href="functions-for-difference-in-difference-computations.html#cb148-40" tabindex="-1"></a>  </span>
<span id="cb148-41"><a href="functions-for-difference-in-difference-computations.html#cb148-41" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;list_pa&quot;</span> <span class="ot">=</span> list_pa, <span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">TRUE</span>))</span>
<span id="cb148-42"><a href="functions-for-difference-in-difference-computations.html#cb148-42" tabindex="-1"></a>    },</span>
<span id="cb148-43"><a href="functions-for-difference-in-difference-computations.html#cb148-43" tabindex="-1"></a>  </span>
<span id="cb148-44"><a href="functions-for-difference-in-difference-computations.html#cb148-44" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb148-45"><a href="functions-for-difference-in-difference-computations.html#cb148-45" tabindex="-1"></a>  {</span>
<span id="cb148-46"><a href="functions-for-difference-in-difference-computations.html#cb148-46" tabindex="-1"></a>    <span class="fu">print</span>(e)</span>
<span id="cb148-47"><a href="functions-for-difference-in-difference-computations.html#cb148-47" tabindex="-1"></a>    <span class="co">#cat(paste(&quot;Error in loading the list of protected areas :\n&quot;, e, &quot;\n&quot;), file = log, append = TRUE)</span></span>
<span id="cb148-48"><a href="functions-for-difference-in-difference-computations.html#cb148-48" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Error in loading the list of protected areas :</span><span class="sc">\n</span><span class="st">&quot;</span>, e, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb148-49"><a href="functions-for-difference-in-difference-computations.html#cb148-49" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span>))</span>
<span id="cb148-50"><a href="functions-for-difference-in-difference-computations.html#cb148-50" tabindex="-1"></a>  }</span>
<span id="cb148-51"><a href="functions-for-difference-in-difference-computations.html#cb148-51" tabindex="-1"></a>  </span>
<span id="cb148-52"><a href="functions-for-difference-in-difference-computations.html#cb148-52" tabindex="-1"></a>  )</span>
<span id="cb148-53"><a href="functions-for-difference-in-difference-computations.html#cb148-53" tabindex="-1"></a>  </span>
<span id="cb148-54"><a href="functions-for-difference-in-difference-computations.html#cb148-54" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb148-55"><a href="functions-for-difference-in-difference-computations.html#cb148-55" tabindex="-1"></a>}</span>
<span id="cb148-56"><a href="functions-for-difference-in-difference-computations.html#cb148-56" tabindex="-1"></a></span>
<span id="cb148-57"><a href="functions-for-difference-in-difference-computations.html#cb148-57" tabindex="-1"></a></span>
<span id="cb148-58"><a href="functions-for-difference-in-difference-computations.html#cb148-58" tabindex="-1"></a><span class="co">#For a protected area, compute annual deforestation rates à la Wolf et al. 2021, before and after treatment</span></span>
<span id="cb148-59"><a href="functions-for-difference-in-difference-computations.html#cb148-59" tabindex="-1"></a><span class="do">## INPUTS </span></span>
<span id="cb148-60"><a href="functions-for-difference-in-difference-computations.html#cb148-60" tabindex="-1"></a><span class="do">### iso : the iso3 code for the country considered</span></span>
<span id="cb148-61"><a href="functions-for-difference-in-difference-computations.html#cb148-61" tabindex="-1"></a><span class="do">### wdpaid : the WDPAID of the PA considered</span></span>
<span id="cb148-62"><a href="functions-for-difference-in-difference-computations.html#cb148-62" tabindex="-1"></a><span class="do">### alpha : the margin of error to define confidence interval</span></span>
<span id="cb148-63"><a href="functions-for-difference-in-difference-computations.html#cb148-63" tabindex="-1"></a><span class="do">### load_dir : a path to load matching frame</span></span>
<span id="cb148-64"><a href="functions-for-difference-in-difference-computations.html#cb148-64" tabindex="-1"></a><span class="do">### ext_output : the output extension</span></span>
<span id="cb148-65"><a href="functions-for-difference-in-difference-computations.html#cb148-65" tabindex="-1"></a><span class="do">## OUTPUTS</span></span>
<span id="cb148-66"><a href="functions-for-difference-in-difference-computations.html#cb148-66" tabindex="-1"></a><span class="do">### df_fl_annual_wolf : a dataframe with statistics on annual deforestation in matched treated and control units, computed à la Wolf et al. 2021</span></span>
<span id="cb148-67"><a href="functions-for-difference-in-difference-computations.html#cb148-67" tabindex="-1"></a><span class="do">### is_ok : a boolean indicating whether or not an error occured inside the function </span></span>
<span id="cb148-68"><a href="functions-for-difference-in-difference-computations.html#cb148-68" tabindex="-1"></a>fn_fl_wolf <span class="ot">=</span> <span class="cf">function</span>(iso, wdpaid, alpha, load_dir, ext_input)</span>
<span id="cb148-69"><a href="functions-for-difference-in-difference-computations.html#cb148-69" tabindex="-1"></a>{</span>
<span id="cb148-70"><a href="functions-for-difference-in-difference-computations.html#cb148-70" tabindex="-1"></a>  output <span class="ot">=</span> <span class="fu">tryCatch</span>(</span>
<span id="cb148-71"><a href="functions-for-difference-in-difference-computations.html#cb148-71" tabindex="-1"></a>    </span>
<span id="cb148-72"><a href="functions-for-difference-in-difference-computations.html#cb148-72" tabindex="-1"></a>    {</span>
<span id="cb148-73"><a href="functions-for-difference-in-difference-computations.html#cb148-73" tabindex="-1"></a>      </span>
<span id="cb148-74"><a href="functions-for-difference-in-difference-computations.html#cb148-74" tabindex="-1"></a>  <span class="co">#Import matched units</span></span>
<span id="cb148-75"><a href="functions-for-difference-in-difference-computations.html#cb148-75" tabindex="-1"></a>  df_long <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-76"><a href="functions-for-difference-in-difference-computations.html#cb148-76" tabindex="-1"></a>                           <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;matched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-77"><a href="functions-for-difference-in-difference-computations.html#cb148-77" tabindex="-1"></a>                           <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-78"><a href="functions-for-difference-in-difference-computations.html#cb148-78" tabindex="-1"></a>                           <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-79"><a href="functions-for-difference-in-difference-computations.html#cb148-79" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, res_m, year, var, fc_ha))</span>
<span id="cb148-80"><a href="functions-for-difference-in-difference-computations.html#cb148-80" tabindex="-1"></a>  <span class="co">#select(c(region, country_en, iso3, wdpaid, group, status_yr, year_funding_first, year_funding_all, year, var, fc_ha))</span></span>
<span id="cb148-81"><a href="functions-for-difference-in-difference-computations.html#cb148-81" tabindex="-1"></a>  </span>
<span id="cb148-82"><a href="functions-for-difference-in-difference-computations.html#cb148-82" tabindex="-1"></a>  <span class="do">##Extract country iso</span></span>
<span id="cb148-83"><a href="functions-for-difference-in-difference-computations.html#cb148-83" tabindex="-1"></a>  country.iso <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-84"><a href="functions-for-difference-in-difference-computations.html#cb148-84" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-85"><a href="functions-for-difference-in-difference-computations.html#cb148-85" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-86"><a href="functions-for-difference-in-difference-computations.html#cb148-86" tabindex="-1"></a>  country.iso <span class="ot">=</span> country.iso<span class="sc">$</span>iso3</span>
<span id="cb148-87"><a href="functions-for-difference-in-difference-computations.html#cb148-87" tabindex="-1"></a>  </span>
<span id="cb148-88"><a href="functions-for-difference-in-difference-computations.html#cb148-88" tabindex="-1"></a>  <span class="do">##Extract region name</span></span>
<span id="cb148-89"><a href="functions-for-difference-in-difference-computations.html#cb148-89" tabindex="-1"></a>  region.name <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-90"><a href="functions-for-difference-in-difference-computations.html#cb148-90" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-91"><a href="functions-for-difference-in-difference-computations.html#cb148-91" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-92"><a href="functions-for-difference-in-difference-computations.html#cb148-92" tabindex="-1"></a>  region.name <span class="ot">=</span> region.name<span class="sc">$</span>region</span>
<span id="cb148-93"><a href="functions-for-difference-in-difference-computations.html#cb148-93" tabindex="-1"></a>  </span>
<span id="cb148-94"><a href="functions-for-difference-in-difference-computations.html#cb148-94" tabindex="-1"></a>  <span class="co">#Compute annual deforestation rates à la Wolf et al. 2021 before and after treatment for treated, and for all the period for controls. This is averaged across pixels.</span></span>
<span id="cb148-95"><a href="functions-for-difference-in-difference-computations.html#cb148-95" tabindex="-1"></a>  df_fl_annual_wolf <span class="ot">=</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb148-96"><a href="functions-for-difference-in-difference-computations.html#cb148-96" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">treatment_year =</span> <span class="fu">case_when</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb148-97"><a href="functions-for-difference-in-difference-computations.html#cb148-97" tabindex="-1"></a>                                      group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span>status_yr), <span class="co">#Set treatment year to 0 for control units (required by did::att_gt)</span></span>
<span id="cb148-98"><a href="functions-for-difference-in-difference-computations.html#cb148-98" tabindex="-1"></a>           <span class="at">time =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> year<span class="sc">-</span>treatment_year, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-99"><a href="functions-for-difference-in-difference-computations.html#cb148-99" tabindex="-1"></a>           <span class="at">.after =</span> status_yr) <span class="sc">%&gt;%</span></span>
<span id="cb148-100"><a href="functions-for-difference-in-difference-computations.html#cb148-100" tabindex="-1"></a>    <span class="fu">group_by</span>(assetid) <span class="sc">%&gt;%</span></span>
<span id="cb148-101"><a href="functions-for-difference-in-difference-computations.html#cb148-101" tabindex="-1"></a>    <span class="co"># mutate(FL_2000_cum = (fc_ha-fc_ha[year == 2000])/fc_ha[year == 2000]*100,</span></span>
<span id="cb148-102"><a href="functions-for-difference-in-difference-computations.html#cb148-102" tabindex="-1"></a>    <span class="co">#        fc_2000 = fc_ha[year == 2000]) %&gt;%</span></span>
<span id="cb148-103"><a href="functions-for-difference-in-difference-computations.html#cb148-103" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">FL_annual_wolf_pre =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> ((fc_ha[time <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(year[time <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">2000</span>))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-104"><a href="functions-for-difference-in-difference-computations.html#cb148-104" tabindex="-1"></a>           <span class="at">FL_annual_wolf_post =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> ((fc_ha[time <span class="sc">==</span> <span class="fu">max</span>(time)]<span class="sc">/</span>fc_ha[time <span class="sc">==</span> <span class="dv">0</span>])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">max</span>(time))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-105"><a href="functions-for-difference-in-difference-computations.html#cb148-105" tabindex="-1"></a>           <span class="at">FL_annual_wolf_tot =</span> ((fc_ha[year <span class="sc">==</span> <span class="dv">2021</span>]<span class="sc">/</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>])<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">2021-2000</span>))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-106"><a href="functions-for-difference-in-difference-computations.html#cb148-106" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-107"><a href="functions-for-difference-in-difference-computations.html#cb148-107" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-108"><a href="functions-for-difference-in-difference-computations.html#cb148-108" tabindex="-1"></a>    <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb148-109"><a href="functions-for-difference-in-difference-computations.html#cb148-109" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">avgFL_annual_wolf_pre =</span> <span class="fu">mean</span>(FL_annual_wolf_pre, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-110"><a href="functions-for-difference-in-difference-computations.html#cb148-110" tabindex="-1"></a>              <span class="at">avgFL_annual_wolf_post =</span> <span class="fu">mean</span>(FL_annual_wolf_post, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-111"><a href="functions-for-difference-in-difference-computations.html#cb148-111" tabindex="-1"></a>              <span class="at">avgFL_annual_wolf_tot =</span> <span class="fu">mean</span>(FL_annual_wolf_tot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-112"><a href="functions-for-difference-in-difference-computations.html#cb148-112" tabindex="-1"></a>              <span class="at">medFL_annual_wolf_pre =</span> <span class="fu">median</span>(FL_annual_wolf_pre, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-113"><a href="functions-for-difference-in-difference-computations.html#cb148-113" tabindex="-1"></a>              <span class="at">medFL_annual_wolf_post =</span> <span class="fu">median</span>(FL_annual_wolf_post, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-114"><a href="functions-for-difference-in-difference-computations.html#cb148-114" tabindex="-1"></a>              <span class="at">medFL_annual_wolf_tot =</span> <span class="fu">median</span>(FL_annual_wolf_tot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-115"><a href="functions-for-difference-in-difference-computations.html#cb148-115" tabindex="-1"></a>              <span class="at">sdFL_annual_wolf_pre =</span> <span class="fu">sd</span>(FL_annual_wolf_pre, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-116"><a href="functions-for-difference-in-difference-computations.html#cb148-116" tabindex="-1"></a>              <span class="at">sdFL_annual_wolf_post =</span> <span class="fu">sd</span>(FL_annual_wolf_post, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-117"><a href="functions-for-difference-in-difference-computations.html#cb148-117" tabindex="-1"></a>              <span class="at">sdFL_annual_wolf_tot =</span> <span class="fu">sd</span>(FL_annual_wolf_tot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-118"><a href="functions-for-difference-in-difference-computations.html#cb148-118" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-119"><a href="functions-for-difference-in-difference-computations.html#cb148-119" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> region.name, <span class="at">iso3 =</span> country.iso, <span class="at">wdpaid =</span> wdpaid, <span class="at">.before =</span> <span class="st">&quot;group&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-120"><a href="functions-for-difference-in-difference-computations.html#cb148-120" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Control&quot;</span>,</span>
<span id="cb148-121"><a href="functions-for-difference-in-difference-computations.html#cb148-121" tabindex="-1"></a>                             group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;Treated&quot;</span>))</span>
<span id="cb148-122"><a href="functions-for-difference-in-difference-computations.html#cb148-122" tabindex="-1"></a>  </span>
<span id="cb148-123"><a href="functions-for-difference-in-difference-computations.html#cb148-123" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;df_fl_annual_wolf&quot;</span> <span class="ot">=</span> df_fl_annual_wolf, <span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">TRUE</span>))</span>
<span id="cb148-124"><a href="functions-for-difference-in-difference-computations.html#cb148-124" tabindex="-1"></a>    },</span>
<span id="cb148-125"><a href="functions-for-difference-in-difference-computations.html#cb148-125" tabindex="-1"></a>  </span>
<span id="cb148-126"><a href="functions-for-difference-in-difference-computations.html#cb148-126" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb148-127"><a href="functions-for-difference-in-difference-computations.html#cb148-127" tabindex="-1"></a>  {</span>
<span id="cb148-128"><a href="functions-for-difference-in-difference-computations.html#cb148-128" tabindex="-1"></a>    <span class="fu">print</span>(e)</span>
<span id="cb148-129"><a href="functions-for-difference-in-difference-computations.html#cb148-129" tabindex="-1"></a>    <span class="co">#cat(paste(&quot;Error while computing annual deforestation à la Wolf et al. 2021 :\n&quot;, e, &quot;\n&quot;), file = log, append = TRUE)</span></span>
<span id="cb148-130"><a href="functions-for-difference-in-difference-computations.html#cb148-130" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Error while annual deforestation à la Wolf et al. 2021 :</span><span class="sc">\n</span><span class="st">&quot;</span>, e, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb148-131"><a href="functions-for-difference-in-difference-computations.html#cb148-131" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span>))</span>
<span id="cb148-132"><a href="functions-for-difference-in-difference-computations.html#cb148-132" tabindex="-1"></a>  }</span>
<span id="cb148-133"><a href="functions-for-difference-in-difference-computations.html#cb148-133" tabindex="-1"></a>  </span>
<span id="cb148-134"><a href="functions-for-difference-in-difference-computations.html#cb148-134" tabindex="-1"></a>  )</span>
<span id="cb148-135"><a href="functions-for-difference-in-difference-computations.html#cb148-135" tabindex="-1"></a>}</span>
<span id="cb148-136"><a href="functions-for-difference-in-difference-computations.html#cb148-136" tabindex="-1"></a></span>
<span id="cb148-137"><a href="functions-for-difference-in-difference-computations.html#cb148-137" tabindex="-1"></a><span class="co">#Compute the treatment effect for a given protected area that is supported by the AFD. This function specifically includes information related to funding we obtain from AFD internal services.</span></span>
<span id="cb148-138"><a href="functions-for-difference-in-difference-computations.html#cb148-138" tabindex="-1"></a><span class="do">## INPUTS : </span></span>
<span id="cb148-139"><a href="functions-for-difference-in-difference-computations.html#cb148-139" tabindex="-1"></a><span class="do">### iso : the iso3 code for the country considered</span></span>
<span id="cb148-140"><a href="functions-for-difference-in-difference-computations.html#cb148-140" tabindex="-1"></a><span class="do">### wdpaid : the WDPAID of the PA considered</span></span>
<span id="cb148-141"><a href="functions-for-difference-in-difference-computations.html#cb148-141" tabindex="-1"></a><span class="do">### data_pa : dataset with information on protected areas, and especially their surfaces</span></span>
<span id="cb148-142"><a href="functions-for-difference-in-difference-computations.html#cb148-142" tabindex="-1"></a><span class="do">### data_fund : information on funding from AFD internal datasets, on AFD funded projects related to protected areas.</span></span>
<span id="cb148-143"><a href="functions-for-difference-in-difference-computations.html#cb148-143" tabindex="-1"></a><span class="do">### data_report : list of projects related to protected areas in AFD, reported by technical departments</span></span>
<span id="cb148-144"><a href="functions-for-difference-in-difference-computations.html#cb148-144" tabindex="-1"></a><span class="do">### alpha : the threshold for confidence interval</span></span>
<span id="cb148-145"><a href="functions-for-difference-in-difference-computations.html#cb148-145" tabindex="-1"></a><span class="do">### is_m : boolean stating whether we compute treatment effects from matched (TRUE) or unmatched treated and control units (FALSE)</span></span>
<span id="cb148-146"><a href="functions-for-difference-in-difference-computations.html#cb148-146" tabindex="-1"></a><span class="do">### save_dir : the saving directory in the remote storage</span></span>
<span id="cb148-147"><a href="functions-for-difference-in-difference-computations.html#cb148-147" tabindex="-1"></a><span class="do">### load_dir : the loading directory in the remote storage</span></span>
<span id="cb148-148"><a href="functions-for-difference-in-difference-computations.html#cb148-148" tabindex="-1"></a><span class="do">### ext_input : the extension of input dataframe</span></span>
<span id="cb148-149"><a href="functions-for-difference-in-difference-computations.html#cb148-149" tabindex="-1"></a><span class="do">## OUTPUTS :</span></span>
<span id="cb148-150"><a href="functions-for-difference-in-difference-computations.html#cb148-150" tabindex="-1"></a><span class="do">### df_fc_attgt : treatment effect computed for the protected area considered, expressed in avoided deforestation (hectare)</span></span>
<span id="cb148-151"><a href="functions-for-difference-in-difference-computations.html#cb148-151" tabindex="-1"></a><span class="do">### df_fl_attgt : treatment effect computed for the protected area considered, expressed in change of deforestation rate</span></span>
<span id="cb148-152"><a href="functions-for-difference-in-difference-computations.html#cb148-152" tabindex="-1"></a><span class="do">### is_ok : a boolean indicating whether or not an error occured inside the function </span></span>
<span id="cb148-153"><a href="functions-for-difference-in-difference-computations.html#cb148-153" tabindex="-1"></a><span class="do">## DATA SAVED :</span></span>
<span id="cb148-154"><a href="functions-for-difference-in-difference-computations.html#cb148-154" tabindex="-1"></a><span class="do">### Dynamic treatment effects : avoided deforestation in an average pixel (in ha), avoided deforestation relative to 2000 forest cover, avoided deforestation extrapolated to the entire protected area (in ha), change in deforestation rate (in percentage points)</span></span>
<span id="cb148-155"><a href="functions-for-difference-in-difference-computations.html#cb148-155" tabindex="-1"></a>fn_did_att_afd <span class="ot">=</span> <span class="cf">function</span>(iso, wdpaid, data_pa, data_fund, data_report, alpha, is_m, load_dir, ext_input, save_dir)</span>
<span id="cb148-156"><a href="functions-for-difference-in-difference-computations.html#cb148-156" tabindex="-1"></a>{</span>
<span id="cb148-157"><a href="functions-for-difference-in-difference-computations.html#cb148-157" tabindex="-1"></a>  </span>
<span id="cb148-158"><a href="functions-for-difference-in-difference-computations.html#cb148-158" tabindex="-1"></a>  output <span class="ot">=</span> <span class="fu">tryCatch</span>(</span>
<span id="cb148-159"><a href="functions-for-difference-in-difference-computations.html#cb148-159" tabindex="-1"></a>    </span>
<span id="cb148-160"><a href="functions-for-difference-in-difference-computations.html#cb148-160" tabindex="-1"></a>    {</span>
<span id="cb148-161"><a href="functions-for-difference-in-difference-computations.html#cb148-161" tabindex="-1"></a>      </span>
<span id="cb148-162"><a href="functions-for-difference-in-difference-computations.html#cb148-162" tabindex="-1"></a>  <span class="co">#Loading matched and unmatched datasets</span></span>
<span id="cb148-163"><a href="functions-for-difference-in-difference-computations.html#cb148-163" tabindex="-1"></a>  df_long_m <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-164"><a href="functions-for-difference-in-difference-computations.html#cb148-164" tabindex="-1"></a>                           <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;matched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-165"><a href="functions-for-difference-in-difference-computations.html#cb148-165" tabindex="-1"></a>                           <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-166"><a href="functions-for-difference-in-difference-computations.html#cb148-166" tabindex="-1"></a>                           <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-167"><a href="functions-for-difference-in-difference-computations.html#cb148-167" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, res_m, year, var, fc_ha))</span>
<span id="cb148-168"><a href="functions-for-difference-in-difference-computations.html#cb148-168" tabindex="-1"></a>  <span class="co">#dplyr::select(c(region, country_en, iso3, wdpaid, group, status_yr, year_funding_first, year_funding_all, year, var, fc_ha))</span></span>
<span id="cb148-169"><a href="functions-for-difference-in-difference-computations.html#cb148-169" tabindex="-1"></a>  </span>
<span id="cb148-170"><a href="functions-for-difference-in-difference-computations.html#cb148-170" tabindex="-1"></a>  df_long_unm <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-171"><a href="functions-for-difference-in-difference-computations.html#cb148-171" tabindex="-1"></a>                             <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;unmatched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-172"><a href="functions-for-difference-in-difference-computations.html#cb148-172" tabindex="-1"></a>                             <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-173"><a href="functions-for-difference-in-difference-computations.html#cb148-173" tabindex="-1"></a>                             <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-174"><a href="functions-for-difference-in-difference-computations.html#cb148-174" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, year, res_m, var, fc_ha))</span>
<span id="cb148-175"><a href="functions-for-difference-in-difference-computations.html#cb148-175" tabindex="-1"></a>  <span class="co">#dplyr::select(c(region, country_en, iso3, wdpaid, group, status_yr, year_funding_first, year_funding_all, year, var, fc_ha))</span></span>
<span id="cb148-176"><a href="functions-for-difference-in-difference-computations.html#cb148-176" tabindex="-1"></a>  </span>
<span id="cb148-177"><a href="functions-for-difference-in-difference-computations.html#cb148-177" tabindex="-1"></a>  <span class="co"># Define the working datasets depending on the is_m value</span></span>
<span id="cb148-178"><a href="functions-for-difference-in-difference-computations.html#cb148-178" tabindex="-1"></a>  <span class="cf">if</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-179"><a href="functions-for-difference-in-difference-computations.html#cb148-179" tabindex="-1"></a>  {</span>
<span id="cb148-180"><a href="functions-for-difference-in-difference-computations.html#cb148-180" tabindex="-1"></a>    df_long <span class="ot">=</span> df_long_m</span>
<span id="cb148-181"><a href="functions-for-difference-in-difference-computations.html#cb148-181" tabindex="-1"></a>  } <span class="cf">else</span>{df_long <span class="ot">=</span> df_long_unm </span>
<span id="cb148-182"><a href="functions-for-difference-in-difference-computations.html#cb148-182" tabindex="-1"></a>  }</span>
<span id="cb148-183"><a href="functions-for-difference-in-difference-computations.html#cb148-183" tabindex="-1"></a>  </span>
<span id="cb148-184"><a href="functions-for-difference-in-difference-computations.html#cb148-184" tabindex="-1"></a>  <span class="co">#Extract some relevant variables for later plots and treatment effect computations</span></span>
<span id="cb148-185"><a href="functions-for-difference-in-difference-computations.html#cb148-185" tabindex="-1"></a>  <span class="do">##Extract spatial resolution of pixels res_m and define pixel area in ha</span></span>
<span id="cb148-186"><a href="functions-for-difference-in-difference-computations.html#cb148-186" tabindex="-1"></a>  res_m <span class="ot">=</span> <span class="fu">unique</span>(df_long<span class="sc">$</span>res_m)</span>
<span id="cb148-187"><a href="functions-for-difference-in-difference-computations.html#cb148-187" tabindex="-1"></a>  res_ha <span class="ot">=</span> res_m<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fl">1e-4</span></span>
<span id="cb148-188"><a href="functions-for-difference-in-difference-computations.html#cb148-188" tabindex="-1"></a>  </span>
<span id="cb148-189"><a href="functions-for-difference-in-difference-computations.html#cb148-189" tabindex="-1"></a>  <span class="do">##Extract treatment year</span></span>
<span id="cb148-190"><a href="functions-for-difference-in-difference-computations.html#cb148-190" tabindex="-1"></a>  treatment.year <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-191"><a href="functions-for-difference-in-difference-computations.html#cb148-191" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-192"><a href="functions-for-difference-in-difference-computations.html#cb148-192" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-193"><a href="functions-for-difference-in-difference-computations.html#cb148-193" tabindex="-1"></a>  treatment.year <span class="ot">=</span> treatment.year<span class="sc">$</span>status_yr</span>
<span id="cb148-194"><a href="functions-for-difference-in-difference-computations.html#cb148-194" tabindex="-1"></a>  </span>
<span id="cb148-195"><a href="functions-for-difference-in-difference-computations.html#cb148-195" tabindex="-1"></a>  <span class="do">##Extract funding years</span></span>
<span id="cb148-196"><a href="functions-for-difference-in-difference-computations.html#cb148-196" tabindex="-1"></a>  df_fund_yr <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-197"><a href="functions-for-difference-in-difference-computations.html#cb148-197" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-198"><a href="functions-for-difference-in-difference-computations.html#cb148-198" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-199"><a href="functions-for-difference-in-difference-computations.html#cb148-199" tabindex="-1"></a>  funding.years <span class="ot">=</span> df_fund_yr<span class="sc">$</span>year_funding_first</span>
<span id="cb148-200"><a href="functions-for-difference-in-difference-computations.html#cb148-200" tabindex="-1"></a>  list.funding.years <span class="ot">=</span> df_fund_yr<span class="sc">$</span>year_funding_all</span>
<span id="cb148-201"><a href="functions-for-difference-in-difference-computations.html#cb148-201" tabindex="-1"></a>  </span>
<span id="cb148-202"><a href="functions-for-difference-in-difference-computations.html#cb148-202" tabindex="-1"></a>  <span class="do">##Extract country name</span></span>
<span id="cb148-203"><a href="functions-for-difference-in-difference-computations.html#cb148-203" tabindex="-1"></a>  <span class="co"># country.name = df_long %&gt;% </span></span>
<span id="cb148-204"><a href="functions-for-difference-in-difference-computations.html#cb148-204" tabindex="-1"></a>  <span class="co">#   filter(group == 2) %&gt;% </span></span>
<span id="cb148-205"><a href="functions-for-difference-in-difference-computations.html#cb148-205" tabindex="-1"></a>  <span class="co">#   slice(1)</span></span>
<span id="cb148-206"><a href="functions-for-difference-in-difference-computations.html#cb148-206" tabindex="-1"></a>  <span class="co"># country.name = country.name$country_en</span></span>
<span id="cb148-207"><a href="functions-for-difference-in-difference-computations.html#cb148-207" tabindex="-1"></a>  </span>
<span id="cb148-208"><a href="functions-for-difference-in-difference-computations.html#cb148-208" tabindex="-1"></a>  <span class="do">##Extract country iso</span></span>
<span id="cb148-209"><a href="functions-for-difference-in-difference-computations.html#cb148-209" tabindex="-1"></a>  country.iso <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-210"><a href="functions-for-difference-in-difference-computations.html#cb148-210" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-211"><a href="functions-for-difference-in-difference-computations.html#cb148-211" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-212"><a href="functions-for-difference-in-difference-computations.html#cb148-212" tabindex="-1"></a>  country.iso <span class="ot">=</span> country.iso<span class="sc">$</span>iso3</span>
<span id="cb148-213"><a href="functions-for-difference-in-difference-computations.html#cb148-213" tabindex="-1"></a>  </span>
<span id="cb148-214"><a href="functions-for-difference-in-difference-computations.html#cb148-214" tabindex="-1"></a>  <span class="do">##Extract region name</span></span>
<span id="cb148-215"><a href="functions-for-difference-in-difference-computations.html#cb148-215" tabindex="-1"></a>  region.name <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-216"><a href="functions-for-difference-in-difference-computations.html#cb148-216" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-217"><a href="functions-for-difference-in-difference-computations.html#cb148-217" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-218"><a href="functions-for-difference-in-difference-computations.html#cb148-218" tabindex="-1"></a>  region.name <span class="ot">=</span> region.name<span class="sc">$</span>region</span>
<span id="cb148-219"><a href="functions-for-difference-in-difference-computations.html#cb148-219" tabindex="-1"></a>  </span>
<span id="cb148-220"><a href="functions-for-difference-in-difference-computations.html#cb148-220" tabindex="-1"></a>  <span class="do">##Extract more information not in the matched dataframe</span></span>
<span id="cb148-221"><a href="functions-for-difference-in-difference-computations.html#cb148-221" tabindex="-1"></a>  <span class="do">### Area</span></span>
<span id="cb148-222"><a href="functions-for-difference-in-difference-computations.html#cb148-222" tabindex="-1"></a>  wdpa_id <span class="ot">=</span> wdpaid <span class="co">#Need to give a name to wdpaid (function argument) different from the varaible in the dataset (wdpaid)</span></span>
<span id="cb148-223"><a href="functions-for-difference-in-difference-computations.html#cb148-223" tabindex="-1"></a>  area_ha <span class="ot">=</span> data_pa[data_pa<span class="sc">$</span>wdpaid <span class="sc">==</span> wdpa_id,]<span class="sc">$</span>area_km2<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb148-224"><a href="functions-for-difference-in-difference-computations.html#cb148-224" tabindex="-1"></a>  <span class="do">### Name of the PA</span></span>
<span id="cb148-225"><a href="functions-for-difference-in-difference-computations.html#cb148-225" tabindex="-1"></a>  pa.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-226"><a href="functions-for-difference-in-difference-computations.html#cb148-226" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-227"><a href="functions-for-difference-in-difference-computations.html#cb148-227" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-228"><a href="functions-for-difference-in-difference-computations.html#cb148-228" tabindex="-1"></a>  pa.name <span class="ot">=</span> pa.name<span class="sc">$</span>name_pa</span>
<span id="cb148-229"><a href="functions-for-difference-in-difference-computations.html#cb148-229" tabindex="-1"></a>  <span class="do">### Country name</span></span>
<span id="cb148-230"><a href="functions-for-difference-in-difference-computations.html#cb148-230" tabindex="-1"></a>  country.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-231"><a href="functions-for-difference-in-difference-computations.html#cb148-231" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-232"><a href="functions-for-difference-in-difference-computations.html#cb148-232" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-233"><a href="functions-for-difference-in-difference-computations.html#cb148-233" tabindex="-1"></a>  country.name <span class="ot">=</span> country.name<span class="sc">$</span>country_en</span>
<span id="cb148-234"><a href="functions-for-difference-in-difference-computations.html#cb148-234" tabindex="-1"></a>  <span class="do">### AFD project ID</span></span>
<span id="cb148-235"><a href="functions-for-difference-in-difference-computations.html#cb148-235" tabindex="-1"></a>  <span class="co"># id.project = data_pa %&gt;% </span></span>
<span id="cb148-236"><a href="functions-for-difference-in-difference-computations.html#cb148-236" tabindex="-1"></a>  <span class="co">#   filter(wdpaid == wdpa_id) %&gt;% </span></span>
<span id="cb148-237"><a href="functions-for-difference-in-difference-computations.html#cb148-237" tabindex="-1"></a>  <span class="co">#   slice(1)</span></span>
<span id="cb148-238"><a href="functions-for-difference-in-difference-computations.html#cb148-238" tabindex="-1"></a>  <span class="co"># id.project = id.project$id_projet</span></span>
<span id="cb148-239"><a href="functions-for-difference-in-difference-computations.html#cb148-239" tabindex="-1"></a>  <span class="do">### WDPA status</span></span>
<span id="cb148-240"><a href="functions-for-difference-in-difference-computations.html#cb148-240" tabindex="-1"></a>  status.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-241"><a href="functions-for-difference-in-difference-computations.html#cb148-241" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-242"><a href="functions-for-difference-in-difference-computations.html#cb148-242" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-243"><a href="functions-for-difference-in-difference-computations.html#cb148-243" tabindex="-1"></a>  status.wdpa <span class="ot">=</span> status.wdpa<span class="sc">$</span>status</span>
<span id="cb148-244"><a href="functions-for-difference-in-difference-computations.html#cb148-244" tabindex="-1"></a>  <span class="do">### IUCN category and description</span></span>
<span id="cb148-245"><a href="functions-for-difference-in-difference-computations.html#cb148-245" tabindex="-1"></a>  iucn.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-246"><a href="functions-for-difference-in-difference-computations.html#cb148-246" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-247"><a href="functions-for-difference-in-difference-computations.html#cb148-247" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-248"><a href="functions-for-difference-in-difference-computations.html#cb148-248" tabindex="-1"></a>  iucn.cat <span class="ot">=</span> iucn.wdpa<span class="sc">$</span>iucn_cat</span>
<span id="cb148-249"><a href="functions-for-difference-in-difference-computations.html#cb148-249" tabindex="-1"></a>  iucn.des <span class="ot">=</span> iucn.wdpa<span class="sc">$</span>iucn_des_en</span>
<span id="cb148-250"><a href="functions-for-difference-in-difference-computations.html#cb148-250" tabindex="-1"></a>  <span class="do">### Ecosystem</span></span>
<span id="cb148-251"><a href="functions-for-difference-in-difference-computations.html#cb148-251" tabindex="-1"></a>  eco.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-252"><a href="functions-for-difference-in-difference-computations.html#cb148-252" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-253"><a href="functions-for-difference-in-difference-computations.html#cb148-253" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-254"><a href="functions-for-difference-in-difference-computations.html#cb148-254" tabindex="-1"></a>  eco.wdpa <span class="ot">=</span> eco.wdpa<span class="sc">$</span>marine</span>
<span id="cb148-255"><a href="functions-for-difference-in-difference-computations.html#cb148-255" tabindex="-1"></a>  <span class="do">### Governance</span></span>
<span id="cb148-256"><a href="functions-for-difference-in-difference-computations.html#cb148-256" tabindex="-1"></a>  gov.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-257"><a href="functions-for-difference-in-difference-computations.html#cb148-257" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-258"><a href="functions-for-difference-in-difference-computations.html#cb148-258" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-259"><a href="functions-for-difference-in-difference-computations.html#cb148-259" tabindex="-1"></a>  gov.wdpa <span class="ot">=</span> gov.wdpa<span class="sc">$</span>gov_type</span>
<span id="cb148-260"><a href="functions-for-difference-in-difference-computations.html#cb148-260" tabindex="-1"></a>  <span class="do">### Owner</span></span>
<span id="cb148-261"><a href="functions-for-difference-in-difference-computations.html#cb148-261" tabindex="-1"></a>  own.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-262"><a href="functions-for-difference-in-difference-computations.html#cb148-262" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-263"><a href="functions-for-difference-in-difference-computations.html#cb148-263" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-264"><a href="functions-for-difference-in-difference-computations.html#cb148-264" tabindex="-1"></a>  own.wdpa <span class="ot">=</span> own.wdpa<span class="sc">$</span>own_type</span>
<span id="cb148-265"><a href="functions-for-difference-in-difference-computations.html#cb148-265" tabindex="-1"></a>  </span>
<span id="cb148-266"><a href="functions-for-difference-in-difference-computations.html#cb148-266" tabindex="-1"></a>  <span class="do">## Extract information on funding</span></span>
<span id="cb148-267"><a href="functions-for-difference-in-difference-computations.html#cb148-267" tabindex="-1"></a>  <span class="do">### Type of funding</span></span>
<span id="cb148-268"><a href="functions-for-difference-in-difference-computations.html#cb148-268" tabindex="-1"></a>  fund.type <span class="ot">=</span> data_fund <span class="sc">%&gt;%</span></span>
<span id="cb148-269"><a href="functions-for-difference-in-difference-computations.html#cb148-269" tabindex="-1"></a>    <span class="fu">filter</span>(id_projet <span class="sc">==</span> id.project) <span class="sc">%&gt;%</span></span>
<span id="cb148-270"><a href="functions-for-difference-in-difference-computations.html#cb148-270" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-271"><a href="functions-for-difference-in-difference-computations.html#cb148-271" tabindex="-1"></a>  fund.type <span class="ot">=</span> fund.type<span class="sc">$</span>libelle_produit</span>
<span id="cb148-272"><a href="functions-for-difference-in-difference-computations.html#cb148-272" tabindex="-1"></a>  <span class="do">### Cofunders</span></span>
<span id="cb148-273"><a href="functions-for-difference-in-difference-computations.html#cb148-273" tabindex="-1"></a>  cofund <span class="ot">=</span> data_fund <span class="sc">%&gt;%</span></span>
<span id="cb148-274"><a href="functions-for-difference-in-difference-computations.html#cb148-274" tabindex="-1"></a>    <span class="fu">filter</span>(id_projet <span class="sc">==</span> id.project) <span class="sc">%&gt;%</span></span>
<span id="cb148-275"><a href="functions-for-difference-in-difference-computations.html#cb148-275" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-276"><a href="functions-for-difference-in-difference-computations.html#cb148-276" tabindex="-1"></a>  cofund <span class="ot">=</span> cofund<span class="sc">$</span>cofinanciers</span>
<span id="cb148-277"><a href="functions-for-difference-in-difference-computations.html#cb148-277" tabindex="-1"></a>  <span class="do">### KfW ?</span></span>
<span id="cb148-278"><a href="functions-for-difference-in-difference-computations.html#cb148-278" tabindex="-1"></a>  kfw <span class="ot">=</span> data_fund <span class="sc">%&gt;%</span></span>
<span id="cb148-279"><a href="functions-for-difference-in-difference-computations.html#cb148-279" tabindex="-1"></a>    <span class="fu">filter</span>(id_projet <span class="sc">==</span> id.project) <span class="sc">%&gt;%</span></span>
<span id="cb148-280"><a href="functions-for-difference-in-difference-computations.html#cb148-280" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-281"><a href="functions-for-difference-in-difference-computations.html#cb148-281" tabindex="-1"></a>  kfw <span class="ot">=</span> kfw<span class="sc">$</span>kfw</span>
<span id="cb148-282"><a href="functions-for-difference-in-difference-computations.html#cb148-282" tabindex="-1"></a>  <span class="do">### FFEM ?</span></span>
<span id="cb148-283"><a href="functions-for-difference-in-difference-computations.html#cb148-283" tabindex="-1"></a>  ffem <span class="ot">=</span> data_fund <span class="sc">%&gt;%</span></span>
<span id="cb148-284"><a href="functions-for-difference-in-difference-computations.html#cb148-284" tabindex="-1"></a>    <span class="fu">filter</span>(id_projet <span class="sc">==</span> id.project) <span class="sc">%&gt;%</span></span>
<span id="cb148-285"><a href="functions-for-difference-in-difference-computations.html#cb148-285" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-286"><a href="functions-for-difference-in-difference-computations.html#cb148-286" tabindex="-1"></a>  ffem <span class="ot">=</span> ffem<span class="sc">$</span>ffem</span>
<span id="cb148-287"><a href="functions-for-difference-in-difference-computations.html#cb148-287" tabindex="-1"></a></span>
<span id="cb148-288"><a href="functions-for-difference-in-difference-computations.html#cb148-288" tabindex="-1"></a>  <span class="do">## Extract reporting department</span></span>
<span id="cb148-289"><a href="functions-for-difference-in-difference-computations.html#cb148-289" tabindex="-1"></a>  reporter <span class="ot">=</span> data_report <span class="sc">%&gt;%</span></span>
<span id="cb148-290"><a href="functions-for-difference-in-difference-computations.html#cb148-290" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id <span class="sc">&amp;</span> id_projet <span class="sc">==</span> id.project <span class="sc">&amp;</span> nom_ap <span class="sc">==</span> pa.name) <span class="sc">%&gt;%</span></span>
<span id="cb148-291"><a href="functions-for-difference-in-difference-computations.html#cb148-291" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-292"><a href="functions-for-difference-in-difference-computations.html#cb148-292" tabindex="-1"></a>  reporter <span class="ot">=</span> reporter<span class="sc">$</span>auteur_entree</span>
<span id="cb148-293"><a href="functions-for-difference-in-difference-computations.html#cb148-293" tabindex="-1"></a>  </span>
<span id="cb148-294"><a href="functions-for-difference-in-difference-computations.html#cb148-294" tabindex="-1"></a>  <span class="co">#Extract number of pixels in the PA</span></span>
<span id="cb148-295"><a href="functions-for-difference-in-difference-computations.html#cb148-295" tabindex="-1"></a>  <span class="co">#n_pix_pa = length(unique(filter(df_long_unm, group == 2)$assetid))</span></span>
<span id="cb148-296"><a href="functions-for-difference-in-difference-computations.html#cb148-296" tabindex="-1"></a>  n_pix_pa <span class="ot">=</span> area_ha<span class="sc">/</span>res_ha</span>
<span id="cb148-297"><a href="functions-for-difference-in-difference-computations.html#cb148-297" tabindex="-1"></a>  </span>
<span id="cb148-298"><a href="functions-for-difference-in-difference-computations.html#cb148-298" tabindex="-1"></a>  <span class="co">#Average forest cover in a treated pixel in 2000</span></span>
<span id="cb148-299"><a href="functions-for-difference-in-difference-computations.html#cb148-299" tabindex="-1"></a>  <span class="do">## For matched </span></span>
<span id="cb148-300"><a href="functions-for-difference-in-difference-computations.html#cb148-300" tabindex="-1"></a>  avgFC_2000_m <span class="ot">=</span> df_long_m <span class="sc">%&gt;%</span> </span>
<span id="cb148-301"><a href="functions-for-difference-in-difference-computations.html#cb148-301" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2000</span>) </span>
<span id="cb148-302"><a href="functions-for-difference-in-difference-computations.html#cb148-302" tabindex="-1"></a>  avgFC_2000_m <span class="ot">=</span> <span class="fu">mean</span>(avgFC_2000_m<span class="sc">$</span>fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-303"><a href="functions-for-difference-in-difference-computations.html#cb148-303" tabindex="-1"></a>  <span class="do">## For unmatched</span></span>
<span id="cb148-304"><a href="functions-for-difference-in-difference-computations.html#cb148-304" tabindex="-1"></a>  avgFC_2000_unm <span class="ot">=</span> df_long_unm <span class="sc">%&gt;%</span> </span>
<span id="cb148-305"><a href="functions-for-difference-in-difference-computations.html#cb148-305" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2000</span>) </span>
<span id="cb148-306"><a href="functions-for-difference-in-difference-computations.html#cb148-306" tabindex="-1"></a>  avgFC_2000_unm <span class="ot">=</span> <span class="fu">mean</span>(avgFC_2000_unm<span class="sc">$</span>fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-307"><a href="functions-for-difference-in-difference-computations.html#cb148-307" tabindex="-1"></a>  </span>
<span id="cb148-308"><a href="functions-for-difference-in-difference-computations.html#cb148-308" tabindex="-1"></a>  <span class="co">#Then modify the dataframe before difference-in-difference computations</span></span>
<span id="cb148-309"><a href="functions-for-difference-in-difference-computations.html#cb148-309" tabindex="-1"></a>  <span class="do">## Set treatment year = 0 for controls (necessary for did package to consider &quot;never treated&quot; units)</span></span>
<span id="cb148-310"><a href="functions-for-difference-in-difference-computations.html#cb148-310" tabindex="-1"></a>  <span class="do">## Compute cumulative deforestation relative to 2000 forest cover (outcome where TE is computed)</span></span>
<span id="cb148-311"><a href="functions-for-difference-in-difference-computations.html#cb148-311" tabindex="-1"></a>  df_did <span class="ot">=</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb148-312"><a href="functions-for-difference-in-difference-computations.html#cb148-312" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">treatment_year =</span> <span class="fu">case_when</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb148-313"><a href="functions-for-difference-in-difference-computations.html#cb148-313" tabindex="-1"></a>                                      group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span>status_yr), <span class="co">#Set treatment year to 0 for control units (required by did::att_gt)</span></span>
<span id="cb148-314"><a href="functions-for-difference-in-difference-computations.html#cb148-314" tabindex="-1"></a>           <span class="at">time =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> year<span class="sc">-</span>treatment_year, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-315"><a href="functions-for-difference-in-difference-computations.html#cb148-315" tabindex="-1"></a>           <span class="at">.after =</span> status_yr) <span class="sc">%&gt;%</span></span>
<span id="cb148-316"><a href="functions-for-difference-in-difference-computations.html#cb148-316" tabindex="-1"></a>    <span class="fu">group_by</span>(assetid) <span class="sc">%&gt;%</span></span>
<span id="cb148-317"><a href="functions-for-difference-in-difference-computations.html#cb148-317" tabindex="-1"></a>    <span class="co"># mutate(FL_2000_cum = (fc_ha-fc_ha[year == 2000])/fc_ha[year == 2000]*100,</span></span>
<span id="cb148-318"><a href="functions-for-difference-in-difference-computations.html#cb148-318" tabindex="-1"></a>    <span class="co">#        fc_2000 = fc_ha[year == 2000]) %&gt;%</span></span>
<span id="cb148-319"><a href="functions-for-difference-in-difference-computations.html#cb148-319" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">FL_2000_cum =</span> <span class="fu">case_when</span>(fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> (fc_ha<span class="sc">-</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>])<span class="sc">/</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>]<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb148-320"><a href="functions-for-difference-in-difference-computations.html#cb148-320" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-321"><a href="functions-for-difference-in-difference-computations.html#cb148-321" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-322"><a href="functions-for-difference-in-difference-computations.html#cb148-322" tabindex="-1"></a>  </span>
<span id="cb148-323"><a href="functions-for-difference-in-difference-computations.html#cb148-323" tabindex="-1"></a></span>
<span id="cb148-324"><a href="functions-for-difference-in-difference-computations.html#cb148-324" tabindex="-1"></a>  <span class="do">##Average forest cover in 2000 in a pixel, and average share of forest cover in a pixel</span></span>
<span id="cb148-325"><a href="functions-for-difference-in-difference-computations.html#cb148-325" tabindex="-1"></a>  <span class="co"># fc_2000_avg = mean(df_did[df_did$group == 2,]$fc_2000, na.rm = TRUE)</span></span>
<span id="cb148-326"><a href="functions-for-difference-in-difference-computations.html#cb148-326" tabindex="-1"></a>  <span class="co"># per_fc_2000_avg = min(fc_2000_avg/res_ha, 1) #Take the min as in some cases, reported forest cover is higher than pixel area</span></span>
<span id="cb148-327"><a href="functions-for-difference-in-difference-computations.html#cb148-327" tabindex="-1"></a>  </span>
<span id="cb148-328"><a href="functions-for-difference-in-difference-computations.html#cb148-328" tabindex="-1"></a>  <span class="co">#Compute dynamic treatment effect with did package. </span></span>
<span id="cb148-329"><a href="functions-for-difference-in-difference-computations.html#cb148-329" tabindex="-1"></a>  <span class="do">## Control are &quot;never treated&quot; units, no covariate is added in the regression estimated with doubly-robust method</span></span>
<span id="cb148-330"><a href="functions-for-difference-in-difference-computations.html#cb148-330" tabindex="-1"></a>  <span class="do">## standard errors are computed with bootstrap, and confidence intervals computed from it.</span></span>
<span id="cb148-331"><a href="functions-for-difference-in-difference-computations.html#cb148-331" tabindex="-1"></a>  <span class="do">## No clustering is performed as it does not seem relevant in our case (https://blogs.worldbank.org/impactevaluations/when-should-you-cluster-standard-errors-new-wisdom-econometrics-oracle)</span></span>
<span id="cb148-332"><a href="functions-for-difference-in-difference-computations.html#cb148-332" tabindex="-1"></a>  <span class="do">## Pseudo treatment effects are computed for each pre-treatment year (varying base period)</span></span>
<span id="cb148-333"><a href="functions-for-difference-in-difference-computations.html#cb148-333" tabindex="-1"></a>  </span>
<span id="cb148-334"><a href="functions-for-difference-in-difference-computations.html#cb148-334" tabindex="-1"></a>  <span class="do">##For forest cover (ha and %)</span></span>
<span id="cb148-335"><a href="functions-for-difference-in-difference-computations.html#cb148-335" tabindex="-1"></a>  <span class="do">### treatment effect computation</span></span>
<span id="cb148-336"><a href="functions-for-difference-in-difference-computations.html#cb148-336" tabindex="-1"></a>  fc_attgt <span class="ot">=</span> did<span class="sc">::</span><span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">&quot;fc_ha&quot;</span>,</span>
<span id="cb148-337"><a href="functions-for-difference-in-difference-computations.html#cb148-337" tabindex="-1"></a>                         <span class="at">gname =</span> <span class="st">&quot;treatment_year&quot;</span>,</span>
<span id="cb148-338"><a href="functions-for-difference-in-difference-computations.html#cb148-338" tabindex="-1"></a>                         <span class="at">idname =</span> <span class="st">&quot;assetid&quot;</span>,</span>
<span id="cb148-339"><a href="functions-for-difference-in-difference-computations.html#cb148-339" tabindex="-1"></a>                         <span class="at">tname =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb148-340"><a href="functions-for-difference-in-difference-computations.html#cb148-340" tabindex="-1"></a>                         <span class="at">control_group =</span> <span class="st">&quot;nevertreated&quot;</span>, <span class="co">#Thsi corresponds to control pixels as defined in the matching , with treatment year set to 0</span></span>
<span id="cb148-341"><a href="functions-for-difference-in-difference-computations.html#cb148-341" tabindex="-1"></a>                         <span class="at">xformla =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb148-342"><a href="functions-for-difference-in-difference-computations.html#cb148-342" tabindex="-1"></a>                         <span class="at">alp =</span> alpha, <span class="co">#For 95% confidence interval</span></span>
<span id="cb148-343"><a href="functions-for-difference-in-difference-computations.html#cb148-343" tabindex="-1"></a>                         <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>, <span class="co">#Ensure no unit is dropped, though every pixel should have data for all years in the period</span></span>
<span id="cb148-344"><a href="functions-for-difference-in-difference-computations.html#cb148-344" tabindex="-1"></a>                         <span class="at">bstrap=</span><span class="cn">TRUE</span>, <span class="co">#Compute bootstrap CI</span></span>
<span id="cb148-345"><a href="functions-for-difference-in-difference-computations.html#cb148-345" tabindex="-1"></a>                         <span class="at">biters =</span> <span class="dv">1000</span>, <span class="co">#The number of bootstrap iteration, 1000 is default</span></span>
<span id="cb148-346"><a href="functions-for-difference-in-difference-computations.html#cb148-346" tabindex="-1"></a>                         <span class="at">cband =</span> <span class="cn">TRUE</span>, <span class="co">#Compute CI</span></span>
<span id="cb148-347"><a href="functions-for-difference-in-difference-computations.html#cb148-347" tabindex="-1"></a>                         <span class="at">clustervars =</span> <span class="cn">NULL</span>, <span class="co">#No clustering seems relevant to me </span></span>
<span id="cb148-348"><a href="functions-for-difference-in-difference-computations.html#cb148-348" tabindex="-1"></a>                         <span class="at">base_period =</span> <span class="st">&quot;varying&quot;</span>,</span>
<span id="cb148-349"><a href="functions-for-difference-in-difference-computations.html#cb148-349" tabindex="-1"></a>                         <span class="at">data =</span> df_did,</span>
<span id="cb148-350"><a href="functions-for-difference-in-difference-computations.html#cb148-350" tabindex="-1"></a>                         <span class="at">print_details =</span> F)</span>
<span id="cb148-351"><a href="functions-for-difference-in-difference-computations.html#cb148-351" tabindex="-1"></a>  <span class="do">##For change in deforestation rate (percentage points)</span></span>
<span id="cb148-352"><a href="functions-for-difference-in-difference-computations.html#cb148-352" tabindex="-1"></a>  <span class="do">### treatment effect computation</span></span>
<span id="cb148-353"><a href="functions-for-difference-in-difference-computations.html#cb148-353" tabindex="-1"></a>  fl_attgt <span class="ot">=</span> did<span class="sc">::</span><span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">&quot;FL_2000_cum&quot;</span>,</span>
<span id="cb148-354"><a href="functions-for-difference-in-difference-computations.html#cb148-354" tabindex="-1"></a>                         <span class="at">gname =</span> <span class="st">&quot;treatment_year&quot;</span>,</span>
<span id="cb148-355"><a href="functions-for-difference-in-difference-computations.html#cb148-355" tabindex="-1"></a>                         <span class="at">idname =</span> <span class="st">&quot;assetid&quot;</span>,</span>
<span id="cb148-356"><a href="functions-for-difference-in-difference-computations.html#cb148-356" tabindex="-1"></a>                         <span class="at">tname =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb148-357"><a href="functions-for-difference-in-difference-computations.html#cb148-357" tabindex="-1"></a>                         <span class="at">control_group =</span> <span class="st">&quot;nevertreated&quot;</span>, <span class="co">#Thsi corresponds to control pixels as defined in the matching , with treatment year set to 0</span></span>
<span id="cb148-358"><a href="functions-for-difference-in-difference-computations.html#cb148-358" tabindex="-1"></a>                         <span class="at">xformla =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb148-359"><a href="functions-for-difference-in-difference-computations.html#cb148-359" tabindex="-1"></a>                         <span class="at">alp =</span> alpha, <span class="co">#For 95% confidence interval</span></span>
<span id="cb148-360"><a href="functions-for-difference-in-difference-computations.html#cb148-360" tabindex="-1"></a>                         <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>, <span class="co">#Ensure no unit is dropped, though every pixel should have data for all years in the period</span></span>
<span id="cb148-361"><a href="functions-for-difference-in-difference-computations.html#cb148-361" tabindex="-1"></a>                         <span class="at">bstrap=</span><span class="cn">TRUE</span>, <span class="co">#Compute bootstrap CI</span></span>
<span id="cb148-362"><a href="functions-for-difference-in-difference-computations.html#cb148-362" tabindex="-1"></a>                         <span class="at">biters =</span> <span class="dv">1000</span>, <span class="co">#The number of bootstrap iteration, 1000 is default</span></span>
<span id="cb148-363"><a href="functions-for-difference-in-difference-computations.html#cb148-363" tabindex="-1"></a>                         <span class="at">cband =</span> <span class="cn">TRUE</span>, <span class="co">#Compute CI</span></span>
<span id="cb148-364"><a href="functions-for-difference-in-difference-computations.html#cb148-364" tabindex="-1"></a>                         <span class="at">clustervars =</span> <span class="cn">NULL</span>, <span class="co">#No clustering seems relevant to me</span></span>
<span id="cb148-365"><a href="functions-for-difference-in-difference-computations.html#cb148-365" tabindex="-1"></a>                         <span class="at">base_period =</span> <span class="st">&quot;varying&quot;</span>,</span>
<span id="cb148-366"><a href="functions-for-difference-in-difference-computations.html#cb148-366" tabindex="-1"></a>                         <span class="at">data =</span> df_did,</span>
<span id="cb148-367"><a href="functions-for-difference-in-difference-computations.html#cb148-367" tabindex="-1"></a>                         <span class="at">print_details =</span> F)</span>
<span id="cb148-368"><a href="functions-for-difference-in-difference-computations.html#cb148-368" tabindex="-1"></a>  </span>
<span id="cb148-369"><a href="functions-for-difference-in-difference-computations.html#cb148-369" tabindex="-1"></a>  </span>
<span id="cb148-370"><a href="functions-for-difference-in-difference-computations.html#cb148-370" tabindex="-1"></a>  <span class="do">### Report results in a dataframe</span></span>
<span id="cb148-371"><a href="functions-for-difference-in-difference-computations.html#cb148-371" tabindex="-1"></a>  <span class="do">### The computed is at pixel level</span></span>
<span id="cb148-372"><a href="functions-for-difference-in-difference-computations.html#cb148-372" tabindex="-1"></a>  <span class="do">### This treatment effect is aggregated to protected area by multiplying treatment effect by the number of pixel in the PA. It is also expressed in percentage of pixel area (avoided deforestation in share of pixel area)</span></span>
<span id="cb148-373"><a href="functions-for-difference-in-difference-computations.html#cb148-373" tabindex="-1"></a>  <span class="do">### confidence intervals (at pixel level) are computed from bootstrap standard errors after a coefficient is applied.</span></span>
<span id="cb148-374"><a href="functions-for-difference-in-difference-computations.html#cb148-374" tabindex="-1"></a>  <span class="do">### This computation takes the one from did:::summary.MP function, line 15 and 16. </span></span>
<span id="cb148-375"><a href="functions-for-difference-in-difference-computations.html#cb148-375" tabindex="-1"></a>  <span class="do">### They are multiplied by the number of pixels to compute confidence intervals for treatment effect at protected area level </span></span>
<span id="cb148-376"><a href="functions-for-difference-in-difference-computations.html#cb148-376" tabindex="-1"></a>  <span class="do">### They are divided by the pixel area to compute CI for treatment effect in percentage of pixel area</span></span>
<span id="cb148-377"><a href="functions-for-difference-in-difference-computations.html#cb148-377" tabindex="-1"></a>  df_fc_attgt <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">&quot;treatment_year&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>group,</span>
<span id="cb148-378"><a href="functions-for-difference-in-difference-computations.html#cb148-378" tabindex="-1"></a>                           <span class="st">&quot;year&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>t,</span>
<span id="cb148-379"><a href="functions-for-difference-in-difference-computations.html#cb148-379" tabindex="-1"></a>                           <span class="st">&quot;att_pix&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>att,</span>
<span id="cb148-380"><a href="functions-for-difference-in-difference-computations.html#cb148-380" tabindex="-1"></a>                           <span class="st">&quot;c&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>c,</span>
<span id="cb148-381"><a href="functions-for-difference-in-difference-computations.html#cb148-381" tabindex="-1"></a>                           <span class="st">&quot;se&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>se,  </span>
<span id="cb148-382"><a href="functions-for-difference-in-difference-computations.html#cb148-382" tabindex="-1"></a>                           <span class="st">&quot;n&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb148-383"><a href="functions-for-difference-in-difference-computations.html#cb148-383" tabindex="-1"></a>    <span class="co">#Compute treatment effect at PA level and in share of pixel area</span></span>
<span id="cb148-384"><a href="functions-for-difference-in-difference-computations.html#cb148-384" tabindex="-1"></a>    <span class="do">## att_pa : the total avoided deforestation is the avoided deforestation in ha in a given pixel, multiplied by the number of pixel in the PA.</span></span>
<span id="cb148-385"><a href="functions-for-difference-in-difference-computations.html#cb148-385" tabindex="-1"></a>    <span class="do">## att_per : avoided deforestation in a pixel, as a share of average forest cover in 2000 in matched treated. Can be extrapolated to full PA in principle (avoided deforestation in share of 2000 forest cover)</span></span>
<span id="cb148-386"><a href="functions-for-difference-in-difference-computations.html#cb148-386" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">att_pa =</span> att_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-387"><a href="functions-for-difference-in-difference-computations.html#cb148-387" tabindex="-1"></a>           <span class="at">att_per =</span> att_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-388"><a href="functions-for-difference-in-difference-computations.html#cb148-388" tabindex="-1"></a>    <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-389"><a href="functions-for-difference-in-difference-computations.html#cb148-389" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-390"><a href="functions-for-difference-in-difference-computations.html#cb148-390" tabindex="-1"></a>           <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-391"><a href="functions-for-difference-in-difference-computations.html#cb148-391" tabindex="-1"></a>    <span class="co">#Compute confidence intervals</span></span>
<span id="cb148-392"><a href="functions-for-difference-in-difference-computations.html#cb148-392" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cband_lower_pix =</span> <span class="fu">round</span>(att_pix<span class="sc">-</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-393"><a href="functions-for-difference-in-difference-computations.html#cb148-393" tabindex="-1"></a>           <span class="at">cband_upper_pix =</span> <span class="fu">round</span>(att_pix<span class="sc">+</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-394"><a href="functions-for-difference-in-difference-computations.html#cb148-394" tabindex="-1"></a>           <span class="at">cband_lower_pa =</span> cband_lower_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-395"><a href="functions-for-difference-in-difference-computations.html#cb148-395" tabindex="-1"></a>           <span class="at">cband_upper_pa =</span> cband_upper_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-396"><a href="functions-for-difference-in-difference-computations.html#cb148-396" tabindex="-1"></a>           <span class="at">cband_lower_per =</span> cband_lower_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb148-397"><a href="functions-for-difference-in-difference-computations.html#cb148-397" tabindex="-1"></a>           <span class="at">cband_upper_per =</span> cband_upper_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb148-398"><a href="functions-for-difference-in-difference-computations.html#cb148-398" tabindex="-1"></a>           <span class="at">sig =</span> <span class="fu">sign</span>(cband_lower_pix) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pix),</span>
<span id="cb148-399"><a href="functions-for-difference-in-difference-computations.html#cb148-399" tabindex="-1"></a>           <span class="at">sig_5 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span><span class="dv">5</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">5</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-400"><a href="functions-for-difference-in-difference-computations.html#cb148-400" tabindex="-1"></a>           <span class="at">sig_10 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">10</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-401"><a href="functions-for-difference-in-difference-computations.html#cb148-401" tabindex="-1"></a>           <span class="at">sig_end =</span> sig[time <span class="sc">==</span> <span class="fu">max</span>(time)] <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-402"><a href="functions-for-difference-in-difference-computations.html#cb148-402" tabindex="-1"></a>           <span class="at">alpha =</span> alpha) <span class="sc">%&gt;%</span></span>
<span id="cb148-403"><a href="functions-for-difference-in-difference-computations.html#cb148-403" tabindex="-1"></a>    <span class="co">#Add relevant information</span></span>
<span id="cb148-404"><a href="functions-for-difference-in-difference-computations.html#cb148-404" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> region.name,</span>
<span id="cb148-405"><a href="functions-for-difference-in-difference-computations.html#cb148-405" tabindex="-1"></a>           <span class="at">country_en =</span> country.name,</span>
<span id="cb148-406"><a href="functions-for-difference-in-difference-computations.html#cb148-406" tabindex="-1"></a>           <span class="at">iso3 =</span> country.iso,</span>
<span id="cb148-407"><a href="functions-for-difference-in-difference-computations.html#cb148-407" tabindex="-1"></a>           <span class="at">name_pa =</span> pa.name,</span>
<span id="cb148-408"><a href="functions-for-difference-in-difference-computations.html#cb148-408" tabindex="-1"></a>           <span class="at">wdpaid =</span> wdpaid,</span>
<span id="cb148-409"><a href="functions-for-difference-in-difference-computations.html#cb148-409" tabindex="-1"></a>           <span class="at">res_ha =</span> res_ha,</span>
<span id="cb148-410"><a href="functions-for-difference-in-difference-computations.html#cb148-410" tabindex="-1"></a>           <span class="at">id_projet =</span> id.project,</span>
<span id="cb148-411"><a href="functions-for-difference-in-difference-computations.html#cb148-411" tabindex="-1"></a>           <span class="at">status_wdpa =</span> status.wdpa,</span>
<span id="cb148-412"><a href="functions-for-difference-in-difference-computations.html#cb148-412" tabindex="-1"></a>           <span class="at">iucn_cat =</span> iucn.cat,</span>
<span id="cb148-413"><a href="functions-for-difference-in-difference-computations.html#cb148-413" tabindex="-1"></a>           <span class="at">iucn_des_en =</span> iucn.des,</span>
<span id="cb148-414"><a href="functions-for-difference-in-difference-computations.html#cb148-414" tabindex="-1"></a>           <span class="at">gov_type =</span> gov.wdpa,</span>
<span id="cb148-415"><a href="functions-for-difference-in-difference-computations.html#cb148-415" tabindex="-1"></a>           <span class="at">own_type =</span> own.wdpa,</span>
<span id="cb148-416"><a href="functions-for-difference-in-difference-computations.html#cb148-416" tabindex="-1"></a>           <span class="at">marine =</span> eco.wdpa,</span>
<span id="cb148-417"><a href="functions-for-difference-in-difference-computations.html#cb148-417" tabindex="-1"></a>           <span class="at">cofund =</span> cofund,</span>
<span id="cb148-418"><a href="functions-for-difference-in-difference-computations.html#cb148-418" tabindex="-1"></a>           <span class="at">kfw =</span> kfw,</span>
<span id="cb148-419"><a href="functions-for-difference-in-difference-computations.html#cb148-419" tabindex="-1"></a>           <span class="at">ffem =</span> ffem,</span>
<span id="cb148-420"><a href="functions-for-difference-in-difference-computations.html#cb148-420" tabindex="-1"></a>           <span class="at">fund_type =</span> fund.type,</span>
<span id="cb148-421"><a href="functions-for-difference-in-difference-computations.html#cb148-421" tabindex="-1"></a>           <span class="at">dept_report =</span> reporter,</span>
<span id="cb148-422"><a href="functions-for-difference-in-difference-computations.html#cb148-422" tabindex="-1"></a>           <span class="at">funding_year =</span> funding.years,</span>
<span id="cb148-423"><a href="functions-for-difference-in-difference-computations.html#cb148-423" tabindex="-1"></a>           <span class="at">funding_year_list =</span> list.funding.years,</span>
<span id="cb148-424"><a href="functions-for-difference-in-difference-computations.html#cb148-424" tabindex="-1"></a>           <span class="at">.before =</span> <span class="st">&quot;treatment_year&quot;</span>)</span>
<span id="cb148-425"><a href="functions-for-difference-in-difference-computations.html#cb148-425" tabindex="-1"></a>  </span>
<span id="cb148-426"><a href="functions-for-difference-in-difference-computations.html#cb148-426" tabindex="-1"></a>  <span class="co"># Same for change in deforestation rate</span></span>
<span id="cb148-427"><a href="functions-for-difference-in-difference-computations.html#cb148-427" tabindex="-1"></a>  df_fl_attgt <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">&quot;treatment_year&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>group,</span>
<span id="cb148-428"><a href="functions-for-difference-in-difference-computations.html#cb148-428" tabindex="-1"></a>                           <span class="st">&quot;year&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>t,</span>
<span id="cb148-429"><a href="functions-for-difference-in-difference-computations.html#cb148-429" tabindex="-1"></a>                           <span class="st">&quot;att&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>att,</span>
<span id="cb148-430"><a href="functions-for-difference-in-difference-computations.html#cb148-430" tabindex="-1"></a>                           <span class="st">&quot;c&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>c,</span>
<span id="cb148-431"><a href="functions-for-difference-in-difference-computations.html#cb148-431" tabindex="-1"></a>                           <span class="st">&quot;se&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>se,</span>
<span id="cb148-432"><a href="functions-for-difference-in-difference-computations.html#cb148-432" tabindex="-1"></a>                           <span class="st">&quot;n&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb148-433"><a href="functions-for-difference-in-difference-computations.html#cb148-433" tabindex="-1"></a>    <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-434"><a href="functions-for-difference-in-difference-computations.html#cb148-434" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-435"><a href="functions-for-difference-in-difference-computations.html#cb148-435" tabindex="-1"></a>           <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-436"><a href="functions-for-difference-in-difference-computations.html#cb148-436" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cband_lower =</span> <span class="fu">round</span>(att<span class="sc">-</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-437"><a href="functions-for-difference-in-difference-computations.html#cb148-437" tabindex="-1"></a>           <span class="at">cband_upper =</span> <span class="fu">round</span>(att<span class="sc">+</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-438"><a href="functions-for-difference-in-difference-computations.html#cb148-438" tabindex="-1"></a>           <span class="at">sig =</span> <span class="fu">sign</span>(cband_lower) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper),</span>
<span id="cb148-439"><a href="functions-for-difference-in-difference-computations.html#cb148-439" tabindex="-1"></a>           <span class="at">sig_5 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span><span class="dv">5</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">5</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-440"><a href="functions-for-difference-in-difference-computations.html#cb148-440" tabindex="-1"></a>           <span class="at">sig_10 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">10</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-441"><a href="functions-for-difference-in-difference-computations.html#cb148-441" tabindex="-1"></a>           <span class="at">sig_end =</span> sig[time <span class="sc">==</span> <span class="fu">max</span>(time)] <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-442"><a href="functions-for-difference-in-difference-computations.html#cb148-442" tabindex="-1"></a>           <span class="at">alpha =</span> alpha) <span class="sc">%&gt;%</span></span>
<span id="cb148-443"><a href="functions-for-difference-in-difference-computations.html#cb148-443" tabindex="-1"></a>    <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-444"><a href="functions-for-difference-in-difference-computations.html#cb148-444" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-445"><a href="functions-for-difference-in-difference-computations.html#cb148-445" tabindex="-1"></a>           <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-446"><a href="functions-for-difference-in-difference-computations.html#cb148-446" tabindex="-1"></a>    <span class="co">#Add relevant information</span></span>
<span id="cb148-447"><a href="functions-for-difference-in-difference-computations.html#cb148-447" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> region.name,</span>
<span id="cb148-448"><a href="functions-for-difference-in-difference-computations.html#cb148-448" tabindex="-1"></a>           <span class="at">country_en =</span> country.name,</span>
<span id="cb148-449"><a href="functions-for-difference-in-difference-computations.html#cb148-449" tabindex="-1"></a>           <span class="at">iso3 =</span> country.iso,</span>
<span id="cb148-450"><a href="functions-for-difference-in-difference-computations.html#cb148-450" tabindex="-1"></a>           <span class="at">name_pa =</span> pa.name,</span>
<span id="cb148-451"><a href="functions-for-difference-in-difference-computations.html#cb148-451" tabindex="-1"></a>           <span class="at">wdpaid =</span> wdpaid,</span>
<span id="cb148-452"><a href="functions-for-difference-in-difference-computations.html#cb148-452" tabindex="-1"></a>           <span class="at">res_ha =</span> res_ha,</span>
<span id="cb148-453"><a href="functions-for-difference-in-difference-computations.html#cb148-453" tabindex="-1"></a>           <span class="at">id_projet =</span> id.project,</span>
<span id="cb148-454"><a href="functions-for-difference-in-difference-computations.html#cb148-454" tabindex="-1"></a>           <span class="at">status_wdpa =</span> status.wdpa,</span>
<span id="cb148-455"><a href="functions-for-difference-in-difference-computations.html#cb148-455" tabindex="-1"></a>           <span class="at">iucn_cat =</span> iucn.cat,</span>
<span id="cb148-456"><a href="functions-for-difference-in-difference-computations.html#cb148-456" tabindex="-1"></a>           <span class="at">iucn_des_en =</span> iucn.des,</span>
<span id="cb148-457"><a href="functions-for-difference-in-difference-computations.html#cb148-457" tabindex="-1"></a>           <span class="at">gov_type =</span> gov.wdpa,</span>
<span id="cb148-458"><a href="functions-for-difference-in-difference-computations.html#cb148-458" tabindex="-1"></a>           <span class="at">own_type =</span> own.wdpa,</span>
<span id="cb148-459"><a href="functions-for-difference-in-difference-computations.html#cb148-459" tabindex="-1"></a>           <span class="at">marine =</span> eco.wdpa,</span>
<span id="cb148-460"><a href="functions-for-difference-in-difference-computations.html#cb148-460" tabindex="-1"></a>           <span class="at">cofund =</span> cofund,</span>
<span id="cb148-461"><a href="functions-for-difference-in-difference-computations.html#cb148-461" tabindex="-1"></a>           <span class="at">kfw =</span> kfw,</span>
<span id="cb148-462"><a href="functions-for-difference-in-difference-computations.html#cb148-462" tabindex="-1"></a>           <span class="at">ffem =</span> ffem,</span>
<span id="cb148-463"><a href="functions-for-difference-in-difference-computations.html#cb148-463" tabindex="-1"></a>           <span class="at">fund_type =</span> fund.type,</span>
<span id="cb148-464"><a href="functions-for-difference-in-difference-computations.html#cb148-464" tabindex="-1"></a>           <span class="at">dept_report =</span> reporter,</span>
<span id="cb148-465"><a href="functions-for-difference-in-difference-computations.html#cb148-465" tabindex="-1"></a>           <span class="at">funding_year =</span> funding.years,</span>
<span id="cb148-466"><a href="functions-for-difference-in-difference-computations.html#cb148-466" tabindex="-1"></a>           <span class="at">funding_year_list =</span> list.funding.years,</span>
<span id="cb148-467"><a href="functions-for-difference-in-difference-computations.html#cb148-467" tabindex="-1"></a>           <span class="at">.before =</span> <span class="st">&quot;treatment_year&quot;</span>)</span>
<span id="cb148-468"><a href="functions-for-difference-in-difference-computations.html#cb148-468" tabindex="-1"></a>  </span>
<span id="cb148-469"><a href="functions-for-difference-in-difference-computations.html#cb148-469" tabindex="-1"></a>  <span class="do">###Plot results</span></span>
<span id="cb148-470"><a href="functions-for-difference-in-difference-computations.html#cb148-470" tabindex="-1"></a>  <span class="do">## treatment effect : avoided deforestation at pixel level (in ha)</span></span>
<span id="cb148-471"><a href="functions-for-difference-in-difference-computations.html#cb148-471" tabindex="-1"></a>  fig_att_pix <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-472"><a href="functions-for-difference-in-difference-computations.html#cb148-472" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_pix)) <span class="sc">%&gt;%</span></span>
<span id="cb148-473"><a href="functions-for-difference-in-difference-computations.html#cb148-473" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-474"><a href="functions-for-difference-in-difference-computations.html#cb148-474" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-475"><a href="functions-for-difference-in-difference-computations.html#cb148-475" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_pix, <span class="at">ymax =</span> cband_upper_pix),</span>
<span id="cb148-476"><a href="functions-for-difference-in-difference-computations.html#cb148-476" tabindex="-1"></a>                  <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-477"><a href="functions-for-difference-in-difference-computations.html#cb148-477" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-478"><a href="functions-for-difference-in-difference-computations.html#cb148-478" tabindex="-1"></a>                          <span class="at">yes =</span> <span class="st">&quot;Deforestation avoided in a pixel,on average (matched)&quot;</span>,</span>
<span id="cb148-479"><a href="functions-for-difference-in-difference-computations.html#cb148-479" tabindex="-1"></a>                          <span class="at">no =</span> <span class="st">&quot;Deforestation avoided in a pixel,on average (unmatched)&quot;</span>),</span>
<span id="cb148-480"><a href="functions-for-difference-in-difference-computations.html#cb148-480" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-481"><a href="functions-for-difference-in-difference-computations.html#cb148-481" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the deforestation avoided at pixel level in hectare, due to the conservation program.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-482"><a href="functions-for-difference-in-difference-computations.html#cb148-482" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;Area (ha)&quot;</span>,</span>
<span id="cb148-483"><a href="functions-for-difference-in-difference-computations.html#cb148-483" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-484"><a href="functions-for-difference-in-difference-computations.html#cb148-484" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-485"><a href="functions-for-difference-in-difference-computations.html#cb148-485" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-486"><a href="functions-for-difference-in-difference-computations.html#cb148-486" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-487"><a href="functions-for-difference-in-difference-computations.html#cb148-487" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-488"><a href="functions-for-difference-in-difference-computations.html#cb148-488" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-489"><a href="functions-for-difference-in-difference-computations.html#cb148-489" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-490"><a href="functions-for-difference-in-difference-computations.html#cb148-490" tabindex="-1"></a>      </span>
<span id="cb148-491"><a href="functions-for-difference-in-difference-computations.html#cb148-491" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-492"><a href="functions-for-difference-in-difference-computations.html#cb148-492" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-493"><a href="functions-for-difference-in-difference-computations.html#cb148-493" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-494"><a href="functions-for-difference-in-difference-computations.html#cb148-494" tabindex="-1"></a>      </span>
<span id="cb148-495"><a href="functions-for-difference-in-difference-computations.html#cb148-495" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-496"><a href="functions-for-difference-in-difference-computations.html#cb148-496" tabindex="-1"></a>      </span>
<span id="cb148-497"><a href="functions-for-difference-in-difference-computations.html#cb148-497" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-498"><a href="functions-for-difference-in-difference-computations.html#cb148-498" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-499"><a href="functions-for-difference-in-difference-computations.html#cb148-499" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-500"><a href="functions-for-difference-in-difference-computations.html#cb148-500" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-501"><a href="functions-for-difference-in-difference-computations.html#cb148-501" tabindex="-1"></a>      <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-502"><a href="functions-for-difference-in-difference-computations.html#cb148-502" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-503"><a href="functions-for-difference-in-difference-computations.html#cb148-503" tabindex="-1"></a>      </span>
<span id="cb148-504"><a href="functions-for-difference-in-difference-computations.html#cb148-504" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-505"><a href="functions-for-difference-in-difference-computations.html#cb148-505" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-506"><a href="functions-for-difference-in-difference-computations.html#cb148-506" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-507"><a href="functions-for-difference-in-difference-computations.html#cb148-507" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-508"><a href="functions-for-difference-in-difference-computations.html#cb148-508" tabindex="-1"></a>    )</span>
<span id="cb148-509"><a href="functions-for-difference-in-difference-computations.html#cb148-509" tabindex="-1"></a>  </span>
<span id="cb148-510"><a href="functions-for-difference-in-difference-computations.html#cb148-510" tabindex="-1"></a>  <span class="co"># treatment effect : avoided deforestation in terms of 2000 forest cover</span></span>
<span id="cb148-511"><a href="functions-for-difference-in-difference-computations.html#cb148-511" tabindex="-1"></a>  fig_att_per <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-512"><a href="functions-for-difference-in-difference-computations.html#cb148-512" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-513"><a href="functions-for-difference-in-difference-computations.html#cb148-513" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-514"><a href="functions-for-difference-in-difference-computations.html#cb148-514" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-515"><a href="functions-for-difference-in-difference-computations.html#cb148-515" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_per, <span class="at">ymax =</span> cband_upper_per),</span>
<span id="cb148-516"><a href="functions-for-difference-in-difference-computations.html#cb148-516" tabindex="-1"></a>                  <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-517"><a href="functions-for-difference-in-difference-computations.html#cb148-517" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-518"><a href="functions-for-difference-in-difference-computations.html#cb148-518" tabindex="-1"></a>                          <span class="at">yes =</span> <span class="st">&quot;Average deforestation avoided relative to 2000 forest cover (matched)&quot;</span>,</span>
<span id="cb148-519"><a href="functions-for-difference-in-difference-computations.html#cb148-519" tabindex="-1"></a>                          <span class="at">no =</span> <span class="st">&quot;Average deforestation avoided relative to 2000 forest cover (unmatched)&quot;</span>),</span>
<span id="cb148-520"><a href="functions-for-difference-in-difference-computations.html#cb148-520" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-521"><a href="functions-for-difference-in-difference-computations.html#cb148-521" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the deforestation avoided in percentage of 2000 forest cover.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-522"><a href="functions-for-difference-in-difference-computations.html#cb148-522" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-523"><a href="functions-for-difference-in-difference-computations.html#cb148-523" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-524"><a href="functions-for-difference-in-difference-computations.html#cb148-524" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-525"><a href="functions-for-difference-in-difference-computations.html#cb148-525" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-526"><a href="functions-for-difference-in-difference-computations.html#cb148-526" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-527"><a href="functions-for-difference-in-difference-computations.html#cb148-527" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-528"><a href="functions-for-difference-in-difference-computations.html#cb148-528" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-529"><a href="functions-for-difference-in-difference-computations.html#cb148-529" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-530"><a href="functions-for-difference-in-difference-computations.html#cb148-530" tabindex="-1"></a>      </span>
<span id="cb148-531"><a href="functions-for-difference-in-difference-computations.html#cb148-531" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-532"><a href="functions-for-difference-in-difference-computations.html#cb148-532" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-533"><a href="functions-for-difference-in-difference-computations.html#cb148-533" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-534"><a href="functions-for-difference-in-difference-computations.html#cb148-534" tabindex="-1"></a>      </span>
<span id="cb148-535"><a href="functions-for-difference-in-difference-computations.html#cb148-535" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-536"><a href="functions-for-difference-in-difference-computations.html#cb148-536" tabindex="-1"></a>      </span>
<span id="cb148-537"><a href="functions-for-difference-in-difference-computations.html#cb148-537" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-538"><a href="functions-for-difference-in-difference-computations.html#cb148-538" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-539"><a href="functions-for-difference-in-difference-computations.html#cb148-539" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-540"><a href="functions-for-difference-in-difference-computations.html#cb148-540" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-541"><a href="functions-for-difference-in-difference-computations.html#cb148-541" tabindex="-1"></a>      <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-542"><a href="functions-for-difference-in-difference-computations.html#cb148-542" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-543"><a href="functions-for-difference-in-difference-computations.html#cb148-543" tabindex="-1"></a>      </span>
<span id="cb148-544"><a href="functions-for-difference-in-difference-computations.html#cb148-544" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-545"><a href="functions-for-difference-in-difference-computations.html#cb148-545" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-546"><a href="functions-for-difference-in-difference-computations.html#cb148-546" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-547"><a href="functions-for-difference-in-difference-computations.html#cb148-547" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-548"><a href="functions-for-difference-in-difference-computations.html#cb148-548" tabindex="-1"></a>    )</span>
<span id="cb148-549"><a href="functions-for-difference-in-difference-computations.html#cb148-549" tabindex="-1"></a>  </span>
<span id="cb148-550"><a href="functions-for-difference-in-difference-computations.html#cb148-550" tabindex="-1"></a>  <span class="co"># treatment effect : avoided deforestation in the PA</span></span>
<span id="cb148-551"><a href="functions-for-difference-in-difference-computations.html#cb148-551" tabindex="-1"></a>  fig_att_pa <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-552"><a href="functions-for-difference-in-difference-computations.html#cb148-552" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-553"><a href="functions-for-difference-in-difference-computations.html#cb148-553" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-554"><a href="functions-for-difference-in-difference-computations.html#cb148-554" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-555"><a href="functions-for-difference-in-difference-computations.html#cb148-555" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_pa, <span class="at">ymax =</span> cband_upper_pa),</span>
<span id="cb148-556"><a href="functions-for-difference-in-difference-computations.html#cb148-556" tabindex="-1"></a>                  <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-557"><a href="functions-for-difference-in-difference-computations.html#cb148-557" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-558"><a href="functions-for-difference-in-difference-computations.html#cb148-558" tabindex="-1"></a>                          <span class="at">yes =</span> <span class="st">&quot;Total deforestation avoided (matched)&quot;</span>,</span>
<span id="cb148-559"><a href="functions-for-difference-in-difference-computations.html#cb148-559" tabindex="-1"></a>                          <span class="at">no =</span> <span class="st">&quot;Total deforestation avoided (unmatched)&quot;</span>),</span>
<span id="cb148-560"><a href="functions-for-difference-in-difference-computations.html#cb148-560" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-561"><a href="functions-for-difference-in-difference-computations.html#cb148-561" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>,  <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the total deforestation avoided in the protected areas, in hectare (ha).</span><span class="sc">\n</span><span class="st">This measure is an extrapolation to the full protected area of average avoided deforestation at pixel level.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-562"><a href="functions-for-difference-in-difference-computations.html#cb148-562" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;Forest area (ha)&quot;</span>,</span>
<span id="cb148-563"><a href="functions-for-difference-in-difference-computations.html#cb148-563" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-564"><a href="functions-for-difference-in-difference-computations.html#cb148-564" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-565"><a href="functions-for-difference-in-difference-computations.html#cb148-565" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-566"><a href="functions-for-difference-in-difference-computations.html#cb148-566" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-567"><a href="functions-for-difference-in-difference-computations.html#cb148-567" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-568"><a href="functions-for-difference-in-difference-computations.html#cb148-568" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-569"><a href="functions-for-difference-in-difference-computations.html#cb148-569" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-570"><a href="functions-for-difference-in-difference-computations.html#cb148-570" tabindex="-1"></a>      </span>
<span id="cb148-571"><a href="functions-for-difference-in-difference-computations.html#cb148-571" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-572"><a href="functions-for-difference-in-difference-computations.html#cb148-572" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-573"><a href="functions-for-difference-in-difference-computations.html#cb148-573" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-574"><a href="functions-for-difference-in-difference-computations.html#cb148-574" tabindex="-1"></a>      </span>
<span id="cb148-575"><a href="functions-for-difference-in-difference-computations.html#cb148-575" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-576"><a href="functions-for-difference-in-difference-computations.html#cb148-576" tabindex="-1"></a>      </span>
<span id="cb148-577"><a href="functions-for-difference-in-difference-computations.html#cb148-577" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-578"><a href="functions-for-difference-in-difference-computations.html#cb148-578" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-579"><a href="functions-for-difference-in-difference-computations.html#cb148-579" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-580"><a href="functions-for-difference-in-difference-computations.html#cb148-580" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-581"><a href="functions-for-difference-in-difference-computations.html#cb148-581" tabindex="-1"></a>      <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-582"><a href="functions-for-difference-in-difference-computations.html#cb148-582" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-583"><a href="functions-for-difference-in-difference-computations.html#cb148-583" tabindex="-1"></a>      </span>
<span id="cb148-584"><a href="functions-for-difference-in-difference-computations.html#cb148-584" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-585"><a href="functions-for-difference-in-difference-computations.html#cb148-585" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-586"><a href="functions-for-difference-in-difference-computations.html#cb148-586" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-587"><a href="functions-for-difference-in-difference-computations.html#cb148-587" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-588"><a href="functions-for-difference-in-difference-computations.html#cb148-588" tabindex="-1"></a>    )</span>
<span id="cb148-589"><a href="functions-for-difference-in-difference-computations.html#cb148-589" tabindex="-1"></a>  </span>
<span id="cb148-590"><a href="functions-for-difference-in-difference-computations.html#cb148-590" tabindex="-1"></a></span>
<span id="cb148-591"><a href="functions-for-difference-in-difference-computations.html#cb148-591" tabindex="-1"></a>  <span class="co"># treatment effect : change in deforestation rate</span></span>
<span id="cb148-592"><a href="functions-for-difference-in-difference-computations.html#cb148-592" tabindex="-1"></a>  fig_fl_att <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fl_attgt,</span>
<span id="cb148-593"><a href="functions-for-difference-in-difference-computations.html#cb148-593" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att)) <span class="sc">%&gt;%</span></span>
<span id="cb148-594"><a href="functions-for-difference-in-difference-computations.html#cb148-594" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-595"><a href="functions-for-difference-in-difference-computations.html#cb148-595" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-596"><a href="functions-for-difference-in-difference-computations.html#cb148-596" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower, <span class="at">ymax =</span> cband_upper),</span>
<span id="cb148-597"><a href="functions-for-difference-in-difference-computations.html#cb148-597" tabindex="-1"></a>                  <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-598"><a href="functions-for-difference-in-difference-computations.html#cb148-598" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Effect of the conservation on the deforestation rate, relative to 2000&quot;</span>,</span>
<span id="cb148-599"><a href="functions-for-difference-in-difference-computations.html#cb148-599" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-600"><a href="functions-for-difference-in-difference-computations.html#cb148-600" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents &quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot; % confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the reduction of cumulated deforestation rate (relative to 2000 forest cover) in percentage points (pp).</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-601"><a href="functions-for-difference-in-difference-computations.html#cb148-601" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;Reduction of deforestation (p.p)&quot;</span>,</span>
<span id="cb148-602"><a href="functions-for-difference-in-difference-computations.html#cb148-602" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-603"><a href="functions-for-difference-in-difference-computations.html#cb148-603" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-604"><a href="functions-for-difference-in-difference-computations.html#cb148-604" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-605"><a href="functions-for-difference-in-difference-computations.html#cb148-605" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-606"><a href="functions-for-difference-in-difference-computations.html#cb148-606" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-607"><a href="functions-for-difference-in-difference-computations.html#cb148-607" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-608"><a href="functions-for-difference-in-difference-computations.html#cb148-608" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-609"><a href="functions-for-difference-in-difference-computations.html#cb148-609" tabindex="-1"></a>      </span>
<span id="cb148-610"><a href="functions-for-difference-in-difference-computations.html#cb148-610" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-611"><a href="functions-for-difference-in-difference-computations.html#cb148-611" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-612"><a href="functions-for-difference-in-difference-computations.html#cb148-612" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-613"><a href="functions-for-difference-in-difference-computations.html#cb148-613" tabindex="-1"></a>      </span>
<span id="cb148-614"><a href="functions-for-difference-in-difference-computations.html#cb148-614" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-615"><a href="functions-for-difference-in-difference-computations.html#cb148-615" tabindex="-1"></a>      </span>
<span id="cb148-616"><a href="functions-for-difference-in-difference-computations.html#cb148-616" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-617"><a href="functions-for-difference-in-difference-computations.html#cb148-617" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-618"><a href="functions-for-difference-in-difference-computations.html#cb148-618" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-619"><a href="functions-for-difference-in-difference-computations.html#cb148-619" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-620"><a href="functions-for-difference-in-difference-computations.html#cb148-620" tabindex="-1"></a>      <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-621"><a href="functions-for-difference-in-difference-computations.html#cb148-621" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-622"><a href="functions-for-difference-in-difference-computations.html#cb148-622" tabindex="-1"></a>      </span>
<span id="cb148-623"><a href="functions-for-difference-in-difference-computations.html#cb148-623" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-624"><a href="functions-for-difference-in-difference-computations.html#cb148-624" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-625"><a href="functions-for-difference-in-difference-computations.html#cb148-625" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-626"><a href="functions-for-difference-in-difference-computations.html#cb148-626" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-627"><a href="functions-for-difference-in-difference-computations.html#cb148-627" tabindex="-1"></a>    )</span>
<span id="cb148-628"><a href="functions-for-difference-in-difference-computations.html#cb148-628" tabindex="-1"></a>  </span>
<span id="cb148-629"><a href="functions-for-difference-in-difference-computations.html#cb148-629" tabindex="-1"></a>  </span>
<span id="cb148-630"><a href="functions-for-difference-in-difference-computations.html#cb148-630" tabindex="-1"></a>  </span>
<span id="cb148-631"><a href="functions-for-difference-in-difference-computations.html#cb148-631" tabindex="-1"></a>  <span class="do">##Saving plots</span></span>
<span id="cb148-632"><a href="functions-for-difference-in-difference-computations.html#cb148-632" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;fig&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb148-633"><a href="functions-for-difference-in-difference-computations.html#cb148-633" tabindex="-1"></a>  </span>
<span id="cb148-634"><a href="functions-for-difference-in-difference-computations.html#cb148-634" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-635"><a href="functions-for-difference-in-difference-computations.html#cb148-635" tabindex="-1"></a>                <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pix_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-636"><a href="functions-for-difference-in-difference-computations.html#cb148-636" tabindex="-1"></a>                <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pix_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-637"><a href="functions-for-difference-in-difference-computations.html#cb148-637" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pix,</span>
<span id="cb148-638"><a href="functions-for-difference-in-difference-computations.html#cb148-638" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-639"><a href="functions-for-difference-in-difference-computations.html#cb148-639" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-640"><a href="functions-for-difference-in-difference-computations.html#cb148-640" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-641"><a href="functions-for-difference-in-difference-computations.html#cb148-641" tabindex="-1"></a>                <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pa_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-642"><a href="functions-for-difference-in-difference-computations.html#cb148-642" tabindex="-1"></a>                <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pa_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-643"><a href="functions-for-difference-in-difference-computations.html#cb148-643" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa,</span>
<span id="cb148-644"><a href="functions-for-difference-in-difference-computations.html#cb148-644" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-645"><a href="functions-for-difference-in-difference-computations.html#cb148-645" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-646"><a href="functions-for-difference-in-difference-computations.html#cb148-646" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-647"><a href="functions-for-difference-in-difference-computations.html#cb148-647" tabindex="-1"></a>                <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_per_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-648"><a href="functions-for-difference-in-difference-computations.html#cb148-648" tabindex="-1"></a>                <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_per_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-649"><a href="functions-for-difference-in-difference-computations.html#cb148-649" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per,</span>
<span id="cb148-650"><a href="functions-for-difference-in-difference-computations.html#cb148-650" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-651"><a href="functions-for-difference-in-difference-computations.html#cb148-651" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-652"><a href="functions-for-difference-in-difference-computations.html#cb148-652" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_fl_att_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-653"><a href="functions-for-difference-in-difference-computations.html#cb148-653" tabindex="-1"></a>         <span class="at">plot =</span> fig_fl_att,</span>
<span id="cb148-654"><a href="functions-for-difference-in-difference-computations.html#cb148-654" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-655"><a href="functions-for-difference-in-difference-computations.html#cb148-655" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-656"><a href="functions-for-difference-in-difference-computations.html#cb148-656" tabindex="-1"></a>  </span>
<span id="cb148-657"><a href="functions-for-difference-in-difference-computations.html#cb148-657" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-658"><a href="functions-for-difference-in-difference-computations.html#cb148-658" tabindex="-1"></a>  <span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb148-659"><a href="functions-for-difference-in-difference-computations.html#cb148-659" tabindex="-1"></a>  <span class="cf">for</span>(f <span class="cf">in</span> files) </span>
<span id="cb148-660"><a href="functions-for-difference-in-difference-computations.html#cb148-660" tabindex="-1"></a>  {</span>
<span id="cb148-661"><a href="functions-for-difference-in-difference-computations.html#cb148-661" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb148-662"><a href="functions-for-difference-in-difference-computations.html#cb148-662" tabindex="-1"></a>    aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb148-663"><a href="functions-for-difference-in-difference-computations.html#cb148-663" tabindex="-1"></a>                       <span class="at">bucket =</span> <span class="fu">paste</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>, save_dir, iso, wdpaid, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-664"><a href="functions-for-difference-in-difference-computations.html#cb148-664" tabindex="-1"></a>                       <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-665"><a href="functions-for-difference-in-difference-computations.html#cb148-665" tabindex="-1"></a>  }</span>
<span id="cb148-666"><a href="functions-for-difference-in-difference-computations.html#cb148-666" tabindex="-1"></a>  <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb148-667"><a href="functions-for-difference-in-difference-computations.html#cb148-667" tabindex="-1"></a>  </span>
<span id="cb148-668"><a href="functions-for-difference-in-difference-computations.html#cb148-668" tabindex="-1"></a>  </span>
<span id="cb148-669"><a href="functions-for-difference-in-difference-computations.html#cb148-669" tabindex="-1"></a>  </span>
<span id="cb148-670"><a href="functions-for-difference-in-difference-computations.html#cb148-670" tabindex="-1"></a>  <span class="co">#Return outputs</span></span>
<span id="cb148-671"><a href="functions-for-difference-in-difference-computations.html#cb148-671" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;df_fc_att&quot;</span> <span class="ot">=</span> df_fc_attgt, <span class="st">&quot;df_fl_att&quot;</span>  <span class="ot">=</span> df_fl_attgt, <span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">TRUE</span>))</span>
<span id="cb148-672"><a href="functions-for-difference-in-difference-computations.html#cb148-672" tabindex="-1"></a>  </span>
<span id="cb148-673"><a href="functions-for-difference-in-difference-computations.html#cb148-673" tabindex="-1"></a>    },</span>
<span id="cb148-674"><a href="functions-for-difference-in-difference-computations.html#cb148-674" tabindex="-1"></a>  </span>
<span id="cb148-675"><a href="functions-for-difference-in-difference-computations.html#cb148-675" tabindex="-1"></a>  <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb148-676"><a href="functions-for-difference-in-difference-computations.html#cb148-676" tabindex="-1"></a>  {</span>
<span id="cb148-677"><a href="functions-for-difference-in-difference-computations.html#cb148-677" tabindex="-1"></a>    <span class="fu">print</span>(e)</span>
<span id="cb148-678"><a href="functions-for-difference-in-difference-computations.html#cb148-678" tabindex="-1"></a>    <span class="co">#cat(paste(&quot;Error while computing/plotting DiD :\n&quot;, e, &quot;\n&quot;), file = log, append = TRUE)</span></span>
<span id="cb148-679"><a href="functions-for-difference-in-difference-computations.html#cb148-679" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Error while computing/plotting DiD :</span><span class="sc">\n</span><span class="st">&quot;</span>, e, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb148-680"><a href="functions-for-difference-in-difference-computations.html#cb148-680" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span>))</span>
<span id="cb148-681"><a href="functions-for-difference-in-difference-computations.html#cb148-681" tabindex="-1"></a>  }</span>
<span id="cb148-682"><a href="functions-for-difference-in-difference-computations.html#cb148-682" tabindex="-1"></a>  </span>
<span id="cb148-683"><a href="functions-for-difference-in-difference-computations.html#cb148-683" tabindex="-1"></a>  )</span>
<span id="cb148-684"><a href="functions-for-difference-in-difference-computations.html#cb148-684" tabindex="-1"></a>  </span>
<span id="cb148-685"><a href="functions-for-difference-in-difference-computations.html#cb148-685" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb148-686"><a href="functions-for-difference-in-difference-computations.html#cb148-686" tabindex="-1"></a>  </span>
<span id="cb148-687"><a href="functions-for-difference-in-difference-computations.html#cb148-687" tabindex="-1"></a>  <span class="co">#TEST : is treatment effect computed by the did package coherent with manual computations ? </span></span>
<span id="cb148-688"><a href="functions-for-difference-in-difference-computations.html#cb148-688" tabindex="-1"></a>  <span class="co"># --&gt; YES :D</span></span>
<span id="cb148-689"><a href="functions-for-difference-in-difference-computations.html#cb148-689" tabindex="-1"></a>  <span class="co"># test = df_did %&gt;% </span></span>
<span id="cb148-690"><a href="functions-for-difference-in-difference-computations.html#cb148-690" tabindex="-1"></a>  <span class="co">#   group_by(group, year) %&gt;%</span></span>
<span id="cb148-691"><a href="functions-for-difference-in-difference-computations.html#cb148-691" tabindex="-1"></a>  <span class="co">#   summarize(avgFL_2000_cum = mean(FL_2000_cum, na.rm = TRUE),</span></span>
<span id="cb148-692"><a href="functions-for-difference-in-difference-computations.html#cb148-692" tabindex="-1"></a>  <span class="co">#             avgFC_ha = mean(fc_ha, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb148-693"><a href="functions-for-difference-in-difference-computations.html#cb148-693" tabindex="-1"></a>  <span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb148-694"><a href="functions-for-difference-in-difference-computations.html#cb148-694" tabindex="-1"></a>  <span class="co">#   mutate(fc_te2 = (avgFC_ha[year == 2009 &amp; group == 2] - avgFC_ha[year == 2006 &amp; group == 2]) - (avgFC_ha[year == 2009 &amp; group == 1] - avgFC_ha[year == 2006 &amp; group == 1]),</span></span>
<span id="cb148-695"><a href="functions-for-difference-in-difference-computations.html#cb148-695" tabindex="-1"></a>  <span class="co">#          fl_te2 = (avgFL_2000_cum[year == 2009 &amp; group == 2] - avgFL_2000_cum[year == 2006 &amp; group == 2]) - (avgFL_2000_cum[year == 2009 &amp; group == 1] - avgFL_2000_cum[year == 2006 &amp; group == 1]))</span></span>
<span id="cb148-696"><a href="functions-for-difference-in-difference-computations.html#cb148-696" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb148-697"><a href="functions-for-difference-in-difference-computations.html#cb148-697" tabindex="-1"></a>  </span>
<span id="cb148-698"><a href="functions-for-difference-in-difference-computations.html#cb148-698" tabindex="-1"></a>  </span>
<span id="cb148-699"><a href="functions-for-difference-in-difference-computations.html#cb148-699" tabindex="-1"></a>}</span>
<span id="cb148-700"><a href="functions-for-difference-in-difference-computations.html#cb148-700" tabindex="-1"></a></span>
<span id="cb148-701"><a href="functions-for-difference-in-difference-computations.html#cb148-701" tabindex="-1"></a></span>
<span id="cb148-702"><a href="functions-for-difference-in-difference-computations.html#cb148-702" tabindex="-1"></a><span class="co">#Compute the treatment effect for a given protected area. This function can be used on any protected area for which, though no funding information will be displayed contrary to fn_did_att_afd.</span></span>
<span id="cb148-703"><a href="functions-for-difference-in-difference-computations.html#cb148-703" tabindex="-1"></a><span class="do">## INPUTS </span></span>
<span id="cb148-704"><a href="functions-for-difference-in-difference-computations.html#cb148-704" tabindex="-1"></a><span class="do">### iso : the iso3 code for the country considered</span></span>
<span id="cb148-705"><a href="functions-for-difference-in-difference-computations.html#cb148-705" tabindex="-1"></a><span class="do">### wdpaid : the WDPAID of the PA considered</span></span>
<span id="cb148-706"><a href="functions-for-difference-in-difference-computations.html#cb148-706" tabindex="-1"></a><span class="do">### data_pa : dataset with information on protected areas, and especially their surfaces</span></span>
<span id="cb148-707"><a href="functions-for-difference-in-difference-computations.html#cb148-707" tabindex="-1"></a><span class="do">### alpha : the threshold for confidence interval</span></span>
<span id="cb148-708"><a href="functions-for-difference-in-difference-computations.html#cb148-708" tabindex="-1"></a><span class="do">### is_m : boolean stating whether we compute treatment effects from matched (TRUE) or unmatched treated and control units (FALSE)</span></span>
<span id="cb148-709"><a href="functions-for-difference-in-difference-computations.html#cb148-709" tabindex="-1"></a><span class="do">### save_dir : the saving directory in the remote storage</span></span>
<span id="cb148-710"><a href="functions-for-difference-in-difference-computations.html#cb148-710" tabindex="-1"></a><span class="do">### load_dir : the loading directory in the remote storage</span></span>
<span id="cb148-711"><a href="functions-for-difference-in-difference-computations.html#cb148-711" tabindex="-1"></a><span class="do">### ext_input : the extension of input dataframe</span></span>
<span id="cb148-712"><a href="functions-for-difference-in-difference-computations.html#cb148-712" tabindex="-1"></a><span class="do">## OUTPUTS</span></span>
<span id="cb148-713"><a href="functions-for-difference-in-difference-computations.html#cb148-713" tabindex="-1"></a><span class="do">### df_fc_attgt : treatment effect computed for the protected area considered, expressed in avoided deforestation (hectare)</span></span>
<span id="cb148-714"><a href="functions-for-difference-in-difference-computations.html#cb148-714" tabindex="-1"></a><span class="do">### df_fl_attgt : treatment effect computed for the protected area considered, expressed in change of deforestation rate</span></span>
<span id="cb148-715"><a href="functions-for-difference-in-difference-computations.html#cb148-715" tabindex="-1"></a><span class="do">### is_ok : a boolean indicating whether or not an error occured inside the function </span></span>
<span id="cb148-716"><a href="functions-for-difference-in-difference-computations.html#cb148-716" tabindex="-1"></a><span class="do">## DATA SAVED :</span></span>
<span id="cb148-717"><a href="functions-for-difference-in-difference-computations.html#cb148-717" tabindex="-1"></a><span class="do">### Dynamic treatment effects : avoided deforestation in an average pixel (in ha), avoided deforestation relative to 2000 forest cover, avoided deforestation extrapolated to the entire protected area (in ha), change in deforestation rate (in percentage points)</span></span>
<span id="cb148-718"><a href="functions-for-difference-in-difference-computations.html#cb148-718" tabindex="-1"></a>fn_did_att_general <span class="ot">=</span> <span class="cf">function</span>(iso, wdpaid, data_pa, alpha, is_m, load_dir, ext_input, save_dir)</span>
<span id="cb148-719"><a href="functions-for-difference-in-difference-computations.html#cb148-719" tabindex="-1"></a>{</span>
<span id="cb148-720"><a href="functions-for-difference-in-difference-computations.html#cb148-720" tabindex="-1"></a>  </span>
<span id="cb148-721"><a href="functions-for-difference-in-difference-computations.html#cb148-721" tabindex="-1"></a>  output <span class="ot">=</span> <span class="fu">tryCatch</span>(</span>
<span id="cb148-722"><a href="functions-for-difference-in-difference-computations.html#cb148-722" tabindex="-1"></a>    </span>
<span id="cb148-723"><a href="functions-for-difference-in-difference-computations.html#cb148-723" tabindex="-1"></a>    {</span>
<span id="cb148-724"><a href="functions-for-difference-in-difference-computations.html#cb148-724" tabindex="-1"></a>      </span>
<span id="cb148-725"><a href="functions-for-difference-in-difference-computations.html#cb148-725" tabindex="-1"></a>      <span class="co">#Loading matched and unmatched datasets</span></span>
<span id="cb148-726"><a href="functions-for-difference-in-difference-computations.html#cb148-726" tabindex="-1"></a>      df_long_m <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-727"><a href="functions-for-difference-in-difference-computations.html#cb148-727" tabindex="-1"></a>                               <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;matched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-728"><a href="functions-for-difference-in-difference-computations.html#cb148-728" tabindex="-1"></a>                               <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-729"><a href="functions-for-difference-in-difference-computations.html#cb148-729" tabindex="-1"></a>                               <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-730"><a href="functions-for-difference-in-difference-computations.html#cb148-730" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, res_m, year, var, fc_ha))</span>
<span id="cb148-731"><a href="functions-for-difference-in-difference-computations.html#cb148-731" tabindex="-1"></a>      <span class="co">#dplyr::select(c(region, country_en, iso3, wdpaid, group, status_yr, year_funding_first, year_funding_all, year, var, fc_ha))</span></span>
<span id="cb148-732"><a href="functions-for-difference-in-difference-computations.html#cb148-732" tabindex="-1"></a>      </span>
<span id="cb148-733"><a href="functions-for-difference-in-difference-computations.html#cb148-733" tabindex="-1"></a>      df_long_unm <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-734"><a href="functions-for-difference-in-difference-computations.html#cb148-734" tabindex="-1"></a>                                 <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;unmatched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-735"><a href="functions-for-difference-in-difference-computations.html#cb148-735" tabindex="-1"></a>                                 <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-736"><a href="functions-for-difference-in-difference-computations.html#cb148-736" tabindex="-1"></a>                                 <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-737"><a href="functions-for-difference-in-difference-computations.html#cb148-737" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, year, res_m, var, fc_ha))</span>
<span id="cb148-738"><a href="functions-for-difference-in-difference-computations.html#cb148-738" tabindex="-1"></a>      <span class="co">#dplyr::select(c(region, country_en, iso3, wdpaid, group, status_yr, year_funding_first, year_funding_all, year, var, fc_ha))</span></span>
<span id="cb148-739"><a href="functions-for-difference-in-difference-computations.html#cb148-739" tabindex="-1"></a>      </span>
<span id="cb148-740"><a href="functions-for-difference-in-difference-computations.html#cb148-740" tabindex="-1"></a>      <span class="co"># Define the working datasets depending on the is_m value</span></span>
<span id="cb148-741"><a href="functions-for-difference-in-difference-computations.html#cb148-741" tabindex="-1"></a>      <span class="cf">if</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-742"><a href="functions-for-difference-in-difference-computations.html#cb148-742" tabindex="-1"></a>      {</span>
<span id="cb148-743"><a href="functions-for-difference-in-difference-computations.html#cb148-743" tabindex="-1"></a>        df_long <span class="ot">=</span> df_long_m</span>
<span id="cb148-744"><a href="functions-for-difference-in-difference-computations.html#cb148-744" tabindex="-1"></a>      } <span class="cf">else</span>{df_long <span class="ot">=</span> df_long_unm </span>
<span id="cb148-745"><a href="functions-for-difference-in-difference-computations.html#cb148-745" tabindex="-1"></a>      }</span>
<span id="cb148-746"><a href="functions-for-difference-in-difference-computations.html#cb148-746" tabindex="-1"></a>      </span>
<span id="cb148-747"><a href="functions-for-difference-in-difference-computations.html#cb148-747" tabindex="-1"></a>      <span class="co">#Extract some relevant variables</span></span>
<span id="cb148-748"><a href="functions-for-difference-in-difference-computations.html#cb148-748" tabindex="-1"></a>      <span class="do">##Extract spatial resolution of pixels res_m and define pixel area in ha</span></span>
<span id="cb148-749"><a href="functions-for-difference-in-difference-computations.html#cb148-749" tabindex="-1"></a>      res_m <span class="ot">=</span> <span class="fu">unique</span>(df_long<span class="sc">$</span>res_m)</span>
<span id="cb148-750"><a href="functions-for-difference-in-difference-computations.html#cb148-750" tabindex="-1"></a>      res_ha <span class="ot">=</span> res_m<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fl">1e-4</span></span>
<span id="cb148-751"><a href="functions-for-difference-in-difference-computations.html#cb148-751" tabindex="-1"></a>      </span>
<span id="cb148-752"><a href="functions-for-difference-in-difference-computations.html#cb148-752" tabindex="-1"></a>      <span class="do">##Extract treatment year</span></span>
<span id="cb148-753"><a href="functions-for-difference-in-difference-computations.html#cb148-753" tabindex="-1"></a>      treatment.year <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-754"><a href="functions-for-difference-in-difference-computations.html#cb148-754" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-755"><a href="functions-for-difference-in-difference-computations.html#cb148-755" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-756"><a href="functions-for-difference-in-difference-computations.html#cb148-756" tabindex="-1"></a>      treatment.year <span class="ot">=</span> treatment.year<span class="sc">$</span>status_yr</span>
<span id="cb148-757"><a href="functions-for-difference-in-difference-computations.html#cb148-757" tabindex="-1"></a>      </span>
<span id="cb148-758"><a href="functions-for-difference-in-difference-computations.html#cb148-758" tabindex="-1"></a>      <span class="do">##Extract funding years</span></span>
<span id="cb148-759"><a href="functions-for-difference-in-difference-computations.html#cb148-759" tabindex="-1"></a>      df_fund_yr <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-760"><a href="functions-for-difference-in-difference-computations.html#cb148-760" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-761"><a href="functions-for-difference-in-difference-computations.html#cb148-761" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-762"><a href="functions-for-difference-in-difference-computations.html#cb148-762" tabindex="-1"></a>      funding.years <span class="ot">=</span> df_fund_yr<span class="sc">$</span>year_funding_first</span>
<span id="cb148-763"><a href="functions-for-difference-in-difference-computations.html#cb148-763" tabindex="-1"></a>      list.funding.years <span class="ot">=</span> df_fund_yr<span class="sc">$</span>year_funding_all</span>
<span id="cb148-764"><a href="functions-for-difference-in-difference-computations.html#cb148-764" tabindex="-1"></a>      </span>
<span id="cb148-765"><a href="functions-for-difference-in-difference-computations.html#cb148-765" tabindex="-1"></a>      <span class="do">##Extract country name</span></span>
<span id="cb148-766"><a href="functions-for-difference-in-difference-computations.html#cb148-766" tabindex="-1"></a>      <span class="co"># country.name = df_long %&gt;% </span></span>
<span id="cb148-767"><a href="functions-for-difference-in-difference-computations.html#cb148-767" tabindex="-1"></a>      <span class="co">#   filter(group == 2) %&gt;% </span></span>
<span id="cb148-768"><a href="functions-for-difference-in-difference-computations.html#cb148-768" tabindex="-1"></a>      <span class="co">#   slice(1)</span></span>
<span id="cb148-769"><a href="functions-for-difference-in-difference-computations.html#cb148-769" tabindex="-1"></a>      <span class="co"># country.name = country.name$country_en</span></span>
<span id="cb148-770"><a href="functions-for-difference-in-difference-computations.html#cb148-770" tabindex="-1"></a>      </span>
<span id="cb148-771"><a href="functions-for-difference-in-difference-computations.html#cb148-771" tabindex="-1"></a>      <span class="do">##Extract country iso</span></span>
<span id="cb148-772"><a href="functions-for-difference-in-difference-computations.html#cb148-772" tabindex="-1"></a>      country.iso <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-773"><a href="functions-for-difference-in-difference-computations.html#cb148-773" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-774"><a href="functions-for-difference-in-difference-computations.html#cb148-774" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-775"><a href="functions-for-difference-in-difference-computations.html#cb148-775" tabindex="-1"></a>      country.iso <span class="ot">=</span> country.iso<span class="sc">$</span>iso3</span>
<span id="cb148-776"><a href="functions-for-difference-in-difference-computations.html#cb148-776" tabindex="-1"></a>      </span>
<span id="cb148-777"><a href="functions-for-difference-in-difference-computations.html#cb148-777" tabindex="-1"></a>      <span class="do">##Extract region name</span></span>
<span id="cb148-778"><a href="functions-for-difference-in-difference-computations.html#cb148-778" tabindex="-1"></a>      region.name <span class="ot">=</span> df_long <span class="sc">%&gt;%</span> </span>
<span id="cb148-779"><a href="functions-for-difference-in-difference-computations.html#cb148-779" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-780"><a href="functions-for-difference-in-difference-computations.html#cb148-780" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-781"><a href="functions-for-difference-in-difference-computations.html#cb148-781" tabindex="-1"></a>      region.name <span class="ot">=</span> region.name<span class="sc">$</span>region</span>
<span id="cb148-782"><a href="functions-for-difference-in-difference-computations.html#cb148-782" tabindex="-1"></a>      </span>
<span id="cb148-783"><a href="functions-for-difference-in-difference-computations.html#cb148-783" tabindex="-1"></a>      <span class="do">##Extract more information not in the matched dataframe</span></span>
<span id="cb148-784"><a href="functions-for-difference-in-difference-computations.html#cb148-784" tabindex="-1"></a>      <span class="do">### Area</span></span>
<span id="cb148-785"><a href="functions-for-difference-in-difference-computations.html#cb148-785" tabindex="-1"></a>      wdpa_id <span class="ot">=</span> wdpaid <span class="co">#Need to give a name to wdpaid (function argument) different from the varaible in the dataset (wdpaid)</span></span>
<span id="cb148-786"><a href="functions-for-difference-in-difference-computations.html#cb148-786" tabindex="-1"></a>      area_ha <span class="ot">=</span> data_pa[data_pa<span class="sc">$</span>wdpaid <span class="sc">==</span> wdpa_id,]<span class="sc">$</span>area_km2<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb148-787"><a href="functions-for-difference-in-difference-computations.html#cb148-787" tabindex="-1"></a>      <span class="do">### Name of the PA</span></span>
<span id="cb148-788"><a href="functions-for-difference-in-difference-computations.html#cb148-788" tabindex="-1"></a>      pa.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-789"><a href="functions-for-difference-in-difference-computations.html#cb148-789" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-790"><a href="functions-for-difference-in-difference-computations.html#cb148-790" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-791"><a href="functions-for-difference-in-difference-computations.html#cb148-791" tabindex="-1"></a>      pa.name <span class="ot">=</span> pa.name<span class="sc">$</span>name_pa</span>
<span id="cb148-792"><a href="functions-for-difference-in-difference-computations.html#cb148-792" tabindex="-1"></a>      <span class="do">### Country name</span></span>
<span id="cb148-793"><a href="functions-for-difference-in-difference-computations.html#cb148-793" tabindex="-1"></a>      country.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-794"><a href="functions-for-difference-in-difference-computations.html#cb148-794" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-795"><a href="functions-for-difference-in-difference-computations.html#cb148-795" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-796"><a href="functions-for-difference-in-difference-computations.html#cb148-796" tabindex="-1"></a>      country.name <span class="ot">=</span> country.name<span class="sc">$</span>country_en</span>
<span id="cb148-797"><a href="functions-for-difference-in-difference-computations.html#cb148-797" tabindex="-1"></a>      <span class="do">### WDPA status</span></span>
<span id="cb148-798"><a href="functions-for-difference-in-difference-computations.html#cb148-798" tabindex="-1"></a>      status.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-799"><a href="functions-for-difference-in-difference-computations.html#cb148-799" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-800"><a href="functions-for-difference-in-difference-computations.html#cb148-800" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-801"><a href="functions-for-difference-in-difference-computations.html#cb148-801" tabindex="-1"></a>      status.wdpa <span class="ot">=</span> status.wdpa<span class="sc">$</span>status</span>
<span id="cb148-802"><a href="functions-for-difference-in-difference-computations.html#cb148-802" tabindex="-1"></a>      <span class="do">### IUCN category and description</span></span>
<span id="cb148-803"><a href="functions-for-difference-in-difference-computations.html#cb148-803" tabindex="-1"></a>      iucn.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-804"><a href="functions-for-difference-in-difference-computations.html#cb148-804" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-805"><a href="functions-for-difference-in-difference-computations.html#cb148-805" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-806"><a href="functions-for-difference-in-difference-computations.html#cb148-806" tabindex="-1"></a>      iucn.cat <span class="ot">=</span> iucn.wdpa<span class="sc">$</span>iucn_cat</span>
<span id="cb148-807"><a href="functions-for-difference-in-difference-computations.html#cb148-807" tabindex="-1"></a>      iucn.des <span class="ot">=</span> iucn.wdpa<span class="sc">$</span>iucn_des_en</span>
<span id="cb148-808"><a href="functions-for-difference-in-difference-computations.html#cb148-808" tabindex="-1"></a>      <span class="do">### Ecosystem</span></span>
<span id="cb148-809"><a href="functions-for-difference-in-difference-computations.html#cb148-809" tabindex="-1"></a>      eco.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-810"><a href="functions-for-difference-in-difference-computations.html#cb148-810" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-811"><a href="functions-for-difference-in-difference-computations.html#cb148-811" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-812"><a href="functions-for-difference-in-difference-computations.html#cb148-812" tabindex="-1"></a>      eco.wdpa <span class="ot">=</span> eco.wdpa<span class="sc">$</span>marine</span>
<span id="cb148-813"><a href="functions-for-difference-in-difference-computations.html#cb148-813" tabindex="-1"></a>      <span class="do">### Governance</span></span>
<span id="cb148-814"><a href="functions-for-difference-in-difference-computations.html#cb148-814" tabindex="-1"></a>      gov.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-815"><a href="functions-for-difference-in-difference-computations.html#cb148-815" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-816"><a href="functions-for-difference-in-difference-computations.html#cb148-816" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-817"><a href="functions-for-difference-in-difference-computations.html#cb148-817" tabindex="-1"></a>      gov.wdpa <span class="ot">=</span> gov.wdpa<span class="sc">$</span>gov_type</span>
<span id="cb148-818"><a href="functions-for-difference-in-difference-computations.html#cb148-818" tabindex="-1"></a>      <span class="do">### Owner</span></span>
<span id="cb148-819"><a href="functions-for-difference-in-difference-computations.html#cb148-819" tabindex="-1"></a>      own.wdpa <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-820"><a href="functions-for-difference-in-difference-computations.html#cb148-820" tabindex="-1"></a>        <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-821"><a href="functions-for-difference-in-difference-computations.html#cb148-821" tabindex="-1"></a>        <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-822"><a href="functions-for-difference-in-difference-computations.html#cb148-822" tabindex="-1"></a>      own.wdpa <span class="ot">=</span> own.wdpa<span class="sc">$</span>own_type</span>
<span id="cb148-823"><a href="functions-for-difference-in-difference-computations.html#cb148-823" tabindex="-1"></a>      </span>
<span id="cb148-824"><a href="functions-for-difference-in-difference-computations.html#cb148-824" tabindex="-1"></a>      <span class="co">#Extract number of pixels in the PA</span></span>
<span id="cb148-825"><a href="functions-for-difference-in-difference-computations.html#cb148-825" tabindex="-1"></a>      <span class="co">#n_pix_pa = length(unique(filter(df_long_unm, group == 2)$assetid))</span></span>
<span id="cb148-826"><a href="functions-for-difference-in-difference-computations.html#cb148-826" tabindex="-1"></a>      n_pix_pa <span class="ot">=</span> area_ha<span class="sc">/</span>res_ha</span>
<span id="cb148-827"><a href="functions-for-difference-in-difference-computations.html#cb148-827" tabindex="-1"></a>      </span>
<span id="cb148-828"><a href="functions-for-difference-in-difference-computations.html#cb148-828" tabindex="-1"></a>      <span class="co">#Average forest cover in a treated pixel in 2000</span></span>
<span id="cb148-829"><a href="functions-for-difference-in-difference-computations.html#cb148-829" tabindex="-1"></a>      <span class="do">## For matched </span></span>
<span id="cb148-830"><a href="functions-for-difference-in-difference-computations.html#cb148-830" tabindex="-1"></a>      avgFC_2000_m <span class="ot">=</span> df_long_m <span class="sc">%&gt;%</span> </span>
<span id="cb148-831"><a href="functions-for-difference-in-difference-computations.html#cb148-831" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2000</span>) </span>
<span id="cb148-832"><a href="functions-for-difference-in-difference-computations.html#cb148-832" tabindex="-1"></a>      avgFC_2000_m <span class="ot">=</span> <span class="fu">mean</span>(avgFC_2000_m<span class="sc">$</span>fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-833"><a href="functions-for-difference-in-difference-computations.html#cb148-833" tabindex="-1"></a>      <span class="do">## For unmatched</span></span>
<span id="cb148-834"><a href="functions-for-difference-in-difference-computations.html#cb148-834" tabindex="-1"></a>      avgFC_2000_unm <span class="ot">=</span> df_long_unm <span class="sc">%&gt;%</span> </span>
<span id="cb148-835"><a href="functions-for-difference-in-difference-computations.html#cb148-835" tabindex="-1"></a>        <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="dv">2000</span>) </span>
<span id="cb148-836"><a href="functions-for-difference-in-difference-computations.html#cb148-836" tabindex="-1"></a>      avgFC_2000_unm <span class="ot">=</span> <span class="fu">mean</span>(avgFC_2000_unm<span class="sc">$</span>fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-837"><a href="functions-for-difference-in-difference-computations.html#cb148-837" tabindex="-1"></a>      </span>
<span id="cb148-838"><a href="functions-for-difference-in-difference-computations.html#cb148-838" tabindex="-1"></a>      <span class="co">#Then modify the dataframe before DiD computations</span></span>
<span id="cb148-839"><a href="functions-for-difference-in-difference-computations.html#cb148-839" tabindex="-1"></a>      <span class="do">## Set treatment year = 0 for controls (necessary for did package to consider &quot;never treated&quot; units)</span></span>
<span id="cb148-840"><a href="functions-for-difference-in-difference-computations.html#cb148-840" tabindex="-1"></a>      <span class="do">## Compute cumulative deforestation relative to 2000 forest cover (outcome where TE is computed)</span></span>
<span id="cb148-841"><a href="functions-for-difference-in-difference-computations.html#cb148-841" tabindex="-1"></a>      df_did <span class="ot">=</span> df_long <span class="sc">%&gt;%</span></span>
<span id="cb148-842"><a href="functions-for-difference-in-difference-computations.html#cb148-842" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">treatment_year =</span> <span class="fu">case_when</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb148-843"><a href="functions-for-difference-in-difference-computations.html#cb148-843" tabindex="-1"></a>                                          group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span>status_yr), <span class="co">#Set treatment year to 0 for control units (required by did::att_gt)</span></span>
<span id="cb148-844"><a href="functions-for-difference-in-difference-computations.html#cb148-844" tabindex="-1"></a>               <span class="at">time =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="at">yes =</span> year<span class="sc">-</span>treatment_year, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-845"><a href="functions-for-difference-in-difference-computations.html#cb148-845" tabindex="-1"></a>               <span class="at">.after =</span> status_yr) <span class="sc">%&gt;%</span></span>
<span id="cb148-846"><a href="functions-for-difference-in-difference-computations.html#cb148-846" tabindex="-1"></a>        <span class="fu">group_by</span>(assetid) <span class="sc">%&gt;%</span></span>
<span id="cb148-847"><a href="functions-for-difference-in-difference-computations.html#cb148-847" tabindex="-1"></a>        <span class="co"># mutate(FL_2000_cum = (fc_ha-fc_ha[year == 2000])/fc_ha[year == 2000]*100,</span></span>
<span id="cb148-848"><a href="functions-for-difference-in-difference-computations.html#cb148-848" tabindex="-1"></a>        <span class="co">#        fc_2000 = fc_ha[year == 2000]) %&gt;%</span></span>
<span id="cb148-849"><a href="functions-for-difference-in-difference-computations.html#cb148-849" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">FL_2000_cum =</span> <span class="fu">case_when</span>(fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> (fc_ha<span class="sc">-</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>])<span class="sc">/</span>fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>]<span class="sc">*</span><span class="dv">100</span>, </span>
<span id="cb148-850"><a href="functions-for-difference-in-difference-computations.html#cb148-850" tabindex="-1"></a>                                       <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-851"><a href="functions-for-difference-in-difference-computations.html#cb148-851" tabindex="-1"></a>        <span class="fu">ungroup</span>()</span>
<span id="cb148-852"><a href="functions-for-difference-in-difference-computations.html#cb148-852" tabindex="-1"></a>      </span>
<span id="cb148-853"><a href="functions-for-difference-in-difference-computations.html#cb148-853" tabindex="-1"></a>      </span>
<span id="cb148-854"><a href="functions-for-difference-in-difference-computations.html#cb148-854" tabindex="-1"></a>      <span class="do">##Average forest cover in 2000 in a pixel, and average share of forest cover in a pixel</span></span>
<span id="cb148-855"><a href="functions-for-difference-in-difference-computations.html#cb148-855" tabindex="-1"></a>      <span class="co"># fc_2000_avg = mean(df_did[df_did$group == 2,]$fc_2000, na.rm = TRUE)</span></span>
<span id="cb148-856"><a href="functions-for-difference-in-difference-computations.html#cb148-856" tabindex="-1"></a>      <span class="co"># per_fc_2000_avg = min(fc_2000_avg/res_ha, 1) #Take the min as in some cases, reported forest cover is higher than pixel area</span></span>
<span id="cb148-857"><a href="functions-for-difference-in-difference-computations.html#cb148-857" tabindex="-1"></a>      </span>
<span id="cb148-858"><a href="functions-for-difference-in-difference-computations.html#cb148-858" tabindex="-1"></a>      <span class="co">#Compute dynamic TE with did package. </span></span>
<span id="cb148-859"><a href="functions-for-difference-in-difference-computations.html#cb148-859" tabindex="-1"></a>      <span class="do">## Control are &quot;never treated&quot; units, no covariate is added in the regression estimated with doubly-robust method</span></span>
<span id="cb148-860"><a href="functions-for-difference-in-difference-computations.html#cb148-860" tabindex="-1"></a>      <span class="do">## standard errors are computed with bootstrap, and confidence intervals computed from it.</span></span>
<span id="cb148-861"><a href="functions-for-difference-in-difference-computations.html#cb148-861" tabindex="-1"></a>      <span class="do">## No clustering is performed as it does not seem relevant in our case (https://blogs.worldbank.org/impactevaluations/when-should-you-cluster-standard-errors-new-wisdom-econometrics-oracle)</span></span>
<span id="cb148-862"><a href="functions-for-difference-in-difference-computations.html#cb148-862" tabindex="-1"></a>      <span class="do">## Pseudo treatment effect are computed for each pre-treatment year (varying base period)</span></span>
<span id="cb148-863"><a href="functions-for-difference-in-difference-computations.html#cb148-863" tabindex="-1"></a>      </span>
<span id="cb148-864"><a href="functions-for-difference-in-difference-computations.html#cb148-864" tabindex="-1"></a>      <span class="do">##For forest cover (ha and %)</span></span>
<span id="cb148-865"><a href="functions-for-difference-in-difference-computations.html#cb148-865" tabindex="-1"></a>      <span class="do">### treatment effect computation</span></span>
<span id="cb148-866"><a href="functions-for-difference-in-difference-computations.html#cb148-866" tabindex="-1"></a>      fc_attgt <span class="ot">=</span> did<span class="sc">::</span><span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">&quot;fc_ha&quot;</span>,</span>
<span id="cb148-867"><a href="functions-for-difference-in-difference-computations.html#cb148-867" tabindex="-1"></a>                             <span class="at">gname =</span> <span class="st">&quot;treatment_year&quot;</span>,</span>
<span id="cb148-868"><a href="functions-for-difference-in-difference-computations.html#cb148-868" tabindex="-1"></a>                             <span class="at">idname =</span> <span class="st">&quot;assetid&quot;</span>,</span>
<span id="cb148-869"><a href="functions-for-difference-in-difference-computations.html#cb148-869" tabindex="-1"></a>                             <span class="at">tname =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb148-870"><a href="functions-for-difference-in-difference-computations.html#cb148-870" tabindex="-1"></a>                             <span class="at">control_group =</span> <span class="st">&quot;nevertreated&quot;</span>, <span class="co">#Thsi corresponds to control pixels as defined in the matching , with treatment year set to 0</span></span>
<span id="cb148-871"><a href="functions-for-difference-in-difference-computations.html#cb148-871" tabindex="-1"></a>                             <span class="at">xformla =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb148-872"><a href="functions-for-difference-in-difference-computations.html#cb148-872" tabindex="-1"></a>                             <span class="at">alp =</span> alpha, <span class="co">#For 95% confidence interval</span></span>
<span id="cb148-873"><a href="functions-for-difference-in-difference-computations.html#cb148-873" tabindex="-1"></a>                             <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>, <span class="co">#Ensure no unit is dropped, though every pixel should have data for all years in the period</span></span>
<span id="cb148-874"><a href="functions-for-difference-in-difference-computations.html#cb148-874" tabindex="-1"></a>                             <span class="at">bstrap=</span><span class="cn">TRUE</span>, <span class="co">#Compute bootstrap CI</span></span>
<span id="cb148-875"><a href="functions-for-difference-in-difference-computations.html#cb148-875" tabindex="-1"></a>                             <span class="at">biters =</span> <span class="dv">1000</span>, <span class="co">#The number of bootstrap iteration, 1000 is default</span></span>
<span id="cb148-876"><a href="functions-for-difference-in-difference-computations.html#cb148-876" tabindex="-1"></a>                             <span class="at">cband =</span> <span class="cn">TRUE</span>, <span class="co">#Compute CI</span></span>
<span id="cb148-877"><a href="functions-for-difference-in-difference-computations.html#cb148-877" tabindex="-1"></a>                             <span class="at">clustervars =</span> <span class="cn">NULL</span>, <span class="co">#No clustering seems relevant to me </span></span>
<span id="cb148-878"><a href="functions-for-difference-in-difference-computations.html#cb148-878" tabindex="-1"></a>                             <span class="at">base_period =</span> <span class="st">&quot;varying&quot;</span>,</span>
<span id="cb148-879"><a href="functions-for-difference-in-difference-computations.html#cb148-879" tabindex="-1"></a>                             <span class="at">data =</span> df_did,</span>
<span id="cb148-880"><a href="functions-for-difference-in-difference-computations.html#cb148-880" tabindex="-1"></a>                             <span class="at">print_details =</span> F)</span>
<span id="cb148-881"><a href="functions-for-difference-in-difference-computations.html#cb148-881" tabindex="-1"></a>      <span class="do">##For change in deforestation rate (percentage points)</span></span>
<span id="cb148-882"><a href="functions-for-difference-in-difference-computations.html#cb148-882" tabindex="-1"></a>      fl_attgt <span class="ot">=</span> did<span class="sc">::</span><span class="fu">att_gt</span>(<span class="at">yname =</span> <span class="st">&quot;FL_2000_cum&quot;</span>,</span>
<span id="cb148-883"><a href="functions-for-difference-in-difference-computations.html#cb148-883" tabindex="-1"></a>                             <span class="at">gname =</span> <span class="st">&quot;treatment_year&quot;</span>,</span>
<span id="cb148-884"><a href="functions-for-difference-in-difference-computations.html#cb148-884" tabindex="-1"></a>                             <span class="at">idname =</span> <span class="st">&quot;assetid&quot;</span>,</span>
<span id="cb148-885"><a href="functions-for-difference-in-difference-computations.html#cb148-885" tabindex="-1"></a>                             <span class="at">tname =</span> <span class="st">&quot;year&quot;</span>,</span>
<span id="cb148-886"><a href="functions-for-difference-in-difference-computations.html#cb148-886" tabindex="-1"></a>                             <span class="at">control_group =</span> <span class="st">&quot;nevertreated&quot;</span>, <span class="co">#Thsi corresponds to control pixels as defined in the matching , with treatment year set to 0</span></span>
<span id="cb148-887"><a href="functions-for-difference-in-difference-computations.html#cb148-887" tabindex="-1"></a>                             <span class="at">xformla =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb148-888"><a href="functions-for-difference-in-difference-computations.html#cb148-888" tabindex="-1"></a>                             <span class="at">alp =</span> alpha, <span class="co">#For 95% confidence interval</span></span>
<span id="cb148-889"><a href="functions-for-difference-in-difference-computations.html#cb148-889" tabindex="-1"></a>                             <span class="at">allow_unbalanced_panel =</span> <span class="cn">TRUE</span>, <span class="co">#Ensure no unit is dropped, though every pixel should have data for all years in the period</span></span>
<span id="cb148-890"><a href="functions-for-difference-in-difference-computations.html#cb148-890" tabindex="-1"></a>                             <span class="at">bstrap=</span><span class="cn">TRUE</span>, <span class="co">#Compute bootstrap CI</span></span>
<span id="cb148-891"><a href="functions-for-difference-in-difference-computations.html#cb148-891" tabindex="-1"></a>                             <span class="at">biters =</span> <span class="dv">1000</span>, <span class="co">#The number of bootstrap iteration, 1000 is default</span></span>
<span id="cb148-892"><a href="functions-for-difference-in-difference-computations.html#cb148-892" tabindex="-1"></a>                             <span class="at">cband =</span> <span class="cn">TRUE</span>, <span class="co">#Compute CI</span></span>
<span id="cb148-893"><a href="functions-for-difference-in-difference-computations.html#cb148-893" tabindex="-1"></a>                             <span class="at">clustervars =</span> <span class="cn">NULL</span>, <span class="co">#No clustering seems relevant to me</span></span>
<span id="cb148-894"><a href="functions-for-difference-in-difference-computations.html#cb148-894" tabindex="-1"></a>                             <span class="at">base_period =</span> <span class="st">&quot;varying&quot;</span>,</span>
<span id="cb148-895"><a href="functions-for-difference-in-difference-computations.html#cb148-895" tabindex="-1"></a>                             <span class="at">data =</span> df_did,</span>
<span id="cb148-896"><a href="functions-for-difference-in-difference-computations.html#cb148-896" tabindex="-1"></a>                             <span class="at">print_details =</span> F)</span>
<span id="cb148-897"><a href="functions-for-difference-in-difference-computations.html#cb148-897" tabindex="-1"></a>      </span>
<span id="cb148-898"><a href="functions-for-difference-in-difference-computations.html#cb148-898" tabindex="-1"></a>      </span>
<span id="cb148-899"><a href="functions-for-difference-in-difference-computations.html#cb148-899" tabindex="-1"></a>      <span class="do">### Report results in a dataframe</span></span>
<span id="cb148-900"><a href="functions-for-difference-in-difference-computations.html#cb148-900" tabindex="-1"></a>      <span class="do">### The treatment effect computed is at pixel level (avoided deforestation in a pixel, in ha)</span></span>
<span id="cb148-901"><a href="functions-for-difference-in-difference-computations.html#cb148-901" tabindex="-1"></a>      <span class="do">### This treatment effect is aggregated to PA by multiplying treatment effect by the number of pixel in the PA. It is also expressed in percentage of pixel area (avoided deforestation in share of pixel area)</span></span>
<span id="cb148-902"><a href="functions-for-difference-in-difference-computations.html#cb148-902" tabindex="-1"></a>      <span class="do">### confidence intervals (at pixel level) are computed from bootstrap standard errors after a coefficient is applied.</span></span>
<span id="cb148-903"><a href="functions-for-difference-in-difference-computations.html#cb148-903" tabindex="-1"></a>      <span class="do">### This computation takes the one from did:::summary.MP function, line 15 and 16. </span></span>
<span id="cb148-904"><a href="functions-for-difference-in-difference-computations.html#cb148-904" tabindex="-1"></a>      <span class="do">### They are multiplied by the number of pixels to compute CI for treatment effect at PA level </span></span>
<span id="cb148-905"><a href="functions-for-difference-in-difference-computations.html#cb148-905" tabindex="-1"></a>      <span class="do">### They are divided by the pixel area to compute CI for treatment effect in percentage of pixel area</span></span>
<span id="cb148-906"><a href="functions-for-difference-in-difference-computations.html#cb148-906" tabindex="-1"></a>      df_fc_attgt <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">&quot;treatment_year&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>group,</span>
<span id="cb148-907"><a href="functions-for-difference-in-difference-computations.html#cb148-907" tabindex="-1"></a>                               <span class="st">&quot;year&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>t,</span>
<span id="cb148-908"><a href="functions-for-difference-in-difference-computations.html#cb148-908" tabindex="-1"></a>                               <span class="st">&quot;att_pix&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>att,</span>
<span id="cb148-909"><a href="functions-for-difference-in-difference-computations.html#cb148-909" tabindex="-1"></a>                               <span class="st">&quot;c&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>c,</span>
<span id="cb148-910"><a href="functions-for-difference-in-difference-computations.html#cb148-910" tabindex="-1"></a>                               <span class="st">&quot;se&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>se,  </span>
<span id="cb148-911"><a href="functions-for-difference-in-difference-computations.html#cb148-911" tabindex="-1"></a>                               <span class="st">&quot;n&quot;</span> <span class="ot">=</span> fc_attgt<span class="sc">$</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb148-912"><a href="functions-for-difference-in-difference-computations.html#cb148-912" tabindex="-1"></a>        <span class="co">#Compute treatment effect at PA level and in share of pixel area</span></span>
<span id="cb148-913"><a href="functions-for-difference-in-difference-computations.html#cb148-913" tabindex="-1"></a>        <span class="do">## att_pa : the total avoided deforestation is the avoided deforestation in ha in a given pixel, multiplied by the number of pixel in the PA.</span></span>
<span id="cb148-914"><a href="functions-for-difference-in-difference-computations.html#cb148-914" tabindex="-1"></a>        <span class="do">## att_per : avoided deforestation in a pixel, as a share of average forest cover in 2000 in matched treated. Can be extrapolated to full PA in principle (avoided deforestation in share of 2000 forest cover)</span></span>
<span id="cb148-915"><a href="functions-for-difference-in-difference-computations.html#cb148-915" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">att_pa =</span> att_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-916"><a href="functions-for-difference-in-difference-computations.html#cb148-916" tabindex="-1"></a>               <span class="at">att_per =</span> att_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-917"><a href="functions-for-difference-in-difference-computations.html#cb148-917" tabindex="-1"></a>        <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-918"><a href="functions-for-difference-in-difference-computations.html#cb148-918" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-919"><a href="functions-for-difference-in-difference-computations.html#cb148-919" tabindex="-1"></a>               <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-920"><a href="functions-for-difference-in-difference-computations.html#cb148-920" tabindex="-1"></a>        <span class="co">#Compute confidence intervals</span></span>
<span id="cb148-921"><a href="functions-for-difference-in-difference-computations.html#cb148-921" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cband_lower_pix =</span> <span class="fu">round</span>(att_pix<span class="sc">-</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-922"><a href="functions-for-difference-in-difference-computations.html#cb148-922" tabindex="-1"></a>               <span class="at">cband_upper_pix =</span> <span class="fu">round</span>(att_pix<span class="sc">+</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-923"><a href="functions-for-difference-in-difference-computations.html#cb148-923" tabindex="-1"></a>               <span class="at">cband_lower_pa =</span> cband_lower_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-924"><a href="functions-for-difference-in-difference-computations.html#cb148-924" tabindex="-1"></a>               <span class="at">cband_upper_pa =</span> cband_upper_pix<span class="sc">*</span>n_pix_pa,</span>
<span id="cb148-925"><a href="functions-for-difference-in-difference-computations.html#cb148-925" tabindex="-1"></a>               <span class="at">cband_lower_per =</span> cband_lower_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb148-926"><a href="functions-for-difference-in-difference-computations.html#cb148-926" tabindex="-1"></a>               <span class="at">cband_upper_per =</span> cband_upper_pix<span class="sc">/</span>avgFC_2000_m<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb148-927"><a href="functions-for-difference-in-difference-computations.html#cb148-927" tabindex="-1"></a>               <span class="at">sig =</span> <span class="fu">sign</span>(cband_lower_pix) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pix),</span>
<span id="cb148-928"><a href="functions-for-difference-in-difference-computations.html#cb148-928" tabindex="-1"></a>               <span class="at">sig_5 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span><span class="dv">5</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">5</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-929"><a href="functions-for-difference-in-difference-computations.html#cb148-929" tabindex="-1"></a>               <span class="at">sig_10 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">10</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-930"><a href="functions-for-difference-in-difference-computations.html#cb148-930" tabindex="-1"></a>               <span class="at">sig_end =</span> sig[time <span class="sc">==</span> <span class="fu">max</span>(time)] <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-931"><a href="functions-for-difference-in-difference-computations.html#cb148-931" tabindex="-1"></a>               <span class="at">alpha =</span> alpha) <span class="sc">%&gt;%</span></span>
<span id="cb148-932"><a href="functions-for-difference-in-difference-computations.html#cb148-932" tabindex="-1"></a>        <span class="co">#Add relevant information</span></span>
<span id="cb148-933"><a href="functions-for-difference-in-difference-computations.html#cb148-933" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">region =</span> region.name,</span>
<span id="cb148-934"><a href="functions-for-difference-in-difference-computations.html#cb148-934" tabindex="-1"></a>               <span class="at">country_en =</span> country.name,</span>
<span id="cb148-935"><a href="functions-for-difference-in-difference-computations.html#cb148-935" tabindex="-1"></a>               <span class="at">iso3 =</span> country.iso,</span>
<span id="cb148-936"><a href="functions-for-difference-in-difference-computations.html#cb148-936" tabindex="-1"></a>               <span class="at">name_pa =</span> pa.name,</span>
<span id="cb148-937"><a href="functions-for-difference-in-difference-computations.html#cb148-937" tabindex="-1"></a>               <span class="at">wdpaid =</span> wdpaid,</span>
<span id="cb148-938"><a href="functions-for-difference-in-difference-computations.html#cb148-938" tabindex="-1"></a>               <span class="at">res_ha =</span> res_ha,</span>
<span id="cb148-939"><a href="functions-for-difference-in-difference-computations.html#cb148-939" tabindex="-1"></a>               <span class="at">status_wdpa =</span> status.wdpa,</span>
<span id="cb148-940"><a href="functions-for-difference-in-difference-computations.html#cb148-940" tabindex="-1"></a>               <span class="at">iucn_cat =</span> iucn.cat,</span>
<span id="cb148-941"><a href="functions-for-difference-in-difference-computations.html#cb148-941" tabindex="-1"></a>               <span class="at">iucn_des_en =</span> iucn.des,</span>
<span id="cb148-942"><a href="functions-for-difference-in-difference-computations.html#cb148-942" tabindex="-1"></a>               <span class="at">gov_type =</span> gov.wdpa,</span>
<span id="cb148-943"><a href="functions-for-difference-in-difference-computations.html#cb148-943" tabindex="-1"></a>               <span class="at">own_type =</span> own.wdpa,</span>
<span id="cb148-944"><a href="functions-for-difference-in-difference-computations.html#cb148-944" tabindex="-1"></a>               <span class="at">marine =</span> eco.wdpa,</span>
<span id="cb148-945"><a href="functions-for-difference-in-difference-computations.html#cb148-945" tabindex="-1"></a>               <span class="at">funding_year =</span> funding.years,</span>
<span id="cb148-946"><a href="functions-for-difference-in-difference-computations.html#cb148-946" tabindex="-1"></a>               <span class="at">funding_year_list =</span> list.funding.years,</span>
<span id="cb148-947"><a href="functions-for-difference-in-difference-computations.html#cb148-947" tabindex="-1"></a>               <span class="at">.before =</span> <span class="st">&quot;treatment_year&quot;</span>)</span>
<span id="cb148-948"><a href="functions-for-difference-in-difference-computations.html#cb148-948" tabindex="-1"></a>      <span class="co"># Same for treatment effect expressed as a change in deforestation rate</span></span>
<span id="cb148-949"><a href="functions-for-difference-in-difference-computations.html#cb148-949" tabindex="-1"></a>      df_fl_attgt <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="st">&quot;treatment_year&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>group,</span>
<span id="cb148-950"><a href="functions-for-difference-in-difference-computations.html#cb148-950" tabindex="-1"></a>                               <span class="st">&quot;year&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>t,</span>
<span id="cb148-951"><a href="functions-for-difference-in-difference-computations.html#cb148-951" tabindex="-1"></a>                               <span class="st">&quot;att&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>att,</span>
<span id="cb148-952"><a href="functions-for-difference-in-difference-computations.html#cb148-952" tabindex="-1"></a>                               <span class="st">&quot;c&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>c,</span>
<span id="cb148-953"><a href="functions-for-difference-in-difference-computations.html#cb148-953" tabindex="-1"></a>                               <span class="st">&quot;se&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>se,</span>
<span id="cb148-954"><a href="functions-for-difference-in-difference-computations.html#cb148-954" tabindex="-1"></a>                               <span class="st">&quot;n&quot;</span> <span class="ot">=</span> fl_attgt<span class="sc">$</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb148-955"><a href="functions-for-difference-in-difference-computations.html#cb148-955" tabindex="-1"></a>        <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-956"><a href="functions-for-difference-in-difference-computations.html#cb148-956" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-957"><a href="functions-for-difference-in-difference-computations.html#cb148-957" tabindex="-1"></a>               <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-958"><a href="functions-for-difference-in-difference-computations.html#cb148-958" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">cband_lower =</span> <span class="fu">round</span>(att<span class="sc">-</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-959"><a href="functions-for-difference-in-difference-computations.html#cb148-959" tabindex="-1"></a>               <span class="at">cband_upper =</span> <span class="fu">round</span>(att<span class="sc">+</span>c<span class="sc">*</span>se, <span class="dv">4</span>),</span>
<span id="cb148-960"><a href="functions-for-difference-in-difference-computations.html#cb148-960" tabindex="-1"></a>               <span class="at">sig =</span> <span class="fu">sign</span>(cband_lower) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper),</span>
<span id="cb148-961"><a href="functions-for-difference-in-difference-computations.html#cb148-961" tabindex="-1"></a>               <span class="at">sig_5 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span><span class="dv">5</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">5</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-962"><a href="functions-for-difference-in-difference-computations.html#cb148-962" tabindex="-1"></a>               <span class="at">sig_10 =</span> <span class="fu">ifelse</span>(<span class="fu">max</span>(time) <span class="sc">&gt;=</span> <span class="dv">10</span>, <span class="at">yes =</span> sig[time <span class="sc">==</span> <span class="dv">10</span>] <span class="sc">==</span> <span class="cn">TRUE</span>, <span class="at">no =</span> <span class="cn">NA</span>),</span>
<span id="cb148-963"><a href="functions-for-difference-in-difference-computations.html#cb148-963" tabindex="-1"></a>               <span class="at">sig_end =</span> sig[time <span class="sc">==</span> <span class="fu">max</span>(time)] <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-964"><a href="functions-for-difference-in-difference-computations.html#cb148-964" tabindex="-1"></a>               <span class="at">alpha =</span> alpha) <span class="sc">%&gt;%</span></span>
<span id="cb148-965"><a href="functions-for-difference-in-difference-computations.html#cb148-965" tabindex="-1"></a>        <span class="co">#Compute time relative to treatment year</span></span>
<span id="cb148-966"><a href="functions-for-difference-in-difference-computations.html#cb148-966" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">time =</span> year <span class="sc">-</span> treatment_year,</span>
<span id="cb148-967"><a href="functions-for-difference-in-difference-computations.html#cb148-967" tabindex="-1"></a>               <span class="at">.before =</span> year) <span class="sc">%&gt;%</span></span>
<span id="cb148-968"><a href="functions-for-difference-in-difference-computations.html#cb148-968" tabindex="-1"></a>        <span class="co">#Add relevant information</span></span>
<span id="cb148-969"><a href="functions-for-difference-in-difference-computations.html#cb148-969" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">region =</span> region.name,</span>
<span id="cb148-970"><a href="functions-for-difference-in-difference-computations.html#cb148-970" tabindex="-1"></a>               <span class="at">country_en =</span> country.name,</span>
<span id="cb148-971"><a href="functions-for-difference-in-difference-computations.html#cb148-971" tabindex="-1"></a>               <span class="at">iso3 =</span> country.iso,</span>
<span id="cb148-972"><a href="functions-for-difference-in-difference-computations.html#cb148-972" tabindex="-1"></a>               <span class="at">name_pa =</span> pa.name,</span>
<span id="cb148-973"><a href="functions-for-difference-in-difference-computations.html#cb148-973" tabindex="-1"></a>               <span class="at">wdpaid =</span> wdpaid,</span>
<span id="cb148-974"><a href="functions-for-difference-in-difference-computations.html#cb148-974" tabindex="-1"></a>               <span class="at">res_ha =</span> res_ha,</span>
<span id="cb148-975"><a href="functions-for-difference-in-difference-computations.html#cb148-975" tabindex="-1"></a>               <span class="at">status_wdpa =</span> status.wdpa,</span>
<span id="cb148-976"><a href="functions-for-difference-in-difference-computations.html#cb148-976" tabindex="-1"></a>               <span class="at">iucn_cat =</span> iucn.cat,</span>
<span id="cb148-977"><a href="functions-for-difference-in-difference-computations.html#cb148-977" tabindex="-1"></a>               <span class="at">iucn_des_en =</span> iucn.des,</span>
<span id="cb148-978"><a href="functions-for-difference-in-difference-computations.html#cb148-978" tabindex="-1"></a>               <span class="at">gov_type =</span> gov.wdpa,</span>
<span id="cb148-979"><a href="functions-for-difference-in-difference-computations.html#cb148-979" tabindex="-1"></a>               <span class="at">own_type =</span> own.wdpa,</span>
<span id="cb148-980"><a href="functions-for-difference-in-difference-computations.html#cb148-980" tabindex="-1"></a>               <span class="at">marine =</span> eco.wdpa,</span>
<span id="cb148-981"><a href="functions-for-difference-in-difference-computations.html#cb148-981" tabindex="-1"></a>               <span class="at">funding_year =</span> funding.years,</span>
<span id="cb148-982"><a href="functions-for-difference-in-difference-computations.html#cb148-982" tabindex="-1"></a>               <span class="at">funding_year_list =</span> list.funding.years,</span>
<span id="cb148-983"><a href="functions-for-difference-in-difference-computations.html#cb148-983" tabindex="-1"></a>               <span class="at">.before =</span> <span class="st">&quot;treatment_year&quot;</span>)</span>
<span id="cb148-984"><a href="functions-for-difference-in-difference-computations.html#cb148-984" tabindex="-1"></a>      </span>
<span id="cb148-985"><a href="functions-for-difference-in-difference-computations.html#cb148-985" tabindex="-1"></a>      <span class="do">###Plot results</span></span>
<span id="cb148-986"><a href="functions-for-difference-in-difference-computations.html#cb148-986" tabindex="-1"></a>      <span class="do">## treatment effect : avoided deforestation at pixel level (in ha)</span></span>
<span id="cb148-987"><a href="functions-for-difference-in-difference-computations.html#cb148-987" tabindex="-1"></a>      fig_att_pix <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-988"><a href="functions-for-difference-in-difference-computations.html#cb148-988" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_pix)) <span class="sc">%&gt;%</span></span>
<span id="cb148-989"><a href="functions-for-difference-in-difference-computations.html#cb148-989" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-990"><a href="functions-for-difference-in-difference-computations.html#cb148-990" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-991"><a href="functions-for-difference-in-difference-computations.html#cb148-991" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_pix, <span class="at">ymax =</span> cband_upper_pix),</span>
<span id="cb148-992"><a href="functions-for-difference-in-difference-computations.html#cb148-992" tabindex="-1"></a>                      <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-993"><a href="functions-for-difference-in-difference-computations.html#cb148-993" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-994"><a href="functions-for-difference-in-difference-computations.html#cb148-994" tabindex="-1"></a>                              <span class="at">yes =</span> <span class="st">&quot;Deforestation avoided in a pixel,on average (matched)&quot;</span>,</span>
<span id="cb148-995"><a href="functions-for-difference-in-difference-computations.html#cb148-995" tabindex="-1"></a>                              <span class="at">no =</span> <span class="st">&quot;Deforestation avoided in a pixel,on average (unmatched)&quot;</span>),</span>
<span id="cb148-996"><a href="functions-for-difference-in-difference-computations.html#cb148-996" tabindex="-1"></a>               <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-997"><a href="functions-for-difference-in-difference-computations.html#cb148-997" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the deforestation avoided at pixel level in hectare, due to the conservation program.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-998"><a href="functions-for-difference-in-difference-computations.html#cb148-998" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">&quot;Area (ha)&quot;</span>,</span>
<span id="cb148-999"><a href="functions-for-difference-in-difference-computations.html#cb148-999" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1000"><a href="functions-for-difference-in-difference-computations.html#cb148-1000" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1001"><a href="functions-for-difference-in-difference-computations.html#cb148-1001" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1002"><a href="functions-for-difference-in-difference-computations.html#cb148-1002" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1003"><a href="functions-for-difference-in-difference-computations.html#cb148-1003" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1004"><a href="functions-for-difference-in-difference-computations.html#cb148-1004" tabindex="-1"></a>          <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1005"><a href="functions-for-difference-in-difference-computations.html#cb148-1005" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1006"><a href="functions-for-difference-in-difference-computations.html#cb148-1006" tabindex="-1"></a>          </span>
<span id="cb148-1007"><a href="functions-for-difference-in-difference-computations.html#cb148-1007" tabindex="-1"></a>          <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1008"><a href="functions-for-difference-in-difference-computations.html#cb148-1008" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1009"><a href="functions-for-difference-in-difference-computations.html#cb148-1009" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1010"><a href="functions-for-difference-in-difference-computations.html#cb148-1010" tabindex="-1"></a>          </span>
<span id="cb148-1011"><a href="functions-for-difference-in-difference-computations.html#cb148-1011" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1012"><a href="functions-for-difference-in-difference-computations.html#cb148-1012" tabindex="-1"></a>          </span>
<span id="cb148-1013"><a href="functions-for-difference-in-difference-computations.html#cb148-1013" tabindex="-1"></a>          <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1014"><a href="functions-for-difference-in-difference-computations.html#cb148-1014" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1015"><a href="functions-for-difference-in-difference-computations.html#cb148-1015" tabindex="-1"></a>          <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1016"><a href="functions-for-difference-in-difference-computations.html#cb148-1016" tabindex="-1"></a>          <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1017"><a href="functions-for-difference-in-difference-computations.html#cb148-1017" tabindex="-1"></a>          <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-1018"><a href="functions-for-difference-in-difference-computations.html#cb148-1018" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1019"><a href="functions-for-difference-in-difference-computations.html#cb148-1019" tabindex="-1"></a>          </span>
<span id="cb148-1020"><a href="functions-for-difference-in-difference-computations.html#cb148-1020" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1021"><a href="functions-for-difference-in-difference-computations.html#cb148-1021" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1022"><a href="functions-for-difference-in-difference-computations.html#cb148-1022" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1023"><a href="functions-for-difference-in-difference-computations.html#cb148-1023" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1024"><a href="functions-for-difference-in-difference-computations.html#cb148-1024" tabindex="-1"></a>        )</span>
<span id="cb148-1025"><a href="functions-for-difference-in-difference-computations.html#cb148-1025" tabindex="-1"></a>      </span>
<span id="cb148-1026"><a href="functions-for-difference-in-difference-computations.html#cb148-1026" tabindex="-1"></a>      <span class="co"># treatment effect : avoided deforestation in terms of 2000 forest cover</span></span>
<span id="cb148-1027"><a href="functions-for-difference-in-difference-computations.html#cb148-1027" tabindex="-1"></a>      fig_att_per <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-1028"><a href="functions-for-difference-in-difference-computations.html#cb148-1028" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1029"><a href="functions-for-difference-in-difference-computations.html#cb148-1029" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1030"><a href="functions-for-difference-in-difference-computations.html#cb148-1030" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1031"><a href="functions-for-difference-in-difference-computations.html#cb148-1031" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_per, <span class="at">ymax =</span> cband_upper_per),</span>
<span id="cb148-1032"><a href="functions-for-difference-in-difference-computations.html#cb148-1032" tabindex="-1"></a>                      <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1033"><a href="functions-for-difference-in-difference-computations.html#cb148-1033" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-1034"><a href="functions-for-difference-in-difference-computations.html#cb148-1034" tabindex="-1"></a>                              <span class="at">yes =</span> <span class="st">&quot;Average deforestation avoided relative to 2000 forest cover (matched)&quot;</span>,</span>
<span id="cb148-1035"><a href="functions-for-difference-in-difference-computations.html#cb148-1035" tabindex="-1"></a>                              <span class="at">no =</span> <span class="st">&quot;Average deforestation avoided relative to 2000 forest cover (unmatched)&quot;</span>),</span>
<span id="cb148-1036"><a href="functions-for-difference-in-difference-computations.html#cb148-1036" tabindex="-1"></a>               <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-1037"><a href="functions-for-difference-in-difference-computations.html#cb148-1037" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the deforestation avoided in percentage of 2000 forest cover.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-1038"><a href="functions-for-difference-in-difference-computations.html#cb148-1038" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-1039"><a href="functions-for-difference-in-difference-computations.html#cb148-1039" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1040"><a href="functions-for-difference-in-difference-computations.html#cb148-1040" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1041"><a href="functions-for-difference-in-difference-computations.html#cb148-1041" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1042"><a href="functions-for-difference-in-difference-computations.html#cb148-1042" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1043"><a href="functions-for-difference-in-difference-computations.html#cb148-1043" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1044"><a href="functions-for-difference-in-difference-computations.html#cb148-1044" tabindex="-1"></a>          <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1045"><a href="functions-for-difference-in-difference-computations.html#cb148-1045" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1046"><a href="functions-for-difference-in-difference-computations.html#cb148-1046" tabindex="-1"></a>          </span>
<span id="cb148-1047"><a href="functions-for-difference-in-difference-computations.html#cb148-1047" tabindex="-1"></a>          <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1048"><a href="functions-for-difference-in-difference-computations.html#cb148-1048" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1049"><a href="functions-for-difference-in-difference-computations.html#cb148-1049" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1050"><a href="functions-for-difference-in-difference-computations.html#cb148-1050" tabindex="-1"></a>          </span>
<span id="cb148-1051"><a href="functions-for-difference-in-difference-computations.html#cb148-1051" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1052"><a href="functions-for-difference-in-difference-computations.html#cb148-1052" tabindex="-1"></a>          </span>
<span id="cb148-1053"><a href="functions-for-difference-in-difference-computations.html#cb148-1053" tabindex="-1"></a>          <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1054"><a href="functions-for-difference-in-difference-computations.html#cb148-1054" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1055"><a href="functions-for-difference-in-difference-computations.html#cb148-1055" tabindex="-1"></a>          <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1056"><a href="functions-for-difference-in-difference-computations.html#cb148-1056" tabindex="-1"></a>          <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1057"><a href="functions-for-difference-in-difference-computations.html#cb148-1057" tabindex="-1"></a>          <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-1058"><a href="functions-for-difference-in-difference-computations.html#cb148-1058" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1059"><a href="functions-for-difference-in-difference-computations.html#cb148-1059" tabindex="-1"></a>          </span>
<span id="cb148-1060"><a href="functions-for-difference-in-difference-computations.html#cb148-1060" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1061"><a href="functions-for-difference-in-difference-computations.html#cb148-1061" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1062"><a href="functions-for-difference-in-difference-computations.html#cb148-1062" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1063"><a href="functions-for-difference-in-difference-computations.html#cb148-1063" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1064"><a href="functions-for-difference-in-difference-computations.html#cb148-1064" tabindex="-1"></a>        )</span>
<span id="cb148-1065"><a href="functions-for-difference-in-difference-computations.html#cb148-1065" tabindex="-1"></a>      </span>
<span id="cb148-1066"><a href="functions-for-difference-in-difference-computations.html#cb148-1066" tabindex="-1"></a>      <span class="co"># treatment effect : avoided deforestation in the PA</span></span>
<span id="cb148-1067"><a href="functions-for-difference-in-difference-computations.html#cb148-1067" tabindex="-1"></a>      fig_att_pa <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fc_attgt,</span>
<span id="cb148-1068"><a href="functions-for-difference-in-difference-computations.html#cb148-1068" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1069"><a href="functions-for-difference-in-difference-computations.html#cb148-1069" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1070"><a href="functions-for-difference-in-difference-computations.html#cb148-1070" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1071"><a href="functions-for-difference-in-difference-computations.html#cb148-1071" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower_pa, <span class="at">ymax =</span> cband_upper_pa),</span>
<span id="cb148-1072"><a href="functions-for-difference-in-difference-computations.html#cb148-1072" tabindex="-1"></a>                      <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1073"><a href="functions-for-difference-in-difference-computations.html#cb148-1073" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>, </span>
<span id="cb148-1074"><a href="functions-for-difference-in-difference-computations.html#cb148-1074" tabindex="-1"></a>                              <span class="at">yes =</span> <span class="st">&quot;Total deforestation avoided (matched)&quot;</span>,</span>
<span id="cb148-1075"><a href="functions-for-difference-in-difference-computations.html#cb148-1075" tabindex="-1"></a>                              <span class="at">no =</span> <span class="st">&quot;Total deforestation avoided (unmatched)&quot;</span>),</span>
<span id="cb148-1076"><a href="functions-for-difference-in-difference-computations.html#cb148-1076" tabindex="-1"></a>               <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-1077"><a href="functions-for-difference-in-difference-computations.html#cb148-1077" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>,  <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the total deforestation avoided in the protected areas, in hectare (ha).</span><span class="sc">\n</span><span class="st">This measure is an extrapolation to the full protected area of average avoided deforestation at pixel level.</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-1078"><a href="functions-for-difference-in-difference-computations.html#cb148-1078" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">&quot;Forest area (ha)&quot;</span>,</span>
<span id="cb148-1079"><a href="functions-for-difference-in-difference-computations.html#cb148-1079" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1080"><a href="functions-for-difference-in-difference-computations.html#cb148-1080" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1081"><a href="functions-for-difference-in-difference-computations.html#cb148-1081" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1082"><a href="functions-for-difference-in-difference-computations.html#cb148-1082" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1083"><a href="functions-for-difference-in-difference-computations.html#cb148-1083" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1084"><a href="functions-for-difference-in-difference-computations.html#cb148-1084" tabindex="-1"></a>          <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1085"><a href="functions-for-difference-in-difference-computations.html#cb148-1085" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1086"><a href="functions-for-difference-in-difference-computations.html#cb148-1086" tabindex="-1"></a>          </span>
<span id="cb148-1087"><a href="functions-for-difference-in-difference-computations.html#cb148-1087" tabindex="-1"></a>          <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1088"><a href="functions-for-difference-in-difference-computations.html#cb148-1088" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1089"><a href="functions-for-difference-in-difference-computations.html#cb148-1089" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1090"><a href="functions-for-difference-in-difference-computations.html#cb148-1090" tabindex="-1"></a>          </span>
<span id="cb148-1091"><a href="functions-for-difference-in-difference-computations.html#cb148-1091" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1092"><a href="functions-for-difference-in-difference-computations.html#cb148-1092" tabindex="-1"></a>          </span>
<span id="cb148-1093"><a href="functions-for-difference-in-difference-computations.html#cb148-1093" tabindex="-1"></a>          <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1094"><a href="functions-for-difference-in-difference-computations.html#cb148-1094" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1095"><a href="functions-for-difference-in-difference-computations.html#cb148-1095" tabindex="-1"></a>          <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1096"><a href="functions-for-difference-in-difference-computations.html#cb148-1096" tabindex="-1"></a>          <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1097"><a href="functions-for-difference-in-difference-computations.html#cb148-1097" tabindex="-1"></a>          <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-1098"><a href="functions-for-difference-in-difference-computations.html#cb148-1098" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1099"><a href="functions-for-difference-in-difference-computations.html#cb148-1099" tabindex="-1"></a>          </span>
<span id="cb148-1100"><a href="functions-for-difference-in-difference-computations.html#cb148-1100" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1101"><a href="functions-for-difference-in-difference-computations.html#cb148-1101" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1102"><a href="functions-for-difference-in-difference-computations.html#cb148-1102" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1103"><a href="functions-for-difference-in-difference-computations.html#cb148-1103" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1104"><a href="functions-for-difference-in-difference-computations.html#cb148-1104" tabindex="-1"></a>        )</span>
<span id="cb148-1105"><a href="functions-for-difference-in-difference-computations.html#cb148-1105" tabindex="-1"></a>      </span>
<span id="cb148-1106"><a href="functions-for-difference-in-difference-computations.html#cb148-1106" tabindex="-1"></a>      </span>
<span id="cb148-1107"><a href="functions-for-difference-in-difference-computations.html#cb148-1107" tabindex="-1"></a>      <span class="co"># treatment effect : change in deforestation rate</span></span>
<span id="cb148-1108"><a href="functions-for-difference-in-difference-computations.html#cb148-1108" tabindex="-1"></a>      fig_fl_att <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_fl_attgt,</span>
<span id="cb148-1109"><a href="functions-for-difference-in-difference-computations.html#cb148-1109" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> att)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1110"><a href="functions-for-difference-in-difference-computations.html#cb148-1110" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1111"><a href="functions-for-difference-in-difference-computations.html#cb148-1111" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#08519C&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1112"><a href="functions-for-difference-in-difference-computations.html#cb148-1112" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cband_lower, <span class="at">ymax =</span> cband_upper),</span>
<span id="cb148-1113"><a href="functions-for-difference-in-difference-computations.html#cb148-1113" tabindex="-1"></a>                      <span class="at">alpha=</span><span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">&quot;#FB6A4A&quot;</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1114"><a href="functions-for-difference-in-difference-computations.html#cb148-1114" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Effect of the conservation on the deforestation rate, relative to 2000&quot;</span>,</span>
<span id="cb148-1115"><a href="functions-for-difference-in-difference-computations.html#cb148-1115" tabindex="-1"></a>               <span class="at">subtitle =</span> <span class="fu">paste0</span>(pa.name, <span class="st">&quot;, &quot;</span>, country.name, <span class="st">&quot;, implemented in &quot;</span>, treatment.year),</span>
<span id="cb148-1116"><a href="functions-for-difference-in-difference-computations.html#cb148-1116" tabindex="-1"></a>               <span class="at">caption =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID :&quot;</span>, wdpa_id, <span class="st">&quot;|&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha |&quot;</span>, <span class="st">&quot;Pixel resolution :&quot;</span>, res_ha, <span class="st">&quot;ha&quot;</span>, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">Ribbon represents &quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot; % confidence interval.</span><span class="sc">\n</span><span class="st">Treatment effect is interpreted as the reduction of cumulated deforestation rate (relative to 2000 forest cover) in percentage points (pp).</span><span class="sc">\n</span><span class="st">A negative effect means the conservation program has caused higher deforestation.&quot;</span>),</span>
<span id="cb148-1117"><a href="functions-for-difference-in-difference-computations.html#cb148-1117" tabindex="-1"></a>               <span class="at">y =</span> <span class="st">&quot;Reduction of deforestation (p.p)&quot;</span>,</span>
<span id="cb148-1118"><a href="functions-for-difference-in-difference-computations.html#cb148-1118" tabindex="-1"></a>               <span class="at">x =</span> <span class="st">&quot;Year relative to treatment (t = 0)&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1119"><a href="functions-for-difference-in-difference-computations.html#cb148-1119" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="fu">seq</span>(<span class="fu">min</span>(df_fc_attgt<span class="sc">$</span>time),<span class="fu">max</span>(df_fc_attgt<span class="sc">$</span>time),<span class="at">by=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1120"><a href="functions-for-difference-in-difference-computations.html#cb148-1120" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1121"><a href="functions-for-difference-in-difference-computations.html#cb148-1121" tabindex="-1"></a>        <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1122"><a href="functions-for-difference-in-difference-computations.html#cb148-1122" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1123"><a href="functions-for-difference-in-difference-computations.html#cb148-1123" tabindex="-1"></a>          <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1124"><a href="functions-for-difference-in-difference-computations.html#cb148-1124" tabindex="-1"></a>          <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1125"><a href="functions-for-difference-in-difference-computations.html#cb148-1125" tabindex="-1"></a>          </span>
<span id="cb148-1126"><a href="functions-for-difference-in-difference-computations.html#cb148-1126" tabindex="-1"></a>          <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1127"><a href="functions-for-difference-in-difference-computations.html#cb148-1127" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1128"><a href="functions-for-difference-in-difference-computations.html#cb148-1128" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1129"><a href="functions-for-difference-in-difference-computations.html#cb148-1129" tabindex="-1"></a>          </span>
<span id="cb148-1130"><a href="functions-for-difference-in-difference-computations.html#cb148-1130" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1131"><a href="functions-for-difference-in-difference-computations.html#cb148-1131" tabindex="-1"></a>          </span>
<span id="cb148-1132"><a href="functions-for-difference-in-difference-computations.html#cb148-1132" tabindex="-1"></a>          <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1133"><a href="functions-for-difference-in-difference-computations.html#cb148-1133" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-1134"><a href="functions-for-difference-in-difference-computations.html#cb148-1134" tabindex="-1"></a>          <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1135"><a href="functions-for-difference-in-difference-computations.html#cb148-1135" tabindex="-1"></a>          <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1136"><a href="functions-for-difference-in-difference-computations.html#cb148-1136" tabindex="-1"></a>          <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-1137"><a href="functions-for-difference-in-difference-computations.html#cb148-1137" tabindex="-1"></a>          <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1138"><a href="functions-for-difference-in-difference-computations.html#cb148-1138" tabindex="-1"></a>          </span>
<span id="cb148-1139"><a href="functions-for-difference-in-difference-computations.html#cb148-1139" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1140"><a href="functions-for-difference-in-difference-computations.html#cb148-1140" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1141"><a href="functions-for-difference-in-difference-computations.html#cb148-1141" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1142"><a href="functions-for-difference-in-difference-computations.html#cb148-1142" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1143"><a href="functions-for-difference-in-difference-computations.html#cb148-1143" tabindex="-1"></a>        )</span>
<span id="cb148-1144"><a href="functions-for-difference-in-difference-computations.html#cb148-1144" tabindex="-1"></a>      </span>
<span id="cb148-1145"><a href="functions-for-difference-in-difference-computations.html#cb148-1145" tabindex="-1"></a>      </span>
<span id="cb148-1146"><a href="functions-for-difference-in-difference-computations.html#cb148-1146" tabindex="-1"></a>      </span>
<span id="cb148-1147"><a href="functions-for-difference-in-difference-computations.html#cb148-1147" tabindex="-1"></a>      <span class="do">##Saving plots</span></span>
<span id="cb148-1148"><a href="functions-for-difference-in-difference-computations.html#cb148-1148" tabindex="-1"></a>      tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;fig&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb148-1149"><a href="functions-for-difference-in-difference-computations.html#cb148-1149" tabindex="-1"></a>      </span>
<span id="cb148-1150"><a href="functions-for-difference-in-difference-computations.html#cb148-1150" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-1151"><a href="functions-for-difference-in-difference-computations.html#cb148-1151" tabindex="-1"></a>                    <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pix_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1152"><a href="functions-for-difference-in-difference-computations.html#cb148-1152" tabindex="-1"></a>                    <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pix_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-1153"><a href="functions-for-difference-in-difference-computations.html#cb148-1153" tabindex="-1"></a>             <span class="at">plot =</span> fig_att_pix,</span>
<span id="cb148-1154"><a href="functions-for-difference-in-difference-computations.html#cb148-1154" tabindex="-1"></a>             <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1155"><a href="functions-for-difference-in-difference-computations.html#cb148-1155" tabindex="-1"></a>             <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1156"><a href="functions-for-difference-in-difference-computations.html#cb148-1156" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-1157"><a href="functions-for-difference-in-difference-computations.html#cb148-1157" tabindex="-1"></a>                    <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pa_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1158"><a href="functions-for-difference-in-difference-computations.html#cb148-1158" tabindex="-1"></a>                    <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_pa_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-1159"><a href="functions-for-difference-in-difference-computations.html#cb148-1159" tabindex="-1"></a>             <span class="at">plot =</span> fig_att_pa,</span>
<span id="cb148-1160"><a href="functions-for-difference-in-difference-computations.html#cb148-1160" tabindex="-1"></a>             <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1161"><a href="functions-for-difference-in-difference-computations.html#cb148-1161" tabindex="-1"></a>             <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1162"><a href="functions-for-difference-in-difference-computations.html#cb148-1162" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">ifelse</span>(is_m <span class="sc">==</span> <span class="cn">TRUE</span>,</span>
<span id="cb148-1163"><a href="functions-for-difference-in-difference-computations.html#cb148-1163" tabindex="-1"></a>                    <span class="at">yes =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_per_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_m&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1164"><a href="functions-for-difference-in-difference-computations.html#cb148-1164" tabindex="-1"></a>                    <span class="at">no =</span> <span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_att_per_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;_unm&quot;</span>, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)),</span>
<span id="cb148-1165"><a href="functions-for-difference-in-difference-computations.html#cb148-1165" tabindex="-1"></a>             <span class="at">plot =</span> fig_att_per,</span>
<span id="cb148-1166"><a href="functions-for-difference-in-difference-computations.html#cb148-1166" tabindex="-1"></a>             <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1167"><a href="functions-for-difference-in-difference-computations.html#cb148-1167" tabindex="-1"></a>             <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1168"><a href="functions-for-difference-in-difference-computations.html#cb148-1168" tabindex="-1"></a>      <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_fl_att_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1169"><a href="functions-for-difference-in-difference-computations.html#cb148-1169" tabindex="-1"></a>             <span class="at">plot =</span> fig_fl_att,</span>
<span id="cb148-1170"><a href="functions-for-difference-in-difference-computations.html#cb148-1170" tabindex="-1"></a>             <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1171"><a href="functions-for-difference-in-difference-computations.html#cb148-1171" tabindex="-1"></a>             <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1172"><a href="functions-for-difference-in-difference-computations.html#cb148-1172" tabindex="-1"></a>      </span>
<span id="cb148-1173"><a href="functions-for-difference-in-difference-computations.html#cb148-1173" tabindex="-1"></a>      files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1174"><a href="functions-for-difference-in-difference-computations.html#cb148-1174" tabindex="-1"></a>      <span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb148-1175"><a href="functions-for-difference-in-difference-computations.html#cb148-1175" tabindex="-1"></a>      <span class="cf">for</span>(f <span class="cf">in</span> files) </span>
<span id="cb148-1176"><a href="functions-for-difference-in-difference-computations.html#cb148-1176" tabindex="-1"></a>      {</span>
<span id="cb148-1177"><a href="functions-for-difference-in-difference-computations.html#cb148-1177" tabindex="-1"></a>        <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb148-1178"><a href="functions-for-difference-in-difference-computations.html#cb148-1178" tabindex="-1"></a>        aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb148-1179"><a href="functions-for-difference-in-difference-computations.html#cb148-1179" tabindex="-1"></a>                           <span class="at">bucket =</span> <span class="fu">paste</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>, save_dir, iso, wdpaid, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1180"><a href="functions-for-difference-in-difference-computations.html#cb148-1180" tabindex="-1"></a>                           <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1181"><a href="functions-for-difference-in-difference-computations.html#cb148-1181" tabindex="-1"></a>      }</span>
<span id="cb148-1182"><a href="functions-for-difference-in-difference-computations.html#cb148-1182" tabindex="-1"></a>      <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb148-1183"><a href="functions-for-difference-in-difference-computations.html#cb148-1183" tabindex="-1"></a>      </span>
<span id="cb148-1184"><a href="functions-for-difference-in-difference-computations.html#cb148-1184" tabindex="-1"></a>      </span>
<span id="cb148-1185"><a href="functions-for-difference-in-difference-computations.html#cb148-1185" tabindex="-1"></a>      </span>
<span id="cb148-1186"><a href="functions-for-difference-in-difference-computations.html#cb148-1186" tabindex="-1"></a>      <span class="co">#Return outputs</span></span>
<span id="cb148-1187"><a href="functions-for-difference-in-difference-computations.html#cb148-1187" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;df_fc_att&quot;</span> <span class="ot">=</span> df_fc_attgt, <span class="st">&quot;df_fl_att&quot;</span>  <span class="ot">=</span> df_fl_attgt, <span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">TRUE</span>))</span>
<span id="cb148-1188"><a href="functions-for-difference-in-difference-computations.html#cb148-1188" tabindex="-1"></a>      </span>
<span id="cb148-1189"><a href="functions-for-difference-in-difference-computations.html#cb148-1189" tabindex="-1"></a>    },</span>
<span id="cb148-1190"><a href="functions-for-difference-in-difference-computations.html#cb148-1190" tabindex="-1"></a>    </span>
<span id="cb148-1191"><a href="functions-for-difference-in-difference-computations.html#cb148-1191" tabindex="-1"></a>    <span class="at">error =</span> <span class="cf">function</span>(e)</span>
<span id="cb148-1192"><a href="functions-for-difference-in-difference-computations.html#cb148-1192" tabindex="-1"></a>    {</span>
<span id="cb148-1193"><a href="functions-for-difference-in-difference-computations.html#cb148-1193" tabindex="-1"></a>      <span class="fu">print</span>(e)</span>
<span id="cb148-1194"><a href="functions-for-difference-in-difference-computations.html#cb148-1194" tabindex="-1"></a>      <span class="co">#cat(paste(&quot;Error while computing/plotting DiD :\n&quot;, e, &quot;\n&quot;), file = log, append = TRUE)</span></span>
<span id="cb148-1195"><a href="functions-for-difference-in-difference-computations.html#cb148-1195" tabindex="-1"></a>      <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;Error while computing/plotting DiD :</span><span class="sc">\n</span><span class="st">&quot;</span>, e, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>))</span>
<span id="cb148-1196"><a href="functions-for-difference-in-difference-computations.html#cb148-1196" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">list</span>(<span class="st">&quot;is_ok&quot;</span> <span class="ot">=</span> <span class="cn">FALSE</span>))</span>
<span id="cb148-1197"><a href="functions-for-difference-in-difference-computations.html#cb148-1197" tabindex="-1"></a>    }</span>
<span id="cb148-1198"><a href="functions-for-difference-in-difference-computations.html#cb148-1198" tabindex="-1"></a>    </span>
<span id="cb148-1199"><a href="functions-for-difference-in-difference-computations.html#cb148-1199" tabindex="-1"></a>  )</span>
<span id="cb148-1200"><a href="functions-for-difference-in-difference-computations.html#cb148-1200" tabindex="-1"></a>  </span>
<span id="cb148-1201"><a href="functions-for-difference-in-difference-computations.html#cb148-1201" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb148-1202"><a href="functions-for-difference-in-difference-computations.html#cb148-1202" tabindex="-1"></a>  </span>
<span id="cb148-1203"><a href="functions-for-difference-in-difference-computations.html#cb148-1203" tabindex="-1"></a>  <span class="co">#TEST : is treatment effect computed by the did package coherent with manual computations ? </span></span>
<span id="cb148-1204"><a href="functions-for-difference-in-difference-computations.html#cb148-1204" tabindex="-1"></a>  <span class="co"># --&gt; YES :D</span></span>
<span id="cb148-1205"><a href="functions-for-difference-in-difference-computations.html#cb148-1205" tabindex="-1"></a>  <span class="co"># test = df_did %&gt;% </span></span>
<span id="cb148-1206"><a href="functions-for-difference-in-difference-computations.html#cb148-1206" tabindex="-1"></a>  <span class="co">#   group_by(group, year) %&gt;%</span></span>
<span id="cb148-1207"><a href="functions-for-difference-in-difference-computations.html#cb148-1207" tabindex="-1"></a>  <span class="co">#   summarize(avgFL_2000_cum = mean(FL_2000_cum, na.rm = TRUE),</span></span>
<span id="cb148-1208"><a href="functions-for-difference-in-difference-computations.html#cb148-1208" tabindex="-1"></a>  <span class="co">#             avgFC_ha = mean(fc_ha, na.rm = TRUE)) %&gt;%</span></span>
<span id="cb148-1209"><a href="functions-for-difference-in-difference-computations.html#cb148-1209" tabindex="-1"></a>  <span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb148-1210"><a href="functions-for-difference-in-difference-computations.html#cb148-1210" tabindex="-1"></a>  <span class="co">#   mutate(fc_te2 = (avgFC_ha[year == 2009 &amp; group == 2] - avgFC_ha[year == 2006 &amp; group == 2]) - (avgFC_ha[year == 2009 &amp; group == 1] - avgFC_ha[year == 2006 &amp; group == 1]),</span></span>
<span id="cb148-1211"><a href="functions-for-difference-in-difference-computations.html#cb148-1211" tabindex="-1"></a>  <span class="co">#          fl_te2 = (avgFL_2000_cum[year == 2009 &amp; group == 2] - avgFL_2000_cum[year == 2006 &amp; group == 2]) - (avgFL_2000_cum[year == 2009 &amp; group == 1] - avgFL_2000_cum[year == 2006 &amp; group == 1]))</span></span>
<span id="cb148-1212"><a href="functions-for-difference-in-difference-computations.html#cb148-1212" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb148-1213"><a href="functions-for-difference-in-difference-computations.html#cb148-1213" tabindex="-1"></a>  </span>
<span id="cb148-1214"><a href="functions-for-difference-in-difference-computations.html#cb148-1214" tabindex="-1"></a>  </span>
<span id="cb148-1215"><a href="functions-for-difference-in-difference-computations.html#cb148-1215" tabindex="-1"></a>}</span>
<span id="cb148-1216"><a href="functions-for-difference-in-difference-computations.html#cb148-1216" tabindex="-1"></a></span>
<span id="cb148-1217"><a href="functions-for-difference-in-difference-computations.html#cb148-1217" tabindex="-1"></a></span>
<span id="cb148-1218"><a href="functions-for-difference-in-difference-computations.html#cb148-1218" tabindex="-1"></a><span class="co">#Plot the forest cover loss with 2000 as a base year in treated and control units, before and after matching</span></span>
<span id="cb148-1219"><a href="functions-for-difference-in-difference-computations.html#cb148-1219" tabindex="-1"></a><span class="do">##INPUTS</span></span>
<span id="cb148-1220"><a href="functions-for-difference-in-difference-computations.html#cb148-1220" tabindex="-1"></a><span class="do">### iso : the iso3 code for the country considered</span></span>
<span id="cb148-1221"><a href="functions-for-difference-in-difference-computations.html#cb148-1221" tabindex="-1"></a><span class="do">### wdpaid : the WDPAID of the PA considered</span></span>
<span id="cb148-1222"><a href="functions-for-difference-in-difference-computations.html#cb148-1222" tabindex="-1"></a><span class="do">### data_pa : dataset with information on protected areas, and especially their surfaces</span></span>
<span id="cb148-1223"><a href="functions-for-difference-in-difference-computations.html#cb148-1223" tabindex="-1"></a><span class="do">### alpha : the threshold for confidence interval</span></span>
<span id="cb148-1224"><a href="functions-for-difference-in-difference-computations.html#cb148-1224" tabindex="-1"></a><span class="do">### save_dir : the saving directory in the remote storage</span></span>
<span id="cb148-1225"><a href="functions-for-difference-in-difference-computations.html#cb148-1225" tabindex="-1"></a><span class="do">### load_dir : the loading directory in the remote storage</span></span>
<span id="cb148-1226"><a href="functions-for-difference-in-difference-computations.html#cb148-1226" tabindex="-1"></a><span class="do">### ext_input : the extension of input dataframe</span></span>
<span id="cb148-1227"><a href="functions-for-difference-in-difference-computations.html#cb148-1227" tabindex="-1"></a><span class="do">## DATA SAVED</span></span>
<span id="cb148-1228"><a href="functions-for-difference-in-difference-computations.html#cb148-1228" tabindex="-1"></a><span class="do">### Plot of forest cover loss with 2000 as a base year in treated and control units, before and after matching</span></span>
<span id="cb148-1229"><a href="functions-for-difference-in-difference-computations.html#cb148-1229" tabindex="-1"></a>fn_plot_forest_loss <span class="ot">=</span> <span class="cf">function</span>(iso, wdpaid, data_pa, alpha, load_dir, ext_input, save_dir)</span>
<span id="cb148-1230"><a href="functions-for-difference-in-difference-computations.html#cb148-1230" tabindex="-1"></a>{</span>
<span id="cb148-1231"><a href="functions-for-difference-in-difference-computations.html#cb148-1231" tabindex="-1"></a>  </span>
<span id="cb148-1232"><a href="functions-for-difference-in-difference-computations.html#cb148-1232" tabindex="-1"></a>  <span class="co">#Loading matched and unmatched data frames</span></span>
<span id="cb148-1233"><a href="functions-for-difference-in-difference-computations.html#cb148-1233" tabindex="-1"></a>  df_long_m_raw <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-1234"><a href="functions-for-difference-in-difference-computations.html#cb148-1234" tabindex="-1"></a>                               <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;matched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-1235"><a href="functions-for-difference-in-difference-computations.html#cb148-1235" tabindex="-1"></a>                               <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-1236"><a href="functions-for-difference-in-difference-computations.html#cb148-1236" tabindex="-1"></a>                               <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1237"><a href="functions-for-difference-in-difference-computations.html#cb148-1237" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, res_m, year, var, fc_ha))</span>
<span id="cb148-1238"><a href="functions-for-difference-in-difference-computations.html#cb148-1238" tabindex="-1"></a>  </span>
<span id="cb148-1239"><a href="functions-for-difference-in-difference-computations.html#cb148-1239" tabindex="-1"></a>  df_long_unm_raw <span class="ot">=</span> <span class="fu">s3read_using</span>(data.table<span class="sc">::</span>fread,</span>
<span id="cb148-1240"><a href="functions-for-difference-in-difference-computations.html#cb148-1240" tabindex="-1"></a>                                 <span class="at">object =</span> <span class="fu">paste0</span>(load_dir, <span class="st">&quot;/&quot;</span>, iso, <span class="st">&quot;/&quot;</span>, wdpaid, <span class="st">&quot;/&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;unmatched_long&quot;</span>, <span class="st">&quot;_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, ext_input)),</span>
<span id="cb148-1241"><a href="functions-for-difference-in-difference-computations.html#cb148-1241" tabindex="-1"></a>                                 <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb148-1242"><a href="functions-for-difference-in-difference-computations.html#cb148-1242" tabindex="-1"></a>                                 <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1243"><a href="functions-for-difference-in-difference-computations.html#cb148-1243" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, wdpaid, group, assetid, status_yr, year_funding_first, year_funding_all, year, res_m, var, fc_ha))</span>
<span id="cb148-1244"><a href="functions-for-difference-in-difference-computations.html#cb148-1244" tabindex="-1"></a>  </span>
<span id="cb148-1245"><a href="functions-for-difference-in-difference-computations.html#cb148-1245" tabindex="-1"></a>  wdpa_id <span class="ot">=</span> wdpaid</span>
<span id="cb148-1246"><a href="functions-for-difference-in-difference-computations.html#cb148-1246" tabindex="-1"></a>  <span class="co">#Extract relevant information</span></span>
<span id="cb148-1247"><a href="functions-for-difference-in-difference-computations.html#cb148-1247" tabindex="-1"></a>  <span class="do">##Spatial resolution of pixels res_m and define pixel area in ha</span></span>
<span id="cb148-1248"><a href="functions-for-difference-in-difference-computations.html#cb148-1248" tabindex="-1"></a>  res_m <span class="ot">=</span> <span class="fu">unique</span>(df_long_m_raw<span class="sc">$</span>res_m)</span>
<span id="cb148-1249"><a href="functions-for-difference-in-difference-computations.html#cb148-1249" tabindex="-1"></a>  res_ha <span class="ot">=</span> res_m<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fl">1e-4</span></span>
<span id="cb148-1250"><a href="functions-for-difference-in-difference-computations.html#cb148-1250" tabindex="-1"></a>  </span>
<span id="cb148-1251"><a href="functions-for-difference-in-difference-computations.html#cb148-1251" tabindex="-1"></a>  <span class="do">##treatment year</span></span>
<span id="cb148-1252"><a href="functions-for-difference-in-difference-computations.html#cb148-1252" tabindex="-1"></a>  treatment.year <span class="ot">=</span> df_long_m_raw <span class="sc">%&gt;%</span> </span>
<span id="cb148-1253"><a href="functions-for-difference-in-difference-computations.html#cb148-1253" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1254"><a href="functions-for-difference-in-difference-computations.html#cb148-1254" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1255"><a href="functions-for-difference-in-difference-computations.html#cb148-1255" tabindex="-1"></a>  treatment.year <span class="ot">=</span> treatment.year<span class="sc">$</span>status_yr</span>
<span id="cb148-1256"><a href="functions-for-difference-in-difference-computations.html#cb148-1256" tabindex="-1"></a>  </span>
<span id="cb148-1257"><a href="functions-for-difference-in-difference-computations.html#cb148-1257" tabindex="-1"></a>  <span class="do">##funding years</span></span>
<span id="cb148-1258"><a href="functions-for-difference-in-difference-computations.html#cb148-1258" tabindex="-1"></a>  funding.years <span class="ot">=</span> df_long_m_raw <span class="sc">%&gt;%</span> </span>
<span id="cb148-1259"><a href="functions-for-difference-in-difference-computations.html#cb148-1259" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1260"><a href="functions-for-difference-in-difference-computations.html#cb148-1260" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1261"><a href="functions-for-difference-in-difference-computations.html#cb148-1261" tabindex="-1"></a>  funding.years <span class="ot">=</span> funding.years<span class="sc">$</span>year_funding_first</span>
<span id="cb148-1262"><a href="functions-for-difference-in-difference-computations.html#cb148-1262" tabindex="-1"></a>  <span class="co">#funding.years = as.numeric(unlist(strsplit(funding.years$year_funding_all, split = &quot;,&quot;)))</span></span>
<span id="cb148-1263"><a href="functions-for-difference-in-difference-computations.html#cb148-1263" tabindex="-1"></a>  </span>
<span id="cb148-1264"><a href="functions-for-difference-in-difference-computations.html#cb148-1264" tabindex="-1"></a>  <span class="do">##country iso</span></span>
<span id="cb148-1265"><a href="functions-for-difference-in-difference-computations.html#cb148-1265" tabindex="-1"></a>  country.iso <span class="ot">=</span> df_long_m_raw <span class="sc">%&gt;%</span> </span>
<span id="cb148-1266"><a href="functions-for-difference-in-difference-computations.html#cb148-1266" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1267"><a href="functions-for-difference-in-difference-computations.html#cb148-1267" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1268"><a href="functions-for-difference-in-difference-computations.html#cb148-1268" tabindex="-1"></a>  country.iso <span class="ot">=</span> country.iso<span class="sc">$</span>iso3</span>
<span id="cb148-1269"><a href="functions-for-difference-in-difference-computations.html#cb148-1269" tabindex="-1"></a>  </span>
<span id="cb148-1270"><a href="functions-for-difference-in-difference-computations.html#cb148-1270" tabindex="-1"></a>  <span class="do">##region name</span></span>
<span id="cb148-1271"><a href="functions-for-difference-in-difference-computations.html#cb148-1271" tabindex="-1"></a>  region.name <span class="ot">=</span> df_long_m_raw <span class="sc">%&gt;%</span> </span>
<span id="cb148-1272"><a href="functions-for-difference-in-difference-computations.html#cb148-1272" tabindex="-1"></a>    <span class="fu">filter</span>(group <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1273"><a href="functions-for-difference-in-difference-computations.html#cb148-1273" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1274"><a href="functions-for-difference-in-difference-computations.html#cb148-1274" tabindex="-1"></a>  region.name <span class="ot">=</span> region.name<span class="sc">$</span>region</span>
<span id="cb148-1275"><a href="functions-for-difference-in-difference-computations.html#cb148-1275" tabindex="-1"></a>  </span>
<span id="cb148-1276"><a href="functions-for-difference-in-difference-computations.html#cb148-1276" tabindex="-1"></a>  <span class="do">##Area of the PA and PA/country name</span></span>
<span id="cb148-1277"><a href="functions-for-difference-in-difference-computations.html#cb148-1277" tabindex="-1"></a>  area_ha <span class="ot">=</span> data_pa[data_pa<span class="sc">$</span>wdpaid <span class="sc">==</span> wdpa_id,]<span class="sc">$</span>area_km2<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb148-1278"><a href="functions-for-difference-in-difference-computations.html#cb148-1278" tabindex="-1"></a>  country.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-1279"><a href="functions-for-difference-in-difference-computations.html#cb148-1279" tabindex="-1"></a>    <span class="fu">filter</span>(iso3 <span class="sc">==</span> iso) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1280"><a href="functions-for-difference-in-difference-computations.html#cb148-1280" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1281"><a href="functions-for-difference-in-difference-computations.html#cb148-1281" tabindex="-1"></a>  country.name <span class="ot">=</span> country.name<span class="sc">$</span>country_en</span>
<span id="cb148-1282"><a href="functions-for-difference-in-difference-computations.html#cb148-1282" tabindex="-1"></a>  pa.name <span class="ot">=</span> data_pa <span class="sc">%&gt;%</span> </span>
<span id="cb148-1283"><a href="functions-for-difference-in-difference-computations.html#cb148-1283" tabindex="-1"></a>    <span class="fu">filter</span>(wdpaid <span class="sc">==</span> wdpa_id) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1284"><a href="functions-for-difference-in-difference-computations.html#cb148-1284" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb148-1285"><a href="functions-for-difference-in-difference-computations.html#cb148-1285" tabindex="-1"></a>  pa.name <span class="ot">=</span> pa.name<span class="sc">$</span>name_pa</span>
<span id="cb148-1286"><a href="functions-for-difference-in-difference-computations.html#cb148-1286" tabindex="-1"></a>  </span>
<span id="cb148-1287"><a href="functions-for-difference-in-difference-computations.html#cb148-1287" tabindex="-1"></a>  </span>
<span id="cb148-1288"><a href="functions-for-difference-in-difference-computations.html#cb148-1288" tabindex="-1"></a>  <span class="co">#Forest cover loss is computed for each pixel relative to 2000, then average forest cover evolution and loss is computed for treated and controls</span></span>
<span id="cb148-1289"><a href="functions-for-difference-in-difference-computations.html#cb148-1289" tabindex="-1"></a>  df_long_m <span class="ot">=</span> df_long_m_raw <span class="sc">%&gt;%</span></span>
<span id="cb148-1290"><a href="functions-for-difference-in-difference-computations.html#cb148-1290" tabindex="-1"></a>    <span class="co">#Compute forest loss relative to 2000 in ha for each pixel</span></span>
<span id="cb148-1291"><a href="functions-for-difference-in-difference-computations.html#cb148-1291" tabindex="-1"></a>    <span class="fu">group_by</span>(assetid) <span class="sc">%&gt;%</span></span>
<span id="cb148-1292"><a href="functions-for-difference-in-difference-computations.html#cb148-1292" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fc_rel00_ha =</span> fc_ha <span class="sc">-</span> fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>],</span>
<span id="cb148-1293"><a href="functions-for-difference-in-difference-computations.html#cb148-1293" tabindex="-1"></a>           <span class="at">.after =</span> <span class="st">&quot;fc_ha&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1294"><a href="functions-for-difference-in-difference-computations.html#cb148-1294" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1295"><a href="functions-for-difference-in-difference-computations.html#cb148-1295" tabindex="-1"></a>    <span class="co">#Compute average forest cover and forest cover loss relative to 2000 for each group, year</span></span>
<span id="cb148-1296"><a href="functions-for-difference-in-difference-computations.html#cb148-1296" tabindex="-1"></a>    <span class="fu">group_by</span>(group, year) <span class="sc">%&gt;%</span></span>
<span id="cb148-1297"><a href="functions-for-difference-in-difference-computations.html#cb148-1297" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n=</span> <span class="fu">n</span>(),</span>
<span id="cb148-1298"><a href="functions-for-difference-in-difference-computations.html#cb148-1298" tabindex="-1"></a>              <span class="at">avgfc_ha =</span> <span class="fu">mean</span>(fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1299"><a href="functions-for-difference-in-difference-computations.html#cb148-1299" tabindex="-1"></a>              <span class="at">sdfc_ha =</span> <span class="fu">sd</span>(fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1300"><a href="functions-for-difference-in-difference-computations.html#cb148-1300" tabindex="-1"></a>              <span class="at">avgfc_rel00_ha =</span> <span class="fu">mean</span>(fc_rel00_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1301"><a href="functions-for-difference-in-difference-computations.html#cb148-1301" tabindex="-1"></a>              <span class="at">sdfc_rel00_ha =</span> <span class="fu">sd</span>(fc_rel00_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1302"><a href="functions-for-difference-in-difference-computations.html#cb148-1302" tabindex="-1"></a>              <span class="at">fc_ha_ci_upper =</span> avgfc_ha <span class="sc">+</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1303"><a href="functions-for-difference-in-difference-computations.html#cb148-1303" tabindex="-1"></a>              <span class="at">fc_ha_ci_lower =</span> avgfc_ha <span class="sc">-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1304"><a href="functions-for-difference-in-difference-computations.html#cb148-1304" tabindex="-1"></a>              <span class="at">fc_rel00_ha_ci_upper =</span> avgfc_rel00_ha <span class="sc">+</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_rel00_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1305"><a href="functions-for-difference-in-difference-computations.html#cb148-1305" tabindex="-1"></a>              <span class="at">fc_rel00_ha_ci_lower =</span> avgfc_rel00_ha <span class="sc">-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_rel00_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1306"><a href="functions-for-difference-in-difference-computations.html#cb148-1306" tabindex="-1"></a>              <span class="at">matched =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb148-1307"><a href="functions-for-difference-in-difference-computations.html#cb148-1307" tabindex="-1"></a>    <span class="co">#Compute total forest cover and forest loss relative to 2000, knowing area of the PA and average forest share in a pixel in 2000</span></span>
<span id="cb148-1308"><a href="functions-for-difference-in-difference-computations.html#cb148-1308" tabindex="-1"></a>    <span class="co">#CI are computed at 95% confidence level</span></span>
<span id="cb148-1309"><a href="functions-for-difference-in-difference-computations.html#cb148-1309" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1310"><a href="functions-for-difference-in-difference-computations.html#cb148-1310" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="co">#per_fc_2000_avg = min(fc_ha[year == 2000]/res_ha, 1),</span></span>
<span id="cb148-1311"><a href="functions-for-difference-in-difference-computations.html#cb148-1311" tabindex="-1"></a>      <span class="co">#fc_tot_ha = fc_ha*(area_ha*per_fc_2000_avg/res_ha),</span></span>
<span id="cb148-1312"><a href="functions-for-difference-in-difference-computations.html#cb148-1312" tabindex="-1"></a>      <span class="at">fc_tot_ha =</span> avgfc_ha<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1313"><a href="functions-for-difference-in-difference-computations.html#cb148-1313" tabindex="-1"></a>      <span class="co">#fc_tot_rel00_ha = avgfc_rel00_ha*(area_ha*per_fc_2000_avg/res_ha),</span></span>
<span id="cb148-1314"><a href="functions-for-difference-in-difference-computations.html#cb148-1314" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha =</span> avgfc_rel00_ha<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1315"><a href="functions-for-difference-in-difference-computations.html#cb148-1315" tabindex="-1"></a>      <span class="at">fc_tot_ha_ci_upper =</span> fc_ha_ci_upper<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1316"><a href="functions-for-difference-in-difference-computations.html#cb148-1316" tabindex="-1"></a>      <span class="at">fc_tot_ha_ci_upper =</span> fc_ha_ci_lower<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1317"><a href="functions-for-difference-in-difference-computations.html#cb148-1317" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha_ci_upper =</span> fc_rel00_ha_ci_upper<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1318"><a href="functions-for-difference-in-difference-computations.html#cb148-1318" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha_ci_lower =</span> fc_rel00_ha_ci_lower<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1319"><a href="functions-for-difference-in-difference-computations.html#cb148-1319" tabindex="-1"></a>      <span class="at">alpha =</span> alpha)</span>
<span id="cb148-1320"><a href="functions-for-difference-in-difference-computations.html#cb148-1320" tabindex="-1"></a>  </span>
<span id="cb148-1321"><a href="functions-for-difference-in-difference-computations.html#cb148-1321" tabindex="-1"></a>  df_long_unm <span class="ot">=</span> df_long_unm_raw <span class="sc">%&gt;%</span></span>
<span id="cb148-1322"><a href="functions-for-difference-in-difference-computations.html#cb148-1322" tabindex="-1"></a>    <span class="co">#Compute forest loss relative to 2000 in ha for each pixel</span></span>
<span id="cb148-1323"><a href="functions-for-difference-in-difference-computations.html#cb148-1323" tabindex="-1"></a>    <span class="fu">group_by</span>(assetid) <span class="sc">%&gt;%</span></span>
<span id="cb148-1324"><a href="functions-for-difference-in-difference-computations.html#cb148-1324" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">fc_rel00_ha =</span> fc_ha <span class="sc">-</span> fc_ha[year <span class="sc">==</span> <span class="dv">2000</span>],</span>
<span id="cb148-1325"><a href="functions-for-difference-in-difference-computations.html#cb148-1325" tabindex="-1"></a>           <span class="at">.after =</span> <span class="st">&quot;fc_ha&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1326"><a href="functions-for-difference-in-difference-computations.html#cb148-1326" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1327"><a href="functions-for-difference-in-difference-computations.html#cb148-1327" tabindex="-1"></a>    <span class="co">#Compute average forest cover and forest cover loss relative to 2000 for each group, year</span></span>
<span id="cb148-1328"><a href="functions-for-difference-in-difference-computations.html#cb148-1328" tabindex="-1"></a>    <span class="fu">group_by</span>(group, year) <span class="sc">%&gt;%</span></span>
<span id="cb148-1329"><a href="functions-for-difference-in-difference-computations.html#cb148-1329" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n=</span> <span class="fu">n</span>(),</span>
<span id="cb148-1330"><a href="functions-for-difference-in-difference-computations.html#cb148-1330" tabindex="-1"></a>              <span class="at">avgfc_ha =</span> <span class="fu">mean</span>(fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1331"><a href="functions-for-difference-in-difference-computations.html#cb148-1331" tabindex="-1"></a>              <span class="at">sdfc_ha =</span> <span class="fu">sd</span>(fc_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1332"><a href="functions-for-difference-in-difference-computations.html#cb148-1332" tabindex="-1"></a>              <span class="at">avgfc_rel00_ha =</span> <span class="fu">mean</span>(fc_rel00_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1333"><a href="functions-for-difference-in-difference-computations.html#cb148-1333" tabindex="-1"></a>              <span class="at">sdfc_rel00_ha =</span> <span class="fu">sd</span>(fc_rel00_ha, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-1334"><a href="functions-for-difference-in-difference-computations.html#cb148-1334" tabindex="-1"></a>              <span class="at">fc_ha_ci_upper =</span> avgfc_ha <span class="sc">+</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1335"><a href="functions-for-difference-in-difference-computations.html#cb148-1335" tabindex="-1"></a>              <span class="at">fc_ha_ci_lower =</span> avgfc_ha <span class="sc">-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1336"><a href="functions-for-difference-in-difference-computations.html#cb148-1336" tabindex="-1"></a>              <span class="at">fc_rel00_ha_ci_upper =</span> avgfc_rel00_ha <span class="sc">+</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_rel00_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1337"><a href="functions-for-difference-in-difference-computations.html#cb148-1337" tabindex="-1"></a>              <span class="at">fc_rel00_ha_ci_lower =</span> avgfc_rel00_ha <span class="sc">-</span> <span class="fu">qt</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">/</span><span class="dv">2</span>,<span class="at">df=</span>n<span class="dv">-1</span>)<span class="sc">*</span>sdfc_rel00_ha<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb148-1338"><a href="functions-for-difference-in-difference-computations.html#cb148-1338" tabindex="-1"></a>              <span class="at">matched =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1339"><a href="functions-for-difference-in-difference-computations.html#cb148-1339" tabindex="-1"></a>    <span class="co">#Compute total forest cover and forest loss relative to 2000, knowing area of the PA and average forest share in a pixel in 2000</span></span>
<span id="cb148-1340"><a href="functions-for-difference-in-difference-computations.html#cb148-1340" tabindex="-1"></a>    <span class="co">#CI are computed at 95% confidence level</span></span>
<span id="cb148-1341"><a href="functions-for-difference-in-difference-computations.html#cb148-1341" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1342"><a href="functions-for-difference-in-difference-computations.html#cb148-1342" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="co">#per_fc_2000_avg = min(fc_ha[year == 2000]/res_ha, 1),</span></span>
<span id="cb148-1343"><a href="functions-for-difference-in-difference-computations.html#cb148-1343" tabindex="-1"></a>      <span class="co">#fc_tot_ha = fc_ha*(area_ha*per_fc_2000_avg/res_ha),</span></span>
<span id="cb148-1344"><a href="functions-for-difference-in-difference-computations.html#cb148-1344" tabindex="-1"></a>      <span class="at">fc_tot_ha =</span> avgfc_ha<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1345"><a href="functions-for-difference-in-difference-computations.html#cb148-1345" tabindex="-1"></a>      <span class="co">#fc_tot_rel00_ha = avgfc_rel00_ha*(area_ha*per_fc_2000_avg/res_ha),</span></span>
<span id="cb148-1346"><a href="functions-for-difference-in-difference-computations.html#cb148-1346" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha =</span> avgfc_rel00_ha<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1347"><a href="functions-for-difference-in-difference-computations.html#cb148-1347" tabindex="-1"></a>      <span class="at">fc_tot_ha_ci_upper =</span> fc_ha_ci_upper<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1348"><a href="functions-for-difference-in-difference-computations.html#cb148-1348" tabindex="-1"></a>      <span class="at">fc_tot_ha_ci_upper =</span> fc_ha_ci_lower<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1349"><a href="functions-for-difference-in-difference-computations.html#cb148-1349" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha_ci_upper =</span> fc_rel00_ha_ci_upper<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1350"><a href="functions-for-difference-in-difference-computations.html#cb148-1350" tabindex="-1"></a>      <span class="at">fc_tot_rel00_ha_ci_lower =</span> fc_rel00_ha_ci_lower<span class="sc">*</span>(area_ha<span class="sc">/</span>res_ha),</span>
<span id="cb148-1351"><a href="functions-for-difference-in-difference-computations.html#cb148-1351" tabindex="-1"></a>      <span class="at">alpha =</span> alpha)</span>
<span id="cb148-1352"><a href="functions-for-difference-in-difference-computations.html#cb148-1352" tabindex="-1"></a>  </span>
<span id="cb148-1353"><a href="functions-for-difference-in-difference-computations.html#cb148-1353" tabindex="-1"></a>  </span>
<span id="cb148-1354"><a href="functions-for-difference-in-difference-computations.html#cb148-1354" tabindex="-1"></a>  <span class="co">#Define plotting dataset</span></span>
<span id="cb148-1355"><a href="functions-for-difference-in-difference-computations.html#cb148-1355" tabindex="-1"></a>  df_plot <span class="ot">=</span> <span class="fu">rbind</span>(df_long_m, df_long_unm) <span class="sc">%&gt;%</span></span>
<span id="cb148-1356"><a href="functions-for-difference-in-difference-computations.html#cb148-1356" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span><span class="st">&quot;Control&quot;</span>,</span>
<span id="cb148-1357"><a href="functions-for-difference-in-difference-computations.html#cb148-1357" tabindex="-1"></a>                             group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span><span class="st">&quot;Treated&quot;</span>),</span>
<span id="cb148-1358"><a href="functions-for-difference-in-difference-computations.html#cb148-1358" tabindex="-1"></a>           <span class="at">region =</span> region.name,</span>
<span id="cb148-1359"><a href="functions-for-difference-in-difference-computations.html#cb148-1359" tabindex="-1"></a>           <span class="at">country_en =</span> country.name,</span>
<span id="cb148-1360"><a href="functions-for-difference-in-difference-computations.html#cb148-1360" tabindex="-1"></a>           <span class="at">iso3 =</span> country.iso,</span>
<span id="cb148-1361"><a href="functions-for-difference-in-difference-computations.html#cb148-1361" tabindex="-1"></a>           <span class="at">wdpaid =</span> wdpaid, </span>
<span id="cb148-1362"><a href="functions-for-difference-in-difference-computations.html#cb148-1362" tabindex="-1"></a>           <span class="at">name_pa =</span> pa.name,</span>
<span id="cb148-1363"><a href="functions-for-difference-in-difference-computations.html#cb148-1363" tabindex="-1"></a>           <span class="at">area_ha =</span> area_ha)</span>
<span id="cb148-1364"><a href="functions-for-difference-in-difference-computations.html#cb148-1364" tabindex="-1"></a>  </span>
<span id="cb148-1365"><a href="functions-for-difference-in-difference-computations.html#cb148-1365" tabindex="-1"></a>  <span class="co">#The period where deforestation is plotted</span></span>
<span id="cb148-1366"><a href="functions-for-difference-in-difference-computations.html#cb148-1366" tabindex="-1"></a>  year.max <span class="ot">=</span> <span class="fu">max</span>(df_long_m<span class="sc">$</span>year)</span>
<span id="cb148-1367"><a href="functions-for-difference-in-difference-computations.html#cb148-1367" tabindex="-1"></a>  </span>
<span id="cb148-1368"><a href="functions-for-difference-in-difference-computations.html#cb148-1368" tabindex="-1"></a>  <span class="co">#Plot</span></span>
<span id="cb148-1369"><a href="functions-for-difference-in-difference-computations.html#cb148-1369" tabindex="-1"></a>  fct.labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Before Matching&quot;</span>, <span class="st">&quot;After Matching&quot;</span>)</span>
<span id="cb148-1370"><a href="functions-for-difference-in-difference-computations.html#cb148-1370" tabindex="-1"></a>  <span class="fu">names</span>(fct.labs) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb148-1371"><a href="functions-for-difference-in-difference-computations.html#cb148-1371" tabindex="-1"></a>  </span>
<span id="cb148-1372"><a href="functions-for-difference-in-difference-computations.html#cb148-1372" tabindex="-1"></a>  fig <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">filter</span>(df_plot, year <span class="sc">==</span> year.max),</span>
<span id="cb148-1373"><a href="functions-for-difference-in-difference-computations.html#cb148-1373" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">abs</span>(fc_tot_rel00_ha), <span class="at">fill =</span> <span class="fu">as.factor</span>(group), <span class="at">x =</span> group)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1374"><a href="functions-for-difference-in-difference-computations.html#cb148-1374" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span>  <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.8</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1375"><a href="functions-for-difference-in-difference-computations.html#cb148-1375" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax=</span><span class="fu">abs</span>(fc_tot_rel00_ha_ci_upper), <span class="at">ymin=</span><span class="fu">abs</span>(fc_tot_rel00_ha_ci_lower)), <span class="at">width=</span><span class="fl">0.4</span>, <span class="at">colour=</span><span class="st">&quot;grey60&quot;</span>, <span class="at">alpha=</span><span class="fl">0.9</span>, <span class="at">size=</span><span class="fl">1.3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1376"><a href="functions-for-difference-in-difference-computations.html#cb148-1376" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">format</span>(<span class="fu">round</span>(<span class="fu">abs</span>(fc_tot_rel00_ha), <span class="dv">0</span>), <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="at">y =</span> <span class="fu">abs</span>(fc_tot_rel00_ha)), </span>
<span id="cb148-1377"><a href="functions-for-difference-in-difference-computations.html#cb148-1377" tabindex="-1"></a>                 <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb148-1378"><a href="functions-for-difference-in-difference-computations.html#cb148-1378" tabindex="-1"></a>                 <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1379"><a href="functions-for-difference-in-difference-computations.html#cb148-1379" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_fill_brewer</span>(<span class="at">name =</span> <span class="st">&quot;Group&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1380"><a href="functions-for-difference-in-difference-computations.html#cb148-1380" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb148-1381"><a href="functions-for-difference-in-difference-computations.html#cb148-1381" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;Forest cover loss (ha)&quot;</span>,</span>
<span id="cb148-1382"><a href="functions-for-difference-in-difference-computations.html#cb148-1382" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Average area deforested between 2000 and&quot;</span>, year.max),</span>
<span id="cb148-1383"><a href="functions-for-difference-in-difference-computations.html#cb148-1383" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;WDPA ID&quot;</span>, wdpaid, <span class="st">&quot;in&quot;</span>, country.iso, <span class="st">&quot;,implemented in&quot;</span>, treatment.year, <span class="st">&quot;and covering&quot;</span>, <span class="fu">format</span>(area_ha, <span class="at">big.mark =</span> <span class="st">&quot;,&quot;</span>), <span class="st">&quot;ha&quot;</span>),</span>
<span id="cb148-1384"><a href="functions-for-difference-in-difference-computations.html#cb148-1384" tabindex="-1"></a>           <span class="at">caption =</span> <span class="fu">paste</span>((<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% confidence intervals.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1385"><a href="functions-for-difference-in-difference-computations.html#cb148-1385" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>matched,</span>
<span id="cb148-1386"><a href="functions-for-difference-in-difference-computations.html#cb148-1386" tabindex="-1"></a>                 <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">matched =</span> fct.labs))  <span class="sc">%&gt;%</span></span>
<span id="cb148-1387"><a href="functions-for-difference-in-difference-computations.html#cb148-1387" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1388"><a href="functions-for-difference-in-difference-computations.html#cb148-1388" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1389"><a href="functions-for-difference-in-difference-computations.html#cb148-1389" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1390"><a href="functions-for-difference-in-difference-computations.html#cb148-1390" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1391"><a href="functions-for-difference-in-difference-computations.html#cb148-1391" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1392"><a href="functions-for-difference-in-difference-computations.html#cb148-1392" tabindex="-1"></a>      </span>
<span id="cb148-1393"><a href="functions-for-difference-in-difference-computations.html#cb148-1393" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1394"><a href="functions-for-difference-in-difference-computations.html#cb148-1394" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1395"><a href="functions-for-difference-in-difference-computations.html#cb148-1395" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1396"><a href="functions-for-difference-in-difference-computations.html#cb148-1396" tabindex="-1"></a>      </span>
<span id="cb148-1397"><a href="functions-for-difference-in-difference-computations.html#cb148-1397" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1398"><a href="functions-for-difference-in-difference-computations.html#cb148-1398" tabindex="-1"></a>      </span>
<span id="cb148-1399"><a href="functions-for-difference-in-difference-computations.html#cb148-1399" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1400"><a href="functions-for-difference-in-difference-computations.html#cb148-1400" tabindex="-1"></a>      <span class="co">#legend.title = element_blank(),</span></span>
<span id="cb148-1401"><a href="functions-for-difference-in-difference-computations.html#cb148-1401" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1402"><a href="functions-for-difference-in-difference-computations.html#cb148-1402" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1403"><a href="functions-for-difference-in-difference-computations.html#cb148-1403" tabindex="-1"></a>      <span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb148-1404"><a href="functions-for-difference-in-difference-computations.html#cb148-1404" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1405"><a href="functions-for-difference-in-difference-computations.html#cb148-1405" tabindex="-1"></a>      </span>
<span id="cb148-1406"><a href="functions-for-difference-in-difference-computations.html#cb148-1406" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1407"><a href="functions-for-difference-in-difference-computations.html#cb148-1407" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1408"><a href="functions-for-difference-in-difference-computations.html#cb148-1408" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1409"><a href="functions-for-difference-in-difference-computations.html#cb148-1409" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1410"><a href="functions-for-difference-in-difference-computations.html#cb148-1410" tabindex="-1"></a>    )</span>
<span id="cb148-1411"><a href="functions-for-difference-in-difference-computations.html#cb148-1411" tabindex="-1"></a>  </span>
<span id="cb148-1412"><a href="functions-for-difference-in-difference-computations.html#cb148-1412" tabindex="-1"></a>  <span class="do">##Saving plots</span></span>
<span id="cb148-1413"><a href="functions-for-difference-in-difference-computations.html#cb148-1413" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;fig&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb148-1414"><a href="functions-for-difference-in-difference-computations.html#cb148-1414" tabindex="-1"></a>  </span>
<span id="cb148-1415"><a href="functions-for-difference-in-difference-computations.html#cb148-1415" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="fu">paste0</span>(<span class="st">&quot;fig_fl_2000_&quot;</span>, year.max, <span class="st">&quot;_m_unm_&quot;</span>, iso, <span class="st">&quot;_&quot;</span>, wdpaid, <span class="st">&quot;.png&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1416"><a href="functions-for-difference-in-difference-computations.html#cb148-1416" tabindex="-1"></a>         <span class="at">plot =</span> fig,</span>
<span id="cb148-1417"><a href="functions-for-difference-in-difference-computations.html#cb148-1417" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1418"><a href="functions-for-difference-in-difference-computations.html#cb148-1418" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1419"><a href="functions-for-difference-in-difference-computations.html#cb148-1419" tabindex="-1"></a>  </span>
<span id="cb148-1420"><a href="functions-for-difference-in-difference-computations.html#cb148-1420" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1421"><a href="functions-for-difference-in-difference-computations.html#cb148-1421" tabindex="-1"></a>  <span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb148-1422"><a href="functions-for-difference-in-difference-computations.html#cb148-1422" tabindex="-1"></a>  <span class="cf">for</span>(f <span class="cf">in</span> files) </span>
<span id="cb148-1423"><a href="functions-for-difference-in-difference-computations.html#cb148-1423" tabindex="-1"></a>  {</span>
<span id="cb148-1424"><a href="functions-for-difference-in-difference-computations.html#cb148-1424" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb148-1425"><a href="functions-for-difference-in-difference-computations.html#cb148-1425" tabindex="-1"></a>    aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb148-1426"><a href="functions-for-difference-in-difference-computations.html#cb148-1426" tabindex="-1"></a>                       <span class="at">bucket =</span> <span class="fu">paste</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>, save_dir, iso, wdpaid, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1427"><a href="functions-for-difference-in-difference-computations.html#cb148-1427" tabindex="-1"></a>                       <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1428"><a href="functions-for-difference-in-difference-computations.html#cb148-1428" tabindex="-1"></a>  }</span>
<span id="cb148-1429"><a href="functions-for-difference-in-difference-computations.html#cb148-1429" tabindex="-1"></a>  <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb148-1430"><a href="functions-for-difference-in-difference-computations.html#cb148-1430" tabindex="-1"></a>  </span>
<span id="cb148-1431"><a href="functions-for-difference-in-difference-computations.html#cb148-1431" tabindex="-1"></a>  <span class="fu">return</span>(df_plot)</span>
<span id="cb148-1432"><a href="functions-for-difference-in-difference-computations.html#cb148-1432" tabindex="-1"></a>}</span>
<span id="cb148-1433"><a href="functions-for-difference-in-difference-computations.html#cb148-1433" tabindex="-1"></a></span>
<span id="cb148-1434"><a href="functions-for-difference-in-difference-computations.html#cb148-1434" tabindex="-1"></a></span>
<span id="cb148-1435"><a href="functions-for-difference-in-difference-computations.html#cb148-1435" tabindex="-1"></a><span class="co"># Plotting the treatment effect of each protected area analyzed in the same graph. This function suits for AFD supported protected areas : it includes funding information to the table and figures</span></span>
<span id="cb148-1436"><a href="functions-for-difference-in-difference-computations.html#cb148-1436" tabindex="-1"></a><span class="do">## INPUTS</span></span>
<span id="cb148-1437"><a href="functions-for-difference-in-difference-computations.html#cb148-1437" tabindex="-1"></a><span class="do">### df_fc_att : a dataset with treatment effects for each protected area in the sample, expressed as avoided deforestation (hectare)</span></span>
<span id="cb148-1438"><a href="functions-for-difference-in-difference-computations.html#cb148-1438" tabindex="-1"></a><span class="do">### df_fl_att : a dataset with treatment effects for each protected area in the sample, expressed as change in deforestation rate</span></span>
<span id="cb148-1439"><a href="functions-for-difference-in-difference-computations.html#cb148-1439" tabindex="-1"></a><span class="do">### alpha : the threshold for confidence interval</span></span>
<span id="cb148-1440"><a href="functions-for-difference-in-difference-computations.html#cb148-1440" tabindex="-1"></a><span class="do">### save_dir : the saving directory in the remote storage</span></span>
<span id="cb148-1441"><a href="functions-for-difference-in-difference-computations.html#cb148-1441" tabindex="-1"></a><span class="do">## DATA SAVED</span></span>
<span id="cb148-1442"><a href="functions-for-difference-in-difference-computations.html#cb148-1442" tabindex="-1"></a><span class="do">### Tables and figures : treatment effects computed for each protected area in the sample, expressed as avoided deforestaion (hectare and percentage of 2000 forest cover) and change in deforestation rate.</span></span>
<span id="cb148-1443"><a href="functions-for-difference-in-difference-computations.html#cb148-1443" tabindex="-1"></a>fn_plot_att_afd <span class="ot">=</span> <span class="cf">function</span>(df_fc_att, df_fl_att, <span class="at">alpha =</span> alpha, save_dir)</span>
<span id="cb148-1444"><a href="functions-for-difference-in-difference-computations.html#cb148-1444" tabindex="-1"></a>{</span>
<span id="cb148-1445"><a href="functions-for-difference-in-difference-computations.html#cb148-1445" tabindex="-1"></a>  </span>
<span id="cb148-1446"><a href="functions-for-difference-in-difference-computations.html#cb148-1446" tabindex="-1"></a>  <span class="co">#list of PAs and two time periods</span></span>
<span id="cb148-1447"><a href="functions-for-difference-in-difference-computations.html#cb148-1447" tabindex="-1"></a>  list_ctry_plot <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1448"><a href="functions-for-difference-in-difference-computations.html#cb148-1448" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(iso3, country_en, wdpaid, iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb148-1449"><a href="functions-for-difference-in-difference-computations.html#cb148-1449" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1450"><a href="functions-for-difference-in-difference-computations.html#cb148-1450" tabindex="-1"></a>    <span class="fu">group_by</span>(iso3, country_en, wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb148-1451"><a href="functions-for-difference-in-difference-computations.html#cb148-1451" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb148-1452"><a href="functions-for-difference-in-difference-computations.html#cb148-1452" tabindex="-1"></a>              <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-1453"><a href="functions-for-difference-in-difference-computations.html#cb148-1453" tabindex="-1"></a>                                    iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-1454"><a href="functions-for-difference-in-difference-computations.html#cb148-1454" tabindex="-1"></a>                                    <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1455"><a href="functions-for-difference-in-difference-computations.html#cb148-1455" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-1456"><a href="functions-for-difference-in-difference-computations.html#cb148-1456" tabindex="-1"></a>  </span>
<span id="cb148-1457"><a href="functions-for-difference-in-difference-computations.html#cb148-1457" tabindex="-1"></a>  <span class="co">#treatment effect for each wdpa (some have not on the two time periods)</span></span>
<span id="cb148-1458"><a href="functions-for-difference-in-difference-computations.html#cb148-1458" tabindex="-1"></a>  temp_fc <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1459"><a href="functions-for-difference-in-difference-computations.html#cb148-1459" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, country_en, wdpaid, name_pa, iucn_cat, treatment_year, time, year, att_per, cband_lower_per, cband_upper_per, att_pa, cband_lower_pa, cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1460"><a href="functions-for-difference-in-difference-computations.html#cb148-1460" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig_pa =</span> <span class="fu">sign</span>(cband_lower_pa) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pa),</span>
<span id="cb148-1461"><a href="functions-for-difference-in-difference-computations.html#cb148-1461" tabindex="-1"></a>           <span class="at">sig_per =</span> <span class="fu">sign</span>(cband_lower_per) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1462"><a href="functions-for-difference-in-difference-computations.html#cb148-1462" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) </span>
<span id="cb148-1463"><a href="functions-for-difference-in-difference-computations.html#cb148-1463" tabindex="-1"></a>  temp_fl <span class="ot">=</span> df_fl_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1464"><a href="functions-for-difference-in-difference-computations.html#cb148-1464" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, country_en, wdpaid, name_pa, iucn_cat, treatment_year, time, year, att, cband_lower, cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1465"><a href="functions-for-difference-in-difference-computations.html#cb148-1465" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">sign</span>(cband_lower) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1466"><a href="functions-for-difference-in-difference-computations.html#cb148-1466" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) </span>
<span id="cb148-1467"><a href="functions-for-difference-in-difference-computations.html#cb148-1467" tabindex="-1"></a>  </span>
<span id="cb148-1468"><a href="functions-for-difference-in-difference-computations.html#cb148-1468" tabindex="-1"></a>  <span class="co">#Att for each WDPAID, for each period (NA if no value)</span></span>
<span id="cb148-1469"><a href="functions-for-difference-in-difference-computations.html#cb148-1469" tabindex="-1"></a>  df_plot_fc_att <span class="ot">=</span> <span class="fu">left_join</span>(list_ctry_plot, temp_fc, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;country_en&quot;</span>, <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1470"><a href="functions-for-difference-in-difference-computations.html#cb148-1470" tabindex="-1"></a>    <span class="fu">group_by</span>(time, country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1471"><a href="functions-for-difference-in-difference-computations.html#cb148-1471" tabindex="-1"></a>    <span class="fu">arrange</span>(country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1472"><a href="functions-for-difference-in-difference-computations.html#cb148-1472" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country_en =</span> <span class="fu">paste0</span>(country_en, <span class="st">&quot; (&quot;</span>, LETTERS[<span class="fu">row_number</span>()], <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1473"><a href="functions-for-difference-in-difference-computations.html#cb148-1473" tabindex="-1"></a>    <span class="fu">ungroup</span>() </span>
<span id="cb148-1474"><a href="functions-for-difference-in-difference-computations.html#cb148-1474" tabindex="-1"></a>  df_plot_fl_att <span class="ot">=</span> <span class="fu">left_join</span>(list_ctry_plot, temp_fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;country_en&quot;</span>, <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;time&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb148-1475"><a href="functions-for-difference-in-difference-computations.html#cb148-1475" tabindex="-1"></a>    <span class="fu">group_by</span>(time, country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1476"><a href="functions-for-difference-in-difference-computations.html#cb148-1476" tabindex="-1"></a>    <span class="fu">arrange</span>(country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1477"><a href="functions-for-difference-in-difference-computations.html#cb148-1477" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country_en =</span> <span class="fu">paste0</span>(country_en, <span class="st">&quot; (&quot;</span>, LETTERS[<span class="fu">row_number</span>()], <span class="st">&quot;)&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1478"><a href="functions-for-difference-in-difference-computations.html#cb148-1478" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-1479"><a href="functions-for-difference-in-difference-computations.html#cb148-1479" tabindex="-1"></a>  </span>
<span id="cb148-1480"><a href="functions-for-difference-in-difference-computations.html#cb148-1480" tabindex="-1"></a>  <span class="co">#Plots</span></span>
<span id="cb148-1481"><a href="functions-for-difference-in-difference-computations.html#cb148-1481" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;5 years after treatment&quot;</span>,</span>
<span id="cb148-1482"><a href="functions-for-difference-in-difference-computations.html#cb148-1482" tabindex="-1"></a>            <span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;10 years after treatment&quot;</span>,</span>
<span id="cb148-1483"><a href="functions-for-difference-in-difference-computations.html#cb148-1483" tabindex="-1"></a>            <span class="st">`</span><span class="at">Strict</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Strict</span><span class="sc">\n</span><span class="st">IUCN cat. I-IV&quot;</span>,</span>
<span id="cb148-1484"><a href="functions-for-difference-in-difference-computations.html#cb148-1484" tabindex="-1"></a>            <span class="st">`</span><span class="at">Non strict</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Non strict</span><span class="sc">\n</span><span class="st">IUCN V-VI&quot;</span>,</span>
<span id="cb148-1485"><a href="functions-for-difference-in-difference-computations.html#cb148-1485" tabindex="-1"></a>            <span class="st">`</span><span class="at">Unknown</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Unknown&quot;</span>)</span>
<span id="cb148-1486"><a href="functions-for-difference-in-difference-computations.html#cb148-1486" tabindex="-1"></a>  </span>
<span id="cb148-1487"><a href="functions-for-difference-in-difference-computations.html#cb148-1487" tabindex="-1"></a>  <span class="do">## Att in share of 2000 forest cover</span></span>
<span id="cb148-1488"><a href="functions-for-difference-in-difference-computations.html#cb148-1488" tabindex="-1"></a>  fig_att_per <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1489"><a href="functions-for-difference-in-difference-computations.html#cb148-1489" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-1490"><a href="functions-for-difference-in-difference-computations.html#cb148-1490" tabindex="-1"></a>                           <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1491"><a href="functions-for-difference-in-difference-computations.html#cb148-1491" tabindex="-1"></a>                           <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1492"><a href="functions-for-difference-in-difference-computations.html#cb148-1492" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1493"><a href="functions-for-difference-in-difference-computations.html#cb148-1493" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1494"><a href="functions-for-difference-in-difference-computations.html#cb148-1494" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1495"><a href="functions-for-difference-in-difference-computations.html#cb148-1495" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1496"><a href="functions-for-difference-in-difference-computations.html#cb148-1496" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1497"><a href="functions-for-difference-in-difference-computations.html#cb148-1497" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-1498"><a href="functions-for-difference-in-difference-computations.html#cb148-1498" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1499"><a href="functions-for-difference-in-difference-computations.html#cb148-1499" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-1500"><a href="functions-for-difference-in-difference-computations.html#cb148-1500" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-1501"><a href="functions-for-difference-in-difference-computations.html#cb148-1501" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1502"><a href="functions-for-difference-in-difference-computations.html#cb148-1502" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1503"><a href="functions-for-difference-in-difference-computations.html#cb148-1503" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1504"><a href="functions-for-difference-in-difference-computations.html#cb148-1504" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1505"><a href="functions-for-difference-in-difference-computations.html#cb148-1505" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1506"><a href="functions-for-difference-in-difference-computations.html#cb148-1506" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1507"><a href="functions-for-difference-in-difference-computations.html#cb148-1507" tabindex="-1"></a>      </span>
<span id="cb148-1508"><a href="functions-for-difference-in-difference-computations.html#cb148-1508" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1509"><a href="functions-for-difference-in-difference-computations.html#cb148-1509" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1510"><a href="functions-for-difference-in-difference-computations.html#cb148-1510" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1511"><a href="functions-for-difference-in-difference-computations.html#cb148-1511" tabindex="-1"></a>      </span>
<span id="cb148-1512"><a href="functions-for-difference-in-difference-computations.html#cb148-1512" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1513"><a href="functions-for-difference-in-difference-computations.html#cb148-1513" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1514"><a href="functions-for-difference-in-difference-computations.html#cb148-1514" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1515"><a href="functions-for-difference-in-difference-computations.html#cb148-1515" tabindex="-1"></a>      </span>
<span id="cb148-1516"><a href="functions-for-difference-in-difference-computations.html#cb148-1516" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1517"><a href="functions-for-difference-in-difference-computations.html#cb148-1517" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1518"><a href="functions-for-difference-in-difference-computations.html#cb148-1518" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1519"><a href="functions-for-difference-in-difference-computations.html#cb148-1519" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1520"><a href="functions-for-difference-in-difference-computations.html#cb148-1520" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1521"><a href="functions-for-difference-in-difference-computations.html#cb148-1521" tabindex="-1"></a>      </span>
<span id="cb148-1522"><a href="functions-for-difference-in-difference-computations.html#cb148-1522" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1523"><a href="functions-for-difference-in-difference-computations.html#cb148-1523" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1524"><a href="functions-for-difference-in-difference-computations.html#cb148-1524" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1525"><a href="functions-for-difference-in-difference-computations.html#cb148-1525" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1526"><a href="functions-for-difference-in-difference-computations.html#cb148-1526" tabindex="-1"></a>    )</span>
<span id="cb148-1527"><a href="functions-for-difference-in-difference-computations.html#cb148-1527" tabindex="-1"></a>  </span>
<span id="cb148-1528"><a href="functions-for-difference-in-difference-computations.html#cb148-1528" tabindex="-1"></a>  fig_att_per_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1529"><a href="functions-for-difference-in-difference-computations.html#cb148-1529" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-1530"><a href="functions-for-difference-in-difference-computations.html#cb148-1530" tabindex="-1"></a>                           <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1531"><a href="functions-for-difference-in-difference-computations.html#cb148-1531" tabindex="-1"></a>                           <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1532"><a href="functions-for-difference-in-difference-computations.html#cb148-1532" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1533"><a href="functions-for-difference-in-difference-computations.html#cb148-1533" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1534"><a href="functions-for-difference-in-difference-computations.html#cb148-1534" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1535"><a href="functions-for-difference-in-difference-computations.html#cb148-1535" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1536"><a href="functions-for-difference-in-difference-computations.html#cb148-1536" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1537"><a href="functions-for-difference-in-difference-computations.html#cb148-1537" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-1538"><a href="functions-for-difference-in-difference-computations.html#cb148-1538" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1539"><a href="functions-for-difference-in-difference-computations.html#cb148-1539" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-1540"><a href="functions-for-difference-in-difference-computations.html#cb148-1540" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-1541"><a href="functions-for-difference-in-difference-computations.html#cb148-1541" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1542"><a href="functions-for-difference-in-difference-computations.html#cb148-1542" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1543"><a href="functions-for-difference-in-difference-computations.html#cb148-1543" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1544"><a href="functions-for-difference-in-difference-computations.html#cb148-1544" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1545"><a href="functions-for-difference-in-difference-computations.html#cb148-1545" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1546"><a href="functions-for-difference-in-difference-computations.html#cb148-1546" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1547"><a href="functions-for-difference-in-difference-computations.html#cb148-1547" tabindex="-1"></a>      </span>
<span id="cb148-1548"><a href="functions-for-difference-in-difference-computations.html#cb148-1548" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1549"><a href="functions-for-difference-in-difference-computations.html#cb148-1549" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1550"><a href="functions-for-difference-in-difference-computations.html#cb148-1550" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1551"><a href="functions-for-difference-in-difference-computations.html#cb148-1551" tabindex="-1"></a>      </span>
<span id="cb148-1552"><a href="functions-for-difference-in-difference-computations.html#cb148-1552" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1553"><a href="functions-for-difference-in-difference-computations.html#cb148-1553" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1554"><a href="functions-for-difference-in-difference-computations.html#cb148-1554" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1555"><a href="functions-for-difference-in-difference-computations.html#cb148-1555" tabindex="-1"></a>      </span>
<span id="cb148-1556"><a href="functions-for-difference-in-difference-computations.html#cb148-1556" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1557"><a href="functions-for-difference-in-difference-computations.html#cb148-1557" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1558"><a href="functions-for-difference-in-difference-computations.html#cb148-1558" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1559"><a href="functions-for-difference-in-difference-computations.html#cb148-1559" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1560"><a href="functions-for-difference-in-difference-computations.html#cb148-1560" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1561"><a href="functions-for-difference-in-difference-computations.html#cb148-1561" tabindex="-1"></a>      </span>
<span id="cb148-1562"><a href="functions-for-difference-in-difference-computations.html#cb148-1562" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1563"><a href="functions-for-difference-in-difference-computations.html#cb148-1563" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1564"><a href="functions-for-difference-in-difference-computations.html#cb148-1564" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1565"><a href="functions-for-difference-in-difference-computations.html#cb148-1565" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1566"><a href="functions-for-difference-in-difference-computations.html#cb148-1566" tabindex="-1"></a>    )</span>
<span id="cb148-1567"><a href="functions-for-difference-in-difference-computations.html#cb148-1567" tabindex="-1"></a></span>
<span id="cb148-1568"><a href="functions-for-difference-in-difference-computations.html#cb148-1568" tabindex="-1"></a>    </span>
<span id="cb148-1569"><a href="functions-for-difference-in-difference-computations.html#cb148-1569" tabindex="-1"></a>  <span class="do">##treatment effect : total deforestation avoided</span></span>
<span id="cb148-1570"><a href="functions-for-difference-in-difference-computations.html#cb148-1570" tabindex="-1"></a>  fig_att_pa <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1571"><a href="functions-for-difference-in-difference-computations.html#cb148-1571" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-1572"><a href="functions-for-difference-in-difference-computations.html#cb148-1572" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1573"><a href="functions-for-difference-in-difference-computations.html#cb148-1573" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1574"><a href="functions-for-difference-in-difference-computations.html#cb148-1574" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1575"><a href="functions-for-difference-in-difference-computations.html#cb148-1575" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1576"><a href="functions-for-difference-in-difference-computations.html#cb148-1576" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1577"><a href="functions-for-difference-in-difference-computations.html#cb148-1577" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1578"><a href="functions-for-difference-in-difference-computations.html#cb148-1578" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1579"><a href="functions-for-difference-in-difference-computations.html#cb148-1579" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1580"><a href="functions-for-difference-in-difference-computations.html#cb148-1580" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-1581"><a href="functions-for-difference-in-difference-computations.html#cb148-1581" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-1582"><a href="functions-for-difference-in-difference-computations.html#cb148-1582" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1583"><a href="functions-for-difference-in-difference-computations.html#cb148-1583" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1584"><a href="functions-for-difference-in-difference-computations.html#cb148-1584" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1585"><a href="functions-for-difference-in-difference-computations.html#cb148-1585" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1586"><a href="functions-for-difference-in-difference-computations.html#cb148-1586" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1587"><a href="functions-for-difference-in-difference-computations.html#cb148-1587" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1588"><a href="functions-for-difference-in-difference-computations.html#cb148-1588" tabindex="-1"></a>      </span>
<span id="cb148-1589"><a href="functions-for-difference-in-difference-computations.html#cb148-1589" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1590"><a href="functions-for-difference-in-difference-computations.html#cb148-1590" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1591"><a href="functions-for-difference-in-difference-computations.html#cb148-1591" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1592"><a href="functions-for-difference-in-difference-computations.html#cb148-1592" tabindex="-1"></a>      </span>
<span id="cb148-1593"><a href="functions-for-difference-in-difference-computations.html#cb148-1593" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1594"><a href="functions-for-difference-in-difference-computations.html#cb148-1594" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1595"><a href="functions-for-difference-in-difference-computations.html#cb148-1595" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1596"><a href="functions-for-difference-in-difference-computations.html#cb148-1596" tabindex="-1"></a>      </span>
<span id="cb148-1597"><a href="functions-for-difference-in-difference-computations.html#cb148-1597" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1598"><a href="functions-for-difference-in-difference-computations.html#cb148-1598" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1599"><a href="functions-for-difference-in-difference-computations.html#cb148-1599" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1600"><a href="functions-for-difference-in-difference-computations.html#cb148-1600" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1601"><a href="functions-for-difference-in-difference-computations.html#cb148-1601" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1602"><a href="functions-for-difference-in-difference-computations.html#cb148-1602" tabindex="-1"></a>      </span>
<span id="cb148-1603"><a href="functions-for-difference-in-difference-computations.html#cb148-1603" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1604"><a href="functions-for-difference-in-difference-computations.html#cb148-1604" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1605"><a href="functions-for-difference-in-difference-computations.html#cb148-1605" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1606"><a href="functions-for-difference-in-difference-computations.html#cb148-1606" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1607"><a href="functions-for-difference-in-difference-computations.html#cb148-1607" tabindex="-1"></a>    )</span>
<span id="cb148-1608"><a href="functions-for-difference-in-difference-computations.html#cb148-1608" tabindex="-1"></a>  </span>
<span id="cb148-1609"><a href="functions-for-difference-in-difference-computations.html#cb148-1609" tabindex="-1"></a>  fig_att_pa_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1610"><a href="functions-for-difference-in-difference-computations.html#cb148-1610" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-1611"><a href="functions-for-difference-in-difference-computations.html#cb148-1611" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1612"><a href="functions-for-difference-in-difference-computations.html#cb148-1612" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1613"><a href="functions-for-difference-in-difference-computations.html#cb148-1613" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1614"><a href="functions-for-difference-in-difference-computations.html#cb148-1614" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1615"><a href="functions-for-difference-in-difference-computations.html#cb148-1615" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1616"><a href="functions-for-difference-in-difference-computations.html#cb148-1616" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1617"><a href="functions-for-difference-in-difference-computations.html#cb148-1617" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1618"><a href="functions-for-difference-in-difference-computations.html#cb148-1618" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1619"><a href="functions-for-difference-in-difference-computations.html#cb148-1619" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-1620"><a href="functions-for-difference-in-difference-computations.html#cb148-1620" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-1621"><a href="functions-for-difference-in-difference-computations.html#cb148-1621" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1622"><a href="functions-for-difference-in-difference-computations.html#cb148-1622" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1623"><a href="functions-for-difference-in-difference-computations.html#cb148-1623" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1624"><a href="functions-for-difference-in-difference-computations.html#cb148-1624" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1625"><a href="functions-for-difference-in-difference-computations.html#cb148-1625" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1626"><a href="functions-for-difference-in-difference-computations.html#cb148-1626" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1627"><a href="functions-for-difference-in-difference-computations.html#cb148-1627" tabindex="-1"></a>      </span>
<span id="cb148-1628"><a href="functions-for-difference-in-difference-computations.html#cb148-1628" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1629"><a href="functions-for-difference-in-difference-computations.html#cb148-1629" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1630"><a href="functions-for-difference-in-difference-computations.html#cb148-1630" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1631"><a href="functions-for-difference-in-difference-computations.html#cb148-1631" tabindex="-1"></a>      </span>
<span id="cb148-1632"><a href="functions-for-difference-in-difference-computations.html#cb148-1632" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1633"><a href="functions-for-difference-in-difference-computations.html#cb148-1633" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1634"><a href="functions-for-difference-in-difference-computations.html#cb148-1634" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1635"><a href="functions-for-difference-in-difference-computations.html#cb148-1635" tabindex="-1"></a>      </span>
<span id="cb148-1636"><a href="functions-for-difference-in-difference-computations.html#cb148-1636" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1637"><a href="functions-for-difference-in-difference-computations.html#cb148-1637" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1638"><a href="functions-for-difference-in-difference-computations.html#cb148-1638" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1639"><a href="functions-for-difference-in-difference-computations.html#cb148-1639" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1640"><a href="functions-for-difference-in-difference-computations.html#cb148-1640" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1641"><a href="functions-for-difference-in-difference-computations.html#cb148-1641" tabindex="-1"></a>      </span>
<span id="cb148-1642"><a href="functions-for-difference-in-difference-computations.html#cb148-1642" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1643"><a href="functions-for-difference-in-difference-computations.html#cb148-1643" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1644"><a href="functions-for-difference-in-difference-computations.html#cb148-1644" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1645"><a href="functions-for-difference-in-difference-computations.html#cb148-1645" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1646"><a href="functions-for-difference-in-difference-computations.html#cb148-1646" tabindex="-1"></a>    )</span>
<span id="cb148-1647"><a href="functions-for-difference-in-difference-computations.html#cb148-1647" tabindex="-1"></a>  </span>
<span id="cb148-1648"><a href="functions-for-difference-in-difference-computations.html#cb148-1648" tabindex="-1"></a>  <span class="do">##treatment effect : avoided deforestation in percentage points</span></span>
<span id="cb148-1649"><a href="functions-for-difference-in-difference-computations.html#cb148-1649" tabindex="-1"></a>  fig_att_fl <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fl_att, </span>
<span id="cb148-1650"><a href="functions-for-difference-in-difference-computations.html#cb148-1650" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-1651"><a href="functions-for-difference-in-difference-computations.html#cb148-1651" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1652"><a href="functions-for-difference-in-difference-computations.html#cb148-1652" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1653"><a href="functions-for-difference-in-difference-computations.html#cb148-1653" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1654"><a href="functions-for-difference-in-difference-computations.html#cb148-1654" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1655"><a href="functions-for-difference-in-difference-computations.html#cb148-1655" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1656"><a href="functions-for-difference-in-difference-computations.html#cb148-1656" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1657"><a href="functions-for-difference-in-difference-computations.html#cb148-1657" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1658"><a href="functions-for-difference-in-difference-computations.html#cb148-1658" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1659"><a href="functions-for-difference-in-difference-computations.html#cb148-1659" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-1660"><a href="functions-for-difference-in-difference-computations.html#cb148-1660" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-1661"><a href="functions-for-difference-in-difference-computations.html#cb148-1661" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1662"><a href="functions-for-difference-in-difference-computations.html#cb148-1662" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1663"><a href="functions-for-difference-in-difference-computations.html#cb148-1663" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1664"><a href="functions-for-difference-in-difference-computations.html#cb148-1664" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1665"><a href="functions-for-difference-in-difference-computations.html#cb148-1665" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1666"><a href="functions-for-difference-in-difference-computations.html#cb148-1666" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1667"><a href="functions-for-difference-in-difference-computations.html#cb148-1667" tabindex="-1"></a>      </span>
<span id="cb148-1668"><a href="functions-for-difference-in-difference-computations.html#cb148-1668" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1669"><a href="functions-for-difference-in-difference-computations.html#cb148-1669" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1670"><a href="functions-for-difference-in-difference-computations.html#cb148-1670" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1671"><a href="functions-for-difference-in-difference-computations.html#cb148-1671" tabindex="-1"></a>      </span>
<span id="cb148-1672"><a href="functions-for-difference-in-difference-computations.html#cb148-1672" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1673"><a href="functions-for-difference-in-difference-computations.html#cb148-1673" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1674"><a href="functions-for-difference-in-difference-computations.html#cb148-1674" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1675"><a href="functions-for-difference-in-difference-computations.html#cb148-1675" tabindex="-1"></a>      </span>
<span id="cb148-1676"><a href="functions-for-difference-in-difference-computations.html#cb148-1676" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1677"><a href="functions-for-difference-in-difference-computations.html#cb148-1677" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1678"><a href="functions-for-difference-in-difference-computations.html#cb148-1678" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1679"><a href="functions-for-difference-in-difference-computations.html#cb148-1679" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1680"><a href="functions-for-difference-in-difference-computations.html#cb148-1680" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1681"><a href="functions-for-difference-in-difference-computations.html#cb148-1681" tabindex="-1"></a>      </span>
<span id="cb148-1682"><a href="functions-for-difference-in-difference-computations.html#cb148-1682" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1683"><a href="functions-for-difference-in-difference-computations.html#cb148-1683" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1684"><a href="functions-for-difference-in-difference-computations.html#cb148-1684" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1685"><a href="functions-for-difference-in-difference-computations.html#cb148-1685" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1686"><a href="functions-for-difference-in-difference-computations.html#cb148-1686" tabindex="-1"></a>    )</span>
<span id="cb148-1687"><a href="functions-for-difference-in-difference-computations.html#cb148-1687" tabindex="-1"></a>  </span>
<span id="cb148-1688"><a href="functions-for-difference-in-difference-computations.html#cb148-1688" tabindex="-1"></a>  fig_att_fl_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fl_att, </span>
<span id="cb148-1689"><a href="functions-for-difference-in-difference-computations.html#cb148-1689" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-1690"><a href="functions-for-difference-in-difference-computations.html#cb148-1690" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(country_en, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(country_en)))),</span>
<span id="cb148-1691"><a href="functions-for-difference-in-difference-computations.html#cb148-1691" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1692"><a href="functions-for-difference-in-difference-computations.html#cb148-1692" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1693"><a href="functions-for-difference-in-difference-computations.html#cb148-1693" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1694"><a href="functions-for-difference-in-difference-computations.html#cb148-1694" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1695"><a href="functions-for-difference-in-difference-computations.html#cb148-1695" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1696"><a href="functions-for-difference-in-difference-computations.html#cb148-1696" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1697"><a href="functions-for-difference-in-difference-computations.html#cb148-1697" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1698"><a href="functions-for-difference-in-difference-computations.html#cb148-1698" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-1699"><a href="functions-for-difference-in-difference-computations.html#cb148-1699" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-1700"><a href="functions-for-difference-in-difference-computations.html#cb148-1700" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1701"><a href="functions-for-difference-in-difference-computations.html#cb148-1701" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1702"><a href="functions-for-difference-in-difference-computations.html#cb148-1702" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1703"><a href="functions-for-difference-in-difference-computations.html#cb148-1703" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1704"><a href="functions-for-difference-in-difference-computations.html#cb148-1704" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1705"><a href="functions-for-difference-in-difference-computations.html#cb148-1705" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1706"><a href="functions-for-difference-in-difference-computations.html#cb148-1706" tabindex="-1"></a>      </span>
<span id="cb148-1707"><a href="functions-for-difference-in-difference-computations.html#cb148-1707" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1708"><a href="functions-for-difference-in-difference-computations.html#cb148-1708" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1709"><a href="functions-for-difference-in-difference-computations.html#cb148-1709" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1710"><a href="functions-for-difference-in-difference-computations.html#cb148-1710" tabindex="-1"></a>      </span>
<span id="cb148-1711"><a href="functions-for-difference-in-difference-computations.html#cb148-1711" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1712"><a href="functions-for-difference-in-difference-computations.html#cb148-1712" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1713"><a href="functions-for-difference-in-difference-computations.html#cb148-1713" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1714"><a href="functions-for-difference-in-difference-computations.html#cb148-1714" tabindex="-1"></a>      </span>
<span id="cb148-1715"><a href="functions-for-difference-in-difference-computations.html#cb148-1715" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1716"><a href="functions-for-difference-in-difference-computations.html#cb148-1716" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1717"><a href="functions-for-difference-in-difference-computations.html#cb148-1717" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1718"><a href="functions-for-difference-in-difference-computations.html#cb148-1718" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1719"><a href="functions-for-difference-in-difference-computations.html#cb148-1719" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1720"><a href="functions-for-difference-in-difference-computations.html#cb148-1720" tabindex="-1"></a>      </span>
<span id="cb148-1721"><a href="functions-for-difference-in-difference-computations.html#cb148-1721" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1722"><a href="functions-for-difference-in-difference-computations.html#cb148-1722" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1723"><a href="functions-for-difference-in-difference-computations.html#cb148-1723" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1724"><a href="functions-for-difference-in-difference-computations.html#cb148-1724" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1725"><a href="functions-for-difference-in-difference-computations.html#cb148-1725" tabindex="-1"></a>    )</span>
<span id="cb148-1726"><a href="functions-for-difference-in-difference-computations.html#cb148-1726" tabindex="-1"></a>  </span>
<span id="cb148-1727"><a href="functions-for-difference-in-difference-computations.html#cb148-1727" tabindex="-1"></a>  </span>
<span id="cb148-1728"><a href="functions-for-difference-in-difference-computations.html#cb148-1728" tabindex="-1"></a>  <span class="co">#Tables </span></span>
<span id="cb148-1729"><a href="functions-for-difference-in-difference-computations.html#cb148-1729" tabindex="-1"></a>  <span class="do">## treatment effect : percentage of deforestation avoided</span></span>
<span id="cb148-1730"><a href="functions-for-difference-in-difference-computations.html#cb148-1730" tabindex="-1"></a>  tbl_fc_att_per <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1731"><a href="functions-for-difference-in-difference-computations.html#cb148-1731" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig_per =</span> <span class="fu">case_when</span>(<span class="fu">sign</span>(cband_lower_per) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_per) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-1732"><a href="functions-for-difference-in-difference-computations.html#cb148-1732" tabindex="-1"></a>                               <span class="fu">sign</span>(cband_lower_per) <span class="sc">!=</span> <span class="fu">sign</span>(cband_upper_per) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1733"><a href="functions-for-difference-in-difference-computations.html#cb148-1733" tabindex="-1"></a>           <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-1734"><a href="functions-for-difference-in-difference-computations.html#cb148-1734" tabindex="-1"></a>                                 iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-1735"><a href="functions-for-difference-in-difference-computations.html#cb148-1735" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-1736"><a href="functions-for-difference-in-difference-computations.html#cb148-1736" tabindex="-1"></a>           <span class="at">dept_report =</span> <span class="fu">case_when</span>(dept_report <span class="sc">==</span> <span class="st">&quot;Léa Poulin,Pierre-Yves Durand,Ingrid Dallmann&quot;</span> <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb148-1737"><a href="functions-for-difference-in-difference-computations.html#cb148-1737" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> dept_report),</span>
<span id="cb148-1738"><a href="functions-for-difference-in-difference-computations.html#cb148-1738" tabindex="-1"></a>           <span class="at">kfw =</span> <span class="fu">case_when</span>(kfw <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, kfw <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1739"><a href="functions-for-difference-in-difference-computations.html#cb148-1739" tabindex="-1"></a>           <span class="at">ffem =</span> <span class="fu">case_when</span>(ffem <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, ffem <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1740"><a href="functions-for-difference-in-difference-computations.html#cb148-1740" tabindex="-1"></a>           <span class="at">funding_year_list =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(funding_year_list) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb148-1741"><a href="functions-for-difference-in-difference-computations.html#cb148-1741" tabindex="-1"></a>                                         <span class="cn">TRUE</span> <span class="sc">~</span> funding_year_list),</span>
<span id="cb148-1742"><a href="functions-for-difference-in-difference-computations.html#cb148-1742" tabindex="-1"></a>           <span class="at">name_pa =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(name_pa) <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(name_pa, <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>),</span>
<span id="cb148-1743"><a href="functions-for-difference-in-difference-computations.html#cb148-1743" tabindex="-1"></a>                               <span class="fu">nchar</span>(name_pa) <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(<span class="fu">paste0</span>(<span class="fu">substr</span>(name_pa, <span class="dv">1</span>, <span class="dv">25</span>), <span class="st">&quot;...&quot;</span>),  <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>))</span>
<span id="cb148-1744"><a href="functions-for-difference-in-difference-computations.html#cb148-1744" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb148-1745"><a href="functions-for-difference-in-difference-computations.html#cb148-1745" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, fund_type, kfw, ffem, iucn_wolf, gov_type, time, att_per, sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1746"><a href="functions-for-difference-in-difference-computations.html#cb148-1746" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1747"><a href="functions-for-difference-in-difference-computations.html#cb148-1747" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;att_per&quot;</span>, <span class="st">&quot;sig_per&quot;</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1748"><a href="functions-for-difference-in-difference-computations.html#cb148-1748" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, kfw, ffem, iucn_wolf, att_per_5, sig_per_5, att_per_10, sig_per_10)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1749"><a href="functions-for-difference-in-difference-computations.html#cb148-1749" tabindex="-1"></a>    <span class="co">#dplyr::select(c(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, fund_type, kfw, ffem, iucn_wolf, gov_type, att_per_5, sig_per_5, att_per_10, sig_per_10)) %&gt;%</span></span>
<span id="cb148-1750"><a href="functions-for-difference-in-difference-computations.html#cb148-1750" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;att&quot;</span>, <span class="st">&quot;sig&quot;</span>)),</span>
<span id="cb148-1751"><a href="functions-for-difference-in-difference-computations.html#cb148-1751" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">format</span>(x, <span class="at">digit =</span> <span class="dv">1</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb148-1752"><a href="functions-for-difference-in-difference-computations.html#cb148-1752" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;Effect (5 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_per_5&quot;</span>,</span>
<span id="cb148-1753"><a href="functions-for-difference-in-difference-computations.html#cb148-1753" tabindex="-1"></a>           <span class="st">&quot;Signi. (5 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_per_5&quot;</span>,</span>
<span id="cb148-1754"><a href="functions-for-difference-in-difference-computations.html#cb148-1754" tabindex="-1"></a>           <span class="st">&quot;Effect (10 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_per_10&quot;</span>,</span>
<span id="cb148-1755"><a href="functions-for-difference-in-difference-computations.html#cb148-1755" tabindex="-1"></a>           <span class="st">&quot;Signi. (10 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_per_10&quot;</span>) </span>
<span id="cb148-1756"><a href="functions-for-difference-in-difference-computations.html#cb148-1756" tabindex="-1"></a>  <span class="co"># names(tbl_fc_att_per) = c(&quot;Name&quot;, &quot;Project ID&quot;, &quot;Tech. div.&quot;, &quot;Country&quot;, &quot;Creation&quot;, &quot;Funding year&quot;, &quot;Type of funding&quot;, &quot;KfW&quot;, &quot;FFEM&quot;, &quot;Protection&quot;, </span></span>
<span id="cb148-1757"><a href="functions-for-difference-in-difference-computations.html#cb148-1757" tabindex="-1"></a>  <span class="co">#                           &quot;Governance&quot;, &quot;Effect (5 y., %)&quot;, &quot;Significance (5 y.)&quot;,&quot;Effect (10 y., %)&quot;, &quot;Significance (10 y.)&quot;)</span></span>
<span id="cb148-1758"><a href="functions-for-difference-in-difference-computations.html#cb148-1758" tabindex="-1"></a>  <span class="fu">names</span>(tbl_fc_att_per) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Project ID&quot;</span>, <span class="st">&quot;Tech. div.&quot;</span>, <span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Creation&quot;</span>, <span class="st">&quot;Funding year&quot;</span>, <span class="st">&quot;KfW&quot;</span>, <span class="st">&quot;FFEM&quot;</span>, <span class="st">&quot;Protection&quot;</span>, </span>
<span id="cb148-1759"><a href="functions-for-difference-in-difference-computations.html#cb148-1759" tabindex="-1"></a>                            <span class="st">&quot;Effect (5 y., %)&quot;</span>, <span class="st">&quot;Signi. (5 y.)&quot;</span>,<span class="st">&quot;Effect (10 y., %)&quot;</span>, <span class="st">&quot;Signi. (10 y.)&quot;</span>)</span>
<span id="cb148-1760"><a href="functions-for-difference-in-difference-computations.html#cb148-1760" tabindex="-1"></a>  </span>
<span id="cb148-1761"><a href="functions-for-difference-in-difference-computations.html#cb148-1761" tabindex="-1"></a>  <span class="co"># treatment effect : total deforestation avoided </span></span>
<span id="cb148-1762"><a href="functions-for-difference-in-difference-computations.html#cb148-1762" tabindex="-1"></a>  tbl_fc_att_pa <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1763"><a href="functions-for-difference-in-difference-computations.html#cb148-1763" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig_pa =</span> <span class="fu">case_when</span>(<span class="fu">sign</span>(cband_lower_pa) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pa) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-1764"><a href="functions-for-difference-in-difference-computations.html#cb148-1764" tabindex="-1"></a>                              <span class="fu">sign</span>(cband_lower_pa) <span class="sc">!=</span> <span class="fu">sign</span>(cband_upper_pa) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1765"><a href="functions-for-difference-in-difference-computations.html#cb148-1765" tabindex="-1"></a>           <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-1766"><a href="functions-for-difference-in-difference-computations.html#cb148-1766" tabindex="-1"></a>                                 iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-1767"><a href="functions-for-difference-in-difference-computations.html#cb148-1767" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-1768"><a href="functions-for-difference-in-difference-computations.html#cb148-1768" tabindex="-1"></a>           <span class="at">dept_report =</span> <span class="fu">case_when</span>(dept_report <span class="sc">==</span> <span class="st">&quot;Léa Poulin,Pierre-Yves Durand,Ingrid Dallmann&quot;</span> <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb148-1769"><a href="functions-for-difference-in-difference-computations.html#cb148-1769" tabindex="-1"></a>                                   <span class="cn">TRUE</span> <span class="sc">~</span> dept_report),</span>
<span id="cb148-1770"><a href="functions-for-difference-in-difference-computations.html#cb148-1770" tabindex="-1"></a>           <span class="at">kfw =</span> <span class="fu">case_when</span>(kfw <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, kfw <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1771"><a href="functions-for-difference-in-difference-computations.html#cb148-1771" tabindex="-1"></a>           <span class="at">ffem =</span> <span class="fu">case_when</span>(ffem <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>, ffem <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-1772"><a href="functions-for-difference-in-difference-computations.html#cb148-1772" tabindex="-1"></a>           <span class="at">funding_year_list =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(funding_year_list) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb148-1773"><a href="functions-for-difference-in-difference-computations.html#cb148-1773" tabindex="-1"></a>                                         <span class="cn">TRUE</span> <span class="sc">~</span> funding_year_list),</span>
<span id="cb148-1774"><a href="functions-for-difference-in-difference-computations.html#cb148-1774" tabindex="-1"></a>           <span class="at">name_pa =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(name_pa) <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(name_pa, <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>),</span>
<span id="cb148-1775"><a href="functions-for-difference-in-difference-computations.html#cb148-1775" tabindex="-1"></a>                               <span class="fu">nchar</span>(name_pa) <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(<span class="fu">paste0</span>(<span class="fu">substr</span>(name_pa, <span class="dv">1</span>, <span class="dv">25</span>), <span class="st">&quot;...&quot;</span>),  <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>))</span>
<span id="cb148-1776"><a href="functions-for-difference-in-difference-computations.html#cb148-1776" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb148-1777"><a href="functions-for-difference-in-difference-computations.html#cb148-1777" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, fund_type, kfw, ffem, iucn_wolf, gov_type, time, att_pa, sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1778"><a href="functions-for-difference-in-difference-computations.html#cb148-1778" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1779"><a href="functions-for-difference-in-difference-computations.html#cb148-1779" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;att_pa&quot;</span>, <span class="st">&quot;sig_pa&quot;</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1780"><a href="functions-for-difference-in-difference-computations.html#cb148-1780" tabindex="-1"></a>    <span class="co"># dplyr::select(c(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, fund_type, kfw, ffem, iucn_wolf, gov_type, att_pa_5, sig_pa_5, att_pa_10, sig_pa_10)) %&gt;%</span></span>
<span id="cb148-1781"><a href="functions-for-difference-in-difference-computations.html#cb148-1781" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, id_projet, dept_report, country_en, treatment_year, funding_year_list, kfw, ffem, iucn_wolf, att_pa_5, sig_pa_5, att_pa_10, sig_pa_10)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1782"><a href="functions-for-difference-in-difference-computations.html#cb148-1782" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;att&quot;</span>, <span class="st">&quot;sig&quot;</span>)),</span>
<span id="cb148-1783"><a href="functions-for-difference-in-difference-computations.html#cb148-1783" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">format</span>(x, <span class="at">digit =</span> <span class="dv">1</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb148-1784"><a href="functions-for-difference-in-difference-computations.html#cb148-1784" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;Effect (5 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_pa_5&quot;</span>,</span>
<span id="cb148-1785"><a href="functions-for-difference-in-difference-computations.html#cb148-1785" tabindex="-1"></a>           <span class="st">&quot;Signi. (5 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_pa_5&quot;</span>,</span>
<span id="cb148-1786"><a href="functions-for-difference-in-difference-computations.html#cb148-1786" tabindex="-1"></a>           <span class="st">&quot;Effect (10 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_pa_10&quot;</span>,</span>
<span id="cb148-1787"><a href="functions-for-difference-in-difference-computations.html#cb148-1787" tabindex="-1"></a>           <span class="st">&quot;Signi. (10 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_pa_10&quot;</span>) </span>
<span id="cb148-1788"><a href="functions-for-difference-in-difference-computations.html#cb148-1788" tabindex="-1"></a>  <span class="co"># names(tbl_fc_att_pa) = c(&quot;Name&quot;, &quot;Project ID&quot;, &quot;Tech. div.&quot;, &quot;Country&quot;, &quot;Creation&quot;, &quot;Funding year&quot;, &quot;Type of funding&quot;, &quot;KfW&quot;, &quot;FFEM&quot;, &quot;Protection&quot;, </span></span>
<span id="cb148-1789"><a href="functions-for-difference-in-difference-computations.html#cb148-1789" tabindex="-1"></a>  <span class="co">#                           &quot;Governance&quot;, &quot;Effect (5 y., ha)&quot;, &quot;Significance (5 y.)&quot;,&quot;Effect (10 y., ha)&quot;, &quot;Significance (10 y.)&quot;)</span></span>
<span id="cb148-1790"><a href="functions-for-difference-in-difference-computations.html#cb148-1790" tabindex="-1"></a>  <span class="fu">names</span>(tbl_fc_att_pa) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;Project ID&quot;</span>, <span class="st">&quot;Tech. div.&quot;</span>, <span class="st">&quot;Country&quot;</span>, <span class="st">&quot;Creation&quot;</span>, <span class="st">&quot;Funding year&quot;</span>, <span class="st">&quot;KfW&quot;</span>, <span class="st">&quot;FFEM&quot;</span>, <span class="st">&quot;Protection&quot;</span>, </span>
<span id="cb148-1791"><a href="functions-for-difference-in-difference-computations.html#cb148-1791" tabindex="-1"></a>                           <span class="st">&quot;Effect (5 y., ha)&quot;</span>, <span class="st">&quot;Signi. (5 y.)&quot;</span>,<span class="st">&quot;Effect (10 y., ha)&quot;</span>, <span class="st">&quot;Signi. (10 y.)&quot;</span>)</span>
<span id="cb148-1792"><a href="functions-for-difference-in-difference-computations.html#cb148-1792" tabindex="-1"></a>  </span>
<span id="cb148-1793"><a href="functions-for-difference-in-difference-computations.html#cb148-1793" tabindex="-1"></a>  </span>
<span id="cb148-1794"><a href="functions-for-difference-in-difference-computations.html#cb148-1794" tabindex="-1"></a>  </span>
<span id="cb148-1795"><a href="functions-for-difference-in-difference-computations.html#cb148-1795" tabindex="-1"></a>  <span class="co">#Saving plots</span></span>
<span id="cb148-1796"><a href="functions-for-difference-in-difference-computations.html#cb148-1796" tabindex="-1"></a>  </span>
<span id="cb148-1797"><a href="functions-for-difference-in-difference-computations.html#cb148-1797" tabindex="-1"></a>  <span class="do">##Saving plots</span></span>
<span id="cb148-1798"><a href="functions-for-difference-in-difference-computations.html#cb148-1798" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;fig&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb148-1799"><a href="functions-for-difference-in-difference-computations.html#cb148-1799" tabindex="-1"></a>  </span>
<span id="cb148-1800"><a href="functions-for-difference-in-difference-computations.html#cb148-1800" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1801"><a href="functions-for-difference-in-difference-computations.html#cb148-1801" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per,</span>
<span id="cb148-1802"><a href="functions-for-difference-in-difference-computations.html#cb148-1802" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1803"><a href="functions-for-difference-in-difference-computations.html#cb148-1803" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1804"><a href="functions-for-difference-in-difference-computations.html#cb148-1804" tabindex="-1"></a>  </span>
<span id="cb148-1805"><a href="functions-for-difference-in-difference-computations.html#cb148-1805" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1806"><a href="functions-for-difference-in-difference-computations.html#cb148-1806" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per_iucn,</span>
<span id="cb148-1807"><a href="functions-for-difference-in-difference-computations.html#cb148-1807" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1808"><a href="functions-for-difference-in-difference-computations.html#cb148-1808" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1809"><a href="functions-for-difference-in-difference-computations.html#cb148-1809" tabindex="-1"></a>  </span>
<span id="cb148-1810"><a href="functions-for-difference-in-difference-computations.html#cb148-1810" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1811"><a href="functions-for-difference-in-difference-computations.html#cb148-1811" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa,</span>
<span id="cb148-1812"><a href="functions-for-difference-in-difference-computations.html#cb148-1812" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1813"><a href="functions-for-difference-in-difference-computations.html#cb148-1813" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1814"><a href="functions-for-difference-in-difference-computations.html#cb148-1814" tabindex="-1"></a>  </span>
<span id="cb148-1815"><a href="functions-for-difference-in-difference-computations.html#cb148-1815" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1816"><a href="functions-for-difference-in-difference-computations.html#cb148-1816" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa_iucn,</span>
<span id="cb148-1817"><a href="functions-for-difference-in-difference-computations.html#cb148-1817" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1818"><a href="functions-for-difference-in-difference-computations.html#cb148-1818" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1819"><a href="functions-for-difference-in-difference-computations.html#cb148-1819" tabindex="-1"></a>  </span>
<span id="cb148-1820"><a href="functions-for-difference-in-difference-computations.html#cb148-1820" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1821"><a href="functions-for-difference-in-difference-computations.html#cb148-1821" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl,</span>
<span id="cb148-1822"><a href="functions-for-difference-in-difference-computations.html#cb148-1822" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1823"><a href="functions-for-difference-in-difference-computations.html#cb148-1823" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1824"><a href="functions-for-difference-in-difference-computations.html#cb148-1824" tabindex="-1"></a>  </span>
<span id="cb148-1825"><a href="functions-for-difference-in-difference-computations.html#cb148-1825" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1826"><a href="functions-for-difference-in-difference-computations.html#cb148-1826" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl_iucn,</span>
<span id="cb148-1827"><a href="functions-for-difference-in-difference-computations.html#cb148-1827" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-1828"><a href="functions-for-difference-in-difference-computations.html#cb148-1828" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-1829"><a href="functions-for-difference-in-difference-computations.html#cb148-1829" tabindex="-1"></a>  </span>
<span id="cb148-1830"><a href="functions-for-difference-in-difference-computations.html#cb148-1830" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">xtable</span>(tbl_fc_att_pa, </span>
<span id="cb148-1831"><a href="functions-for-difference-in-difference-computations.html#cb148-1831" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>),</span>
<span id="cb148-1832"><a href="functions-for-difference-in-difference-computations.html#cb148-1832" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste</span>(tmp, <span class="st">&quot;tbl_fc_att_pa.tex&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb148-1833"><a href="functions-for-difference-in-difference-computations.html#cb148-1833" tabindex="-1"></a>  </span>
<span id="cb148-1834"><a href="functions-for-difference-in-difference-computations.html#cb148-1834" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">xtable</span>(tbl_fc_att_per, <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>),</span>
<span id="cb148-1835"><a href="functions-for-difference-in-difference-computations.html#cb148-1835" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste</span>(tmp, <span class="st">&quot;tbl_fc_att_per.tex&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb148-1836"><a href="functions-for-difference-in-difference-computations.html#cb148-1836" tabindex="-1"></a>  </span>
<span id="cb148-1837"><a href="functions-for-difference-in-difference-computations.html#cb148-1837" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1838"><a href="functions-for-difference-in-difference-computations.html#cb148-1838" tabindex="-1"></a>  <span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb148-1839"><a href="functions-for-difference-in-difference-computations.html#cb148-1839" tabindex="-1"></a>  <span class="cf">for</span>(f <span class="cf">in</span> files) </span>
<span id="cb148-1840"><a href="functions-for-difference-in-difference-computations.html#cb148-1840" tabindex="-1"></a>  {</span>
<span id="cb148-1841"><a href="functions-for-difference-in-difference-computations.html#cb148-1841" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb148-1842"><a href="functions-for-difference-in-difference-computations.html#cb148-1842" tabindex="-1"></a>    aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb148-1843"><a href="functions-for-difference-in-difference-computations.html#cb148-1843" tabindex="-1"></a>                       <span class="at">bucket =</span> <span class="fu">paste</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>, save_dir, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-1844"><a href="functions-for-difference-in-difference-computations.html#cb148-1844" tabindex="-1"></a>                       <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-1845"><a href="functions-for-difference-in-difference-computations.html#cb148-1845" tabindex="-1"></a>  }</span>
<span id="cb148-1846"><a href="functions-for-difference-in-difference-computations.html#cb148-1846" tabindex="-1"></a>  <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb148-1847"><a href="functions-for-difference-in-difference-computations.html#cb148-1847" tabindex="-1"></a>}</span>
<span id="cb148-1848"><a href="functions-for-difference-in-difference-computations.html#cb148-1848" tabindex="-1"></a></span>
<span id="cb148-1849"><a href="functions-for-difference-in-difference-computations.html#cb148-1849" tabindex="-1"></a></span>
<span id="cb148-1850"><a href="functions-for-difference-in-difference-computations.html#cb148-1850" tabindex="-1"></a><span class="co"># Plotting the treatment effect of each protected area analyzed in the same graph. This function suits for all protected areas in general, and does not include any information on funding.</span></span>
<span id="cb148-1851"><a href="functions-for-difference-in-difference-computations.html#cb148-1851" tabindex="-1"></a><span class="do">## INPUTS</span></span>
<span id="cb148-1852"><a href="functions-for-difference-in-difference-computations.html#cb148-1852" tabindex="-1"></a><span class="do">### df_fc_att : a dataset with treatment effects for each protected area in the sample, expressed as avoided deforestation (hectare)</span></span>
<span id="cb148-1853"><a href="functions-for-difference-in-difference-computations.html#cb148-1853" tabindex="-1"></a><span class="do">### df_fl_att : a dataset with treatment effects for each protected area in the sample, expressed as change in deforestation rate</span></span>
<span id="cb148-1854"><a href="functions-for-difference-in-difference-computations.html#cb148-1854" tabindex="-1"></a><span class="do">### alpha : the threshold for confidence interval</span></span>
<span id="cb148-1855"><a href="functions-for-difference-in-difference-computations.html#cb148-1855" tabindex="-1"></a><span class="do">### save_dir : the saving directory in the remote storage</span></span>
<span id="cb148-1856"><a href="functions-for-difference-in-difference-computations.html#cb148-1856" tabindex="-1"></a><span class="do">## DATA SAVED</span></span>
<span id="cb148-1857"><a href="functions-for-difference-in-difference-computations.html#cb148-1857" tabindex="-1"></a><span class="do">### Tables and figures : treatment effects computed for each protected area in the sample, expressed as avoided deforestaion (hectare and percentage of 2000 forest cover) and change in deforestation rate.</span></span>
<span id="cb148-1858"><a href="functions-for-difference-in-difference-computations.html#cb148-1858" tabindex="-1"></a>fn_plot_att_general <span class="ot">=</span> <span class="cf">function</span>(df_fc_att, df_fl_att, list_focus, <span class="at">alpha =</span> alpha, save_dir)</span>
<span id="cb148-1859"><a href="functions-for-difference-in-difference-computations.html#cb148-1859" tabindex="-1"></a>{</span>
<span id="cb148-1860"><a href="functions-for-difference-in-difference-computations.html#cb148-1860" tabindex="-1"></a>  </span>
<span id="cb148-1861"><a href="functions-for-difference-in-difference-computations.html#cb148-1861" tabindex="-1"></a>  <span class="co">#list of PAs and two time periods</span></span>
<span id="cb148-1862"><a href="functions-for-difference-in-difference-computations.html#cb148-1862" tabindex="-1"></a>  list_ctry_plot <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1863"><a href="functions-for-difference-in-difference-computations.html#cb148-1863" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(iso3, country_en, wdpaid, name_pa, iucn_cat, gov_type, own_type, treatment_year, status_wdpa) <span class="sc">%&gt;%</span></span>
<span id="cb148-1864"><a href="functions-for-difference-in-difference-computations.html#cb148-1864" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1865"><a href="functions-for-difference-in-difference-computations.html#cb148-1865" tabindex="-1"></a>    <span class="fu">group_by</span>(iso3, country_en, wdpaid, name_pa) <span class="sc">%&gt;%</span></span>
<span id="cb148-1866"><a href="functions-for-difference-in-difference-computations.html#cb148-1866" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">time =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>),</span>
<span id="cb148-1867"><a href="functions-for-difference-in-difference-computations.html#cb148-1867" tabindex="-1"></a>              <span class="at">iucn_cat =</span> iucn_cat,</span>
<span id="cb148-1868"><a href="functions-for-difference-in-difference-computations.html#cb148-1868" tabindex="-1"></a>              <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-1869"><a href="functions-for-difference-in-difference-computations.html#cb148-1869" tabindex="-1"></a>                                    iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-1870"><a href="functions-for-difference-in-difference-computations.html#cb148-1870" tabindex="-1"></a>                                    <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-1871"><a href="functions-for-difference-in-difference-computations.html#cb148-1871" tabindex="-1"></a>              <span class="at">treatment_year =</span> treatment_year,</span>
<span id="cb148-1872"><a href="functions-for-difference-in-difference-computations.html#cb148-1872" tabindex="-1"></a>              <span class="at">gov_type =</span> gov_type,</span>
<span id="cb148-1873"><a href="functions-for-difference-in-difference-computations.html#cb148-1873" tabindex="-1"></a>              <span class="at">own_type =</span> own_type,</span>
<span id="cb148-1874"><a href="functions-for-difference-in-difference-computations.html#cb148-1874" tabindex="-1"></a>              <span class="at">status_wdpa =</span> status_wdpa) <span class="sc">%&gt;%</span></span>
<span id="cb148-1875"><a href="functions-for-difference-in-difference-computations.html#cb148-1875" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-1876"><a href="functions-for-difference-in-difference-computations.html#cb148-1876" tabindex="-1"></a>  </span>
<span id="cb148-1877"><a href="functions-for-difference-in-difference-computations.html#cb148-1877" tabindex="-1"></a>  <span class="co">#treatment effect for each wdpa (some have not on the two time periods)</span></span>
<span id="cb148-1878"><a href="functions-for-difference-in-difference-computations.html#cb148-1878" tabindex="-1"></a>  temp_fc <span class="ot">=</span> df_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1879"><a href="functions-for-difference-in-difference-computations.html#cb148-1879" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, country_en, wdpaid, name_pa, time, year, att_per, cband_lower_per, cband_upper_per, att_pa, cband_lower_pa, cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1880"><a href="functions-for-difference-in-difference-computations.html#cb148-1880" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig_pa =</span> <span class="fu">sign</span>(cband_lower_pa) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pa),</span>
<span id="cb148-1881"><a href="functions-for-difference-in-difference-computations.html#cb148-1881" tabindex="-1"></a>           <span class="at">sig_per =</span> <span class="fu">sign</span>(cband_lower_per) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1882"><a href="functions-for-difference-in-difference-computations.html#cb148-1882" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) </span>
<span id="cb148-1883"><a href="functions-for-difference-in-difference-computations.html#cb148-1883" tabindex="-1"></a>  temp_fl <span class="ot">=</span> df_fl_att <span class="sc">%&gt;%</span></span>
<span id="cb148-1884"><a href="functions-for-difference-in-difference-computations.html#cb148-1884" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(region, iso3, country_en, wdpaid, name_pa, time, year, att, cband_lower, cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1885"><a href="functions-for-difference-in-difference-computations.html#cb148-1885" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sig =</span> <span class="fu">sign</span>(cband_lower) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1886"><a href="functions-for-difference-in-difference-computations.html#cb148-1886" tabindex="-1"></a>    <span class="fu">filter</span>(time <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>)) </span>
<span id="cb148-1887"><a href="functions-for-difference-in-difference-computations.html#cb148-1887" tabindex="-1"></a>  </span>
<span id="cb148-1888"><a href="functions-for-difference-in-difference-computations.html#cb148-1888" tabindex="-1"></a>  <span class="co">#Att for each WDPAID, for each period (NA if no value)</span></span>
<span id="cb148-1889"><a href="functions-for-difference-in-difference-computations.html#cb148-1889" tabindex="-1"></a>  <span class="do">## For figures</span></span>
<span id="cb148-1890"><a href="functions-for-difference-in-difference-computations.html#cb148-1890" tabindex="-1"></a>  df_plot_fc_att <span class="ot">=</span> <span class="fu">left_join</span>(list_ctry_plot, temp_fc, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;country_en&quot;</span>, <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;name_pa&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1891"><a href="functions-for-difference-in-difference-computations.html#cb148-1891" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">focus =</span> <span class="fu">case_when</span>(wdpaid <span class="sc">%in%</span> list_focus <span class="sc">~</span> <span class="st">&quot;focus&quot;</span>,</span>
<span id="cb148-1892"><a href="functions-for-difference-in-difference-computations.html#cb148-1892" tabindex="-1"></a>                             <span class="sc">!</span>(wdpaid <span class="sc">%in%</span> list_focus) <span class="sc">~</span> <span class="st">&quot;not focus&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1893"><a href="functions-for-difference-in-difference-computations.html#cb148-1893" tabindex="-1"></a>    <span class="fu">group_by</span>(time, country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1894"><a href="functions-for-difference-in-difference-computations.html#cb148-1894" tabindex="-1"></a>    <span class="fu">arrange</span>(country_en, focus) <span class="sc">%&gt;%</span></span>
<span id="cb148-1895"><a href="functions-for-difference-in-difference-computations.html#cb148-1895" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country_en =</span> <span class="fu">paste0</span>(country_en, <span class="st">&quot; (&quot;</span>, <span class="fu">row_number</span>(), <span class="st">&quot;)&quot;</span>),</span>
<span id="cb148-1896"><a href="functions-for-difference-in-difference-computations.html#cb148-1896" tabindex="-1"></a>           <span class="at">n =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb148-1897"><a href="functions-for-difference-in-difference-computations.html#cb148-1897" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-1898"><a href="functions-for-difference-in-difference-computations.html#cb148-1898" tabindex="-1"></a>  </span>
<span id="cb148-1899"><a href="functions-for-difference-in-difference-computations.html#cb148-1899" tabindex="-1"></a>  df_plot_fl_att <span class="ot">=</span> <span class="fu">left_join</span>(list_ctry_plot, temp_fl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;country_en&quot;</span>, <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;name_pa&quot;</span>, <span class="st">&quot;time&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb148-1900"><a href="functions-for-difference-in-difference-computations.html#cb148-1900" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">focus =</span> <span class="fu">case_when</span>(wdpaid <span class="sc">%in%</span> list_focus <span class="sc">~</span> <span class="st">&quot;focus&quot;</span>,</span>
<span id="cb148-1901"><a href="functions-for-difference-in-difference-computations.html#cb148-1901" tabindex="-1"></a>                             <span class="sc">!</span>(wdpaid <span class="sc">%in%</span> list_focus) <span class="sc">~</span> <span class="st">&quot;not focus&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1902"><a href="functions-for-difference-in-difference-computations.html#cb148-1902" tabindex="-1"></a>    <span class="fu">group_by</span>(time, country_en) <span class="sc">%&gt;%</span></span>
<span id="cb148-1903"><a href="functions-for-difference-in-difference-computations.html#cb148-1903" tabindex="-1"></a>    <span class="fu">arrange</span>(country_en, focus) <span class="sc">%&gt;%</span></span>
<span id="cb148-1904"><a href="functions-for-difference-in-difference-computations.html#cb148-1904" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">country_en =</span> <span class="fu">paste0</span>(country_en, <span class="st">&quot; (&quot;</span>, <span class="fu">row_number</span>(), <span class="st">&quot;)&quot;</span>),</span>
<span id="cb148-1905"><a href="functions-for-difference-in-difference-computations.html#cb148-1905" tabindex="-1"></a>           <span class="at">n =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb148-1906"><a href="functions-for-difference-in-difference-computations.html#cb148-1906" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb148-1907"><a href="functions-for-difference-in-difference-computations.html#cb148-1907" tabindex="-1"></a>  </span>
<span id="cb148-1908"><a href="functions-for-difference-in-difference-computations.html#cb148-1908" tabindex="-1"></a>  </span>
<span id="cb148-1909"><a href="functions-for-difference-in-difference-computations.html#cb148-1909" tabindex="-1"></a>  <span class="co">#Plots</span></span>
<span id="cb148-1910"><a href="functions-for-difference-in-difference-computations.html#cb148-1910" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;5 years after treatment&quot;</span>,</span>
<span id="cb148-1911"><a href="functions-for-difference-in-difference-computations.html#cb148-1911" tabindex="-1"></a>            <span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;10 years after treatment&quot;</span>,</span>
<span id="cb148-1912"><a href="functions-for-difference-in-difference-computations.html#cb148-1912" tabindex="-1"></a>            <span class="st">`</span><span class="at">Strict</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Strict</span><span class="sc">\n</span><span class="st">IUCN cat. I-IV&quot;</span>,</span>
<span id="cb148-1913"><a href="functions-for-difference-in-difference-computations.html#cb148-1913" tabindex="-1"></a>            <span class="st">`</span><span class="at">Non strict</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Non strict</span><span class="sc">\n</span><span class="st">IUCN V-VI&quot;</span>,</span>
<span id="cb148-1914"><a href="functions-for-difference-in-difference-computations.html#cb148-1914" tabindex="-1"></a>            <span class="st">`</span><span class="at">Unknown</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Unknown&quot;</span>,</span>
<span id="cb148-1915"><a href="functions-for-difference-in-difference-computations.html#cb148-1915" tabindex="-1"></a>            <span class="st">`</span><span class="at">focus</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;FAPBM funded&quot;</span>,</span>
<span id="cb148-1916"><a href="functions-for-difference-in-difference-computations.html#cb148-1916" tabindex="-1"></a>            <span class="st">`</span><span class="at">not focus</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Others&quot;</span>)</span>
<span id="cb148-1917"><a href="functions-for-difference-in-difference-computations.html#cb148-1917" tabindex="-1"></a>  <span class="co"># df_colors = df_plot_fc_att %&gt;% group_by(n) %&gt;% slice(1)</span></span>
<span id="cb148-1918"><a href="functions-for-difference-in-difference-computations.html#cb148-1918" tabindex="-1"></a>  <span class="co"># colors = ifelse(df_colors$wdpaid %in% list_focus,&quot;#3182BD&quot;,&quot;black&quot;)</span></span>
<span id="cb148-1919"><a href="functions-for-difference-in-difference-computations.html#cb148-1919" tabindex="-1"></a>  </span>
<span id="cb148-1920"><a href="functions-for-difference-in-difference-computations.html#cb148-1920" tabindex="-1"></a>  <span class="do">## Att in share of 2000 forest cover</span></span>
<span id="cb148-1921"><a href="functions-for-difference-in-difference-computations.html#cb148-1921" tabindex="-1"></a>  fig_att_per <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1922"><a href="functions-for-difference-in-difference-computations.html#cb148-1922" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-1923"><a href="functions-for-difference-in-difference-computations.html#cb148-1923" tabindex="-1"></a>                           <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-1924"><a href="functions-for-difference-in-difference-computations.html#cb148-1924" tabindex="-1"></a>                           <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1925"><a href="functions-for-difference-in-difference-computations.html#cb148-1925" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1926"><a href="functions-for-difference-in-difference-computations.html#cb148-1926" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1927"><a href="functions-for-difference-in-difference-computations.html#cb148-1927" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1928"><a href="functions-for-difference-in-difference-computations.html#cb148-1928" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1929"><a href="functions-for-difference-in-difference-computations.html#cb148-1929" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1930"><a href="functions-for-difference-in-difference-computations.html#cb148-1930" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-1931"><a href="functions-for-difference-in-difference-computations.html#cb148-1931" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1932"><a href="functions-for-difference-in-difference-computations.html#cb148-1932" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-1933"><a href="functions-for-difference-in-difference-computations.html#cb148-1933" tabindex="-1"></a>           <span class="co">#caption = &quot;FAPBM funded protected areas are in blue, others are in black.&quot;,</span></span>
<span id="cb148-1934"><a href="functions-for-difference-in-difference-computations.html#cb148-1934" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-1935"><a href="functions-for-difference-in-difference-computations.html#cb148-1935" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1936"><a href="functions-for-difference-in-difference-computations.html#cb148-1936" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1937"><a href="functions-for-difference-in-difference-computations.html#cb148-1937" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1938"><a href="functions-for-difference-in-difference-computations.html#cb148-1938" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1939"><a href="functions-for-difference-in-difference-computations.html#cb148-1939" tabindex="-1"></a>      <span class="co">#axis.text.y = element_text(color = rev(colors)),</span></span>
<span id="cb148-1940"><a href="functions-for-difference-in-difference-computations.html#cb148-1940" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1941"><a href="functions-for-difference-in-difference-computations.html#cb148-1941" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1942"><a href="functions-for-difference-in-difference-computations.html#cb148-1942" tabindex="-1"></a>      </span>
<span id="cb148-1943"><a href="functions-for-difference-in-difference-computations.html#cb148-1943" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1944"><a href="functions-for-difference-in-difference-computations.html#cb148-1944" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1945"><a href="functions-for-difference-in-difference-computations.html#cb148-1945" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1946"><a href="functions-for-difference-in-difference-computations.html#cb148-1946" tabindex="-1"></a>      </span>
<span id="cb148-1947"><a href="functions-for-difference-in-difference-computations.html#cb148-1947" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1948"><a href="functions-for-difference-in-difference-computations.html#cb148-1948" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1949"><a href="functions-for-difference-in-difference-computations.html#cb148-1949" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1950"><a href="functions-for-difference-in-difference-computations.html#cb148-1950" tabindex="-1"></a>      </span>
<span id="cb148-1951"><a href="functions-for-difference-in-difference-computations.html#cb148-1951" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1952"><a href="functions-for-difference-in-difference-computations.html#cb148-1952" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1953"><a href="functions-for-difference-in-difference-computations.html#cb148-1953" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1954"><a href="functions-for-difference-in-difference-computations.html#cb148-1954" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1955"><a href="functions-for-difference-in-difference-computations.html#cb148-1955" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1956"><a href="functions-for-difference-in-difference-computations.html#cb148-1956" tabindex="-1"></a>      </span>
<span id="cb148-1957"><a href="functions-for-difference-in-difference-computations.html#cb148-1957" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1958"><a href="functions-for-difference-in-difference-computations.html#cb148-1958" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1959"><a href="functions-for-difference-in-difference-computations.html#cb148-1959" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1960"><a href="functions-for-difference-in-difference-computations.html#cb148-1960" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-1961"><a href="functions-for-difference-in-difference-computations.html#cb148-1961" tabindex="-1"></a>    )</span>
<span id="cb148-1962"><a href="functions-for-difference-in-difference-computations.html#cb148-1962" tabindex="-1"></a></span>
<span id="cb148-1963"><a href="functions-for-difference-in-difference-computations.html#cb148-1963" tabindex="-1"></a>  fig_att_per_focus_others <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-1964"><a href="functions-for-difference-in-difference-computations.html#cb148-1964" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-1965"><a href="functions-for-difference-in-difference-computations.html#cb148-1965" tabindex="-1"></a>                           <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-1966"><a href="functions-for-difference-in-difference-computations.html#cb148-1966" tabindex="-1"></a>                           <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1967"><a href="functions-for-difference-in-difference-computations.html#cb148-1967" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1968"><a href="functions-for-difference-in-difference-computations.html#cb148-1968" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1969"><a href="functions-for-difference-in-difference-computations.html#cb148-1969" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-1970"><a href="functions-for-difference-in-difference-computations.html#cb148-1970" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-1971"><a href="functions-for-difference-in-difference-computations.html#cb148-1971" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-1972"><a href="functions-for-difference-in-difference-computations.html#cb148-1972" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-1973"><a href="functions-for-difference-in-difference-computations.html#cb148-1973" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(focus<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-1974"><a href="functions-for-difference-in-difference-computations.html#cb148-1974" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-1975"><a href="functions-for-difference-in-difference-computations.html#cb148-1975" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-1976"><a href="functions-for-difference-in-difference-computations.html#cb148-1976" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-1977"><a href="functions-for-difference-in-difference-computations.html#cb148-1977" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-1978"><a href="functions-for-difference-in-difference-computations.html#cb148-1978" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-1979"><a href="functions-for-difference-in-difference-computations.html#cb148-1979" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-1980"><a href="functions-for-difference-in-difference-computations.html#cb148-1980" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-1981"><a href="functions-for-difference-in-difference-computations.html#cb148-1981" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-1982"><a href="functions-for-difference-in-difference-computations.html#cb148-1982" tabindex="-1"></a>      </span>
<span id="cb148-1983"><a href="functions-for-difference-in-difference-computations.html#cb148-1983" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1984"><a href="functions-for-difference-in-difference-computations.html#cb148-1984" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1985"><a href="functions-for-difference-in-difference-computations.html#cb148-1985" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-1986"><a href="functions-for-difference-in-difference-computations.html#cb148-1986" tabindex="-1"></a>      </span>
<span id="cb148-1987"><a href="functions-for-difference-in-difference-computations.html#cb148-1987" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-1988"><a href="functions-for-difference-in-difference-computations.html#cb148-1988" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-1989"><a href="functions-for-difference-in-difference-computations.html#cb148-1989" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-1990"><a href="functions-for-difference-in-difference-computations.html#cb148-1990" tabindex="-1"></a>      </span>
<span id="cb148-1991"><a href="functions-for-difference-in-difference-computations.html#cb148-1991" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-1992"><a href="functions-for-difference-in-difference-computations.html#cb148-1992" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-1993"><a href="functions-for-difference-in-difference-computations.html#cb148-1993" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-1994"><a href="functions-for-difference-in-difference-computations.html#cb148-1994" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-1995"><a href="functions-for-difference-in-difference-computations.html#cb148-1995" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-1996"><a href="functions-for-difference-in-difference-computations.html#cb148-1996" tabindex="-1"></a>      </span>
<span id="cb148-1997"><a href="functions-for-difference-in-difference-computations.html#cb148-1997" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-1998"><a href="functions-for-difference-in-difference-computations.html#cb148-1998" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-1999"><a href="functions-for-difference-in-difference-computations.html#cb148-1999" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2000"><a href="functions-for-difference-in-difference-computations.html#cb148-2000" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2001"><a href="functions-for-difference-in-difference-computations.html#cb148-2001" tabindex="-1"></a>    )</span>
<span id="cb148-2002"><a href="functions-for-difference-in-difference-computations.html#cb148-2002" tabindex="-1"></a>  </span>
<span id="cb148-2003"><a href="functions-for-difference-in-difference-computations.html#cb148-2003" tabindex="-1"></a>  fig_att_per_focus <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(df_plot_fc_att, focus <span class="sc">==</span> <span class="st">&quot;focus&quot;</span>),</span>
<span id="cb148-2004"><a href="functions-for-difference-in-difference-computations.html#cb148-2004" tabindex="-1"></a>                                    <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-2005"><a href="functions-for-difference-in-difference-computations.html#cb148-2005" tabindex="-1"></a>                                        <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2006"><a href="functions-for-difference-in-difference-computations.html#cb148-2006" tabindex="-1"></a>                                        <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2007"><a href="functions-for-difference-in-difference-computations.html#cb148-2007" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2008"><a href="functions-for-difference-in-difference-computations.html#cb148-2008" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2009"><a href="functions-for-difference-in-difference-computations.html#cb148-2009" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2010"><a href="functions-for-difference-in-difference-computations.html#cb148-2010" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2011"><a href="functions-for-difference-in-difference-computations.html#cb148-2011" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2012"><a href="functions-for-difference-in-difference-computations.html#cb148-2012" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-2013"><a href="functions-for-difference-in-difference-computations.html#cb148-2013" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2014"><a href="functions-for-difference-in-difference-computations.html#cb148-2014" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-2015"><a href="functions-for-difference-in-difference-computations.html#cb148-2015" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="st">&quot;Protected areas funded by the FAPBM only&quot;</span>,</span>
<span id="cb148-2016"><a href="functions-for-difference-in-difference-computations.html#cb148-2016" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-2017"><a href="functions-for-difference-in-difference-computations.html#cb148-2017" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2018"><a href="functions-for-difference-in-difference-computations.html#cb148-2018" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2019"><a href="functions-for-difference-in-difference-computations.html#cb148-2019" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2020"><a href="functions-for-difference-in-difference-computations.html#cb148-2020" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2021"><a href="functions-for-difference-in-difference-computations.html#cb148-2021" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2022"><a href="functions-for-difference-in-difference-computations.html#cb148-2022" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2023"><a href="functions-for-difference-in-difference-computations.html#cb148-2023" tabindex="-1"></a>      </span>
<span id="cb148-2024"><a href="functions-for-difference-in-difference-computations.html#cb148-2024" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2025"><a href="functions-for-difference-in-difference-computations.html#cb148-2025" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2026"><a href="functions-for-difference-in-difference-computations.html#cb148-2026" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2027"><a href="functions-for-difference-in-difference-computations.html#cb148-2027" tabindex="-1"></a>      </span>
<span id="cb148-2028"><a href="functions-for-difference-in-difference-computations.html#cb148-2028" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2029"><a href="functions-for-difference-in-difference-computations.html#cb148-2029" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2030"><a href="functions-for-difference-in-difference-computations.html#cb148-2030" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2031"><a href="functions-for-difference-in-difference-computations.html#cb148-2031" tabindex="-1"></a>      </span>
<span id="cb148-2032"><a href="functions-for-difference-in-difference-computations.html#cb148-2032" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2033"><a href="functions-for-difference-in-difference-computations.html#cb148-2033" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2034"><a href="functions-for-difference-in-difference-computations.html#cb148-2034" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2035"><a href="functions-for-difference-in-difference-computations.html#cb148-2035" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2036"><a href="functions-for-difference-in-difference-computations.html#cb148-2036" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2037"><a href="functions-for-difference-in-difference-computations.html#cb148-2037" tabindex="-1"></a>      </span>
<span id="cb148-2038"><a href="functions-for-difference-in-difference-computations.html#cb148-2038" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2039"><a href="functions-for-difference-in-difference-computations.html#cb148-2039" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2040"><a href="functions-for-difference-in-difference-computations.html#cb148-2040" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2041"><a href="functions-for-difference-in-difference-computations.html#cb148-2041" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2042"><a href="functions-for-difference-in-difference-computations.html#cb148-2042" tabindex="-1"></a>    )</span>
<span id="cb148-2043"><a href="functions-for-difference-in-difference-computations.html#cb148-2043" tabindex="-1"></a>  </span>
<span id="cb148-2044"><a href="functions-for-difference-in-difference-computations.html#cb148-2044" tabindex="-1"></a>  </span>
<span id="cb148-2045"><a href="functions-for-difference-in-difference-computations.html#cb148-2045" tabindex="-1"></a>  fig_att_per_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-2046"><a href="functions-for-difference-in-difference-computations.html#cb148-2046" tabindex="-1"></a>                            <span class="fu">aes</span>(<span class="at">x =</span> att_per, </span>
<span id="cb148-2047"><a href="functions-for-difference-in-difference-computations.html#cb148-2047" tabindex="-1"></a>                                <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2048"><a href="functions-for-difference-in-difference-computations.html#cb148-2048" tabindex="-1"></a>                                <span class="at">xmin =</span> cband_lower_per, <span class="at">xmax =</span> cband_upper_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2049"><a href="functions-for-difference-in-difference-computations.html#cb148-2049" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2050"><a href="functions-for-difference-in-difference-computations.html#cb148-2050" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2051"><a href="functions-for-difference-in-difference-computations.html#cb148-2051" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_per)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2052"><a href="functions-for-difference-in-difference-computations.html#cb148-2052" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2053"><a href="functions-for-difference-in-difference-computations.html#cb148-2053" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2054"><a href="functions-for-difference-in-difference-computations.html#cb148-2054" tabindex="-1"></a>    <span class="co"># + scale_x_continuous(breaks=seq(min(df_plot_fc_att$att_per, na.rm = TRUE),max(df_plot_fc_att$att_per, na.rm = TRUE),by=1)) %&gt;%</span></span>
<span id="cb148-2055"><a href="functions-for-difference-in-difference-computations.html#cb148-2055" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2056"><a href="functions-for-difference-in-difference-computations.html#cb148-2056" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Deforestation avoided relative to 2000 forest cover&quot;</span>,</span>
<span id="cb148-2057"><a href="functions-for-difference-in-difference-computations.html#cb148-2057" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;%&quot;</span>,</span>
<span id="cb148-2058"><a href="functions-for-difference-in-difference-computations.html#cb148-2058" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2059"><a href="functions-for-difference-in-difference-computations.html#cb148-2059" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2060"><a href="functions-for-difference-in-difference-computations.html#cb148-2060" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2061"><a href="functions-for-difference-in-difference-computations.html#cb148-2061" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2062"><a href="functions-for-difference-in-difference-computations.html#cb148-2062" tabindex="-1"></a>      <span class="co">#axis.text.y = element_text(color = rev(colors)),</span></span>
<span id="cb148-2063"><a href="functions-for-difference-in-difference-computations.html#cb148-2063" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2064"><a href="functions-for-difference-in-difference-computations.html#cb148-2064" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2065"><a href="functions-for-difference-in-difference-computations.html#cb148-2065" tabindex="-1"></a>      </span>
<span id="cb148-2066"><a href="functions-for-difference-in-difference-computations.html#cb148-2066" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2067"><a href="functions-for-difference-in-difference-computations.html#cb148-2067" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2068"><a href="functions-for-difference-in-difference-computations.html#cb148-2068" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2069"><a href="functions-for-difference-in-difference-computations.html#cb148-2069" tabindex="-1"></a>      </span>
<span id="cb148-2070"><a href="functions-for-difference-in-difference-computations.html#cb148-2070" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2071"><a href="functions-for-difference-in-difference-computations.html#cb148-2071" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2072"><a href="functions-for-difference-in-difference-computations.html#cb148-2072" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2073"><a href="functions-for-difference-in-difference-computations.html#cb148-2073" tabindex="-1"></a>      </span>
<span id="cb148-2074"><a href="functions-for-difference-in-difference-computations.html#cb148-2074" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2075"><a href="functions-for-difference-in-difference-computations.html#cb148-2075" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2076"><a href="functions-for-difference-in-difference-computations.html#cb148-2076" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2077"><a href="functions-for-difference-in-difference-computations.html#cb148-2077" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2078"><a href="functions-for-difference-in-difference-computations.html#cb148-2078" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2079"><a href="functions-for-difference-in-difference-computations.html#cb148-2079" tabindex="-1"></a>      </span>
<span id="cb148-2080"><a href="functions-for-difference-in-difference-computations.html#cb148-2080" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2081"><a href="functions-for-difference-in-difference-computations.html#cb148-2081" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2082"><a href="functions-for-difference-in-difference-computations.html#cb148-2082" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2083"><a href="functions-for-difference-in-difference-computations.html#cb148-2083" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2084"><a href="functions-for-difference-in-difference-computations.html#cb148-2084" tabindex="-1"></a>    )</span>
<span id="cb148-2085"><a href="functions-for-difference-in-difference-computations.html#cb148-2085" tabindex="-1"></a>  </span>
<span id="cb148-2086"><a href="functions-for-difference-in-difference-computations.html#cb148-2086" tabindex="-1"></a>  </span>
<span id="cb148-2087"><a href="functions-for-difference-in-difference-computations.html#cb148-2087" tabindex="-1"></a>  <span class="do">##treatment effect : total deforestation avoided</span></span>
<span id="cb148-2088"><a href="functions-for-difference-in-difference-computations.html#cb148-2088" tabindex="-1"></a>  fig_att_pa <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-2089"><a href="functions-for-difference-in-difference-computations.html#cb148-2089" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-2090"><a href="functions-for-difference-in-difference-computations.html#cb148-2090" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2091"><a href="functions-for-difference-in-difference-computations.html#cb148-2091" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2092"><a href="functions-for-difference-in-difference-computations.html#cb148-2092" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2093"><a href="functions-for-difference-in-difference-computations.html#cb148-2093" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2094"><a href="functions-for-difference-in-difference-computations.html#cb148-2094" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2095"><a href="functions-for-difference-in-difference-computations.html#cb148-2095" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2096"><a href="functions-for-difference-in-difference-computations.html#cb148-2096" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2097"><a href="functions-for-difference-in-difference-computations.html#cb148-2097" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2098"><a href="functions-for-difference-in-difference-computations.html#cb148-2098" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-2099"><a href="functions-for-difference-in-difference-computations.html#cb148-2099" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-2100"><a href="functions-for-difference-in-difference-computations.html#cb148-2100" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2101"><a href="functions-for-difference-in-difference-computations.html#cb148-2101" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2102"><a href="functions-for-difference-in-difference-computations.html#cb148-2102" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2103"><a href="functions-for-difference-in-difference-computations.html#cb148-2103" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2104"><a href="functions-for-difference-in-difference-computations.html#cb148-2104" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2105"><a href="functions-for-difference-in-difference-computations.html#cb148-2105" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2106"><a href="functions-for-difference-in-difference-computations.html#cb148-2106" tabindex="-1"></a>      </span>
<span id="cb148-2107"><a href="functions-for-difference-in-difference-computations.html#cb148-2107" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2108"><a href="functions-for-difference-in-difference-computations.html#cb148-2108" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2109"><a href="functions-for-difference-in-difference-computations.html#cb148-2109" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2110"><a href="functions-for-difference-in-difference-computations.html#cb148-2110" tabindex="-1"></a>      </span>
<span id="cb148-2111"><a href="functions-for-difference-in-difference-computations.html#cb148-2111" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2112"><a href="functions-for-difference-in-difference-computations.html#cb148-2112" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2113"><a href="functions-for-difference-in-difference-computations.html#cb148-2113" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2114"><a href="functions-for-difference-in-difference-computations.html#cb148-2114" tabindex="-1"></a>      </span>
<span id="cb148-2115"><a href="functions-for-difference-in-difference-computations.html#cb148-2115" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2116"><a href="functions-for-difference-in-difference-computations.html#cb148-2116" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2117"><a href="functions-for-difference-in-difference-computations.html#cb148-2117" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2118"><a href="functions-for-difference-in-difference-computations.html#cb148-2118" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2119"><a href="functions-for-difference-in-difference-computations.html#cb148-2119" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2120"><a href="functions-for-difference-in-difference-computations.html#cb148-2120" tabindex="-1"></a>      </span>
<span id="cb148-2121"><a href="functions-for-difference-in-difference-computations.html#cb148-2121" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2122"><a href="functions-for-difference-in-difference-computations.html#cb148-2122" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2123"><a href="functions-for-difference-in-difference-computations.html#cb148-2123" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2124"><a href="functions-for-difference-in-difference-computations.html#cb148-2124" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2125"><a href="functions-for-difference-in-difference-computations.html#cb148-2125" tabindex="-1"></a>    )</span>
<span id="cb148-2126"><a href="functions-for-difference-in-difference-computations.html#cb148-2126" tabindex="-1"></a>  </span>
<span id="cb148-2127"><a href="functions-for-difference-in-difference-computations.html#cb148-2127" tabindex="-1"></a>  fig_att_pa_focus_others <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-2128"><a href="functions-for-difference-in-difference-computations.html#cb148-2128" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-2129"><a href="functions-for-difference-in-difference-computations.html#cb148-2129" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2130"><a href="functions-for-difference-in-difference-computations.html#cb148-2130" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2131"><a href="functions-for-difference-in-difference-computations.html#cb148-2131" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2132"><a href="functions-for-difference-in-difference-computations.html#cb148-2132" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2133"><a href="functions-for-difference-in-difference-computations.html#cb148-2133" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2134"><a href="functions-for-difference-in-difference-computations.html#cb148-2134" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2135"><a href="functions-for-difference-in-difference-computations.html#cb148-2135" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2136"><a href="functions-for-difference-in-difference-computations.html#cb148-2136" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(focus<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2137"><a href="functions-for-difference-in-difference-computations.html#cb148-2137" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-2138"><a href="functions-for-difference-in-difference-computations.html#cb148-2138" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-2139"><a href="functions-for-difference-in-difference-computations.html#cb148-2139" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2140"><a href="functions-for-difference-in-difference-computations.html#cb148-2140" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2141"><a href="functions-for-difference-in-difference-computations.html#cb148-2141" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2142"><a href="functions-for-difference-in-difference-computations.html#cb148-2142" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2143"><a href="functions-for-difference-in-difference-computations.html#cb148-2143" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2144"><a href="functions-for-difference-in-difference-computations.html#cb148-2144" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2145"><a href="functions-for-difference-in-difference-computations.html#cb148-2145" tabindex="-1"></a>      </span>
<span id="cb148-2146"><a href="functions-for-difference-in-difference-computations.html#cb148-2146" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2147"><a href="functions-for-difference-in-difference-computations.html#cb148-2147" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2148"><a href="functions-for-difference-in-difference-computations.html#cb148-2148" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2149"><a href="functions-for-difference-in-difference-computations.html#cb148-2149" tabindex="-1"></a>      </span>
<span id="cb148-2150"><a href="functions-for-difference-in-difference-computations.html#cb148-2150" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2151"><a href="functions-for-difference-in-difference-computations.html#cb148-2151" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2152"><a href="functions-for-difference-in-difference-computations.html#cb148-2152" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2153"><a href="functions-for-difference-in-difference-computations.html#cb148-2153" tabindex="-1"></a>      </span>
<span id="cb148-2154"><a href="functions-for-difference-in-difference-computations.html#cb148-2154" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2155"><a href="functions-for-difference-in-difference-computations.html#cb148-2155" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2156"><a href="functions-for-difference-in-difference-computations.html#cb148-2156" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2157"><a href="functions-for-difference-in-difference-computations.html#cb148-2157" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2158"><a href="functions-for-difference-in-difference-computations.html#cb148-2158" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2159"><a href="functions-for-difference-in-difference-computations.html#cb148-2159" tabindex="-1"></a>      </span>
<span id="cb148-2160"><a href="functions-for-difference-in-difference-computations.html#cb148-2160" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2161"><a href="functions-for-difference-in-difference-computations.html#cb148-2161" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2162"><a href="functions-for-difference-in-difference-computations.html#cb148-2162" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2163"><a href="functions-for-difference-in-difference-computations.html#cb148-2163" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2164"><a href="functions-for-difference-in-difference-computations.html#cb148-2164" tabindex="-1"></a>    )</span>
<span id="cb148-2165"><a href="functions-for-difference-in-difference-computations.html#cb148-2165" tabindex="-1"></a>  </span>
<span id="cb148-2166"><a href="functions-for-difference-in-difference-computations.html#cb148-2166" tabindex="-1"></a>  fig_att_pa_focus <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(df_plot_fc_att, focus <span class="sc">==</span> <span class="st">&quot;focus&quot;</span>), </span>
<span id="cb148-2167"><a href="functions-for-difference-in-difference-computations.html#cb148-2167" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-2168"><a href="functions-for-difference-in-difference-computations.html#cb148-2168" tabindex="-1"></a>                                       <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2169"><a href="functions-for-difference-in-difference-computations.html#cb148-2169" tabindex="-1"></a>                                       <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2170"><a href="functions-for-difference-in-difference-computations.html#cb148-2170" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2171"><a href="functions-for-difference-in-difference-computations.html#cb148-2171" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2172"><a href="functions-for-difference-in-difference-computations.html#cb148-2172" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2173"><a href="functions-for-difference-in-difference-computations.html#cb148-2173" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2174"><a href="functions-for-difference-in-difference-computations.html#cb148-2174" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2175"><a href="functions-for-difference-in-difference-computations.html#cb148-2175" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(focus<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2176"><a href="functions-for-difference-in-difference-computations.html#cb148-2176" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-2177"><a href="functions-for-difference-in-difference-computations.html#cb148-2177" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="st">&quot;Protected areas funded by the FAPBM only&quot;</span>,</span>
<span id="cb148-2178"><a href="functions-for-difference-in-difference-computations.html#cb148-2178" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-2179"><a href="functions-for-difference-in-difference-computations.html#cb148-2179" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2180"><a href="functions-for-difference-in-difference-computations.html#cb148-2180" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2181"><a href="functions-for-difference-in-difference-computations.html#cb148-2181" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2182"><a href="functions-for-difference-in-difference-computations.html#cb148-2182" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2183"><a href="functions-for-difference-in-difference-computations.html#cb148-2183" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2184"><a href="functions-for-difference-in-difference-computations.html#cb148-2184" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2185"><a href="functions-for-difference-in-difference-computations.html#cb148-2185" tabindex="-1"></a>      </span>
<span id="cb148-2186"><a href="functions-for-difference-in-difference-computations.html#cb148-2186" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2187"><a href="functions-for-difference-in-difference-computations.html#cb148-2187" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2188"><a href="functions-for-difference-in-difference-computations.html#cb148-2188" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2189"><a href="functions-for-difference-in-difference-computations.html#cb148-2189" tabindex="-1"></a>      </span>
<span id="cb148-2190"><a href="functions-for-difference-in-difference-computations.html#cb148-2190" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2191"><a href="functions-for-difference-in-difference-computations.html#cb148-2191" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2192"><a href="functions-for-difference-in-difference-computations.html#cb148-2192" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2193"><a href="functions-for-difference-in-difference-computations.html#cb148-2193" tabindex="-1"></a>      </span>
<span id="cb148-2194"><a href="functions-for-difference-in-difference-computations.html#cb148-2194" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2195"><a href="functions-for-difference-in-difference-computations.html#cb148-2195" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2196"><a href="functions-for-difference-in-difference-computations.html#cb148-2196" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2197"><a href="functions-for-difference-in-difference-computations.html#cb148-2197" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2198"><a href="functions-for-difference-in-difference-computations.html#cb148-2198" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2199"><a href="functions-for-difference-in-difference-computations.html#cb148-2199" tabindex="-1"></a>      </span>
<span id="cb148-2200"><a href="functions-for-difference-in-difference-computations.html#cb148-2200" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2201"><a href="functions-for-difference-in-difference-computations.html#cb148-2201" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2202"><a href="functions-for-difference-in-difference-computations.html#cb148-2202" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2203"><a href="functions-for-difference-in-difference-computations.html#cb148-2203" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2204"><a href="functions-for-difference-in-difference-computations.html#cb148-2204" tabindex="-1"></a>    )</span>
<span id="cb148-2205"><a href="functions-for-difference-in-difference-computations.html#cb148-2205" tabindex="-1"></a>  </span>
<span id="cb148-2206"><a href="functions-for-difference-in-difference-computations.html#cb148-2206" tabindex="-1"></a>  fig_att_pa_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fc_att, </span>
<span id="cb148-2207"><a href="functions-for-difference-in-difference-computations.html#cb148-2207" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> att_pa, </span>
<span id="cb148-2208"><a href="functions-for-difference-in-difference-computations.html#cb148-2208" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2209"><a href="functions-for-difference-in-difference-computations.html#cb148-2209" tabindex="-1"></a>                               <span class="at">xmin =</span> cband_lower_pa, <span class="at">xmax =</span> cband_upper_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2210"><a href="functions-for-difference-in-difference-computations.html#cb148-2210" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2211"><a href="functions-for-difference-in-difference-computations.html#cb148-2211" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2212"><a href="functions-for-difference-in-difference-computations.html#cb148-2212" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig_pa)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2213"><a href="functions-for-difference-in-difference-computations.html#cb148-2213" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2214"><a href="functions-for-difference-in-difference-computations.html#cb148-2214" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2215"><a href="functions-for-difference-in-difference-computations.html#cb148-2215" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2216"><a href="functions-for-difference-in-difference-computations.html#cb148-2216" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total deforestation avoided&quot;</span>,</span>
<span id="cb148-2217"><a href="functions-for-difference-in-difference-computations.html#cb148-2217" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb148-2218"><a href="functions-for-difference-in-difference-computations.html#cb148-2218" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2219"><a href="functions-for-difference-in-difference-computations.html#cb148-2219" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2220"><a href="functions-for-difference-in-difference-computations.html#cb148-2220" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2221"><a href="functions-for-difference-in-difference-computations.html#cb148-2221" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2222"><a href="functions-for-difference-in-difference-computations.html#cb148-2222" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2223"><a href="functions-for-difference-in-difference-computations.html#cb148-2223" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2224"><a href="functions-for-difference-in-difference-computations.html#cb148-2224" tabindex="-1"></a>      </span>
<span id="cb148-2225"><a href="functions-for-difference-in-difference-computations.html#cb148-2225" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2226"><a href="functions-for-difference-in-difference-computations.html#cb148-2226" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2227"><a href="functions-for-difference-in-difference-computations.html#cb148-2227" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2228"><a href="functions-for-difference-in-difference-computations.html#cb148-2228" tabindex="-1"></a>      </span>
<span id="cb148-2229"><a href="functions-for-difference-in-difference-computations.html#cb148-2229" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2230"><a href="functions-for-difference-in-difference-computations.html#cb148-2230" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2231"><a href="functions-for-difference-in-difference-computations.html#cb148-2231" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2232"><a href="functions-for-difference-in-difference-computations.html#cb148-2232" tabindex="-1"></a>      </span>
<span id="cb148-2233"><a href="functions-for-difference-in-difference-computations.html#cb148-2233" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2234"><a href="functions-for-difference-in-difference-computations.html#cb148-2234" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2235"><a href="functions-for-difference-in-difference-computations.html#cb148-2235" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2236"><a href="functions-for-difference-in-difference-computations.html#cb148-2236" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2237"><a href="functions-for-difference-in-difference-computations.html#cb148-2237" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2238"><a href="functions-for-difference-in-difference-computations.html#cb148-2238" tabindex="-1"></a>      </span>
<span id="cb148-2239"><a href="functions-for-difference-in-difference-computations.html#cb148-2239" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2240"><a href="functions-for-difference-in-difference-computations.html#cb148-2240" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2241"><a href="functions-for-difference-in-difference-computations.html#cb148-2241" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2242"><a href="functions-for-difference-in-difference-computations.html#cb148-2242" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2243"><a href="functions-for-difference-in-difference-computations.html#cb148-2243" tabindex="-1"></a>    )</span>
<span id="cb148-2244"><a href="functions-for-difference-in-difference-computations.html#cb148-2244" tabindex="-1"></a>  </span>
<span id="cb148-2245"><a href="functions-for-difference-in-difference-computations.html#cb148-2245" tabindex="-1"></a>  <span class="do">##treatment effect : avoided deforestation in percentage points</span></span>
<span id="cb148-2246"><a href="functions-for-difference-in-difference-computations.html#cb148-2246" tabindex="-1"></a>  fig_att_fl <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fl_att, </span>
<span id="cb148-2247"><a href="functions-for-difference-in-difference-computations.html#cb148-2247" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-2248"><a href="functions-for-difference-in-difference-computations.html#cb148-2248" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2249"><a href="functions-for-difference-in-difference-computations.html#cb148-2249" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2250"><a href="functions-for-difference-in-difference-computations.html#cb148-2250" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2251"><a href="functions-for-difference-in-difference-computations.html#cb148-2251" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2252"><a href="functions-for-difference-in-difference-computations.html#cb148-2252" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2253"><a href="functions-for-difference-in-difference-computations.html#cb148-2253" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2254"><a href="functions-for-difference-in-difference-computations.html#cb148-2254" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2255"><a href="functions-for-difference-in-difference-computations.html#cb148-2255" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2256"><a href="functions-for-difference-in-difference-computations.html#cb148-2256" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-2257"><a href="functions-for-difference-in-difference-computations.html#cb148-2257" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-2258"><a href="functions-for-difference-in-difference-computations.html#cb148-2258" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2259"><a href="functions-for-difference-in-difference-computations.html#cb148-2259" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2260"><a href="functions-for-difference-in-difference-computations.html#cb148-2260" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2261"><a href="functions-for-difference-in-difference-computations.html#cb148-2261" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2262"><a href="functions-for-difference-in-difference-computations.html#cb148-2262" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2263"><a href="functions-for-difference-in-difference-computations.html#cb148-2263" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2264"><a href="functions-for-difference-in-difference-computations.html#cb148-2264" tabindex="-1"></a>      </span>
<span id="cb148-2265"><a href="functions-for-difference-in-difference-computations.html#cb148-2265" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2266"><a href="functions-for-difference-in-difference-computations.html#cb148-2266" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2267"><a href="functions-for-difference-in-difference-computations.html#cb148-2267" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2268"><a href="functions-for-difference-in-difference-computations.html#cb148-2268" tabindex="-1"></a>      </span>
<span id="cb148-2269"><a href="functions-for-difference-in-difference-computations.html#cb148-2269" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2270"><a href="functions-for-difference-in-difference-computations.html#cb148-2270" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2271"><a href="functions-for-difference-in-difference-computations.html#cb148-2271" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2272"><a href="functions-for-difference-in-difference-computations.html#cb148-2272" tabindex="-1"></a>      </span>
<span id="cb148-2273"><a href="functions-for-difference-in-difference-computations.html#cb148-2273" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2274"><a href="functions-for-difference-in-difference-computations.html#cb148-2274" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2275"><a href="functions-for-difference-in-difference-computations.html#cb148-2275" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2276"><a href="functions-for-difference-in-difference-computations.html#cb148-2276" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2277"><a href="functions-for-difference-in-difference-computations.html#cb148-2277" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2278"><a href="functions-for-difference-in-difference-computations.html#cb148-2278" tabindex="-1"></a>      </span>
<span id="cb148-2279"><a href="functions-for-difference-in-difference-computations.html#cb148-2279" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2280"><a href="functions-for-difference-in-difference-computations.html#cb148-2280" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2281"><a href="functions-for-difference-in-difference-computations.html#cb148-2281" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2282"><a href="functions-for-difference-in-difference-computations.html#cb148-2282" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2283"><a href="functions-for-difference-in-difference-computations.html#cb148-2283" tabindex="-1"></a>    )</span>
<span id="cb148-2284"><a href="functions-for-difference-in-difference-computations.html#cb148-2284" tabindex="-1"></a>  </span>
<span id="cb148-2285"><a href="functions-for-difference-in-difference-computations.html#cb148-2285" tabindex="-1"></a>  fig_att_fl_focus_others <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fl_att, </span>
<span id="cb148-2286"><a href="functions-for-difference-in-difference-computations.html#cb148-2286" tabindex="-1"></a>                      <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-2287"><a href="functions-for-difference-in-difference-computations.html#cb148-2287" tabindex="-1"></a>                          <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2288"><a href="functions-for-difference-in-difference-computations.html#cb148-2288" tabindex="-1"></a>                          <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2289"><a href="functions-for-difference-in-difference-computations.html#cb148-2289" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2290"><a href="functions-for-difference-in-difference-computations.html#cb148-2290" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2291"><a href="functions-for-difference-in-difference-computations.html#cb148-2291" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2292"><a href="functions-for-difference-in-difference-computations.html#cb148-2292" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2293"><a href="functions-for-difference-in-difference-computations.html#cb148-2293" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2294"><a href="functions-for-difference-in-difference-computations.html#cb148-2294" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(focus<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2295"><a href="functions-for-difference-in-difference-computations.html#cb148-2295" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-2296"><a href="functions-for-difference-in-difference-computations.html#cb148-2296" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-2297"><a href="functions-for-difference-in-difference-computations.html#cb148-2297" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2298"><a href="functions-for-difference-in-difference-computations.html#cb148-2298" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2299"><a href="functions-for-difference-in-difference-computations.html#cb148-2299" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2300"><a href="functions-for-difference-in-difference-computations.html#cb148-2300" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2301"><a href="functions-for-difference-in-difference-computations.html#cb148-2301" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2302"><a href="functions-for-difference-in-difference-computations.html#cb148-2302" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2303"><a href="functions-for-difference-in-difference-computations.html#cb148-2303" tabindex="-1"></a>      </span>
<span id="cb148-2304"><a href="functions-for-difference-in-difference-computations.html#cb148-2304" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2305"><a href="functions-for-difference-in-difference-computations.html#cb148-2305" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2306"><a href="functions-for-difference-in-difference-computations.html#cb148-2306" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2307"><a href="functions-for-difference-in-difference-computations.html#cb148-2307" tabindex="-1"></a>      </span>
<span id="cb148-2308"><a href="functions-for-difference-in-difference-computations.html#cb148-2308" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2309"><a href="functions-for-difference-in-difference-computations.html#cb148-2309" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2310"><a href="functions-for-difference-in-difference-computations.html#cb148-2310" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2311"><a href="functions-for-difference-in-difference-computations.html#cb148-2311" tabindex="-1"></a>      </span>
<span id="cb148-2312"><a href="functions-for-difference-in-difference-computations.html#cb148-2312" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2313"><a href="functions-for-difference-in-difference-computations.html#cb148-2313" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2314"><a href="functions-for-difference-in-difference-computations.html#cb148-2314" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2315"><a href="functions-for-difference-in-difference-computations.html#cb148-2315" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2316"><a href="functions-for-difference-in-difference-computations.html#cb148-2316" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2317"><a href="functions-for-difference-in-difference-computations.html#cb148-2317" tabindex="-1"></a>      </span>
<span id="cb148-2318"><a href="functions-for-difference-in-difference-computations.html#cb148-2318" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2319"><a href="functions-for-difference-in-difference-computations.html#cb148-2319" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2320"><a href="functions-for-difference-in-difference-computations.html#cb148-2320" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2321"><a href="functions-for-difference-in-difference-computations.html#cb148-2321" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2322"><a href="functions-for-difference-in-difference-computations.html#cb148-2322" tabindex="-1"></a>    )</span>
<span id="cb148-2323"><a href="functions-for-difference-in-difference-computations.html#cb148-2323" tabindex="-1"></a>  </span>
<span id="cb148-2324"><a href="functions-for-difference-in-difference-computations.html#cb148-2324" tabindex="-1"></a>  fig_att_fl_focus <span class="ot">=</span> <span class="fu">ggplot</span>(<span class="fu">filter</span>(df_plot_fl_att, focus <span class="sc">==</span> <span class="st">&quot;focus&quot;</span>),</span>
<span id="cb148-2325"><a href="functions-for-difference-in-difference-computations.html#cb148-2325" tabindex="-1"></a>                                   <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-2326"><a href="functions-for-difference-in-difference-computations.html#cb148-2326" tabindex="-1"></a>                                       <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2327"><a href="functions-for-difference-in-difference-computations.html#cb148-2327" tabindex="-1"></a>                                       <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2328"><a href="functions-for-difference-in-difference-computations.html#cb148-2328" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2329"><a href="functions-for-difference-in-difference-computations.html#cb148-2329" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2330"><a href="functions-for-difference-in-difference-computations.html#cb148-2330" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2331"><a href="functions-for-difference-in-difference-computations.html#cb148-2331" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2332"><a href="functions-for-difference-in-difference-computations.html#cb148-2332" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2333"><a href="functions-for-difference-in-difference-computations.html#cb148-2333" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(focus<span class="sc">~</span>time,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2334"><a href="functions-for-difference-in-difference-computations.html#cb148-2334" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-2335"><a href="functions-for-difference-in-difference-computations.html#cb148-2335" tabindex="-1"></a>           <span class="at">subtitle =</span> <span class="st">&quot;Protected areas funded by the FAPBM only&quot;</span>,</span>
<span id="cb148-2336"><a href="functions-for-difference-in-difference-computations.html#cb148-2336" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-2337"><a href="functions-for-difference-in-difference-computations.html#cb148-2337" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2338"><a href="functions-for-difference-in-difference-computations.html#cb148-2338" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2339"><a href="functions-for-difference-in-difference-computations.html#cb148-2339" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2340"><a href="functions-for-difference-in-difference-computations.html#cb148-2340" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2341"><a href="functions-for-difference-in-difference-computations.html#cb148-2341" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2342"><a href="functions-for-difference-in-difference-computations.html#cb148-2342" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2343"><a href="functions-for-difference-in-difference-computations.html#cb148-2343" tabindex="-1"></a>      </span>
<span id="cb148-2344"><a href="functions-for-difference-in-difference-computations.html#cb148-2344" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2345"><a href="functions-for-difference-in-difference-computations.html#cb148-2345" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2346"><a href="functions-for-difference-in-difference-computations.html#cb148-2346" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2347"><a href="functions-for-difference-in-difference-computations.html#cb148-2347" tabindex="-1"></a>      </span>
<span id="cb148-2348"><a href="functions-for-difference-in-difference-computations.html#cb148-2348" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2349"><a href="functions-for-difference-in-difference-computations.html#cb148-2349" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2350"><a href="functions-for-difference-in-difference-computations.html#cb148-2350" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2351"><a href="functions-for-difference-in-difference-computations.html#cb148-2351" tabindex="-1"></a>      </span>
<span id="cb148-2352"><a href="functions-for-difference-in-difference-computations.html#cb148-2352" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2353"><a href="functions-for-difference-in-difference-computations.html#cb148-2353" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2354"><a href="functions-for-difference-in-difference-computations.html#cb148-2354" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2355"><a href="functions-for-difference-in-difference-computations.html#cb148-2355" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2356"><a href="functions-for-difference-in-difference-computations.html#cb148-2356" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2357"><a href="functions-for-difference-in-difference-computations.html#cb148-2357" tabindex="-1"></a>      </span>
<span id="cb148-2358"><a href="functions-for-difference-in-difference-computations.html#cb148-2358" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2359"><a href="functions-for-difference-in-difference-computations.html#cb148-2359" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2360"><a href="functions-for-difference-in-difference-computations.html#cb148-2360" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2361"><a href="functions-for-difference-in-difference-computations.html#cb148-2361" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2362"><a href="functions-for-difference-in-difference-computations.html#cb148-2362" tabindex="-1"></a>    )</span>
<span id="cb148-2363"><a href="functions-for-difference-in-difference-computations.html#cb148-2363" tabindex="-1"></a>  </span>
<span id="cb148-2364"><a href="functions-for-difference-in-difference-computations.html#cb148-2364" tabindex="-1"></a>  fig_att_fl_iucn <span class="ot">=</span> <span class="fu">ggplot</span>(df_plot_fl_att, </span>
<span id="cb148-2365"><a href="functions-for-difference-in-difference-computations.html#cb148-2365" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> att, </span>
<span id="cb148-2366"><a href="functions-for-difference-in-difference-computations.html#cb148-2366" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">factor</span>(name_pa, <span class="at">levels =</span> <span class="fu">unique</span>(<span class="fu">rev</span>(<span class="fu">sort</span>(name_pa)))),</span>
<span id="cb148-2367"><a href="functions-for-difference-in-difference-computations.html#cb148-2367" tabindex="-1"></a>                               <span class="at">xmin =</span> cband_lower, <span class="at">xmax =</span> cband_upper)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2368"><a href="functions-for-difference-in-difference-computations.html#cb148-2368" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2369"><a href="functions-for-difference-in-difference-computations.html#cb148-2369" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2370"><a href="functions-for-difference-in-difference-computations.html#cb148-2370" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">color =</span> sig)) <span class="sc">%&gt;%</span> </span>
<span id="cb148-2371"><a href="functions-for-difference-in-difference-computations.html#cb148-2371" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="fu">paste0</span>(<span class="st">&quot;Significance</span><span class="sc">\n</span><span class="st">(&quot;</span>, (<span class="dv">1</span><span class="sc">-</span>alpha)<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% level)&quot;</span>),</span>
<span id="cb148-2372"><a href="functions-for-difference-in-difference-computations.html#cb148-2372" tabindex="-1"></a>                           <span class="at">na.translate =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb148-2373"><a href="functions-for-difference-in-difference-computations.html#cb148-2373" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">facet_grid</span>(iucn_wolf<span class="sc">~</span>time, <span class="at">scales=</span><span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>,  <span class="at">labeller=</span> <span class="fu">as_labeller</span>(names)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2374"><a href="functions-for-difference-in-difference-computations.html#cb148-2374" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Reduction of deforestation due to the conservation&quot;</span>,</span>
<span id="cb148-2375"><a href="functions-for-difference-in-difference-computations.html#cb148-2375" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">&quot;p.p.&quot;</span>,</span>
<span id="cb148-2376"><a href="functions-for-difference-in-difference-computations.html#cb148-2376" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2377"><a href="functions-for-difference-in-difference-computations.html#cb148-2377" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">%&gt;%</span></span>
<span id="cb148-2378"><a href="functions-for-difference-in-difference-computations.html#cb148-2378" tabindex="-1"></a>    <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb148-2379"><a href="functions-for-difference-in-difference-computations.html#cb148-2379" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb148-2380"><a href="functions-for-difference-in-difference-computations.html#cb148-2380" tabindex="-1"></a>      <span class="at">axis.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb148-2381"><a href="functions-for-difference-in-difference-computations.html#cb148-2381" tabindex="-1"></a>      <span class="at">axis.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>),</span>
<span id="cb148-2382"><a href="functions-for-difference-in-difference-computations.html#cb148-2382" tabindex="-1"></a>      </span>
<span id="cb148-2383"><a href="functions-for-difference-in-difference-computations.html#cb148-2383" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2384"><a href="functions-for-difference-in-difference-computations.html#cb148-2384" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">16</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2385"><a href="functions-for-difference-in-difference-computations.html#cb148-2385" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb148-2386"><a href="functions-for-difference-in-difference-computations.html#cb148-2386" tabindex="-1"></a>      </span>
<span id="cb148-2387"><a href="functions-for-difference-in-difference-computations.html#cb148-2387" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb148-2388"><a href="functions-for-difference-in-difference-computations.html#cb148-2388" tabindex="-1"></a>      <span class="at">strip.clip =</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-2389"><a href="functions-for-difference-in-difference-computations.html#cb148-2389" tabindex="-1"></a>      <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb148-2390"><a href="functions-for-difference-in-difference-computations.html#cb148-2390" tabindex="-1"></a>      </span>
<span id="cb148-2391"><a href="functions-for-difference-in-difference-computations.html#cb148-2391" tabindex="-1"></a>      <span class="co">#legend.position = &quot;bottom&quot;,</span></span>
<span id="cb148-2392"><a href="functions-for-difference-in-difference-computations.html#cb148-2392" tabindex="-1"></a>      <span class="at">legend.text=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb148-2393"><a href="functions-for-difference-in-difference-computations.html#cb148-2393" tabindex="-1"></a>      <span class="co">#legend.spacing.x = unit(1.0, &#39;cm&#39;),</span></span>
<span id="cb148-2394"><a href="functions-for-difference-in-difference-computations.html#cb148-2394" tabindex="-1"></a>      <span class="co">#legend.spacing.y = unit(0.75, &#39;cm&#39;),</span></span>
<span id="cb148-2395"><a href="functions-for-difference-in-difference-computations.html#cb148-2395" tabindex="-1"></a>      <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">&#39;line&#39;</span>),</span>
<span id="cb148-2396"><a href="functions-for-difference-in-difference-computations.html#cb148-2396" tabindex="-1"></a>      </span>
<span id="cb148-2397"><a href="functions-for-difference-in-difference-computations.html#cb148-2397" tabindex="-1"></a>      <span class="at">panel.grid.major.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2398"><a href="functions-for-difference-in-difference-computations.html#cb148-2398" tabindex="-1"></a>      <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>),</span>
<span id="cb148-2399"><a href="functions-for-difference-in-difference-computations.html#cb148-2399" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.3</span>, <span class="at">linetype =</span> <span class="dv">1</span>),</span>
<span id="cb148-2400"><a href="functions-for-difference-in-difference-computations.html#cb148-2400" tabindex="-1"></a>      <span class="at">panel.grid.minor.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;grey80&#39;</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>, <span class="at">linetype =</span> <span class="dv">2</span>)</span>
<span id="cb148-2401"><a href="functions-for-difference-in-difference-computations.html#cb148-2401" tabindex="-1"></a>    )</span>
<span id="cb148-2402"><a href="functions-for-difference-in-difference-computations.html#cb148-2402" tabindex="-1"></a>  </span>
<span id="cb148-2403"><a href="functions-for-difference-in-difference-computations.html#cb148-2403" tabindex="-1"></a>  </span>
<span id="cb148-2404"><a href="functions-for-difference-in-difference-computations.html#cb148-2404" tabindex="-1"></a>  <span class="co">#Tables </span></span>
<span id="cb148-2405"><a href="functions-for-difference-in-difference-computations.html#cb148-2405" tabindex="-1"></a>  <span class="do">## treatment effect : percentage of deforestation avoided</span></span>
<span id="cb148-2406"><a href="functions-for-difference-in-difference-computations.html#cb148-2406" tabindex="-1"></a>  tbl_fc_att_per <span class="ot">=</span> df_plot_fc_att  <span class="sc">%&gt;%</span></span>
<span id="cb148-2407"><a href="functions-for-difference-in-difference-computations.html#cb148-2407" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">focus =</span> <span class="fu">case_when</span>(wdpaid <span class="sc">%in%</span> list_focus <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2408"><a href="functions-for-difference-in-difference-computations.html#cb148-2408" tabindex="-1"></a>                             <span class="sc">!</span>(wdpaid <span class="sc">%in%</span> list_focus) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2409"><a href="functions-for-difference-in-difference-computations.html#cb148-2409" tabindex="-1"></a>           <span class="at">sig_per =</span> <span class="fu">case_when</span>(<span class="fu">sign</span>(cband_lower_per) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_per) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2410"><a href="functions-for-difference-in-difference-computations.html#cb148-2410" tabindex="-1"></a>                               <span class="fu">sign</span>(cband_lower_per) <span class="sc">!=</span> <span class="fu">sign</span>(cband_upper_per) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2411"><a href="functions-for-difference-in-difference-computations.html#cb148-2411" tabindex="-1"></a>           <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-2412"><a href="functions-for-difference-in-difference-computations.html#cb148-2412" tabindex="-1"></a>                                 iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-2413"><a href="functions-for-difference-in-difference-computations.html#cb148-2413" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-2414"><a href="functions-for-difference-in-difference-computations.html#cb148-2414" tabindex="-1"></a>           <span class="at">name_pa =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(name_pa) <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(name_pa, <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>),</span>
<span id="cb148-2415"><a href="functions-for-difference-in-difference-computations.html#cb148-2415" tabindex="-1"></a>                               <span class="fu">nchar</span>(name_pa) <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(<span class="fu">paste0</span>(<span class="fu">substr</span>(name_pa, <span class="dv">1</span>, <span class="dv">25</span>), <span class="st">&quot;...&quot;</span>),  <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>))</span>
<span id="cb148-2416"><a href="functions-for-difference-in-difference-computations.html#cb148-2416" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb148-2417"><a href="functions-for-difference-in-difference-computations.html#cb148-2417" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, treatment_year, iucn_wolf, gov_type, time, att_per, sig_per)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2418"><a href="functions-for-difference-in-difference-computations.html#cb148-2418" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;att_per&quot;</span>, <span class="st">&quot;sig_per&quot;</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2419"><a href="functions-for-difference-in-difference-computations.html#cb148-2419" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, treatment_year, iucn_wolf, att_per_5, sig_per_5, att_per_10, sig_per_10)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2420"><a href="functions-for-difference-in-difference-computations.html#cb148-2420" tabindex="-1"></a>    <span class="co">#dplyr::select(c(name_pa, country_en, treatment_year, iucn_wolf, gov_type, att_per_5, sig_per_5, att_per_10, sig_per_10)) %&gt;%</span></span>
<span id="cb148-2421"><a href="functions-for-difference-in-difference-computations.html#cb148-2421" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;att&quot;</span>)),</span>
<span id="cb148-2422"><a href="functions-for-difference-in-difference-computations.html#cb148-2422" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">format</span>(<span class="fu">round</span>(x, <span class="dv">2</span>), <span class="at">scientific =</span> <span class="cn">FALSE</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2423"><a href="functions-for-difference-in-difference-computations.html#cb148-2423" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;sig&quot;</span>)),</span>
<span id="cb148-2424"><a href="functions-for-difference-in-difference-computations.html#cb148-2424" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> x))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2425"><a href="functions-for-difference-in-difference-computations.html#cb148-2425" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;Effect (5 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_per_5&quot;</span>,</span>
<span id="cb148-2426"><a href="functions-for-difference-in-difference-computations.html#cb148-2426" tabindex="-1"></a>           <span class="st">&quot;Signi. (5 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_per_5&quot;</span>,</span>
<span id="cb148-2427"><a href="functions-for-difference-in-difference-computations.html#cb148-2427" tabindex="-1"></a>           <span class="st">&quot;Effect (10 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_per_10&quot;</span>,</span>
<span id="cb148-2428"><a href="functions-for-difference-in-difference-computations.html#cb148-2428" tabindex="-1"></a>           <span class="st">&quot;Signi. (10 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_per_10&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2429"><a href="functions-for-difference-in-difference-computations.html#cb148-2429" tabindex="-1"></a>    <span class="fu">arrange</span>(focus, name_pa)</span>
<span id="cb148-2430"><a href="functions-for-difference-in-difference-computations.html#cb148-2430" tabindex="-1"></a>  <span class="co"># names(tbl_fc_att_per) = c(&quot;Name&quot;, &quot;FAPBM&quot;, &quot;Creation&quot;,  &quot;Protection&quot;, </span></span>
<span id="cb148-2431"><a href="functions-for-difference-in-difference-computations.html#cb148-2431" tabindex="-1"></a>  <span class="co">#                           &quot;Governance&quot;, &quot;Effect (5 y., %)&quot;, &quot;Significance (5 y.)&quot;,&quot;Effect (10 y., %)&quot;, &quot;Significance (10 y.)&quot;)</span></span>
<span id="cb148-2432"><a href="functions-for-difference-in-difference-computations.html#cb148-2432" tabindex="-1"></a>  <span class="fu">names</span>(tbl_fc_att_per) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;FAPBM&quot;</span>, <span class="st">&quot;Creation&quot;</span>, <span class="st">&quot;Protection&quot;</span>, </span>
<span id="cb148-2433"><a href="functions-for-difference-in-difference-computations.html#cb148-2433" tabindex="-1"></a>                            <span class="st">&quot;Effect (5 y., %)&quot;</span>, <span class="st">&quot;Signi. (5 y.)&quot;</span>,<span class="st">&quot;Effect (10 y., %)&quot;</span>, <span class="st">&quot;Signi. (10 y.)&quot;</span>)</span>
<span id="cb148-2434"><a href="functions-for-difference-in-difference-computations.html#cb148-2434" tabindex="-1"></a>  </span>
<span id="cb148-2435"><a href="functions-for-difference-in-difference-computations.html#cb148-2435" tabindex="-1"></a>  <span class="co"># treatment effect : total deforestation avoided </span></span>
<span id="cb148-2436"><a href="functions-for-difference-in-difference-computations.html#cb148-2436" tabindex="-1"></a>  tbl_fc_att_pa <span class="ot">=</span> df_plot_fc_att <span class="sc">%&gt;%</span></span>
<span id="cb148-2437"><a href="functions-for-difference-in-difference-computations.html#cb148-2437" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">focus =</span> <span class="fu">case_when</span>(wdpaid <span class="sc">%in%</span> list_focus <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2438"><a href="functions-for-difference-in-difference-computations.html#cb148-2438" tabindex="-1"></a>                             <span class="sc">!</span>(wdpaid <span class="sc">%in%</span> list_focus) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2439"><a href="functions-for-difference-in-difference-computations.html#cb148-2439" tabindex="-1"></a>           <span class="at">sig_pa =</span> <span class="fu">case_when</span>(<span class="fu">sign</span>(cband_lower_pa) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper_pa) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2440"><a href="functions-for-difference-in-difference-computations.html#cb148-2440" tabindex="-1"></a>                              <span class="fu">sign</span>(cband_lower_pa) <span class="sc">!=</span> <span class="fu">sign</span>(cband_upper_pa) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2441"><a href="functions-for-difference-in-difference-computations.html#cb148-2441" tabindex="-1"></a>           <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-2442"><a href="functions-for-difference-in-difference-computations.html#cb148-2442" tabindex="-1"></a>                                 iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-2443"><a href="functions-for-difference-in-difference-computations.html#cb148-2443" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-2444"><a href="functions-for-difference-in-difference-computations.html#cb148-2444" tabindex="-1"></a>           <span class="at">name_pa =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(name_pa) <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(name_pa, <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>),</span>
<span id="cb148-2445"><a href="functions-for-difference-in-difference-computations.html#cb148-2445" tabindex="-1"></a>                               <span class="fu">nchar</span>(name_pa) <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(<span class="fu">paste0</span>(<span class="fu">substr</span>(name_pa, <span class="dv">1</span>, <span class="dv">25</span>), <span class="st">&quot;...&quot;</span>),  <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>))</span>
<span id="cb148-2446"><a href="functions-for-difference-in-difference-computations.html#cb148-2446" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb148-2447"><a href="functions-for-difference-in-difference-computations.html#cb148-2447" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, country_en, treatment_year, iucn_wolf, gov_type, time, att_pa, sig_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2448"><a href="functions-for-difference-in-difference-computations.html#cb148-2448" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;att_pa&quot;</span>, <span class="st">&quot;sig_pa&quot;</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2449"><a href="functions-for-difference-in-difference-computations.html#cb148-2449" tabindex="-1"></a>    <span class="co"># dplyr::select(c(name_pa, country_en, treatment_year, iucn_wolf, gov_type, att_pa_5, sig_pa_5, att_pa_10, sig_pa_10)) %&gt;%</span></span>
<span id="cb148-2450"><a href="functions-for-difference-in-difference-computations.html#cb148-2450" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, treatment_year, iucn_wolf, att_pa_5, sig_pa_5, att_pa_10, sig_pa_10)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2451"><a href="functions-for-difference-in-difference-computations.html#cb148-2451" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;att&quot;</span>)),</span>
<span id="cb148-2452"><a href="functions-for-difference-in-difference-computations.html#cb148-2452" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">format</span>(<span class="fu">round</span>(x, <span class="dv">2</span>), <span class="at">scientific =</span> <span class="cn">FALSE</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2453"><a href="functions-for-difference-in-difference-computations.html#cb148-2453" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;sig&quot;</span>)),</span>
<span id="cb148-2454"><a href="functions-for-difference-in-difference-computations.html#cb148-2454" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> x))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2455"><a href="functions-for-difference-in-difference-computations.html#cb148-2455" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;Effect (5 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_pa_5&quot;</span>,</span>
<span id="cb148-2456"><a href="functions-for-difference-in-difference-computations.html#cb148-2456" tabindex="-1"></a>           <span class="st">&quot;Signi. (5 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_pa_5&quot;</span>,</span>
<span id="cb148-2457"><a href="functions-for-difference-in-difference-computations.html#cb148-2457" tabindex="-1"></a>           <span class="st">&quot;Effect (10 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_pa_10&quot;</span>,</span>
<span id="cb148-2458"><a href="functions-for-difference-in-difference-computations.html#cb148-2458" tabindex="-1"></a>           <span class="st">&quot;Signi. (10 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_pa_10&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2459"><a href="functions-for-difference-in-difference-computations.html#cb148-2459" tabindex="-1"></a>  <span class="fu">arrange</span>(focus, name_pa)</span>
<span id="cb148-2460"><a href="functions-for-difference-in-difference-computations.html#cb148-2460" tabindex="-1"></a>  <span class="co"># names(tbl_fc_att_pa) = c(&quot;Name&quot;, &quot;FAPBM&quot;, &quot;Creation&quot;,  &quot;Protection&quot;, </span></span>
<span id="cb148-2461"><a href="functions-for-difference-in-difference-computations.html#cb148-2461" tabindex="-1"></a>  <span class="co">#                           &quot;Governance&quot;, &quot;Effect (5 y., ha)&quot;, &quot;Significance (5 y.)&quot;,&quot;Effect (10 y., ha)&quot;, &quot;Significance (10 y.)&quot;)</span></span>
<span id="cb148-2462"><a href="functions-for-difference-in-difference-computations.html#cb148-2462" tabindex="-1"></a>  <span class="fu">names</span>(tbl_fc_att_pa) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;FAPBM&quot;</span>, <span class="st">&quot;Creation&quot;</span>, <span class="st">&quot;Protection&quot;</span>, </span>
<span id="cb148-2463"><a href="functions-for-difference-in-difference-computations.html#cb148-2463" tabindex="-1"></a>                            <span class="st">&quot;Effect (5 y., ha)&quot;</span>, <span class="st">&quot;Signi. (5 y.)&quot;</span>,<span class="st">&quot;Effect (10 y., ha)&quot;</span>, <span class="st">&quot;Signi. (10 y.)&quot;</span>)</span>
<span id="cb148-2464"><a href="functions-for-difference-in-difference-computations.html#cb148-2464" tabindex="-1"></a>  </span>
<span id="cb148-2465"><a href="functions-for-difference-in-difference-computations.html#cb148-2465" tabindex="-1"></a>  <span class="co"># treatment effect : avoided deforestation, in terms of difference in cumultaed deforestation rate </span></span>
<span id="cb148-2466"><a href="functions-for-difference-in-difference-computations.html#cb148-2466" tabindex="-1"></a>  tbl_fl_att <span class="ot">=</span> df_plot_fl_att <span class="sc">%&gt;%</span></span>
<span id="cb148-2467"><a href="functions-for-difference-in-difference-computations.html#cb148-2467" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">focus =</span> <span class="fu">case_when</span>(wdpaid <span class="sc">%in%</span> list_focus <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2468"><a href="functions-for-difference-in-difference-computations.html#cb148-2468" tabindex="-1"></a>                             <span class="sc">!</span>(wdpaid <span class="sc">%in%</span> list_focus) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2469"><a href="functions-for-difference-in-difference-computations.html#cb148-2469" tabindex="-1"></a>           <span class="at">sig =</span> <span class="fu">case_when</span>(<span class="fu">sign</span>(cband_lower) <span class="sc">==</span> <span class="fu">sign</span>(cband_upper) <span class="sc">~</span> <span class="st">&quot;Yes&quot;</span>,</span>
<span id="cb148-2470"><a href="functions-for-difference-in-difference-computations.html#cb148-2470" tabindex="-1"></a>                              <span class="fu">sign</span>(cband_lower) <span class="sc">!=</span> <span class="fu">sign</span>(cband_upper) <span class="sc">~</span> <span class="st">&quot;No&quot;</span>),</span>
<span id="cb148-2471"><a href="functions-for-difference-in-difference-computations.html#cb148-2471" tabindex="-1"></a>           <span class="at">iucn_wolf =</span> <span class="fu">case_when</span>(iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;II&quot;</span>, <span class="st">&quot;III&quot;</span>, <span class="st">&quot;IV&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Strict&quot;</span>,</span>
<span id="cb148-2472"><a href="functions-for-difference-in-difference-computations.html#cb148-2472" tabindex="-1"></a>                                 iucn_cat <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;V&quot;</span>, <span class="st">&quot;VI&quot;</span>) <span class="sc">~</span> <span class="st">&quot;Non strict&quot;</span>,</span>
<span id="cb148-2473"><a href="functions-for-difference-in-difference-computations.html#cb148-2473" tabindex="-1"></a>                                 <span class="fu">grepl</span>(<span class="st">&quot;not&quot;</span>, iucn_cat, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Unknown&quot;</span>),</span>
<span id="cb148-2474"><a href="functions-for-difference-in-difference-computations.html#cb148-2474" tabindex="-1"></a>           <span class="at">name_pa =</span> <span class="fu">case_when</span>(<span class="fu">nchar</span>(name_pa) <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(name_pa, <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>),</span>
<span id="cb148-2475"><a href="functions-for-difference-in-difference-computations.html#cb148-2475" tabindex="-1"></a>                               <span class="fu">nchar</span>(name_pa) <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">~</span> <span class="fu">stri_trans_general</span>(<span class="fu">paste0</span>(<span class="fu">substr</span>(name_pa, <span class="dv">1</span>, <span class="dv">25</span>), <span class="st">&quot;...&quot;</span>),  <span class="at">id =</span> <span class="st">&quot;Latin-ASCII&quot;</span>))</span>
<span id="cb148-2476"><a href="functions-for-difference-in-difference-computations.html#cb148-2476" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb148-2477"><a href="functions-for-difference-in-difference-computations.html#cb148-2477" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, country_en, treatment_year, iucn_wolf, gov_type, time, att, sig)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2478"><a href="functions-for-difference-in-difference-computations.html#cb148-2478" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;att&quot;</span>, <span class="st">&quot;sig&quot;</span>), <span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2479"><a href="functions-for-difference-in-difference-computations.html#cb148-2479" tabindex="-1"></a>    <span class="co"># dplyr::select(c(name_pa, country_en, treatment_year, iucn_wolf, gov_type, att_5, sig_5, att_10, sig_10)) %&gt;%</span></span>
<span id="cb148-2480"><a href="functions-for-difference-in-difference-computations.html#cb148-2480" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(name_pa, focus, treatment_year, iucn_wolf, att_5, sig_5, att_10, sig_10)) <span class="sc">%&gt;%</span></span>
<span id="cb148-2481"><a href="functions-for-difference-in-difference-computations.html#cb148-2481" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;att&quot;</span>)),</span>
<span id="cb148-2482"><a href="functions-for-difference-in-difference-computations.html#cb148-2482" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(<span class="fu">format</span>(<span class="fu">round</span>(x, <span class="dv">2</span>), <span class="at">scientific =</span> <span class="cn">FALSE</span>))))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2483"><a href="functions-for-difference-in-difference-computations.html#cb148-2483" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;sig&quot;</span>)),</span>
<span id="cb148-2484"><a href="functions-for-difference-in-difference-computations.html#cb148-2484" tabindex="-1"></a>                  <span class="at">.fns =</span> \(x) <span class="fu">case_when</span>(<span class="fu">is.na</span>(x) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;/&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> x))) <span class="sc">%&gt;%</span></span>
<span id="cb148-2485"><a href="functions-for-difference-in-difference-computations.html#cb148-2485" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;Effect (5 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_5&quot;</span>,</span>
<span id="cb148-2486"><a href="functions-for-difference-in-difference-computations.html#cb148-2486" tabindex="-1"></a>           <span class="st">&quot;Signi. (5 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_5&quot;</span>,</span>
<span id="cb148-2487"><a href="functions-for-difference-in-difference-computations.html#cb148-2487" tabindex="-1"></a>           <span class="st">&quot;Effect (10 y., %)&quot;</span> <span class="ot">=</span> <span class="st">&quot;att_10&quot;</span>,</span>
<span id="cb148-2488"><a href="functions-for-difference-in-difference-computations.html#cb148-2488" tabindex="-1"></a>           <span class="st">&quot;Signi. (10 y.)&quot;</span> <span class="ot">=</span> <span class="st">&quot;sig_10&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb148-2489"><a href="functions-for-difference-in-difference-computations.html#cb148-2489" tabindex="-1"></a>    <span class="fu">arrange</span>(focus, name_pa)</span>
<span id="cb148-2490"><a href="functions-for-difference-in-difference-computations.html#cb148-2490" tabindex="-1"></a>  <span class="co"># names(tbl_fl_att) = c(&quot;Name&quot;, &quot;FAPBM&quot;, &quot;Creation&quot;,  &quot;Protection&quot;, </span></span>
<span id="cb148-2491"><a href="functions-for-difference-in-difference-computations.html#cb148-2491" tabindex="-1"></a>  <span class="co">#                           &quot;Governance&quot;, &quot;Effect (5 y., pp)&quot;, &quot;Significance (5 y.)&quot;,&quot;Effect (10 y., pp)&quot;, &quot;Significance (10 y.)&quot;)</span></span>
<span id="cb148-2492"><a href="functions-for-difference-in-difference-computations.html#cb148-2492" tabindex="-1"></a>  <span class="fu">names</span>(tbl_fl_att) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Name&quot;</span>, <span class="st">&quot;FAPBM&quot;</span>, <span class="st">&quot;Creation&quot;</span>, <span class="st">&quot;Protection&quot;</span>, </span>
<span id="cb148-2493"><a href="functions-for-difference-in-difference-computations.html#cb148-2493" tabindex="-1"></a>                           <span class="st">&quot;Effect (5 y., pp)&quot;</span>, <span class="st">&quot;Signi. (5 y.)&quot;</span>,<span class="st">&quot;Effect (10 y., pp)&quot;</span>, <span class="st">&quot;Signi. (10 y.)&quot;</span>)</span>
<span id="cb148-2494"><a href="functions-for-difference-in-difference-computations.html#cb148-2494" tabindex="-1"></a>  </span>
<span id="cb148-2495"><a href="functions-for-difference-in-difference-computations.html#cb148-2495" tabindex="-1"></a>  <span class="co">#Saving plots</span></span>
<span id="cb148-2496"><a href="functions-for-difference-in-difference-computations.html#cb148-2496" tabindex="-1"></a>  </span>
<span id="cb148-2497"><a href="functions-for-difference-in-difference-computations.html#cb148-2497" tabindex="-1"></a>  <span class="do">##Saving plots</span></span>
<span id="cb148-2498"><a href="functions-for-difference-in-difference-computations.html#cb148-2498" tabindex="-1"></a>  tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;fig&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb148-2499"><a href="functions-for-difference-in-difference-computations.html#cb148-2499" tabindex="-1"></a>  </span>
<span id="cb148-2500"><a href="functions-for-difference-in-difference-computations.html#cb148-2500" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2501"><a href="functions-for-difference-in-difference-computations.html#cb148-2501" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per,</span>
<span id="cb148-2502"><a href="functions-for-difference-in-difference-computations.html#cb148-2502" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2503"><a href="functions-for-difference-in-difference-computations.html#cb148-2503" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2504"><a href="functions-for-difference-in-difference-computations.html#cb148-2504" tabindex="-1"></a></span>
<span id="cb148-2505"><a href="functions-for-difference-in-difference-computations.html#cb148-2505" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per_focus.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2506"><a href="functions-for-difference-in-difference-computations.html#cb148-2506" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per_focus,</span>
<span id="cb148-2507"><a href="functions-for-difference-in-difference-computations.html#cb148-2507" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2508"><a href="functions-for-difference-in-difference-computations.html#cb148-2508" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span><span class="dv">9</span>)</span>
<span id="cb148-2509"><a href="functions-for-difference-in-difference-computations.html#cb148-2509" tabindex="-1"></a>  </span>
<span id="cb148-2510"><a href="functions-for-difference-in-difference-computations.html#cb148-2510" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per_focus_others.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2511"><a href="functions-for-difference-in-difference-computations.html#cb148-2511" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per_focus_others,</span>
<span id="cb148-2512"><a href="functions-for-difference-in-difference-computations.html#cb148-2512" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2513"><a href="functions-for-difference-in-difference-computations.html#cb148-2513" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2514"><a href="functions-for-difference-in-difference-computations.html#cb148-2514" tabindex="-1"></a>  </span>
<span id="cb148-2515"><a href="functions-for-difference-in-difference-computations.html#cb148-2515" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_per_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2516"><a href="functions-for-difference-in-difference-computations.html#cb148-2516" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_per_iucn,</span>
<span id="cb148-2517"><a href="functions-for-difference-in-difference-computations.html#cb148-2517" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2518"><a href="functions-for-difference-in-difference-computations.html#cb148-2518" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2519"><a href="functions-for-difference-in-difference-computations.html#cb148-2519" tabindex="-1"></a>  </span>
<span id="cb148-2520"><a href="functions-for-difference-in-difference-computations.html#cb148-2520" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2521"><a href="functions-for-difference-in-difference-computations.html#cb148-2521" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa,</span>
<span id="cb148-2522"><a href="functions-for-difference-in-difference-computations.html#cb148-2522" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2523"><a href="functions-for-difference-in-difference-computations.html#cb148-2523" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2524"><a href="functions-for-difference-in-difference-computations.html#cb148-2524" tabindex="-1"></a>  </span>
<span id="cb148-2525"><a href="functions-for-difference-in-difference-computations.html#cb148-2525" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa_focus.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2526"><a href="functions-for-difference-in-difference-computations.html#cb148-2526" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa_focus,</span>
<span id="cb148-2527"><a href="functions-for-difference-in-difference-computations.html#cb148-2527" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2528"><a href="functions-for-difference-in-difference-computations.html#cb148-2528" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-2529"><a href="functions-for-difference-in-difference-computations.html#cb148-2529" tabindex="-1"></a>  </span>
<span id="cb148-2530"><a href="functions-for-difference-in-difference-computations.html#cb148-2530" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa_focus_others.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2531"><a href="functions-for-difference-in-difference-computations.html#cb148-2531" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa_focus_others,</span>
<span id="cb148-2532"><a href="functions-for-difference-in-difference-computations.html#cb148-2532" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2533"><a href="functions-for-difference-in-difference-computations.html#cb148-2533" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2534"><a href="functions-for-difference-in-difference-computations.html#cb148-2534" tabindex="-1"></a>  </span>
<span id="cb148-2535"><a href="functions-for-difference-in-difference-computations.html#cb148-2535" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_pa_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2536"><a href="functions-for-difference-in-difference-computations.html#cb148-2536" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_pa_iucn,</span>
<span id="cb148-2537"><a href="functions-for-difference-in-difference-computations.html#cb148-2537" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2538"><a href="functions-for-difference-in-difference-computations.html#cb148-2538" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2539"><a href="functions-for-difference-in-difference-computations.html#cb148-2539" tabindex="-1"></a>  </span>
<span id="cb148-2540"><a href="functions-for-difference-in-difference-computations.html#cb148-2540" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2541"><a href="functions-for-difference-in-difference-computations.html#cb148-2541" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl,</span>
<span id="cb148-2542"><a href="functions-for-difference-in-difference-computations.html#cb148-2542" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2543"><a href="functions-for-difference-in-difference-computations.html#cb148-2543" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2544"><a href="functions-for-difference-in-difference-computations.html#cb148-2544" tabindex="-1"></a>  </span>
<span id="cb148-2545"><a href="functions-for-difference-in-difference-computations.html#cb148-2545" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl_focus.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2546"><a href="functions-for-difference-in-difference-computations.html#cb148-2546" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl_focus,</span>
<span id="cb148-2547"><a href="functions-for-difference-in-difference-computations.html#cb148-2547" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2548"><a href="functions-for-difference-in-difference-computations.html#cb148-2548" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="dv">9</span>)</span>
<span id="cb148-2549"><a href="functions-for-difference-in-difference-computations.html#cb148-2549" tabindex="-1"></a>  </span>
<span id="cb148-2550"><a href="functions-for-difference-in-difference-computations.html#cb148-2550" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl_focus_others.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2551"><a href="functions-for-difference-in-difference-computations.html#cb148-2551" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl_focus_others,</span>
<span id="cb148-2552"><a href="functions-for-difference-in-difference-computations.html#cb148-2552" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2553"><a href="functions-for-difference-in-difference-computations.html#cb148-2553" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2554"><a href="functions-for-difference-in-difference-computations.html#cb148-2554" tabindex="-1"></a>  </span>
<span id="cb148-2555"><a href="functions-for-difference-in-difference-computations.html#cb148-2555" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;fig_att_fl_iucn.png&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2556"><a href="functions-for-difference-in-difference-computations.html#cb148-2556" tabindex="-1"></a>         <span class="at">plot =</span> fig_att_fl_iucn,</span>
<span id="cb148-2557"><a href="functions-for-difference-in-difference-computations.html#cb148-2557" tabindex="-1"></a>         <span class="at">device =</span> <span class="st">&quot;png&quot;</span>,</span>
<span id="cb148-2558"><a href="functions-for-difference-in-difference-computations.html#cb148-2558" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">8</span>, <span class="at">width =</span> <span class="dv">12</span>)</span>
<span id="cb148-2559"><a href="functions-for-difference-in-difference-computations.html#cb148-2559" tabindex="-1"></a>  </span>
<span id="cb148-2560"><a href="functions-for-difference-in-difference-computations.html#cb148-2560" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">xtable</span>(tbl_fc_att_pa, <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>, <span class="at">auto =</span> T),</span>
<span id="cb148-2561"><a href="functions-for-difference-in-difference-computations.html#cb148-2561" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste</span>(tmp, <span class="st">&quot;tbl_fc_att_pa.tex&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb148-2562"><a href="functions-for-difference-in-difference-computations.html#cb148-2562" tabindex="-1"></a>  </span>
<span id="cb148-2563"><a href="functions-for-difference-in-difference-computations.html#cb148-2563" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">xtable</span>(tbl_fc_att_per, <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>, <span class="at">auto =</span> T),</span>
<span id="cb148-2564"><a href="functions-for-difference-in-difference-computations.html#cb148-2564" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste</span>(tmp, <span class="st">&quot;tbl_fc_att_per.tex&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb148-2565"><a href="functions-for-difference-in-difference-computations.html#cb148-2565" tabindex="-1"></a>  </span>
<span id="cb148-2566"><a href="functions-for-difference-in-difference-computations.html#cb148-2566" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">xtable</span>(tbl_fl_att, <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>, <span class="at">auto =</span> T),</span>
<span id="cb148-2567"><a href="functions-for-difference-in-difference-computations.html#cb148-2567" tabindex="-1"></a>        <span class="at">file =</span> <span class="fu">paste</span>(tmp, <span class="st">&quot;tbl_fl_att.tex&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb148-2568"><a href="functions-for-difference-in-difference-computations.html#cb148-2568" tabindex="-1"></a>  </span>
<span id="cb148-2569"><a href="functions-for-difference-in-difference-computations.html#cb148-2569" tabindex="-1"></a>  files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-2570"><a href="functions-for-difference-in-difference-computations.html#cb148-2570" tabindex="-1"></a>  <span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb148-2571"><a href="functions-for-difference-in-difference-computations.html#cb148-2571" tabindex="-1"></a>  <span class="cf">for</span>(f <span class="cf">in</span> files) </span>
<span id="cb148-2572"><a href="functions-for-difference-in-difference-computations.html#cb148-2572" tabindex="-1"></a>  {</span>
<span id="cb148-2573"><a href="functions-for-difference-in-difference-computations.html#cb148-2573" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb148-2574"><a href="functions-for-difference-in-difference-computations.html#cb148-2574" tabindex="-1"></a>    aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb148-2575"><a href="functions-for-difference-in-difference-computations.html#cb148-2575" tabindex="-1"></a>                       <span class="at">bucket =</span> <span class="fu">paste</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>, save_dir, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>),</span>
<span id="cb148-2576"><a href="functions-for-difference-in-difference-computations.html#cb148-2576" tabindex="-1"></a>                       <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-2577"><a href="functions-for-difference-in-difference-computations.html#cb148-2577" tabindex="-1"></a>  }</span>
<span id="cb148-2578"><a href="functions-for-difference-in-difference-computations.html#cb148-2578" tabindex="-1"></a>  <span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(tmp, <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb148-2579"><a href="functions-for-difference-in-difference-computations.html#cb148-2579" tabindex="-1"></a>}</span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="functions-for-matching-pre--and-post-processing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vuillota/EVA-impact-aires-protegees/edit/main/appendix.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/vuillota/EVA-impact-aires-protegees/raw/main/appendix.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"code_folding": "hide"
});
});
</script>

</body>

</html>
