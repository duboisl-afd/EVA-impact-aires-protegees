<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 1 Building the datasets | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 1 Building the datasets | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="vuillota/EVA-impact-aires-protegees.git" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 1 Building the datasets | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Antoine Vuillot" />
<meta name="author" content="Ingrid Dallmann" />
<meta name="author" content="Léa Poulin" />
<meta name="author" content="Pierre-Yves Durand" />


<meta name="date" content="2023-10-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="projects-funded-by-the-afd.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Impact analysis of protected areas funded by the AFD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this website</a></li>
<li class="chapter" data-level="1" data-path="building-the-datasets.html"><a href="building-the-datasets.html"><i class="fa fa-check"></i><b>1</b> Building the datasets</a>
<ul>
<li class="chapter" data-level="1.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#initial-settings"><i class="fa fa-check"></i><b>1.1</b> Initial settings</a></li>
<li class="chapter" data-level="1.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-analysis"><i class="fa fa-check"></i><b>1.2</b> Datasets for analysis</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-pas-reporting-by-afd-technical-departments"><i class="fa fa-check"></i><b>1.2.1</b> Merge PAs reporting by AFD technical departments</a></li>
<li class="chapter" data-level="1.2.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-the-list-of-pas-to-afd-project-information-and-wdpa"><i class="fa fa-check"></i><b>1.2.2</b> Merge the list of PAs to AFD project information and WDPA</a></li>
<li class="chapter" data-level="1.2.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#correct-errors"><i class="fa fa-check"></i><b>1.2.3</b> Correct errors</a></li>
<li class="chapter" data-level="1.2.4" data-path="building-the-datasets.html"><a href="building-the-datasets.html#tidy-the-datasets"><i class="fa fa-check"></i><b>1.2.4</b> Tidy the datasets</a></li>
<li class="chapter" data-level="1.2.5" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-with-only-afd-project-variables"><i class="fa fa-check"></i><b>1.2.5</b> Dataset with only AFD project variables</a></li>
<li class="chapter" data-level="1.2.6" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-for-non-confidential-analysis"><i class="fa fa-check"></i><b>1.2.6</b> Dataset for non-confidential analysis</a></li>
<li class="chapter" data-level="1.2.7" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-confidential-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Datasets for confidential analysis</a></li>
<li class="chapter" data-level="1.2.8" data-path="building-the-datasets.html"><a href="building-the-datasets.html#a-polygon-dataset-for-specific-use"><i class="fa fa-check"></i><b>1.2.8</b> A polygon dataset for specific use</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample"><i class="fa fa-check"></i><b>1.3</b> Computing total areas covered by PAs in the sample</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computations-of-polygons-area"><i class="fa fa-check"></i><b>1.3.1</b> Computations of polygons’ area</a></li>
<li class="chapter" data-level="1.3.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level"><i class="fa fa-check"></i><b>1.3.2</b> Computing the intersection at country, region, world level</a></li>
<li class="chapter" data-level="1.3.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-without-intersection"><i class="fa fa-check"></i><b>1.3.3</b> Computing total areas without intersection</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Descriptive statistics</b></span></li>
<li class="chapter" data-level="2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html"><i class="fa fa-check"></i><b>2</b> Projects funded by the AFD</a>
<ul>
<li class="chapter" data-level="2.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#initial-settings-1"><i class="fa fa-check"></i><b>2.1</b> Initial settings</a></li>
<li class="chapter" data-level="2.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#importing-the-datasets"><i class="fa fa-check"></i><b>2.2</b> Importing the datasets</a></li>
<li class="chapter" data-level="2.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#performing-descriptive-statistics"><i class="fa fa-check"></i><b>2.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#iucn-categories"><i class="fa fa-check"></i><b>2.3.1</b> IUCN categories</a></li>
<li class="chapter" data-level="2.3.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#ecosystems-excluding-non-referenced-pas"><i class="fa fa-check"></i><b>2.3.2</b> Ecosystems (excluding non-referenced PAs)</a></li>
<li class="chapter" data-level="2.3.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#distribution-and-surface-of-pas-across-countries-and-regions"><i class="fa fa-check"></i><b>2.3.3</b> Distribution (# and surface) of PAs across countries and regions</a></li>
<li class="chapter" data-level="2.3.4" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#surface-of-pas"><i class="fa fa-check"></i><b>2.3.4</b> Surface of PAs</a></li>
<li class="chapter" data-level="2.3.5" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#temporal-evolution"><i class="fa fa-check"></i><b>2.3.5</b> Temporal evolution</a></li>
<li class="chapter" data-level="2.3.6" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#governance"><i class="fa fa-check"></i><b>2.3.6</b> Governance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html"><i class="fa fa-check"></i><b>3</b> Miscellaneous statistics</a>
<ul>
<li class="chapter" data-level="3.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#initial-settings-2"><i class="fa fa-check"></i><b>3.1</b> Initial settings</a></li>
<li class="chapter" data-level="3.2" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#importing-datasets"><i class="fa fa-check"></i><b>3.2</b> Importing datasets</a></li>
<li class="chapter" data-level="3.3" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#performing-descriptive-statistics-1"><i class="fa fa-check"></i><b>3.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#fapbm-portfolio-and-madagascar"><i class="fa fa-check"></i><b>3.3.1</b> FAPBM portfolio and Madagascar</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#evolution-of-tree-cover-and-deforestation"><i class="fa fa-check"></i><b>3.4</b> Evolution of tree cover and deforestation</a></li>
</ul></li>
<li class="part"><span><b>Impact analysis</b></span></li>
<li class="chapter" data-level="4" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>4</b> Matching</a>
<ul>
<li class="chapter" data-level="4.1" data-path="matching.html"><a href="matching.html#initial-settings-3"><i class="fa fa-check"></i><b>4.1</b> Initial settings</a></li>
<li class="chapter" data-level="4.2" data-path="matching.html"><a href="matching.html#datasets-and-critical-parameters"><i class="fa fa-check"></i><b>4.2</b> Datasets and critical parameters</a></li>
<li class="chapter" data-level="4.3" data-path="matching.html"><a href="matching.html#matching-process"><i class="fa fa-check"></i><b>4.3</b> Matching process</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="difference-in-difference.html"><a href="difference-in-difference.html"><i class="fa fa-check"></i><b>5</b> Difference-in-difference</a>
<ul>
<li class="chapter" data-level="5.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#initial-settings-4"><i class="fa fa-check"></i><b>5.1</b> Initial settings</a></li>
<li class="chapter" data-level="5.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#load-datasets-and-define-critical-parameters"><i class="fa fa-check"></i><b>5.2</b> Load datasets and define critical parameters</a></li>
<li class="chapter" data-level="5.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#computing-treatment-effects-at-protected-area-level"><i class="fa fa-check"></i><b>5.3</b> Computing treatment effects at protected area level</a></li>
<li class="chapter" data-level="5.4" data-path="difference-in-difference.html"><a href="difference-in-difference.html#compute-aggregated-metrics-at-country-and-region-level"><i class="fa fa-check"></i><b>5.4</b> Compute aggregated metrics at country and region level</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-treatment-effects"><i class="fa fa-check"></i><b>5.4.1</b> Aggregation of treatment effects</a></li>
<li class="chapter" data-level="5.4.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-annual-deforestation-rates"><i class="fa fa-check"></i><b>5.4.2</b> Aggregation of annual deforestation rates</a></li>
<li class="chapter" data-level="5.4.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#average-and-total-forest-loss-on-the-period-at-country-and-region-level"><i class="fa fa-check"></i><b>5.4.3</b> Average and total forest loss on the period, at country and region level</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="difference-in-difference.html"><a href="difference-in-difference.html#display-treatment-effects-in-figures-and-tables"><i class="fa fa-check"></i><b>5.5</b> Display treatment effects in figures and tables</a></li>
<li class="chapter" data-level="5.6" data-path="difference-in-difference.html"><a href="difference-in-difference.html#section"><i class="fa fa-check"></i><b>5.6</b> </a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="functions-for-matching-pre--and-post-processing.html"><a href="functions-for-matching-pre--and-post-processing.html"><i class="fa fa-check"></i><b>A</b> Functions for matching pre- and post-processing</a></li>
<li class="chapter" data-level="B" data-path="functions-for-difference-in-difference-computations.html"><a href="functions-for-difference-in-difference-computations.html"><i class="fa fa-check"></i><b>B</b> Functions for difference-in-difference computations</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="building-the-datasets" class="section level1 hasAnchor" number="1">
<h1><span class="header-section-number">Section 1</span> Building the datasets<a href="building-the-datasets.html#building-the-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This script builds the different datasets for the analysis. The lists of protected areas (PAs) reported by the Agence Française de Développement (AFD) departments are combined, merged with AFD project database (“SIOP”) and the World Database on Protected Areas (WDPA). The latter is the most comprehensive database on marine and terrestrial protected areas, published by the International Union for the Conservation of Nature (IUCN). The following datasets are created :</p>
<ul>
<li><p>A confidential dataset to perform descriptive statistics on fundings</p></li>
<li><p>A dataset to perform non-confidential statistics</p></li>
<li><p>Datasets specific to impact analysis (for PA supported by the AFD or a specific funder, a all PA in a given country, etc.)</p></li>
<li><p>Datasets with geospatial information, for specific uses (e.g maps)</p></li>
<li><p>Datasets with total area at country, region or world level, taking into account potential intersection between PA reported by the WDPA (see WDPA documentation)</p></li>
</ul>
<p>These datasets are available upon requests, with potential restriction for datasets containing confidential data. Note that this script loads geospatial datasets that are memory demanding. Ensure that the R session has accessed to enough temporary memory (RAM) before running the script (typically 10 GB), or clean the RAM regularly.</p>
<p>The datasets used are stored and saved into the SSPCloud platform that uses minIO storage. Thus specific functions from the aws.S3 package are used to write and read files (aws.S3::s3read_using() and aws.S3::s3write_using()). These can be replaced by other R functions to read/write locally (data.table::fread() typically).</p>
<div id="initial-settings" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Initial settings<a href="building-the-datasets.html#initial-settings" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Configuring the Rmarkdown</p>
<p>#<code>{r setup, include = FALSE, eval = FALSE} #knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file()) #</code></p>
<p>Downloading and importing the relevant packages</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb1-1"><a href="building-the-datasets.html#cb1-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;janitor&quot;</span>, <span class="st">&quot;geodata&quot;</span>, <span class="st">&quot;wdpar&quot;</span>, <span class="st">&quot;countrycode&quot;</span>))</span>
<span id="cb1-2"><a href="building-the-datasets.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="building-the-datasets.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="building-the-datasets.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-5"><a href="building-the-datasets.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb1-6"><a href="building-the-datasets.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-7"><a href="building-the-datasets.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(stringi)</span>
<span id="cb1-8"><a href="building-the-datasets.html#cb1-8" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-9"><a href="building-the-datasets.html#cb1-9" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-10"><a href="building-the-datasets.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1-11"><a href="building-the-datasets.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(wdpar)</span>
<span id="cb1-12"><a href="building-the-datasets.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(aws.s3)</span>
<span id="cb1-13"><a href="building-the-datasets.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb1-14"><a href="building-the-datasets.html#cb1-14" tabindex="-1"></a><span class="fu">library</span>(geodata)</span>
<span id="cb1-15"><a href="building-the-datasets.html#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="building-the-datasets.html#cb1-16" tabindex="-1"></a><span class="co">#Install webdriver to download WDPA data</span></span>
<span id="cb1-17"><a href="building-the-datasets.html#cb1-17" tabindex="-1"></a><span class="co">#webdriver::install_phantomjs()</span></span></code></pre></div>
</div>
<div id="datasets-for-analysis" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> Datasets for analysis<a href="building-the-datasets.html#datasets-for-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="merge-pas-reporting-by-afd-technical-departments" class="section level3 hasAnchor" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Merge PAs reporting by AFD technical departments<a href="building-the-datasets.html#merge-pas-reporting-by-afd-technical-departments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A first step has been to collect information on the PAs funded by the AFD. A first bunch was collected by Léa Poulin, Ingrid Dallmann and Pierre-Yves Durand (from evaluation and learning service of the innovation, research and knowledge department). Others were reported to us by the agriculture, rural development and biodiversity department. These datasets are combined with only relevant variables for future merging with WDPA and SIOP databases.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r fold-show"><code class="sourceCode r"><span id="cb2-1"><a href="building-the-datasets.html#cb2-1" tabindex="-1"></a><span class="co">#PAs gathered by the evaluation department</span></span>
<span id="cb2-2"><a href="building-the-datasets.html#cb2-2" tabindex="-1"></a><span class="do">##BDD_joint created by Léa Poulin. </span></span>
<span id="cb2-3"><a href="building-the-datasets.html#cb2-3" tabindex="-1"></a><span class="do">##Create a dataset with a merged column for cofunders, instead of a variable for each. Only relevant variables are kept, and the date/author of the report are added.</span></span>
<span id="cb2-4"><a href="building-the-datasets.html#cb2-4" tabindex="-1"></a>data_pa_eva <span class="ot">=</span> </span>
<span id="cb2-5"><a href="building-the-datasets.html#cb2-5" tabindex="-1"></a>  <span class="co">#read_excel(&quot;data_raw/BDD_joint.xlsx&quot;) %&gt;%</span></span>
<span id="cb2-6"><a href="building-the-datasets.html#cb2-6" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readxl<span class="sc">::</span>read_excel,</span>
<span id="cb2-7"><a href="building-the-datasets.html#cb2-7" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_raw/BDD_joint.xlsx&quot;</span>,</span>
<span id="cb2-8"><a href="building-the-datasets.html#cb2-8" tabindex="-1"></a>               <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb2-9"><a href="building-the-datasets.html#cb2-9" tabindex="-1"></a>               <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-10"><a href="building-the-datasets.html#cb2-10" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="building-the-datasets.html#cb2-11" tabindex="-1"></a>  <span class="fu">unite</span>(cofinanciers, <span class="fu">starts_with</span>(<span class="st">&quot;cofinancier&quot;</span>),</span>
<span id="cb2-12"><a href="building-the-datasets.html#cb2-12" tabindex="-1"></a>        <span class="at">sep=</span><span class="st">&quot;,&quot;</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="building-the-datasets.html#cb2-13" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id_projet, id_concours, cofinanciers, </span>
<span id="cb2-14"><a href="building-the-datasets.html#cb2-14" tabindex="-1"></a>           nom_ap, wdpaid, superficie)) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="building-the-datasets.html#cb2-15" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;superficie_km2&quot;</span> <span class="ot">=</span> <span class="st">&quot;superficie&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-16"><a href="building-the-datasets.html#cb2-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">superficie_km2 =</span> <span class="fu">as.numeric</span>(superficie_km2),</span>
<span id="cb2-17"><a href="building-the-datasets.html#cb2-17" tabindex="-1"></a>         <span class="at">wdpaid =</span> <span class="fu">as.numeric</span>(wdpaid),</span>
<span id="cb2-18"><a href="building-the-datasets.html#cb2-18" tabindex="-1"></a>         <span class="at">date_entree =</span> <span class="st">&quot;2022-12-06&quot;</span>,</span>
<span id="cb2-19"><a href="building-the-datasets.html#cb2-19" tabindex="-1"></a>         <span class="at">auteur_entree =</span> <span class="st">&quot;Léa Poulin,Pierre-Yves Durand,Ingrid Dallmann&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-20"><a href="building-the-datasets.html#cb2-20" tabindex="-1"></a>  <span class="co"># Change encoding of characters</span></span>
<span id="cb2-21"><a href="building-the-datasets.html#cb2-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">!</span><span class="fu">c</span>(wdpaid, superficie_km2),</span>
<span id="cb2-22"><a href="building-the-datasets.html#cb2-22" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">stri_enc_toutf8</span>(.x)))</span>
<span id="cb2-23"><a href="building-the-datasets.html#cb2-23" tabindex="-1"></a></span>
<span id="cb2-24"><a href="building-the-datasets.html#cb2-24" tabindex="-1"></a><span class="do">##WDPAID 797 with ID project CZZ3056 corresponds to APAC de Kawawana in Senegal, with no WDPAID (https://kawawana.iccaconsortium.org/) </span></span>
<span id="cb2-25"><a href="building-the-datasets.html#cb2-25" tabindex="-1"></a>data_pa_eva[data_pa_eva<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="st">&quot;797&quot;</span> <span class="sc">&amp;</span> data_pa_eva<span class="sc">$</span>id_projet <span class="sc">==</span> <span class="st">&quot;CZZ3056&quot;</span>,]<span class="sc">$</span>nom_ap <span class="ot">=</span> <span class="st">&quot;APAC de Kawawana&quot;</span></span>
<span id="cb2-26"><a href="building-the-datasets.html#cb2-26" tabindex="-1"></a><span class="co">#Change reported area (https://kawawana.iccaconsortium.org/?p=150) : 10 000 ha or 100 km2</span></span>
<span id="cb2-27"><a href="building-the-datasets.html#cb2-27" tabindex="-1"></a>data_pa_eva[data_pa_eva<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="st">&quot;797&quot;</span> <span class="sc">&amp;</span> data_pa_eva<span class="sc">$</span>id_projet <span class="sc">==</span> <span class="st">&quot;CZZ3056&quot;</span>,]<span class="sc">$</span>superficie_km2 <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb2-28"><a href="building-the-datasets.html#cb2-28" tabindex="-1"></a>data_pa_eva[data_pa_eva<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="st">&quot;797&quot;</span> <span class="sc">&amp;</span> data_pa_eva<span class="sc">$</span>id_projet <span class="sc">==</span> <span class="st">&quot;CZZ3056&quot;</span>,]<span class="sc">$</span>wdpaid <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb2-29"><a href="building-the-datasets.html#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="building-the-datasets.html#cb2-30" tabindex="-1"></a><span class="co">#PAs gathered by agriculture, rural development and biodiversity department (10-08-2023)</span></span>
<span id="cb2-31"><a href="building-the-datasets.html#cb2-31" tabindex="-1"></a>data_pa_arb <span class="ot">=</span> </span>
<span id="cb2-32"><a href="building-the-datasets.html#cb2-32" tabindex="-1"></a>  <span class="co">#read_excel(&quot;data_raw/BDD_ARB_10082023.xlsx&quot;) %&gt;%</span></span>
<span id="cb2-33"><a href="building-the-datasets.html#cb2-33" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readxl<span class="sc">::</span>read_excel,</span>
<span id="cb2-34"><a href="building-the-datasets.html#cb2-34" tabindex="-1"></a>             <span class="at">object =</span> <span class="st">&quot;data_raw/BDD_ARB_10082023.xlsx&quot;</span>,</span>
<span id="cb2-35"><a href="building-the-datasets.html#cb2-35" tabindex="-1"></a>             <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb2-36"><a href="building-the-datasets.html#cb2-36" tabindex="-1"></a>             <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb2-37"><a href="building-the-datasets.html#cb2-37" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-38"><a href="building-the-datasets.html#cb2-38" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-39"><a href="building-the-datasets.html#cb2-39" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id_projet, id_concours, nom_cofinanciers,</span>
<span id="cb2-40"><a href="building-the-datasets.html#cb2-40" tabindex="-1"></a>           nom_de_laire_protegee, id_wdpa, superficie_km2)) <span class="sc">%&gt;%</span></span>
<span id="cb2-41"><a href="building-the-datasets.html#cb2-41" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;cofinanciers&quot;</span> <span class="ot">=</span> <span class="st">&quot;nom_cofinanciers&quot;</span>,</span>
<span id="cb2-42"><a href="building-the-datasets.html#cb2-42" tabindex="-1"></a>         <span class="st">&quot;nom_ap&quot;</span> <span class="ot">=</span> <span class="st">&quot;nom_de_laire_protegee&quot;</span>,</span>
<span id="cb2-43"><a href="building-the-datasets.html#cb2-43" tabindex="-1"></a>         <span class="st">&quot;wdpaid&quot;</span> <span class="ot">=</span> <span class="st">&quot;id_wdpa&quot;</span>,</span>
<span id="cb2-44"><a href="building-the-datasets.html#cb2-44" tabindex="-1"></a>         <span class="st">&quot;superficie_raw&quot;</span> <span class="ot">=</span> <span class="st">&quot;superficie_km2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-45"><a href="building-the-datasets.html#cb2-45" tabindex="-1"></a>  <span class="co">#Create variables:</span></span>
<span id="cb2-46"><a href="building-the-datasets.html#cb2-46" tabindex="-1"></a>  <span class="do">## Replace &quot;NA&quot; by NA values in wdpaid</span></span>
<span id="cb2-47"><a href="building-the-datasets.html#cb2-47" tabindex="-1"></a>  <span class="do">## Check unit of area given reported by ARB</span></span>
<span id="cb2-48"><a href="building-the-datasets.html#cb2-48" tabindex="-1"></a>  <span class="do">## Convert the area reported in km2, controlling for NA values, unreported values (&quot;Non requis (information délivrée par la WDPA)&quot;), values in hectares or km2. Note in some rows, unit must be removed and &quot;,&quot; replaced by &quot;.&quot; for the numeric conversion</span></span>
<span id="cb2-49"><a href="building-the-datasets.html#cb2-49" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wdpaid =</span> <span class="fu">as.numeric</span>(<span class="fu">case_when</span>(wdpaid <span class="sc">==</span> <span class="st">&quot;NA&quot;</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb2-50"><a href="building-the-datasets.html#cb2-50" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> wdpaid)),</span>
<span id="cb2-51"><a href="building-the-datasets.html#cb2-51" tabindex="-1"></a>         <span class="at">date_entree =</span> <span class="st">&quot;2023-08-10&quot;</span>,</span>
<span id="cb2-52"><a href="building-the-datasets.html#cb2-52" tabindex="-1"></a>         <span class="at">auteur_entree =</span> <span class="st">&quot;ARB&quot;</span>,</span>
<span id="cb2-53"><a href="building-the-datasets.html#cb2-53" tabindex="-1"></a>         <span class="at">superficie_unit =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">&quot;km2&quot;</span>, superficie_raw) <span class="sc">~</span> <span class="st">&quot;km2&quot;</span>,</span>
<span id="cb2-54"><a href="building-the-datasets.html#cb2-54" tabindex="-1"></a>                                     <span class="fu">grepl</span>(<span class="st">&quot;ha|Ha&quot;</span>, superficie_raw) <span class="sc">~</span> <span class="st">&quot;ha&quot;</span>,</span>
<span id="cb2-55"><a href="building-the-datasets.html#cb2-55" tabindex="-1"></a>                                     <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;km2&quot;</span>),</span>
<span id="cb2-56"><a href="building-the-datasets.html#cb2-56" tabindex="-1"></a>         <span class="at">superficie_km2 =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">&quot;Non&quot;</span>, superficie_raw) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb2-57"><a href="building-the-datasets.html#cb2-57" tabindex="-1"></a>                                <span class="fu">is.na</span>(superficie_raw) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb2-58"><a href="building-the-datasets.html#cb2-58" tabindex="-1"></a>                                superficie_unit <span class="sc">==</span> <span class="st">&quot;ha&quot;</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="fu">gsub</span>(<span class="st">&quot;ha|Ha&quot;</span>, <span class="st">&quot;&quot;</span>, superficie_raw)))<span class="sc">/</span><span class="fl">1e2</span>,</span>
<span id="cb2-59"><a href="building-the-datasets.html#cb2-59" tabindex="-1"></a>                                superficie_unit <span class="sc">==</span> <span class="st">&quot;km2&quot;</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="fu">gsub</span>(<span class="st">&quot;km2&quot;</span>, <span class="st">&quot;&quot;</span>, superficie_raw))),</span>
<span id="cb2-60"><a href="building-the-datasets.html#cb2-60" tabindex="-1"></a>                                <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(superficie_raw))) <span class="sc">%&gt;%</span></span>
<span id="cb2-61"><a href="building-the-datasets.html#cb2-61" tabindex="-1"></a>  <span class="co"># Change encoding of characters</span></span>
<span id="cb2-62"><a href="building-the-datasets.html#cb2-62" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">!</span><span class="fu">c</span>(wdpaid, superficie_km2),</span>
<span id="cb2-63"><a href="building-the-datasets.html#cb2-63" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">stri_enc_toutf8</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb2-64"><a href="building-the-datasets.html#cb2-64" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;id_concours&quot;</span>, <span class="st">&quot;cofinanciers&quot;</span>, <span class="st">&quot;nom_ap&quot;</span>,</span>
<span id="cb2-65"><a href="building-the-datasets.html#cb2-65" tabindex="-1"></a>           <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;superficie_km2&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="st">&quot;auteur_entree&quot;</span>))</span>
<span id="cb2-66"><a href="building-the-datasets.html#cb2-66" tabindex="-1"></a>  </span>
<span id="cb2-67"><a href="building-the-datasets.html#cb2-67" tabindex="-1"></a><span class="co">#Create a dataset gathering the previous datasets</span></span>
<span id="cb2-68"><a href="building-the-datasets.html#cb2-68" tabindex="-1"></a>data_pa_afd <span class="ot">=</span> <span class="fu">rbind</span>(data_pa_eva, data_pa_arb)</span>
<span id="cb2-69"><a href="building-the-datasets.html#cb2-69" tabindex="-1"></a></span>
<span id="cb2-70"><a href="building-the-datasets.html#cb2-70" tabindex="-1"></a><span class="co">#Finally, writing the dataset in csv file. Careful to the delimiter : &quot;;&quot; used as &quot;,&quot; present in some variables values.</span></span>
<span id="cb2-71"><a href="building-the-datasets.html#cb2-71" tabindex="-1"></a><span class="co"># write_delim(data_pa_afd, &quot;data_raw/BDD_PA_AFD.csv&quot;,</span></span>
<span id="cb2-72"><a href="building-the-datasets.html#cb2-72" tabindex="-1"></a><span class="co">#             delim = &quot;;&quot;,</span></span>
<span id="cb2-73"><a href="building-the-datasets.html#cb2-73" tabindex="-1"></a><span class="co">#             na = &quot;NA&quot;)</span></span>
<span id="cb2-74"><a href="building-the-datasets.html#cb2-74" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_afd,</span></span>
<span id="cb2-75"><a href="building-the-datasets.html#cb2-75" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb2-76"><a href="building-the-datasets.html#cb2-76" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb2-77"><a href="building-the-datasets.html#cb2-77" tabindex="-1"></a><span class="co">#               object = &quot;data_raw/BDD_PA_AFD.csv&quot;,</span></span>
<span id="cb2-78"><a href="building-the-datasets.html#cb2-78" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb2-79"><a href="building-the-datasets.html#cb2-79" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="merge-the-list-of-pas-to-afd-project-information-and-wdpa" class="section level3 hasAnchor" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Merge the list of PAs to AFD project information and WDPA<a href="building-the-datasets.html#merge-the-list-of-pas-to-afd-project-information-and-wdpa" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The list of PAs reported by AFD departments are then merged with AFD internal project information database (so-called “SIOP”) and the World Database on Protected areas.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="building-the-datasets.html#cb3-1" tabindex="-1"></a><span class="co">#Import the list of PAs</span></span>
<span id="cb3-2"><a href="building-the-datasets.html#cb3-2" tabindex="-1"></a>data_pa_afd <span class="ot">=</span> </span>
<span id="cb3-3"><a href="building-the-datasets.html#cb3-3" tabindex="-1"></a>  <span class="co">#read_delim(&quot;data_raw/BDD_PA_AFD.csv&quot;, delim = &quot;;&quot;)</span></span>
<span id="cb3-4"><a href="building-the-datasets.html#cb3-4" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb3-5"><a href="building-the-datasets.html#cb3-5" tabindex="-1"></a>                <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="co">#Careful to the delimiter choice</span></span>
<span id="cb3-6"><a href="building-the-datasets.html#cb3-6" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-7"><a href="building-the-datasets.html#cb3-7" tabindex="-1"></a>                <span class="at">object =</span> <span class="st">&quot;data_raw/BDD_PA_AFD.csv&quot;</span>,</span>
<span id="cb3-8"><a href="building-the-datasets.html#cb3-8" tabindex="-1"></a>                <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb3-9"><a href="building-the-datasets.html#cb3-9" tabindex="-1"></a>                <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-10"><a href="building-the-datasets.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="building-the-datasets.html#cb3-11" tabindex="-1"></a>list_wdpa_afd <span class="ot">=</span> <span class="fu">unique</span>(data_pa_afd<span class="sc">$</span>wdpaid)</span>
<span id="cb3-12"><a href="building-the-datasets.html#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="building-the-datasets.html#cb3-13" tabindex="-1"></a><span class="co">#Import SIOP extract</span></span>
<span id="cb3-14"><a href="building-the-datasets.html#cb3-14" tabindex="-1"></a><span class="do">##A function to transform country names from upper case (SIOP database) to lower cases : FRANCE -&gt; France</span></span>
<span id="cb3-15"><a href="building-the-datasets.html#cb3-15" tabindex="-1"></a>fn_ucfirst <span class="ot">&lt;-</span> <span class="cf">function</span> (str) {</span>
<span id="cb3-16"><a href="building-the-datasets.html#cb3-16" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">toupper</span>(<span class="fu">substring</span>(str, <span class="dv">1</span>, <span class="dv">1</span>)), <span class="fu">tolower</span>(<span class="fu">substring</span>(str, <span class="dv">2</span>)), <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb3-17"><a href="building-the-datasets.html#cb3-17" tabindex="-1"></a>}</span>
<span id="cb3-18"><a href="building-the-datasets.html#cb3-18" tabindex="-1"></a></span>
<span id="cb3-19"><a href="building-the-datasets.html#cb3-19" tabindex="-1"></a>data_siop_pa <span class="ot">=</span> </span>
<span id="cb3-20"><a href="building-the-datasets.html#cb3-20" tabindex="-1"></a>  <span class="co">#read_excel(&quot;data_raw/BO_AP_16082023.xlsx&quot;) %&gt;%</span></span>
<span id="cb3-21"><a href="building-the-datasets.html#cb3-21" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readxl<span class="sc">::</span>read_excel,</span>
<span id="cb3-22"><a href="building-the-datasets.html#cb3-22" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_raw/BO_AP_16082023.xlsx&quot;</span>,</span>
<span id="cb3-23"><a href="building-the-datasets.html#cb3-23" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb3-24"><a href="building-the-datasets.html#cb3-24" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-25"><a href="building-the-datasets.html#cb3-25" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="building-the-datasets.html#cb3-26" tabindex="-1"></a>  <span class="co">#Keep only project IDs corresponding to PAs reported</span></span>
<span id="cb3-27"><a href="building-the-datasets.html#cb3-27" tabindex="-1"></a>  <span class="fu">filter</span>(id_projet <span class="sc">%in%</span> data_pa_afd<span class="sc">$</span>id_projet) <span class="sc">%&gt;%</span></span>
<span id="cb3-28"><a href="building-the-datasets.html#cb3-28" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(id_projet, id_concours,</span>
<span id="cb3-29"><a href="building-the-datasets.html#cb3-29" tabindex="-1"></a>           libelle_court_direction_regionale,</span>
<span id="cb3-30"><a href="building-the-datasets.html#cb3-30" tabindex="-1"></a>           pays_de_realisation, autres_pays_de_realisation,</span>
<span id="cb3-31"><a href="building-the-datasets.html#cb3-31" tabindex="-1"></a>           mt_fin_global_af_d_prevu_devise,</span>
<span id="cb3-32"><a href="building-the-datasets.html#cb3-32" tabindex="-1"></a>           montant_prevu_concours_euro_octroi,</span>
<span id="cb3-33"><a href="building-the-datasets.html#cb3-33" tabindex="-1"></a>           mt_global_projet_prevu_devise,</span>
<span id="cb3-34"><a href="building-the-datasets.html#cb3-34" tabindex="-1"></a>           cofinancier,</span>
<span id="cb3-35"><a href="building-the-datasets.html#cb3-35" tabindex="-1"></a>           mt_part_cofinancier_prevu_euro,</span>
<span id="cb3-36"><a href="building-the-datasets.html#cb3-36" tabindex="-1"></a>           libelle_produit,</span>
<span id="cb3-37"><a href="building-the-datasets.html#cb3-37" tabindex="-1"></a>           date_doctroi_projet, annee_doctroi_projet)) <span class="sc">%&gt;%</span></span>
<span id="cb3-38"><a href="building-the-datasets.html#cb3-38" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;cofinanciers_siop&quot;</span> <span class="ot">=</span> <span class="st">&quot;cofinancier&quot;</span>,</span>
<span id="cb3-39"><a href="building-the-datasets.html#cb3-39" tabindex="-1"></a>         <span class="st">&quot;pays&quot;</span> <span class="ot">=</span> <span class="st">&quot;pays_de_realisation&quot;</span>,</span>
<span id="cb3-40"><a href="building-the-datasets.html#cb3-40" tabindex="-1"></a>         <span class="st">&quot;pays2&quot;</span> <span class="ot">=</span> <span class="st">&quot;autres_pays_de_realisation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-41"><a href="building-the-datasets.html#cb3-41" tabindex="-1"></a>  <span class="co">#Change country (&quot;pays&quot;) name from upper case to lower case : e.g FRANCE -&gt; France </span></span>
<span id="cb3-42"><a href="building-the-datasets.html#cb3-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pays =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(pays) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb3-43"><a href="building-the-datasets.html#cb3-43" tabindex="-1"></a>                         <span class="fu">is.na</span>(pays) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="fu">fn_ucfirst</span>(pays)),</span>
<span id="cb3-44"><a href="building-the-datasets.html#cb3-44" tabindex="-1"></a>         <span class="at">pays2 =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(pays2) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb3-45"><a href="building-the-datasets.html#cb3-45" tabindex="-1"></a>                          <span class="fu">is.na</span>(pays2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> <span class="fu">fn_ucfirst</span>(pays2))) <span class="sc">%&gt;%</span></span>
<span id="cb3-46"><a href="building-the-datasets.html#cb3-46" tabindex="-1"></a>  <span class="co">#Add ISO code from countrycode package, reading &quot;pays&quot; variable</span></span>
<span id="cb3-47"><a href="building-the-datasets.html#cb3-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3_siop =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> pays, </span>
<span id="cb3-48"><a href="building-the-datasets.html#cb3-48" tabindex="-1"></a>                                 <span class="at">origin =</span> <span class="st">&quot;country.name.fr&quot;</span>,</span>
<span id="cb3-49"><a href="building-the-datasets.html#cb3-49" tabindex="-1"></a>                                 <span class="at">destination =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb3-50"><a href="building-the-datasets.html#cb3-50" tabindex="-1"></a>                                 <span class="at">custom_match =</span> <span class="fu">c</span>(<span class="st">&quot;Multi-pays&quot;</span> <span class="ot">=</span> <span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb3-51"><a href="building-the-datasets.html#cb3-51" tabindex="-1"></a>                                                  <span class="st">&quot;Multi-Pays&quot;</span> <span class="ot">=</span> <span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb3-52"><a href="building-the-datasets.html#cb3-52" tabindex="-1"></a>                                                  <span class="st">&quot;Inde&quot;</span> <span class="ot">=</span> <span class="st">&quot;IND&quot;</span>)),</span>
<span id="cb3-53"><a href="building-the-datasets.html#cb3-53" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;pays&quot;</span>)</span>
<span id="cb3-54"><a href="building-the-datasets.html#cb3-54" tabindex="-1"></a>  </span>
<span id="cb3-55"><a href="building-the-datasets.html#cb3-55" tabindex="-1"></a><span class="co">#Import WDPA data</span></span>
<span id="cb3-56"><a href="building-the-datasets.html#cb3-56" tabindex="-1"></a><span class="do">##Download the latest version of the WDPA and write to the storage, if necessary</span></span>
<span id="cb3-57"><a href="building-the-datasets.html#cb3-57" tabindex="-1"></a><span class="co"># data_wdpa = wdpa_fetch(x = &quot;global&quot;, wait = TRUE, download_dir = &quot;data_raw&quot;,</span></span>
<span id="cb3-58"><a href="building-the-datasets.html#cb3-58" tabindex="-1"></a><span class="co">#                        page_wait = 2, verbose = TRUE)</span></span>
<span id="cb3-59"><a href="building-the-datasets.html#cb3-59" tabindex="-1"></a><span class="co"># st_write(wdpa,</span></span>
<span id="cb3-60"><a href="building-the-datasets.html#cb3-60" tabindex="-1"></a><span class="co">#          dsn = &quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;,</span></span>
<span id="cb3-61"><a href="building-the-datasets.html#cb3-61" tabindex="-1"></a><span class="co">#          delete_dsn = TRUE)</span></span>
<span id="cb3-62"><a href="building-the-datasets.html#cb3-62" tabindex="-1"></a></span>
<span id="cb3-63"><a href="building-the-datasets.html#cb3-63" tabindex="-1"></a><span class="do">##Load the WDPA from the storage</span></span>
<span id="cb3-64"><a href="building-the-datasets.html#cb3-64" tabindex="-1"></a>data_wdpa <span class="ot">=</span> </span>
<span id="cb3-65"><a href="building-the-datasets.html#cb3-65" tabindex="-1"></a>  <span class="co">#st_read(&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;) %&gt;%</span></span>
<span id="cb3-66"><a href="building-the-datasets.html#cb3-66" tabindex="-1"></a>  <span class="fu">s3read_using</span>(sf<span class="sc">::</span>st_read,</span>
<span id="cb3-67"><a href="building-the-datasets.html#cb3-67" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;</span>,</span>
<span id="cb3-68"><a href="building-the-datasets.html#cb3-68" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb3-69"><a href="building-the-datasets.html#cb3-69" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-70"><a href="building-the-datasets.html#cb3-70" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-71"><a href="building-the-datasets.html#cb3-71" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-72"><a href="building-the-datasets.html#cb3-72" tabindex="-1"></a>  <span class="fu">filter</span>(wdpaid <span class="sc">%in%</span> list_wdpa_afd) <span class="sc">%&gt;%</span></span>
<span id="cb3-73"><a href="building-the-datasets.html#cb3-73" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;iso3_wdpa&quot;</span> <span class="ot">=</span> <span class="st">&quot;iso3&quot;</span>)</span>
<span id="cb3-74"><a href="building-the-datasets.html#cb3-74" tabindex="-1"></a></span>
<span id="cb3-75"><a href="building-the-datasets.html#cb3-75" tabindex="-1"></a><span class="co">#Merge the datasets</span></span>
<span id="cb3-76"><a href="building-the-datasets.html#cb3-76" tabindex="-1"></a><span class="do">##A first raw dataset that will be edited to complete ISO3 code of countries.</span></span>
<span id="cb3-77"><a href="building-the-datasets.html#cb3-77" tabindex="-1"></a>data_raw1 <span class="ot">=</span> data_pa_afd <span class="sc">%&gt;%</span></span>
<span id="cb3-78"><a href="building-the-datasets.html#cb3-78" tabindex="-1"></a>  <span class="co">#Add information from WDPA to PAs funded and with WDPAID</span></span>
<span id="cb3-79"><a href="building-the-datasets.html#cb3-79" tabindex="-1"></a>  <span class="fu">left_join</span>(data_wdpa, <span class="at">by =</span> <span class="st">&quot;wdpaid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-80"><a href="building-the-datasets.html#cb3-80" tabindex="-1"></a>  <span class="co">#Add information from SIOP</span></span>
<span id="cb3-81"><a href="building-the-datasets.html#cb3-81" tabindex="-1"></a>  <span class="fu">left_join</span>(data_siop_pa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;id_concours&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-82"><a href="building-the-datasets.html#cb3-82" tabindex="-1"></a>  <span class="co">#Keep only one ISO information : priority WDPA, then SIOP if NA value</span></span>
<span id="cb3-83"><a href="building-the-datasets.html#cb3-83" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> iso3_wdpa,</span>
<span id="cb3-84"><a href="building-the-datasets.html#cb3-84" tabindex="-1"></a>         <span class="at">iso3 =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(iso3) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> iso3_siop,</span>
<span id="cb3-85"><a href="building-the-datasets.html#cb3-85" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> iso3),</span>
<span id="cb3-86"><a href="building-the-datasets.html#cb3-86" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;iso3_wdpa&quot;</span>)</span>
<span id="cb3-87"><a href="building-the-datasets.html#cb3-87" tabindex="-1"></a></span>
<span id="cb3-88"><a href="building-the-datasets.html#cb3-88" tabindex="-1"></a><span class="co">#Manually add iso3 for some PAs where names are known but assigned &quot;ZZ&quot;. </span></span>
<span id="cb3-89"><a href="building-the-datasets.html#cb3-89" tabindex="-1"></a><span class="co">#The nom_ap is searched on google (&quot;nom_ap protected area&quot;) and iso3 completed if</span></span>
<span id="cb3-90"><a href="building-the-datasets.html#cb3-90" tabindex="-1"></a><span class="co">#information found</span></span>
<span id="cb3-91"><a href="building-the-datasets.html#cb3-91" tabindex="-1"></a>data_raw2 <span class="ot">=</span> data_raw1 <span class="sc">%&gt;%</span></span>
<span id="cb3-92"><a href="building-the-datasets.html#cb3-92" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> <span class="fu">case_when</span>(<span class="fu">grepl</span>(<span class="st">&quot;Yambé-Diahoué&quot;</span>, nom_ap) <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-93"><a href="building-the-datasets.html#cb3-93" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Aitutaki (3 Ra&#39;ui)&quot;</span> <span class="sc">~</span> <span class="st">&quot;COK&quot;</span>,</span>
<span id="cb3-94"><a href="building-the-datasets.html#cb3-94" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Dohimen (Hienghène)&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-95"><a href="building-the-datasets.html#cb3-95" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Kerehira&quot;</span> <span class="sc">~</span> <span class="st">&quot;SLB&quot;</span>,</span>
<span id="cb3-96"><a href="building-the-datasets.html#cb3-96" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Kiribati&quot;</span> <span class="sc">~</span> <span class="st">&quot;KIR&quot;</span>,</span>
<span id="cb3-97"><a href="building-the-datasets.html#cb3-97" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Marou&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-98"><a href="building-the-datasets.html#cb3-98" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Mistery Island (Aneityum)&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-99"><a href="building-the-datasets.html#cb3-99" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Ngula Pele&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-100"><a href="building-the-datasets.html#cb3-100" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Paonangisu&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-101"><a href="building-the-datasets.html#cb3-101" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Parc provincial Yeega-Hienga (Hienghène)&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-102"><a href="building-the-datasets.html#cb3-102" tabindex="-1"></a>                          <span class="fu">grepl</span>(<span class="st">&quot;Rarotonga&quot;</span>, nom_ap) <span class="sc">~</span> <span class="st">&quot;COK&quot;</span>,</span>
<span id="cb3-103"><a href="building-the-datasets.html#cb3-103" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Saama&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-104"><a href="building-the-datasets.html#cb3-104" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Siviri&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-105"><a href="building-the-datasets.html#cb3-105" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Dohimen&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-106"><a href="building-the-datasets.html#cb3-106" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Hienghène&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-107"><a href="building-the-datasets.html#cb3-107" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Hyabe Lé Jao&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-108"><a href="building-the-datasets.html#cb3-108" tabindex="-1"></a>                          <span class="fu">grepl</span>(<span class="st">&quot;Pouébo&quot;</span>, nom_ap) <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-109"><a href="building-the-datasets.html#cb3-109" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Tasi Vanua&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-110"><a href="building-the-datasets.html#cb3-110" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Yeega&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb3-111"><a href="building-the-datasets.html#cb3-111" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Mangareva&quot;</span> <span class="sc">~</span> <span class="st">&quot;PYF&quot;</span>,</span>
<span id="cb3-112"><a href="building-the-datasets.html#cb3-112" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Rakiraiki&quot;</span> <span class="sc">~</span> <span class="st">&quot;FJI&quot;</span>,</span>
<span id="cb3-113"><a href="building-the-datasets.html#cb3-113" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Tasi Vanua&quot;</span> <span class="sc">~</span> <span class="st">&quot;VUT&quot;</span>,</span>
<span id="cb3-114"><a href="building-the-datasets.html#cb3-114" tabindex="-1"></a>                          nom_ap <span class="sc">==</span> <span class="st">&quot;Parc National Pongara&quot;</span> <span class="sc">~</span> <span class="st">&quot;GAB&quot;</span>,</span>
<span id="cb3-115"><a href="building-the-datasets.html#cb3-115" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span> iso3))</span>
<span id="cb3-116"><a href="building-the-datasets.html#cb3-116" tabindex="-1"></a></span>
<span id="cb3-117"><a href="building-the-datasets.html#cb3-117" tabindex="-1"></a><span class="co">#Save this raw dataset</span></span>
<span id="cb3-118"><a href="building-the-datasets.html#cb3-118" tabindex="-1"></a><span class="co"># s3write_using(x = data_raw2,</span></span>
<span id="cb3-119"><a href="building-the-datasets.html#cb3-119" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb3-120"><a href="building-the-datasets.html#cb3-120" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb3-121"><a href="building-the-datasets.html#cb3-121" tabindex="-1"></a><span class="co">#               object = &quot;data_raw/BDD_PA_raw.csv&quot;,</span></span>
<span id="cb3-122"><a href="building-the-datasets.html#cb3-122" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb3-123"><a href="building-the-datasets.html#cb3-123" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="correct-errors" class="section level3 hasAnchor" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Correct errors<a href="building-the-datasets.html#correct-errors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here errors in the reported information are corrected manually. Note the SIOP can be updated and the error not present anymore. The errors that do not need to be corrected anymore are kept in comment.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="building-the-datasets.html#cb4-1" tabindex="-1"></a><span class="co">#Loading the raw dataset</span></span>
<span id="cb4-2"><a href="building-the-datasets.html#cb4-2" tabindex="-1"></a>data_raw <span class="ot">=</span> </span>
<span id="cb4-3"><a href="building-the-datasets.html#cb4-3" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_PA_raw.csv&quot;)</span></span>
<span id="cb4-4"><a href="building-the-datasets.html#cb4-4" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb4-5"><a href="building-the-datasets.html#cb4-5" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb4-6"><a href="building-the-datasets.html#cb4-6" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-7"><a href="building-the-datasets.html#cb4-7" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_raw/BDD_PA_raw.csv&quot;</span>,</span>
<span id="cb4-8"><a href="building-the-datasets.html#cb4-8" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb4-9"><a href="building-the-datasets.html#cb4-9" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb4-10"><a href="building-the-datasets.html#cb4-10" tabindex="-1"></a>data_raw_corr <span class="ot">=</span> data_raw</span>
<span id="cb4-11"><a href="building-the-datasets.html#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="building-the-datasets.html#cb4-12" tabindex="-1"></a><span class="co">#Modify errors in the dataset</span></span>
<span id="cb4-13"><a href="building-the-datasets.html#cb4-13" tabindex="-1"></a><span class="do">##4223, 4224, 4226, 4228, 4229 : all in PS-N.Caledonie</span></span>
<span id="cb4-14"><a href="building-the-datasets.html#cb4-14" tabindex="-1"></a><span class="do">## -&gt; not relevant with new SIOP extract</span></span>
<span id="cb4-15"><a href="building-the-datasets.html#cb4-15" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;4223&quot;, &quot;4224&quot;, &quot;4226&quot;, &quot;4228&quot;, &quot;4229&quot;) &amp; data_raw_corr$pays == &quot;Fidji&quot;,]$pays = &quot;P-S N.Caléd&quot;</span></span>
<span id="cb4-16"><a href="building-the-datasets.html#cb4-16" tabindex="-1"></a><span class="do">##305082 : Vanuatu instead of Fidji</span></span>
<span id="cb4-17"><a href="building-the-datasets.html#cb4-17" tabindex="-1"></a><span class="co"># -&gt; not relevant with new SIOP extract</span></span>
<span id="cb4-18"><a href="building-the-datasets.html#cb4-18" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;305082&quot;) &amp; data_raw_corr$pays == &quot;Fidji&quot;,]$pays = &quot;Vanuatu&quot;</span></span>
<span id="cb4-19"><a href="building-the-datasets.html#cb4-19" tabindex="-1"></a><span class="do">##31459 : Central African Republic instead of Cameroon. </span></span>
<span id="cb4-20"><a href="building-the-datasets.html#cb4-20" tabindex="-1"></a><span class="co"># -&gt; not relevant with new SIOP extract</span></span>
<span id="cb4-21"><a href="building-the-datasets.html#cb4-21" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;31459&quot;) &amp; data_raw_corr$pays == &quot;Cameroun&quot;,]$pays = &quot;Centrafrique&quot;</span></span>
<span id="cb4-22"><a href="building-the-datasets.html#cb4-22" tabindex="-1"></a><span class="do">##Rio Grande de Buba : Guinee Bissau instead of Gambia</span></span>
<span id="cb4-23"><a href="building-the-datasets.html#cb4-23" tabindex="-1"></a><span class="co"># -&gt; not relevant with new SIOP extract</span></span>
<span id="cb4-24"><a href="building-the-datasets.html#cb4-24" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;317051&quot;) &amp; data_raw_corr$pays == &quot;Gambie&quot;,]$pays = &quot;Guinee-Bissau&quot;</span></span>
<span id="cb4-25"><a href="building-the-datasets.html#cb4-25" tabindex="-1"></a><span class="do">##WDPAID 20267 : in GNQ instead of GIN</span></span>
<span id="cb4-26"><a href="building-the-datasets.html#cb4-26" tabindex="-1"></a><span class="co"># -&gt; not relevant with new SIOP extract</span></span>
<span id="cb4-27"><a href="building-the-datasets.html#cb4-27" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;20267&quot;) ,]$pays = &quot;Guinee-Equatoriale&quot;</span></span>
<span id="cb4-28"><a href="building-the-datasets.html#cb4-28" tabindex="-1"></a><span class="co"># data_raw_corr[data_raw_corr$wdpaid %in% c(&quot;20267&quot;) ,]$iso3 = &quot;GNQ&quot;</span></span>
<span id="cb4-29"><a href="building-the-datasets.html#cb4-29" tabindex="-1"></a></span>
<span id="cb4-30"><a href="building-the-datasets.html#cb4-30" tabindex="-1"></a><span class="co"># s3write_using(x = data_raw_corr,</span></span>
<span id="cb4-31"><a href="building-the-datasets.html#cb4-31" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb4-32"><a href="building-the-datasets.html#cb4-32" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb4-33"><a href="building-the-datasets.html#cb4-33" tabindex="-1"></a><span class="co">#               object = &quot;data_raw/BDD_PA_raw_corr.csv&quot;,</span></span>
<span id="cb4-34"><a href="building-the-datasets.html#cb4-34" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb4-35"><a href="building-the-datasets.html#cb4-35" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="tidy-the-datasets" class="section level3 hasAnchor" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Tidy the datasets<a href="building-the-datasets.html#tidy-the-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>After manual correction, a tidy dataset is built. Relevant variables are selected, region/sub-region/country names are added from ISO3 codes and countrycode package, description of IUCN categories added. Some variables are renamed in English.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="building-the-datasets.html#cb5-1" tabindex="-1"></a><span class="co">#Import raw dataset corrected from report errors</span></span>
<span id="cb5-2"><a href="building-the-datasets.html#cb5-2" tabindex="-1"></a>data_raw_corr <span class="ot">=</span> </span>
<span id="cb5-3"><a href="building-the-datasets.html#cb5-3" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_PA_raw_corr.csv&quot;)</span></span>
<span id="cb5-4"><a href="building-the-datasets.html#cb5-4" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb5-5"><a href="building-the-datasets.html#cb5-5" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb5-6"><a href="building-the-datasets.html#cb5-6" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-7"><a href="building-the-datasets.html#cb5-7" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_raw/BDD_PA_raw_corr.csv&quot;</span>,</span>
<span id="cb5-8"><a href="building-the-datasets.html#cb5-8" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb5-9"><a href="building-the-datasets.html#cb5-9" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb5-10"><a href="building-the-datasets.html#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="building-the-datasets.html#cb5-11" tabindex="-1"></a><span class="co">#Build the tidy dataset</span></span>
<span id="cb5-12"><a href="building-the-datasets.html#cb5-12" tabindex="-1"></a>data_tidy <span class="ot">=</span> data_raw_corr <span class="sc">%&gt;%</span></span>
<span id="cb5-13"><a href="building-the-datasets.html#cb5-13" tabindex="-1"></a>  <span class="co">#Select relevant variables</span></span>
<span id="cb5-14"><a href="building-the-datasets.html#cb5-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(libelle_court_direction_regionale, pays, pays2, parent_iso3, iso3,</span>
<span id="cb5-15"><a href="building-the-datasets.html#cb5-15" tabindex="-1"></a>           id_projet, id_concours, nom_ap, wdpaid, wdpa_pid, </span>
<span id="cb5-16"><a href="building-the-datasets.html#cb5-16" tabindex="-1"></a>           date_doctroi_projet, annee_doctroi_projet, status, status_yr,</span>
<span id="cb5-17"><a href="building-the-datasets.html#cb5-17" tabindex="-1"></a>           iucn_cat, marine, superficie_km2, rep_m_area, rep_area,</span>
<span id="cb5-18"><a href="building-the-datasets.html#cb5-18" tabindex="-1"></a>           gov_type, own_type,</span>
<span id="cb5-19"><a href="building-the-datasets.html#cb5-19" tabindex="-1"></a>           cofinanciers, cofinanciers_siop,</span>
<span id="cb5-20"><a href="building-the-datasets.html#cb5-20" tabindex="-1"></a>           mt_fin_global_af_d_prevu_devise,</span>
<span id="cb5-21"><a href="building-the-datasets.html#cb5-21" tabindex="-1"></a>           montant_prevu_concours_euro_octroi,</span>
<span id="cb5-22"><a href="building-the-datasets.html#cb5-22" tabindex="-1"></a>           mt_global_projet_prevu_devise,</span>
<span id="cb5-23"><a href="building-the-datasets.html#cb5-23" tabindex="-1"></a>           mt_part_cofinancier_prevu_euro,</span>
<span id="cb5-24"><a href="building-the-datasets.html#cb5-24" tabindex="-1"></a>           libelle_produit,</span>
<span id="cb5-25"><a href="building-the-datasets.html#cb5-25" tabindex="-1"></a>           date_entree, auteur_entree)) <span class="sc">%&gt;%</span></span>
<span id="cb5-26"><a href="building-the-datasets.html#cb5-26" tabindex="-1"></a>    <span class="co">#Create dummy variables for main investors</span></span>
<span id="cb5-27"><a href="building-the-datasets.html#cb5-27" tabindex="-1"></a>  <span class="co">#AFD is always funder, so no need of a dummy. </span></span>
<span id="cb5-28"><a href="building-the-datasets.html#cb5-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kfw_bin =</span> <span class="fu">grepl</span>(<span class="st">&quot;KFW|kfw|KfW&quot;</span>, cofinanciers),</span>
<span id="cb5-29"><a href="building-the-datasets.html#cb5-29" tabindex="-1"></a>         <span class="at">ffem_bin =</span> <span class="fu">grepl</span>(<span class="st">&quot;ffem|FFEM&quot;</span>, cofinanciers),</span>
<span id="cb5-30"><a href="building-the-datasets.html#cb5-30" tabindex="-1"></a>         <span class="at">cof_bin =</span> <span class="fu">is.na</span>(cofinanciers) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="sc">!</span>(cofinanciers <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;AFD&quot;</span>, <span class="st">&quot;afd&quot;</span>)),</span>
<span id="cb5-31"><a href="building-the-datasets.html#cb5-31" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;cofinanciers&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-32"><a href="building-the-datasets.html#cb5-32" tabindex="-1"></a>  <span class="co">#Create an area variable combining AFD and WDPA information. Priority given to WDPA, then AFD if unknown</span></span>
<span id="cb5-33"><a href="building-the-datasets.html#cb5-33" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;area_afd_km2&quot;</span> <span class="ot">=</span> <span class="st">&quot;superficie_km2&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-34"><a href="building-the-datasets.html#cb5-34" tabindex="-1"></a>  <span class="co">#If both are not NA and different, take rep_area</span></span>
<span id="cb5-35"><a href="building-the-datasets.html#cb5-35" tabindex="-1"></a>  <span class="co">#If both are equal, take rep_area</span></span>
<span id="cb5-36"><a href="building-the-datasets.html#cb5-36" tabindex="-1"></a>  <span class="co">#if one is NA, take the other</span></span>
<span id="cb5-37"><a href="building-the-datasets.html#cb5-37" tabindex="-1"></a>  <span class="co">#If both NA, set NA</span></span>
<span id="cb5-38"><a href="building-the-datasets.html#cb5-38" tabindex="-1"></a>  <span class="co">#If rep_area = 0 and area_afd_km2 != 0 then set area_afd_km2</span></span>
<span id="cb5-39"><a href="building-the-datasets.html#cb5-39" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_km2 =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(rep_area) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> area_afd_km2 <span class="sc">==</span> rep_area <span class="sc">~</span> rep_area,</span>
<span id="cb5-40"><a href="building-the-datasets.html#cb5-40" tabindex="-1"></a>                              <span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(rep_area) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> area_afd_km2 <span class="sc">!=</span> rep_area <span class="sc">~</span> rep_area,</span>
<span id="cb5-41"><a href="building-the-datasets.html#cb5-41" tabindex="-1"></a>                              <span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(rep_area) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">~</span> rep_area,</span>
<span id="cb5-42"><a href="building-the-datasets.html#cb5-42" tabindex="-1"></a>                              <span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(rep_area) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> area_afd_km2,</span>
<span id="cb5-43"><a href="building-the-datasets.html#cb5-43" tabindex="-1"></a>                              <span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(rep_area) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb5-44"><a href="building-the-datasets.html#cb5-44" tabindex="-1"></a>                              rep_area <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> area_afd_km2 <span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">~</span> area_afd_km2</span>
<span id="cb5-45"><a href="building-the-datasets.html#cb5-45" tabindex="-1"></a>                              ),</span>
<span id="cb5-46"><a href="building-the-datasets.html#cb5-46" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;rep_area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-47"><a href="building-the-datasets.html#cb5-47" tabindex="-1"></a>    <span class="co">#Some entries in &quot;pays&quot; are French department, DROM-COM, &quot;Ocean Indien&quot; or   </span></span>
<span id="cb5-48"><a href="building-the-datasets.html#cb5-48" tabindex="-1"></a>  <span class="co">#&quot;Multi-Pays&quot;.</span></span>
<span id="cb5-49"><a href="building-the-datasets.html#cb5-49" tabindex="-1"></a>  <span class="co">#French related : the ISO3 code </span></span>
<span id="cb5-50"><a href="building-the-datasets.html#cb5-50" tabindex="-1"></a>  <span class="co">#Ocen Indien let NA value, Muti-pays set to ZZ as in the SIOP dataset</span></span>
<span id="cb5-51"><a href="building-the-datasets.html#cb5-51" tabindex="-1"></a>  <span class="co">#Nouvelle-Calédonie is divided in two provinces : north and south. This subdivision is irrelevant in our analysis so we keep only &quot;Nouvelle Caledonie&quot;</span></span>
<span id="cb5-52"><a href="building-the-datasets.html#cb5-52" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-53"><a href="building-the-datasets.html#cb5-53" tabindex="-1"></a>    pays <span class="sc">==</span> <span class="st">&quot;Mayotte&quot;</span> <span class="sc">~</span> <span class="st">&quot;MYT&quot;</span>,</span>
<span id="cb5-54"><a href="building-the-datasets.html#cb5-54" tabindex="-1"></a>    pays <span class="sc">==</span> <span class="st">&quot;Nouvelle-Caledonie&quot;</span> <span class="sc">~</span> <span class="st">&quot;NCL&quot;</span>,</span>
<span id="cb5-55"><a href="building-the-datasets.html#cb5-55" tabindex="-1"></a>    pays <span class="sc">==</span> <span class="st">&quot;Polynesie Francaise&quot;</span> <span class="sc">~</span> <span class="st">&quot;PYF&quot;</span>,</span>
<span id="cb5-56"><a href="building-the-datasets.html#cb5-56" tabindex="-1"></a>    <span class="fu">is.na</span>(iso3) <span class="sc">&amp;</span> pays <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Multi-Pays&quot;</span>, <span class="st">&quot;Multi-pays&quot;</span>, <span class="st">&quot;Ocean Indien&quot;</span>) <span class="sc">~</span> <span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb5-57"><a href="building-the-datasets.html#cb5-57" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> iso3)) <span class="sc">%&gt;%</span></span>
<span id="cb5-58"><a href="building-the-datasets.html#cb5-58" tabindex="-1"></a>  <span class="co">#Add region, sub-region and country names from the ISO3 country code</span></span>
<span id="cb5-59"><a href="building-the-datasets.html#cb5-59" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb5-60"><a href="building-the-datasets.html#cb5-60" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb5-61"><a href="building-the-datasets.html#cb5-61" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.region.name&quot;</span>,</span>
<span id="cb5-62"><a href="building-the-datasets.html#cb5-62" tabindex="-1"></a>                              <span class="at">custom_match =</span> <span class="fu">c</span>(<span class="st">&quot;COG;CMR;CAF&quot;</span> <span class="ot">=</span> <span class="st">&quot;Africa&quot;</span>,</span>
<span id="cb5-63"><a href="building-the-datasets.html#cb5-63" tabindex="-1"></a>                                               <span class="st">&quot;ZZ&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)),</span>
<span id="cb5-64"><a href="building-the-datasets.html#cb5-64" tabindex="-1"></a>         <span class="at">sub_region =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb5-65"><a href="building-the-datasets.html#cb5-65" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb5-66"><a href="building-the-datasets.html#cb5-66" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.regionsub.name&quot;</span>,</span>
<span id="cb5-67"><a href="building-the-datasets.html#cb5-67" tabindex="-1"></a>                              <span class="at">custom_match =</span> <span class="fu">c</span>(<span class="st">&quot;COG;CMR;CAF&quot;</span> <span class="ot">=</span> <span class="st">&quot;Sub-Saharan Africa&quot;</span>,</span>
<span id="cb5-68"><a href="building-the-datasets.html#cb5-68" tabindex="-1"></a>                                               <span class="st">&quot;ZZ&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)),</span>
<span id="cb5-69"><a href="building-the-datasets.html#cb5-69" tabindex="-1"></a>         <span class="at">country_en =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb5-70"><a href="building-the-datasets.html#cb5-70" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb5-71"><a href="building-the-datasets.html#cb5-71" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.en&quot;</span>,</span>
<span id="cb5-72"><a href="building-the-datasets.html#cb5-72" tabindex="-1"></a>                              <span class="at">custom_match =</span> <span class="fu">c</span>(<span class="st">&quot;PYF&quot;</span> <span class="ot">=</span> <span class="st">&quot;French Polynesia&quot;</span>,</span>
<span id="cb5-73"><a href="building-the-datasets.html#cb5-73" tabindex="-1"></a>                                               <span class="st">&quot;NCL&quot;</span> <span class="ot">=</span> <span class="st">&quot;New Caledonia&quot;</span>,</span>
<span id="cb5-74"><a href="building-the-datasets.html#cb5-74" tabindex="-1"></a>                                               <span class="st">&quot;MYT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Mayotte&quot;</span>,</span>
<span id="cb5-75"><a href="building-the-datasets.html#cb5-75" tabindex="-1"></a>                                               <span class="st">&quot;COK&quot;</span> <span class="ot">=</span> <span class="st">&quot;Cook Islands&quot;</span>,</span>
<span id="cb5-76"><a href="building-the-datasets.html#cb5-76" tabindex="-1"></a>                                               <span class="st">&quot;ZZ&quot;</span> <span class="ot">=</span> <span class="st">&quot;Multi-countries&quot;</span>,</span>
<span id="cb5-77"><a href="building-the-datasets.html#cb5-77" tabindex="-1"></a>                                               <span class="st">&quot;COG;CMR;CAF&quot;</span> <span class="ot">=</span> <span class="st">&quot;Multi-countries&quot;</span>)),</span>
<span id="cb5-78"><a href="building-the-datasets.html#cb5-78" tabindex="-1"></a>         <span class="at">country_fr =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb5-79"><a href="building-the-datasets.html#cb5-79" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb5-80"><a href="building-the-datasets.html#cb5-80" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.fr&quot;</span>,</span>
<span id="cb5-81"><a href="building-the-datasets.html#cb5-81" tabindex="-1"></a>                              <span class="at">custom_match =</span> <span class="fu">c</span>(<span class="st">&quot;PYF&quot;</span> <span class="ot">=</span> <span class="st">&quot;Polynésie Française&quot;</span>,</span>
<span id="cb5-82"><a href="building-the-datasets.html#cb5-82" tabindex="-1"></a>                                               <span class="st">&quot;NCL&quot;</span> <span class="ot">=</span> <span class="st">&quot;Nouvelle-Calédonie&quot;</span>,</span>
<span id="cb5-83"><a href="building-the-datasets.html#cb5-83" tabindex="-1"></a>                                               <span class="st">&quot;MYT&quot;</span> <span class="ot">=</span> <span class="st">&quot;Mayotte&quot;</span>,</span>
<span id="cb5-84"><a href="building-the-datasets.html#cb5-84" tabindex="-1"></a>                                               <span class="st">&quot;COK&quot;</span> <span class="ot">=</span> <span class="st">&quot;Iles Cook&quot;</span>,</span>
<span id="cb5-85"><a href="building-the-datasets.html#cb5-85" tabindex="-1"></a>                                               <span class="st">&quot;ZZ&quot;</span> <span class="ot">=</span> <span class="st">&quot;Multi-pays&quot;</span>,</span>
<span id="cb5-86"><a href="building-the-datasets.html#cb5-86" tabindex="-1"></a>                                               <span class="st">&quot;COG;CMR;CAF&quot;</span> <span class="ot">=</span> <span class="st">&quot;Multi-pays&quot;</span>)),</span>
<span id="cb5-87"><a href="building-the-datasets.html#cb5-87" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-88"><a href="building-the-datasets.html#cb5-88" tabindex="-1"></a><span class="co">#Change transboundary iso3 to ZZ (multi-countries)</span></span>
<span id="cb5-89"><a href="building-the-datasets.html#cb5-89" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> <span class="fu">case_when</span>(iso3 <span class="sc">==</span> <span class="st">&quot;COG;CMR;CAF&quot;</span> <span class="sc">~</span><span class="st">&quot;ZZ&quot;</span>,</span>
<span id="cb5-90"><a href="building-the-datasets.html#cb5-90" tabindex="-1"></a>                          <span class="cn">TRUE</span> <span class="sc">~</span>iso3)) <span class="sc">%&gt;%</span></span>
<span id="cb5-91"><a href="building-the-datasets.html#cb5-91" tabindex="-1"></a>    <span class="co">#Some PAs have iso &quot;ZZ&quot; (multi-countries) by funded by Dr Ocean Pacifique. The region is assigned to Oceania</span></span>
<span id="cb5-92"><a href="building-the-datasets.html#cb5-92" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(region <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> libelle_court_direction_regionale <span class="sc">==</span> <span class="st">&quot;DR OCEAN PACIFIQUE&quot;</span> <span class="sc">~</span> <span class="st">&quot;Oceania&quot;</span>,</span>
<span id="cb5-93"><a href="building-the-datasets.html#cb5-93" tabindex="-1"></a>                              region <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">&quot;sahel|guinee|africa&quot;</span>, libelle_court_direction_regionale, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Africa&quot;</span>,</span>
<span id="cb5-94"><a href="building-the-datasets.html#cb5-94" tabindex="-1"></a>                              region <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">&quot;chine|asie&quot;</span>, libelle_court_direction_regionale, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;Asia&quot;</span>,</span>
<span id="cb5-95"><a href="building-the-datasets.html#cb5-95" tabindex="-1"></a>                              region <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">&quot;amerique&quot;</span>, libelle_court_direction_regionale, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>) <span class="sc">~</span> <span class="st">&quot;America&quot;</span>,</span>
<span id="cb5-96"><a href="building-the-datasets.html#cb5-96" tabindex="-1"></a>                              region <span class="sc">==</span> <span class="st">&quot;&quot;</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb5-97"><a href="building-the-datasets.html#cb5-97" tabindex="-1"></a>                            <span class="cn">TRUE</span> <span class="sc">~</span> region)) <span class="sc">%&gt;%</span></span>
<span id="cb5-98"><a href="building-the-datasets.html#cb5-98" tabindex="-1"></a>  <span class="co">#Add the description of IUCN from its category &#39;in French and English)</span></span>
<span id="cb5-99"><a href="building-the-datasets.html#cb5-99" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iucn_des_fr =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-100"><a href="building-the-datasets.html#cb5-100" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Réserve naturelle intégrale&quot;</span>,</span>
<span id="cb5-101"><a href="building-the-datasets.html#cb5-101" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Zone de nature sauvage&quot;</span>,</span>
<span id="cb5-102"><a href="building-the-datasets.html#cb5-102" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;Parc national&quot;</span>, </span>
<span id="cb5-103"><a href="building-the-datasets.html#cb5-103" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Monument naturel&quot;</span>,</span>
<span id="cb5-104"><a href="building-the-datasets.html#cb5-104" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. des habitats/espèces&quot;</span>,</span>
<span id="cb5-105"><a href="building-the-datasets.html#cb5-105" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Paysage protégé&quot;</span>,</span>
<span id="cb5-106"><a href="building-the-datasets.html#cb5-106" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. de ress. protégées&quot;</span>,</span>
<span id="cb5-107"><a href="building-the-datasets.html#cb5-107" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb5-108"><a href="building-the-datasets.html#cb5-108" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb5-109"><a href="building-the-datasets.html#cb5-109" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb5-110"><a href="building-the-datasets.html#cb5-110" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Non référencée&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb5-111"><a href="building-the-datasets.html#cb5-111" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">iucn_des_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-112"><a href="building-the-datasets.html#cb5-112" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Strict nature reserve&quot;</span>,</span>
<span id="cb5-113"><a href="building-the-datasets.html#cb5-113" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Wilderness area&quot;</span>,</span>
<span id="cb5-114"><a href="building-the-datasets.html#cb5-114" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;National park&quot;</span>,</span>
<span id="cb5-115"><a href="building-the-datasets.html#cb5-115" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Natural monument or feature&quot;</span>,</span>
<span id="cb5-116"><a href="building-the-datasets.html#cb5-116" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot; Habitat or species management area&quot;</span>,</span>
<span id="cb5-117"><a href="building-the-datasets.html#cb5-117" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected landscape or seascape&quot;</span>,</span>
<span id="cb5-118"><a href="building-the-datasets.html#cb5-118" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected area with sust. use of nat. res.&quot;</span>,</span>
<span id="cb5-119"><a href="building-the-datasets.html#cb5-119" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb5-120"><a href="building-the-datasets.html#cb5-120" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb5-121"><a href="building-the-datasets.html#cb5-121" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb5-122"><a href="building-the-datasets.html#cb5-122" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Not referenced&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb5-123"><a href="building-the-datasets.html#cb5-123" tabindex="-1"></a>    <span class="co">#Modify class of some variables</span></span>
<span id="cb5-124"><a href="building-the-datasets.html#cb5-124" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;area_afd_km2&quot;</span>, </span>
<span id="cb5-125"><a href="building-the-datasets.html#cb5-125" tabindex="-1"></a>                           <span class="st">&quot;area_km2&quot;</span>, <span class="st">&quot;rep_area&quot;</span>, <span class="st">&quot;rep_m_area&quot;</span>,</span>
<span id="cb5-126"><a href="building-the-datasets.html#cb5-126" tabindex="-1"></a>                           <span class="st">&quot;annee_doctroi_projet&quot;</span>,</span>
<span id="cb5-127"><a href="building-the-datasets.html#cb5-127" tabindex="-1"></a>                          <span class="st">&quot;mt_fin_global_af_d_prevu_devise&quot;</span>,</span>
<span id="cb5-128"><a href="building-the-datasets.html#cb5-128" tabindex="-1"></a>                          <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span> ,</span>
<span id="cb5-129"><a href="building-the-datasets.html#cb5-129" tabindex="-1"></a>                          <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb5-130"><a href="building-the-datasets.html#cb5-130" tabindex="-1"></a>                          <span class="st">&quot;mt_part_cofinancier_prevu_euro&quot;</span>), </span>
<span id="cb5-131"><a href="building-the-datasets.html#cb5-131" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">stri_enc_toutf8</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb5-132"><a href="building-the-datasets.html#cb5-132" tabindex="-1"></a>  <span class="co">#Translate names in English</span></span>
<span id="cb5-133"><a href="building-the-datasets.html#cb5-133" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;region_afd&quot;</span> <span class="ot">=</span> <span class="st">&quot;libelle_court_direction_regionale&quot;</span>,</span>
<span id="cb5-134"><a href="building-the-datasets.html#cb5-134" tabindex="-1"></a>         <span class="st">&quot;name_pa&quot;</span> <span class="ot">=</span> <span class="st">&quot;nom_ap&quot;</span>,</span>
<span id="cb5-135"><a href="building-the-datasets.html#cb5-135" tabindex="-1"></a>         <span class="st">&quot;date_funding&quot;</span> <span class="ot">=</span> <span class="st">&quot;date_doctroi_projet&quot;</span>,</span>
<span id="cb5-136"><a href="building-the-datasets.html#cb5-136" tabindex="-1"></a>         <span class="st">&quot;year_funding&quot;</span> <span class="ot">=</span> <span class="st">&quot;annee_doctroi_projet&quot;</span>)</span></code></pre></div>
</div>
<div id="dataset-with-only-afd-project-variables" class="section level3 hasAnchor" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Dataset with only AFD project variables<a href="building-the-datasets.html#dataset-with-only-afd-project-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Build a dataset from the tidy dataset that keeps only SIOP variables. Potentially useful for analysis on SIOP information.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="building-the-datasets.html#cb6-1" tabindex="-1"></a><span class="co">#Select info corresponding to SIOP extract and AP </span></span>
<span id="cb6-2"><a href="building-the-datasets.html#cb6-2" tabindex="-1"></a>list_var_siop <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;id_concours&quot;</span>, <span class="st">&quot;region_afd&quot;</span>, <span class="st">&quot;pays&quot;</span>, <span class="st">&quot;pays2&quot;</span>, </span>
<span id="cb6-3"><a href="building-the-datasets.html#cb6-3" tabindex="-1"></a>                  <span class="st">&quot;date_funding&quot;</span>, <span class="st">&quot;year_funding&quot;</span>, <span class="st">&quot;cofinanciers_siop&quot;</span>,</span>
<span id="cb6-4"><a href="building-the-datasets.html#cb6-4" tabindex="-1"></a>                  <span class="st">&quot;mt_fin_global_af_d_prevu_devise&quot;</span> ,</span>
<span id="cb6-5"><a href="building-the-datasets.html#cb6-5" tabindex="-1"></a>                  <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb6-6"><a href="building-the-datasets.html#cb6-6" tabindex="-1"></a>                  <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb6-7"><a href="building-the-datasets.html#cb6-7" tabindex="-1"></a>                  <span class="st">&quot;mt_part_cofinancier_prevu_euro&quot;</span>,</span>
<span id="cb6-8"><a href="building-the-datasets.html#cb6-8" tabindex="-1"></a>                  <span class="st">&quot;libelle_produit&quot;</span>, <span class="st">&quot;date_entree&quot;</span>, <span class="st">&quot;auteur_entree&quot;</span> )</span>
<span id="cb6-9"><a href="building-the-datasets.html#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="building-the-datasets.html#cb6-10" tabindex="-1"></a><span class="co">#Definining dataset for future work with dataset other than WDPA </span></span>
<span id="cb6-11"><a href="building-the-datasets.html#cb6-11" tabindex="-1"></a>data_siop_tidy <span class="ot">=</span> data_tidy <span class="sc">%&gt;%</span></span>
<span id="cb6-12"><a href="building-the-datasets.html#cb6-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(list_var_siop))</span>
<span id="cb6-13"><a href="building-the-datasets.html#cb6-13" tabindex="-1"></a></span>
<span id="cb6-14"><a href="building-the-datasets.html#cb6-14" tabindex="-1"></a><span class="co">#write_csv(data_siop_tidy, &quot;data_tidy/BDD_siop_tidy.xlsx&quot;)</span></span>
<span id="cb6-15"><a href="building-the-datasets.html#cb6-15" tabindex="-1"></a><span class="co"># s3write_using(x = data_siop_tidy,</span></span>
<span id="cb6-16"><a href="building-the-datasets.html#cb6-16" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb6-17"><a href="building-the-datasets.html#cb6-17" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb6-18"><a href="building-the-datasets.html#cb6-18" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_tidy_siop.csv&quot;,</span></span>
<span id="cb6-19"><a href="building-the-datasets.html#cb6-19" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb6-20"><a href="building-the-datasets.html#cb6-20" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="dataset-for-non-confidential-analysis" class="section level3 hasAnchor" number="1.2.6">
<h3><span class="header-section-number">1.2.6</span> Dataset for non-confidential analysis<a href="building-the-datasets.html#dataset-for-non-confidential-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Build a dataset with one row per PA. In the list of PAs reported by AFD department, some PAs are also reported in the WDPA and are identified by a unique WDPA ID, some have no WDPAID but have a unique name, and other have neither name nor WDPAID. For the latter case, a PA is supposed to be identified by project ID and country. Thus we need to remove duplicates for each case. Also, all the funding years of each PA is kept. Note that a few PAs have an entry with WDPA ID, and an other with no WDPAID though they have the same name (e.g Parc National de Pongara). The duplicate without WDPA ID is removed.</p>
<p>For the impact analysis, we also need to take into account transboundary PAs (i.e PAs on more than one country). Indeed the analysis is performed country by country. Thus we need to divide the PAs across the countries it is located in, and re-compute the area of the PA in each country.</p>
<div id="for-descriptive-statistics" class="section level4 hasAnchor" number="1.2.6.1">
<h4><span class="header-section-number">1.2.6.1</span> For descriptive statistics<a href="building-the-datasets.html#for-descriptive-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="building-the-datasets.html#cb7-1" tabindex="-1"></a><span class="co">#Listing relevant variables for analysis that are NOT confidential (i.e not concern funding)</span></span>
<span id="cb7-2"><a href="building-the-datasets.html#cb7-2" tabindex="-1"></a>list_var_fund <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;cofinanciers&quot;</span>, <span class="st">&quot;cofinanciers_siop&quot;</span>,</span>
<span id="cb7-3"><a href="building-the-datasets.html#cb7-3" tabindex="-1"></a>                  <span class="st">&quot;mt_fin_global_af_d_prevu_devise&quot;</span>,</span>
<span id="cb7-4"><a href="building-the-datasets.html#cb7-4" tabindex="-1"></a>                  <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb7-5"><a href="building-the-datasets.html#cb7-5" tabindex="-1"></a>                  <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb7-6"><a href="building-the-datasets.html#cb7-6" tabindex="-1"></a>                  <span class="st">&quot;mt_part_cofinancier_prevu_euro&quot;</span>,</span>
<span id="cb7-7"><a href="building-the-datasets.html#cb7-7" tabindex="-1"></a>                  <span class="st">&quot;libelle_produit&quot;</span>,</span>
<span id="cb7-8"><a href="building-the-datasets.html#cb7-8" tabindex="-1"></a>                  <span class="st">&quot;kfw_bin&quot;</span>, <span class="st">&quot;ffem_bin&quot;</span>, <span class="st">&quot;cof_bin&quot;</span>)</span>
<span id="cb7-9"><a href="building-the-datasets.html#cb7-9" tabindex="-1"></a></span>
<span id="cb7-10"><a href="building-the-datasets.html#cb7-10" tabindex="-1"></a><span class="co">#Defining dataset for descriptive statistics</span></span>
<span id="cb7-11"><a href="building-the-datasets.html#cb7-11" tabindex="-1"></a>data_nofund <span class="ot">=</span> data_tidy <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="building-the-datasets.html#cb7-12" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">all_of</span>(list_var_fund))</span>
<span id="cb7-13"><a href="building-the-datasets.html#cb7-13" tabindex="-1"></a></span>
<span id="cb7-14"><a href="building-the-datasets.html#cb7-14" tabindex="-1"></a><span class="co">#fwrite(data_nofund, &quot;data_tidy/BDD_PA_AFD_nofund.csv&quot;)</span></span>
<span id="cb7-15"><a href="building-the-datasets.html#cb7-15" tabindex="-1"></a><span class="co"># s3write_using(x = data_nofund,</span></span>
<span id="cb7-16"><a href="building-the-datasets.html#cb7-16" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb7-17"><a href="building-the-datasets.html#cb7-17" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb7-18"><a href="building-the-datasets.html#cb7-18" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_nofund.csv&quot;,</span></span>
<span id="cb7-19"><a href="building-the-datasets.html#cb7-19" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb7-20"><a href="building-the-datasets.html#cb7-20" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb7-21"><a href="building-the-datasets.html#cb7-21" tabindex="-1"></a></span>
<span id="cb7-22"><a href="building-the-datasets.html#cb7-22" tabindex="-1"></a><span class="co">#Then to keep only one row per PA, we need to consider separately PAs having WDPA ID and PAs which do not.</span></span>
<span id="cb7-23"><a href="building-the-datasets.html#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="building-the-datasets.html#cb7-24" tabindex="-1"></a><span class="do">## Observations with WDPAID</span></span>
<span id="cb7-25"><a href="building-the-datasets.html#cb7-25" tabindex="-1"></a><span class="do">###We keep information on fundings : one row for each wdpa_pid, funding year is kept</span></span>
<span id="cb7-26"><a href="building-the-datasets.html#cb7-26" tabindex="-1"></a><span class="do">###Note that WDPA_PID is a unique identifier for zones inside the corresponding WDPAID. The choice of the WDPA_PID to keep is performed below (e.g choosing the area instead of the buffer zone)</span></span>
<span id="cb7-27"><a href="building-the-datasets.html#cb7-27" tabindex="-1"></a>data_nofund_wdpa <span class="ot">=</span> data_nofund <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="building-the-datasets.html#cb7-28" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="building-the-datasets.html#cb7-29" tabindex="-1"></a>  <span class="fu">group_by</span>(wdpa_pid, year_funding) <span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="building-the-datasets.html#cb7-30" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-31"><a href="building-the-datasets.html#cb7-31" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-32"><a href="building-the-datasets.html#cb7-32" tabindex="-1"></a>  <span class="fu">group_by</span>(wdpa_pid) <span class="sc">%&gt;%</span></span>
<span id="cb7-33"><a href="building-the-datasets.html#cb7-33" tabindex="-1"></a>  <span class="co">#Then we create a variable with all the funding year for each WDPA ...</span></span>
<span id="cb7-34"><a href="building-the-datasets.html#cb7-34" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_all =</span> <span class="fu">paste0</span>(year_funding, <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb7-35"><a href="building-the-datasets.html#cb7-35" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-36"><a href="building-the-datasets.html#cb7-36" tabindex="-1"></a>  <span class="co">#... and keep only the earlier funding year for year_funding</span></span>
<span id="cb7-37"><a href="building-the-datasets.html#cb7-37" tabindex="-1"></a>  <span class="fu">arrange</span>(year_funding) <span class="sc">%&gt;%</span></span>
<span id="cb7-38"><a href="building-the-datasets.html#cb7-38" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-39"><a href="building-the-datasets.html#cb7-39" tabindex="-1"></a>  <span class="co">#Rename year_funding variable to precise it is the year of first funding by the AFD</span></span>
<span id="cb7-40"><a href="building-the-datasets.html#cb7-40" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;year_funding_first&quot;</span> <span class="ot">=</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-41"><a href="building-the-datasets.html#cb7-41" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-42"><a href="building-the-datasets.html#cb7-42" tabindex="-1"></a>  <span class="co">#Finally, we need to manually remove lines with more than one WDPA_PID</span></span>
<span id="cb7-43"><a href="building-the-datasets.html#cb7-43" tabindex="-1"></a>  <span class="do">## Remove the marine area of WDPAID 9035 with null area</span></span>
<span id="cb7-44"><a href="building-the-datasets.html#cb7-44" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;9035_A&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-45"><a href="building-the-datasets.html#cb7-45" tabindex="-1"></a>  <span class="do">## 555547861 has 3 marine PAs. The C one is chosen as the size reported by AFD (superficie_km2) matches the area reported by WDPA (https://www.protectedplanet.net/555547861)</span></span>
<span id="cb7-46"><a href="building-the-datasets.html#cb7-46" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;555547861_A&quot;</span>, <span class="st">&quot;555547861_B&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb7-47"><a href="building-the-datasets.html#cb7-47" tabindex="-1"></a>  <span class="co"># 555705345 : buffer area is also reported. Remove the buffer</span></span>
<span id="cb7-48"><a href="building-the-datasets.html#cb7-48" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;555705345_B&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-49"><a href="building-the-datasets.html#cb7-49" tabindex="-1"></a>  <span class="co">#555547863 : keep the WDPA_PID whose area matches the one reported by AFD employees and WDPA website (https://www.protectedplanet.net/555547863)</span></span>
<span id="cb7-50"><a href="building-the-datasets.html#cb7-50" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;555547863_A&quot;</span>))</span>
<span id="cb7-51"><a href="building-the-datasets.html#cb7-51" tabindex="-1"></a>  </span>
<span id="cb7-52"><a href="building-the-datasets.html#cb7-52" tabindex="-1"></a><span class="co"># info_filtering = filter(data_raw_corr, wdpaid %in% c(9035, 555547861, 555547863, 555705345 )) %&gt;%</span></span>
<span id="cb7-53"><a href="building-the-datasets.html#cb7-53" tabindex="-1"></a><span class="co">#   group_by(wdpa_pid) %&gt;%</span></span>
<span id="cb7-54"><a href="building-the-datasets.html#cb7-54" tabindex="-1"></a><span class="co">#   slice(1)</span></span>
<span id="cb7-55"><a href="building-the-datasets.html#cb7-55" tabindex="-1"></a></span>
<span id="cb7-56"><a href="building-the-datasets.html#cb7-56" tabindex="-1"></a><span class="co">#Observations without WDPAID but with name of the PA</span></span>
<span id="cb7-57"><a href="building-the-datasets.html#cb7-57" tabindex="-1"></a>data_nofund_name <span class="ot">=</span> data_nofund <span class="sc">%&gt;%</span></span>
<span id="cb7-58"><a href="building-the-datasets.html#cb7-58" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(name_pa) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-59"><a href="building-the-datasets.html#cb7-59" tabindex="-1"></a>  <span class="co">#Remove completely similar rows (due to merging with SIOP and WDPA)</span></span>
<span id="cb7-60"><a href="building-the-datasets.html#cb7-60" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-61"><a href="building-the-datasets.html#cb7-61" tabindex="-1"></a>  <span class="co">#Some PAs might have been funded at different times. Create a variable with all the funding year for each PA name</span></span>
<span id="cb7-62"><a href="building-the-datasets.html#cb7-62" tabindex="-1"></a>  <span class="fu">group_by</span>(name_pa) <span class="sc">%&gt;%</span></span>
<span id="cb7-63"><a href="building-the-datasets.html#cb7-63" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_all =</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(year_funding), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb7-64"><a href="building-the-datasets.html#cb7-64" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-65"><a href="building-the-datasets.html#cb7-65" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_all =</span> <span class="fu">case_when</span>(year_funding_all <span class="sc">==</span> <span class="st">&quot;NA&quot;</span> <span class="sc">~</span><span class="cn">NA</span>,</span>
<span id="cb7-66"><a href="building-the-datasets.html#cb7-66" tabindex="-1"></a>                                      <span class="cn">TRUE</span> <span class="sc">~</span> year_funding_all)) <span class="sc">%&gt;%</span></span>
<span id="cb7-67"><a href="building-the-datasets.html#cb7-67" tabindex="-1"></a>  <span class="co">#keep observation with largest area reported</span></span>
<span id="cb7-68"><a href="building-the-datasets.html#cb7-68" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>area_km2) <span class="sc">%&gt;%</span></span>
<span id="cb7-69"><a href="building-the-datasets.html#cb7-69" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-70"><a href="building-the-datasets.html#cb7-70" tabindex="-1"></a>  <span class="co">#Change year_funding to min of year_fund_all</span></span>
<span id="cb7-71"><a href="building-the-datasets.html#cb7-71" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding =</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(year_funding_all, <span class="at">split =</span> <span class="st">&quot;,&quot;</span>))), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-72"><a href="building-the-datasets.html#cb7-72" tabindex="-1"></a>         <span class="at">year_funding =</span> <span class="fu">case_when</span>(year_funding <span class="sc">==</span> <span class="cn">Inf</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb7-73"><a href="building-the-datasets.html#cb7-73" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span> year_funding)) <span class="sc">%&gt;%</span></span>
<span id="cb7-74"><a href="building-the-datasets.html#cb7-74" tabindex="-1"></a>  <span class="co">#Rename year_funding variable to precise it is the year of first funding by the AFD</span></span>
<span id="cb7-75"><a href="building-the-datasets.html#cb7-75" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;year_funding_first&quot;</span> <span class="ot">=</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-76"><a href="building-the-datasets.html#cb7-76" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-77"><a href="building-the-datasets.html#cb7-77" tabindex="-1"></a>  <span class="co">#Some PAs have multiple entries, with DR Siege de Paris and DR Ocean Pacifique. Their region is assigned to Oceania</span></span>
<span id="cb7-78"><a href="building-the-datasets.html#cb7-78" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region =</span> <span class="fu">case_when</span>(name_pa <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Ailite&quot;</span>, <span class="st">&quot;Aitutaki (3 Ra&#39;ui)&quot;</span>,</span>
<span id="cb7-79"><a href="building-the-datasets.html#cb7-79" tabindex="-1"></a>                                               <span class="st">&quot;Kerehira&quot;</span>, </span>
<span id="cb7-80"><a href="building-the-datasets.html#cb7-80" tabindex="-1"></a>                          <span class="st">&quot;Kibelofolu&quot;</span>, <span class="st">&quot;Kiribati&quot;</span>, <span class="st">&quot;Ma&#39;au&quot;</span>, <span class="st">&quot;Mereka&quot;</span>, </span>
<span id="cb7-81"><a href="building-the-datasets.html#cb7-81" tabindex="-1"></a>                          <span class="st">&quot;Mistery Island (Aneityum)&quot;</span>, <span class="st">&quot;Ngula Pele&quot;</span>, <span class="st">&quot;Niu Houa&quot;</span>,</span>
<span id="cb7-82"><a href="building-the-datasets.html#cb7-82" tabindex="-1"></a>                          <span class="st">&quot;Niumarere&quot;</span>, <span class="st">&quot;Paonangisu&quot;</span>, </span>
<span id="cb7-83"><a href="building-the-datasets.html#cb7-83" tabindex="-1"></a>                          <span class="st">&quot;Parc provincial Yeega-Hienga (Hienghène)&quot;</span>, </span>
<span id="cb7-84"><a href="building-the-datasets.html#cb7-84" tabindex="-1"></a>                          <span class="st">&quot;Rarotonga : Avana-Muri lagoon ra&#39;ui&quot;</span>, </span>
<span id="cb7-85"><a href="building-the-datasets.html#cb7-85" tabindex="-1"></a>                          <span class="st">&quot;Rarotonga : Mitiaro ra&#39;ui&quot;</span>, <span class="st">&quot;Saama&quot;</span>, <span class="st">&quot;Siviri&quot;</span>, </span>
<span id="cb7-86"><a href="building-the-datasets.html#cb7-86" tabindex="-1"></a>                          <span class="st">&quot;Takara&quot;</span>, <span class="st">&quot;Takola&quot;</span>, <span class="st">&quot;Tavuilo&quot;</span>, <span class="st">&quot;Waimamaru&quot;</span>) </span>
<span id="cb7-87"><a href="building-the-datasets.html#cb7-87" tabindex="-1"></a>           <span class="sc">&amp;</span> id_projet <span class="sc">==</span> <span class="st">&quot;CZZ1282&quot;</span> <span class="sc">~</span> <span class="st">&quot;Oceania&quot;</span>,</span>
<span id="cb7-88"><a href="building-the-datasets.html#cb7-88" tabindex="-1"></a>         <span class="cn">TRUE</span> <span class="sc">~</span> region)) </span>
<span id="cb7-89"><a href="building-the-datasets.html#cb7-89" tabindex="-1"></a><span class="co">#Careful : the following filtering are outdated</span></span>
<span id="cb7-90"><a href="building-the-datasets.html#cb7-90" tabindex="-1"></a>  <span class="co"># filter(!(grepl(&quot;Aire de gestion durable des ressources Yambé&quot;, name_pa) &amp; id_projet == &quot;CZZ1282&quot;)) %&gt;%</span></span>
<span id="cb7-91"><a href="building-the-datasets.html#cb7-91" tabindex="-1"></a>  <span class="co"># ##Remove duplicate with zero area while the other is non-zerp</span></span>
<span id="cb7-92"><a href="building-the-datasets.html#cb7-92" tabindex="-1"></a>  <span class="co"># filter(!(id_projet == &quot;CZZ1667&quot; &amp; name_pa == &quot;Dohimen&quot;)) %&gt;%</span></span>
<span id="cb7-93"><a href="building-the-datasets.html#cb7-93" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Hienghène&quot; &amp; id_projet == &quot;CZZ1667&quot;)) %&gt;%</span></span>
<span id="cb7-94"><a href="building-the-datasets.html#cb7-94" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Hyabe Lé Jao&quot; &amp; id_projet == &quot;CZZ1667&quot;)) %&gt;%</span></span>
<span id="cb7-95"><a href="building-the-datasets.html#cb7-95" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Naroko&quot; &amp; id_projet == &quot;CZZ1667&quot;)) %&gt;%</span></span>
<span id="cb7-96"><a href="building-the-datasets.html#cb7-96" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Tasi Vanua&quot; &amp; id_projet == &quot;CZZ166701&quot;)) %&gt;%</span></span>
<span id="cb7-97"><a href="building-the-datasets.html#cb7-97" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Yeega&quot; &amp; id_projet == &quot;CZZ1667&quot;)) %&gt;%</span></span>
<span id="cb7-98"><a href="building-the-datasets.html#cb7-98" tabindex="-1"></a>  <span class="co"># ##Remove duplicate of Pouébo with area 0</span></span>
<span id="cb7-99"><a href="building-the-datasets.html#cb7-99" tabindex="-1"></a>  <span class="co"># filter(!(name_pa == &quot;Pweevo (Pouébo)&quot;))</span></span>
<span id="cb7-100"><a href="building-the-datasets.html#cb7-100" tabindex="-1"></a></span>
<span id="cb7-101"><a href="building-the-datasets.html#cb7-101" tabindex="-1"></a><span class="co">#Finally, observations with no WDPAID and no name_pa</span></span>
<span id="cb7-102"><a href="building-the-datasets.html#cb7-102" tabindex="-1"></a>data_nofund_na <span class="ot">=</span> data_nofund <span class="sc">%&gt;%</span></span>
<span id="cb7-103"><a href="building-the-datasets.html#cb7-103" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(name_pa) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-104"><a href="building-the-datasets.html#cb7-104" tabindex="-1"></a>  <span class="co">#Remove identical observations</span></span>
<span id="cb7-105"><a href="building-the-datasets.html#cb7-105" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-106"><a href="building-the-datasets.html#cb7-106" tabindex="-1"></a>    <span class="co">#Some PAs might have been funded at different times. Create a variable with all the funding year for each PA name</span></span>
<span id="cb7-107"><a href="building-the-datasets.html#cb7-107" tabindex="-1"></a>  <span class="fu">group_by</span>(id_projet, iso3) <span class="sc">%&gt;%</span></span>
<span id="cb7-108"><a href="building-the-datasets.html#cb7-108" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_all =</span> <span class="fu">paste0</span>(<span class="fu">unique</span>(year_funding), <span class="at">collapse =</span> <span class="st">&quot;,&quot;</span>),</span>
<span id="cb7-109"><a href="building-the-datasets.html#cb7-109" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-110"><a href="building-the-datasets.html#cb7-110" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_all =</span> <span class="fu">case_when</span>(year_funding_all <span class="sc">==</span> <span class="st">&quot;NA&quot;</span> <span class="sc">~</span><span class="cn">NA</span>,</span>
<span id="cb7-111"><a href="building-the-datasets.html#cb7-111" tabindex="-1"></a>                                      <span class="cn">TRUE</span> <span class="sc">~</span> year_funding_all)) <span class="sc">%&gt;%</span></span>
<span id="cb7-112"><a href="building-the-datasets.html#cb7-112" tabindex="-1"></a>  <span class="co">#keep observation with largest area reported</span></span>
<span id="cb7-113"><a href="building-the-datasets.html#cb7-113" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>area_km2) <span class="sc">%&gt;%</span></span>
<span id="cb7-114"><a href="building-the-datasets.html#cb7-114" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-115"><a href="building-the-datasets.html#cb7-115" tabindex="-1"></a>  <span class="co">#Change year_funding to min of year_fund_all</span></span>
<span id="cb7-116"><a href="building-the-datasets.html#cb7-116" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding =</span> <span class="fu">min</span>(<span class="fu">as.numeric</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(year_funding_all, <span class="at">split =</span> <span class="st">&quot;,&quot;</span>))), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-117"><a href="building-the-datasets.html#cb7-117" tabindex="-1"></a>         <span class="at">year_funding =</span> <span class="fu">case_when</span>(year_funding <span class="sc">==</span> <span class="cn">Inf</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb7-118"><a href="building-the-datasets.html#cb7-118" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span> year_funding)) <span class="sc">%&gt;%</span></span>
<span id="cb7-119"><a href="building-the-datasets.html#cb7-119" tabindex="-1"></a>  <span class="co">#Rename year_funding variable to precise it is the year of first funding by the AFD</span></span>
<span id="cb7-120"><a href="building-the-datasets.html#cb7-120" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;year_funding_first&quot;</span> <span class="ot">=</span> <span class="st">&quot;year_funding&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-121"><a href="building-the-datasets.html#cb7-121" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb7-122"><a href="building-the-datasets.html#cb7-122" tabindex="-1"></a>  </span>
<span id="cb7-123"><a href="building-the-datasets.html#cb7-123" tabindex="-1"></a><span class="co">#Finally bind the datasets</span></span>
<span id="cb7-124"><a href="building-the-datasets.html#cb7-124" tabindex="-1"></a>data_nofund_nodupl <span class="ot">=</span> <span class="fu">rbind</span>(data_nofund_wdpa, data_nofund_name, data_nofund_na) </span>
<span id="cb7-125"><a href="building-the-datasets.html#cb7-125" tabindex="-1"></a></span>
<span id="cb7-126"><a href="building-the-datasets.html#cb7-126" tabindex="-1"></a><span class="co">#fwrite(data_nofund_nodupl, &quot;data_tidy/BDD_nofund_nodupl.csv&quot;)</span></span>
<span id="cb7-127"><a href="building-the-datasets.html#cb7-127" tabindex="-1"></a><span class="co"># s3write_using(x = data_nofund_nodupl,</span></span>
<span id="cb7-128"><a href="building-the-datasets.html#cb7-128" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb7-129"><a href="building-the-datasets.html#cb7-129" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb7-130"><a href="building-the-datasets.html#cb7-130" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_nofund_nodupl.csv&quot;,</span></span>
<span id="cb7-131"><a href="building-the-datasets.html#cb7-131" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb7-132"><a href="building-the-datasets.html#cb7-132" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="for-impact-analysis" class="section level4 hasAnchor" number="1.2.6.2">
<h4><span class="header-section-number">1.2.6.2</span> For impact analysis<a href="building-the-datasets.html#for-impact-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Different datasets are built, depending on the portfolio to analyse (e.g PAs supported by AFD or a specific funder).</p>
<div id="afd-portfolio" class="section level5 hasAnchor" number="1.2.6.2.1">
<h5><span class="header-section-number">1.2.6.2.1</span> AFD portfolio<a href="building-the-datasets.html#afd-portfolio" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>One PA in the AFD portfolio is located in Congo Republic, Cameroon and Republican Central Africa (WDPA ID 555547988). As by desing the impact analysis is performed country by country, this PA must be artificially divided in three and each part assigned to the country it is located in.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="building-the-datasets.html#cb8-1" tabindex="-1"></a><span class="co">#Import the non-confidential dataset with no duplicates</span></span>
<span id="cb8-2"><a href="building-the-datasets.html#cb8-2" tabindex="-1"></a>data_pa_nofund_nodupl <span class="ot">=</span> </span>
<span id="cb8-3"><a href="building-the-datasets.html#cb8-3" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_PA_AFD_nofund_nodupl.csv&quot;)</span></span>
<span id="cb8-4"><a href="building-the-datasets.html#cb8-4" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb8-5"><a href="building-the-datasets.html#cb8-5" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb8-6"><a href="building-the-datasets.html#cb8-6" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-7"><a href="building-the-datasets.html#cb8-7" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_PA_AFD_nofund_nodupl.csv&quot;</span>,</span>
<span id="cb8-8"><a href="building-the-datasets.html#cb8-8" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb8-9"><a href="building-the-datasets.html#cb8-9" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb8-10"><a href="building-the-datasets.html#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="building-the-datasets.html#cb8-11" tabindex="-1"></a><span class="co">#Import WDPA data</span></span>
<span id="cb8-12"><a href="building-the-datasets.html#cb8-12" tabindex="-1"></a>data_wdpa <span class="ot">=</span></span>
<span id="cb8-13"><a href="building-the-datasets.html#cb8-13" tabindex="-1"></a>  <span class="co">#st_read(&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;) %&gt;%</span></span>
<span id="cb8-14"><a href="building-the-datasets.html#cb8-14" tabindex="-1"></a>  <span class="fu">s3read_using</span>(sf<span class="sc">::</span>st_read,</span>
<span id="cb8-15"><a href="building-the-datasets.html#cb8-15" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;</span>,</span>
<span id="cb8-16"><a href="building-the-datasets.html#cb8-16" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb8-17"><a href="building-the-datasets.html#cb8-17" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="building-the-datasets.html#cb8-18" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="building-the-datasets.html#cb8-19" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(wdpaid, geom)) <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="building-the-datasets.html#cb8-20" tabindex="-1"></a>  <span class="fu">filter</span>(wdpaid <span class="sc">%in%</span> data_pa_nofund_nodupl<span class="sc">$</span>wdpaid)</span>
<span id="cb8-21"><a href="building-the-datasets.html#cb8-21" tabindex="-1"></a></span>
<span id="cb8-22"><a href="building-the-datasets.html#cb8-22" tabindex="-1"></a><span class="co">#The PA WDPAID 555547988 is located in COG, CMR and CAF</span></span>
<span id="cb8-23"><a href="building-the-datasets.html#cb8-23" tabindex="-1"></a><span class="do">##Create a frame with one line by country</span></span>
<span id="cb8-24"><a href="building-the-datasets.html#cb8-24" tabindex="-1"></a>df_555547988 <span class="ot">=</span> data_pa_nofund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="building-the-datasets.html#cb8-25" tabindex="-1"></a>  <span class="fu">filter</span>(wdpaid <span class="sc">==</span> <span class="dv">555547988</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="building-the-datasets.html#cb8-26" tabindex="-1"></a>  <span class="fu">left_join</span>(data_wdpa, <span class="at">by =</span> <span class="st">&quot;wdpaid&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="building-the-datasets.html#cb8-27" tabindex="-1"></a>  <span class="co">#Create one line by country</span></span>
<span id="cb8-28"><a href="building-the-datasets.html#cb8-28" tabindex="-1"></a>  <span class="fu">separate_longer_delim</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;parent_iso3&quot;</span>), <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="building-the-datasets.html#cb8-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iso3 =</span> parent_iso3,</span>
<span id="cb8-30"><a href="building-the-datasets.html#cb8-30" tabindex="-1"></a>         <span class="at">country_en =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb8-31"><a href="building-the-datasets.html#cb8-31" tabindex="-1"></a>                                  <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb8-32"><a href="building-the-datasets.html#cb8-32" tabindex="-1"></a>                                  <span class="at">destination =</span> <span class="st">&quot;un.name.en&quot;</span>),</span>
<span id="cb8-33"><a href="building-the-datasets.html#cb8-33" tabindex="-1"></a>        <span class="at">country_fr =</span> <span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb8-34"><a href="building-the-datasets.html#cb8-34" tabindex="-1"></a>                        <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb8-35"><a href="building-the-datasets.html#cb8-35" tabindex="-1"></a>                        <span class="at">destination =</span> <span class="st">&quot;un.name.fr&quot;</span>), </span>
<span id="cb8-36"><a href="building-the-datasets.html#cb8-36" tabindex="-1"></a>        <span class="at">name_pa =</span> <span class="fu">paste</span>(name_pa, iso3, <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>))</span>
<span id="cb8-37"><a href="building-the-datasets.html#cb8-37" tabindex="-1"></a></span>
<span id="cb8-38"><a href="building-the-datasets.html#cb8-38" tabindex="-1"></a><span class="do">##Get countries boundaries from geodata package</span></span>
<span id="cb8-39"><a href="building-the-datasets.html#cb8-39" tabindex="-1"></a>ctry_bnd <span class="ot">=</span> <span class="fu">gadm</span>(<span class="at">country =</span> <span class="fu">unique</span>(df_555547988<span class="sc">$</span>iso3), </span>
<span id="cb8-40"><a href="building-the-datasets.html#cb8-40" tabindex="-1"></a>                <span class="at">path =</span> <span class="fu">tempfile</span>(),</span>
<span id="cb8-41"><a href="building-the-datasets.html#cb8-41" tabindex="-1"></a>                <span class="at">version =</span> <span class="st">&quot;latest&quot;</span>, <span class="at">level =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-42"><a href="building-the-datasets.html#cb8-42" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-43"><a href="building-the-datasets.html#cb8-43" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;geom_ctry&quot;</span> <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span>,</span>
<span id="cb8-44"><a href="building-the-datasets.html#cb8-44" tabindex="-1"></a>         <span class="st">&quot;iso3&quot;</span> <span class="ot">=</span> <span class="st">&quot;GID_0&quot;</span>)</span>
<span id="cb8-45"><a href="building-the-datasets.html#cb8-45" tabindex="-1"></a></span>
<span id="cb8-46"><a href="building-the-datasets.html#cb8-46" tabindex="-1"></a><span class="do">##Take the intersection of each country with the transboundary polygon, then compute its area in km2</span></span>
<span id="cb8-47"><a href="building-the-datasets.html#cb8-47" tabindex="-1"></a>df_int <span class="ot">=</span> <span class="fu">st_intersection</span>(ctry_bnd, df_555547988<span class="sc">$</span>geom) <span class="sc">%&gt;%</span></span>
<span id="cb8-48"><a href="building-the-datasets.html#cb8-48" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-49"><a href="building-the-datasets.html#cb8-49" tabindex="-1"></a>  <span class="co">#Compute the area in km2</span></span>
<span id="cb8-50"><a href="building-the-datasets.html#cb8-50" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_int_km2 =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom_ctry))<span class="sc">/</span><span class="fl">1e6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-51"><a href="building-the-datasets.html#cb8-51" tabindex="-1"></a>  <span class="fu">group_by</span>(area_int_km2) <span class="sc">%&gt;%</span></span>
<span id="cb8-52"><a href="building-the-datasets.html#cb8-52" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-53"><a href="building-the-datasets.html#cb8-53" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;iso3&quot;</span>, <span class="st">&quot;area_int_km2&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-54"><a href="building-the-datasets.html#cb8-54" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb8-55"><a href="building-the-datasets.html#cb8-55" tabindex="-1"></a></span>
<span id="cb8-56"><a href="building-the-datasets.html#cb8-56" tabindex="-1"></a><span class="do">##Define the cropped dataset</span></span>
<span id="cb8-57"><a href="building-the-datasets.html#cb8-57" tabindex="-1"></a>df_cropd <span class="ot">=</span> df_555547988 <span class="sc">%&gt;%</span> </span>
<span id="cb8-58"><a href="building-the-datasets.html#cb8-58" tabindex="-1"></a>  <span class="fu">left_join</span>(df_int, <span class="at">by =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-59"><a href="building-the-datasets.html#cb8-59" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_km2 =</span> area_int_km2) <span class="sc">%&gt;%</span></span>
<span id="cb8-60"><a href="building-the-datasets.html#cb8-60" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">names</span>(data_pa_nofund_nodupl))) <span class="sc">%&gt;%</span></span>
<span id="cb8-61"><a href="building-the-datasets.html#cb8-61" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb8-62"><a href="building-the-datasets.html#cb8-62" tabindex="-1"></a></span>
<span id="cb8-63"><a href="building-the-datasets.html#cb8-63" tabindex="-1"></a><span class="do">##Replace the original transboundary line by multiple lines</span></span>
<span id="cb8-64"><a href="building-the-datasets.html#cb8-64" tabindex="-1"></a>data_pa_ie <span class="ot">=</span> data_pa_nofund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb8-65"><a href="building-the-datasets.html#cb8-65" tabindex="-1"></a>  <span class="co">#Select all lines excepted the one to replace</span></span>
<span id="cb8-66"><a href="building-the-datasets.html#cb8-66" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">|</span> wdpaid <span class="sc">!=</span> <span class="dv">555547988</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-67"><a href="building-the-datasets.html#cb8-67" tabindex="-1"></a>  <span class="co">#Add the multiple lines </span></span>
<span id="cb8-68"><a href="building-the-datasets.html#cb8-68" tabindex="-1"></a>  <span class="fu">rbind</span>(df_cropd)</span>
<span id="cb8-69"><a href="building-the-datasets.html#cb8-69" tabindex="-1"></a></span>
<span id="cb8-70"><a href="building-the-datasets.html#cb8-70" tabindex="-1"></a><span class="co">#Finally this dataset is saved</span></span>
<span id="cb8-71"><a href="building-the-datasets.html#cb8-71" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_ie,</span></span>
<span id="cb8-72"><a href="building-the-datasets.html#cb8-72" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb8-73"><a href="building-the-datasets.html#cb8-73" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb8-74"><a href="building-the-datasets.html#cb8-74" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_ie.csv&quot;,</span></span>
<span id="cb8-75"><a href="building-the-datasets.html#cb8-75" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb8-76"><a href="building-the-datasets.html#cb8-76" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="fapbm-portfolio" class="section level5 hasAnchor" number="1.2.6.2.2">
<h5><span class="header-section-number">1.2.6.2.2</span> FAPBM portfolio<a href="building-the-datasets.html#fapbm-portfolio" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The Fund for Protected Areas and Biodiversity in Madagascar (FAPBM in French) is the main funder of PAs in Madagascar. A dataset specific to the PAs it supports is built, knowing the name of these PAs (FAPBM website).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="building-the-datasets.html#cb9-1" tabindex="-1"></a><span class="co">#The name of PAs funded by the FAPBM, as stated on their website (https://www.fapbm.org/aires-protegees-soutenues/, consulted the 2023-09-18).</span></span>
<span id="cb9-2"><a href="building-the-datasets.html#cb9-2" tabindex="-1"></a><span class="co"># I have removed any &quot;-&quot; and replace it by &quot;&quot;.</span></span>
<span id="cb9-3"><a href="building-the-datasets.html#cb9-3" tabindex="-1"></a>pa_fapbm_names <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name_pa =</span> <span class="fu">c</span>(<span class="st">&quot;Ambohitantely&quot;</span>, <span class="st">&quot;Ibity&quot;</span>, <span class="st">&quot;Corridor Marojejy-Anjanaharibe Sud-Tsaratanana&quot;</span>,<span class="st">&quot;Nosy Hara&quot;</span>,<span class="st">&quot;Galoko Kalobinono&quot;</span>,<span class="st">&quot;Analamerana&quot;</span></span>
<span id="cb9-4"><a href="building-the-datasets.html#cb9-4" tabindex="-1"></a>                   ,<span class="st">&quot;Anjanaharibe Sud&quot;</span>,<span class="st">&quot;Lokobe&quot;</span>,<span class="st">&quot;Manongarivo&quot;</span>, <span class="st">&quot;Ambodivahibe&quot;</span></span>
<span id="cb9-5"><a href="building-the-datasets.html#cb9-5" tabindex="-1"></a>                   , <span class="st">&quot;Andrafiamena Andavakoera&quot;</span>, <span class="st">&quot;Ankivonjy&quot;</span>, <span class="st">&quot;Ankarana&quot;</span>, </span>
<span id="cb9-6"><a href="building-the-datasets.html#cb9-6" tabindex="-1"></a>                   <span class="st">&quot;Montagne d’Ambre&quot;</span>,<span class="st">&quot;Montagne des Français&quot;</span>, <span class="st">&quot;Loky Manambato&quot;</span></span>
<span id="cb9-7"><a href="building-the-datasets.html#cb9-7" tabindex="-1"></a>                   , <span class="st">&quot;Tsaratanana&quot;</span>, <span class="st">&quot;Oronjia&quot;</span>, <span class="st">&quot;Masoala&quot;</span>, <span class="st">&quot;Marojejy&quot;</span>, <span class="st">&quot;Makira&quot;</span></span>
<span id="cb9-8"><a href="building-the-datasets.html#cb9-8" tabindex="-1"></a>                   , <span class="st">&quot;Ivohibe&quot;</span>, <span class="st">&quot;Befotaka Midongy&quot;</span>, <span class="st">&quot;Andringitra&quot;</span>, <span class="st">&quot;Massif d’Itremo&quot;</span></span>
<span id="cb9-9"><a href="building-the-datasets.html#cb9-9" tabindex="-1"></a>                   , <span class="st">&quot;Agnalazaha&quot;</span>, <span class="st">&quot;Ranomafana&quot;</span>, <span class="st">&quot;Manombo&quot;</span>, <span class="st">&quot;Zombitse Voabasia&quot;</span></span>
<span id="cb9-10"><a href="building-the-datasets.html#cb9-10" tabindex="-1"></a>                   , <span class="st">&quot;Nosy Ve Androka&quot;</span>, <span class="st">&quot;Kalambatritra&quot;</span>, <span class="st">&quot;Cap Sainte Marie&quot;</span>, </span>
<span id="cb9-11"><a href="building-the-datasets.html#cb9-11" tabindex="-1"></a>                   <span class="st">&quot;Beza Mahafaly&quot;</span>, <span class="st">&quot;Andranomena&quot;</span>, <span class="st">&quot;Menabe Antimena&quot;</span>, <span class="st">&quot;Mikea&quot;</span></span>
<span id="cb9-12"><a href="building-the-datasets.html#cb9-12" tabindex="-1"></a>                   , <span class="st">&quot;Isalo&quot;</span>, <span class="st">&quot;Tsimanampetsotse&quot;</span>, <span class="st">&quot;Complexe Mangoky Ihotry&quot;</span></span>
<span id="cb9-13"><a href="building-the-datasets.html#cb9-13" tabindex="-1"></a>                   , <span class="st">&quot;Kirindy Mitea&quot;</span>, <span class="st">&quot;Andohahela&quot;</span>, <span class="st">&quot;Bombetoka&quot;</span>, <span class="st">&quot;Namoroka&quot;</span></span>
<span id="cb9-14"><a href="building-the-datasets.html#cb9-14" tabindex="-1"></a>                   , <span class="st">&quot;Sahamalaza Îles Radama&quot;</span>, <span class="st">&quot;Complexe Tsimembo Manambolomaty&quot;</span></span>
<span id="cb9-15"><a href="building-the-datasets.html#cb9-15" tabindex="-1"></a>                   , <span class="st">&quot;Mandrozo&quot;</span>, <span class="st">&quot;Complexe Mahavavy Kinkony&quot;</span>, <span class="st">&quot;Bemaraha&quot;</span></span>
<span id="cb9-16"><a href="building-the-datasets.html#cb9-16" tabindex="-1"></a>                   , <span class="st">&quot;Beanka&quot;</span>, <span class="st">&quot;Baie de Baly&quot;</span>, <span class="st">&quot;Site bioculturel d’Antrema&quot;</span></span>
<span id="cb9-17"><a href="building-the-datasets.html#cb9-17" tabindex="-1"></a>                   , <span class="st">&quot;Ankarafantsika&quot;</span>, <span class="st">&quot;Corridor Ankeniheny Zahamena&quot;</span>, <span class="st">&quot;Mangerivola&quot;</span></span>
<span id="cb9-18"><a href="building-the-datasets.html#cb9-18" tabindex="-1"></a>                   , <span class="st">&quot;Betampona&quot;</span>, <span class="st">&quot;Andasibe Mantadia&quot;</span>, <span class="st">&quot;Analamazaotra&quot;</span>, <span class="st">&quot;Nosy Mangabe&quot;</span></span>
<span id="cb9-19"><a href="building-the-datasets.html#cb9-19" tabindex="-1"></a>                   , <span class="st">&quot;Mananara Nord&quot;</span>, <span class="st">&quot;Zahamena&quot;</span>, <span class="st">&quot;Marotandrano&quot;</span>, <span class="st">&quot;Maromizaha&quot;</span></span>
<span id="cb9-20"><a href="building-the-datasets.html#cb9-20" tabindex="-1"></a>                   , <span class="st">&quot;Analalava&quot;</span>, <span class="st">&quot;Ambatovaky&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-21"><a href="building-the-datasets.html#cb9-21" tabindex="-1"></a>  <span class="co">#Change name for some PAs that are in WDPA but with slightly different name</span></span>
<span id="cb9-22"><a href="building-the-datasets.html#cb9-22" tabindex="-1"></a>  <span class="co">#after cross-checking with polygon of WDPA on https://www.protectedplanet.net/</span></span>
<span id="cb9-23"><a href="building-the-datasets.html#cb9-23" tabindex="-1"></a>  <span class="co">#and https://www.fapbm.org/aires-protegees-soutenues/</span></span>
<span id="cb9-24"><a href="building-the-datasets.html#cb9-24" tabindex="-1"></a>  <span class="co">#Not found :</span></span>
<span id="cb9-25"><a href="building-the-datasets.html#cb9-25" tabindex="-1"></a>  <span class="do">## Corridor Marojejy-Anjanaharibe Sud-Tsaratanana</span></span>
<span id="cb9-26"><a href="building-the-datasets.html#cb9-26" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_pa =</span> <span class="fu">case_when</span>(name_pa <span class="sc">==</span> <span class="st">&quot;Andasibe Mantadia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Mantadia&quot;</span>,</span>
<span id="cb9-27"><a href="building-the-datasets.html#cb9-27" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Bombetoka&quot;</span> <span class="sc">~</span> <span class="st">&quot;Bombetoka Belemboka&quot;</span>,</span>
<span id="cb9-28"><a href="building-the-datasets.html#cb9-28" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Complexe Mahavavy Kinkony&quot;</span> <span class="sc">~</span> <span class="st">&quot;Complexe Zones Humides Mahavavy Kinkony&quot;</span>,</span>
<span id="cb9-29"><a href="building-the-datasets.html#cb9-29" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Complexe Mangoky Ihotry&quot;</span> <span class="sc">~</span> <span class="st">&quot;Complexe Zones Humides Mangoky Ihotry&quot;</span>,</span>
<span id="cb9-30"><a href="building-the-datasets.html#cb9-30" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Kalambatritra&quot;</span> <span class="sc">~</span> <span class="st">&quot;Kalambatrika&quot;</span>,</span>
<span id="cb9-31"><a href="building-the-datasets.html#cb9-31" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Ibity&quot;</span> <span class="sc">~</span> <span class="st">&quot;Massif d&#39;Ibity&quot;</span>,</span>
<span id="cb9-32"><a href="building-the-datasets.html#cb9-32" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Kirindy Mitea&quot;</span> <span class="sc">~</span> <span class="st">&quot;Kirindy Mite&quot;</span>,</span>
<span id="cb9-33"><a href="building-the-datasets.html#cb9-33" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Mandrozo&quot;</span> <span class="sc">~</span><span class="st">&quot;Zone Humide de Mandrozo&quot;</span>,</span>
<span id="cb9-34"><a href="building-the-datasets.html#cb9-34" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Montagne des Français&quot;</span> <span class="sc">~</span><span class="st">&quot;Ambohitr&#39;Antsingy Montagne des Français&quot;</span>,</span>
<span id="cb9-35"><a href="building-the-datasets.html#cb9-35" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Tsimanampetsotse&quot;</span> <span class="sc">~</span> <span class="st">&quot;Tsimanampesotse&quot;</span>,</span>
<span id="cb9-36"><a href="building-the-datasets.html#cb9-36" tabindex="-1"></a>                             name_pa <span class="sc">==</span> <span class="st">&quot;Zombitse Voabasia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Zombitse Vohibasia&quot;</span>,</span>
<span id="cb9-37"><a href="building-the-datasets.html#cb9-37" tabindex="-1"></a>                             <span class="cn">TRUE</span> <span class="sc">~</span> name_pa)) <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="building-the-datasets.html#cb9-38" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_pa_clean =</span> janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(name_pa))</span>
<span id="cb9-39"><a href="building-the-datasets.html#cb9-39" tabindex="-1"></a></span>
<span id="cb9-40"><a href="building-the-datasets.html#cb9-40" tabindex="-1"></a><span class="co">#Filter the WDPA with PA funded by FAPBM</span></span>
<span id="cb9-41"><a href="building-the-datasets.html#cb9-41" tabindex="-1"></a>data_pa_fapbm <span class="ot">=</span> data_wdpa <span class="sc">%&gt;%</span></span>
<span id="cb9-42"><a href="building-the-datasets.html#cb9-42" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-43"><a href="building-the-datasets.html#cb9-43" tabindex="-1"></a>  <span class="fu">filter</span>(iso3 <span class="sc">==</span> <span class="st">&quot;MDG&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-44"><a href="building-the-datasets.html#cb9-44" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_clean =</span> <span class="fu">make_clean_names</span>(name), <span class="at">.after =</span> <span class="st">&quot;name&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-45"><a href="building-the-datasets.html#cb9-45" tabindex="-1"></a>  <span class="fu">filter</span>(name_clean <span class="sc">%in%</span> pa_fapbm_names<span class="sc">$</span>name_pa_clean) <span class="sc">%&gt;%</span></span>
<span id="cb9-46"><a href="building-the-datasets.html#cb9-46" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_km2 =</span> rep_area, <span class="at">.after =</span> <span class="st">&quot;rep_area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="building-the-datasets.html#cb9-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_afd =</span> <span class="st">&quot;DR OCEAN INDIEN&quot;</span>, </span>
<span id="cb9-48"><a href="building-the-datasets.html#cb9-48" tabindex="-1"></a>         <span class="at">name_pa =</span> name,</span>
<span id="cb9-49"><a href="building-the-datasets.html#cb9-49" tabindex="-1"></a>         <span class="at">region =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb9-50"><a href="building-the-datasets.html#cb9-50" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb9-51"><a href="building-the-datasets.html#cb9-51" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.region.name&quot;</span>),</span>
<span id="cb9-52"><a href="building-the-datasets.html#cb9-52" tabindex="-1"></a>         <span class="at">sub_region =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb9-53"><a href="building-the-datasets.html#cb9-53" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb9-54"><a href="building-the-datasets.html#cb9-54" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.regionsub.name&quot;</span>),</span>
<span id="cb9-55"><a href="building-the-datasets.html#cb9-55" tabindex="-1"></a>         <span class="at">country_en =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb9-56"><a href="building-the-datasets.html#cb9-56" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb9-57"><a href="building-the-datasets.html#cb9-57" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.en&quot;</span>),</span>
<span id="cb9-58"><a href="building-the-datasets.html#cb9-58" tabindex="-1"></a>         <span class="at">country_fr =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb9-59"><a href="building-the-datasets.html#cb9-59" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb9-60"><a href="building-the-datasets.html#cb9-60" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.fr&quot;</span>),</span>
<span id="cb9-61"><a href="building-the-datasets.html#cb9-61" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-62"><a href="building-the-datasets.html#cb9-62" tabindex="-1"></a>  <span class="co">#Add the description of IUCN from its category (French and English)</span></span>
<span id="cb9-63"><a href="building-the-datasets.html#cb9-63" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iucn_des_fr =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-64"><a href="building-the-datasets.html#cb9-64" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Réserve naturelle intégrale&quot;</span>,</span>
<span id="cb9-65"><a href="building-the-datasets.html#cb9-65" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Zone de nature sauvage&quot;</span>,</span>
<span id="cb9-66"><a href="building-the-datasets.html#cb9-66" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;Parc national&quot;</span>, </span>
<span id="cb9-67"><a href="building-the-datasets.html#cb9-67" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Monument naturel&quot;</span>,</span>
<span id="cb9-68"><a href="building-the-datasets.html#cb9-68" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. des habitats/espèces&quot;</span>,</span>
<span id="cb9-69"><a href="building-the-datasets.html#cb9-69" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Paysage protégé&quot;</span>,</span>
<span id="cb9-70"><a href="building-the-datasets.html#cb9-70" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. de ress. protégées&quot;</span>,</span>
<span id="cb9-71"><a href="building-the-datasets.html#cb9-71" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb9-72"><a href="building-the-datasets.html#cb9-72" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb9-73"><a href="building-the-datasets.html#cb9-73" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb9-74"><a href="building-the-datasets.html#cb9-74" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Non référencée&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb9-75"><a href="building-the-datasets.html#cb9-75" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">iucn_des_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-76"><a href="building-the-datasets.html#cb9-76" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Strict nature reserve&quot;</span>,</span>
<span id="cb9-77"><a href="building-the-datasets.html#cb9-77" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Wilderness area&quot;</span>,</span>
<span id="cb9-78"><a href="building-the-datasets.html#cb9-78" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;National park&quot;</span>,</span>
<span id="cb9-79"><a href="building-the-datasets.html#cb9-79" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Natural monument or feature&quot;</span>,</span>
<span id="cb9-80"><a href="building-the-datasets.html#cb9-80" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot; Habitat or species management area&quot;</span>,</span>
<span id="cb9-81"><a href="building-the-datasets.html#cb9-81" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected landscape or seascape&quot;</span>,</span>
<span id="cb9-82"><a href="building-the-datasets.html#cb9-82" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected area with sust. use of nat. res.&quot;</span>,</span>
<span id="cb9-83"><a href="building-the-datasets.html#cb9-83" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb9-84"><a href="building-the-datasets.html#cb9-84" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb9-85"><a href="building-the-datasets.html#cb9-85" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb9-86"><a href="building-the-datasets.html#cb9-86" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Not referenced&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb9-87"><a href="building-the-datasets.html#cb9-87" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_first =</span> <span class="cn">NA</span>, <span class="at">year_funding_all =</span> <span class="cn">NA</span>)</span>
<span id="cb9-88"><a href="building-the-datasets.html#cb9-88" tabindex="-1"></a></span>
<span id="cb9-89"><a href="building-the-datasets.html#cb9-89" tabindex="-1"></a></span>
<span id="cb9-90"><a href="building-the-datasets.html#cb9-90" tabindex="-1"></a><span class="co">#The PA funded by FAPBM but not in the WDPA</span></span>
<span id="cb9-91"><a href="building-the-datasets.html#cb9-91" tabindex="-1"></a>pa_fapbm_not_found <span class="ot">=</span> pa_fapbm_names <span class="sc">%&gt;%</span></span>
<span id="cb9-92"><a href="building-the-datasets.html#cb9-92" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(name_pa_clean <span class="sc">%in%</span> data_pa_fapbm<span class="sc">$</span>name_clean))</span>
<span id="cb9-93"><a href="building-the-datasets.html#cb9-93" tabindex="-1"></a></span>
<span id="cb9-94"><a href="building-the-datasets.html#cb9-94" tabindex="-1"></a><span class="co">#Save the dataset</span></span>
<span id="cb9-95"><a href="building-the-datasets.html#cb9-95" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_fapbm,</span></span>
<span id="cb9-96"><a href="building-the-datasets.html#cb9-96" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb9-97"><a href="building-the-datasets.html#cb9-97" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb9-98"><a href="building-the-datasets.html#cb9-98" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_FAPBM.csv&quot;,</span></span>
<span id="cb9-99"><a href="building-the-datasets.html#cb9-99" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb9-100"><a href="building-the-datasets.html#cb9-100" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="for-madagascar" class="section level5 hasAnchor" number="1.2.6.2.3">
<h5><span class="header-section-number">1.2.6.2.3</span> For Madagascar<a href="building-the-datasets.html#for-madagascar" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>A dataset is built from the WDPA. The only modification consists in adding region and country names, plus IUCN category description.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="building-the-datasets.html#cb10-1" tabindex="-1"></a>data_wdpa <span class="ot">=</span></span>
<span id="cb10-2"><a href="building-the-datasets.html#cb10-2" tabindex="-1"></a>  <span class="co">#st_read(&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;) %&gt;%</span></span>
<span id="cb10-3"><a href="building-the-datasets.html#cb10-3" tabindex="-1"></a>  <span class="fu">s3read_using</span>(sf<span class="sc">::</span>st_read,</span>
<span id="cb10-4"><a href="building-the-datasets.html#cb10-4" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;</span>,</span>
<span id="cb10-5"><a href="building-the-datasets.html#cb10-5" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb10-6"><a href="building-the-datasets.html#cb10-6" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="building-the-datasets.html#cb10-7" tabindex="-1"></a>  <span class="fu">clean_names</span>()</span>
<span id="cb10-8"><a href="building-the-datasets.html#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="building-the-datasets.html#cb10-9" tabindex="-1"></a>data_pa_mdg <span class="ot">=</span> data_wdpa <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="building-the-datasets.html#cb10-10" tabindex="-1"></a>  <span class="fu">filter</span>(iso3 <span class="sc">==</span> <span class="st">&quot;MDG&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="building-the-datasets.html#cb10-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_clean =</span> <span class="fu">make_clean_names</span>(name), <span class="at">.after =</span> <span class="st">&quot;name&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="building-the-datasets.html#cb10-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_km2 =</span> rep_area, <span class="at">.after =</span> <span class="st">&quot;rep_area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-13"><a href="building-the-datasets.html#cb10-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">region_afd =</span> <span class="st">&quot;DR OCEAN INDIEN&quot;</span>, </span>
<span id="cb10-14"><a href="building-the-datasets.html#cb10-14" tabindex="-1"></a>         <span class="at">name_pa =</span> name,</span>
<span id="cb10-15"><a href="building-the-datasets.html#cb10-15" tabindex="-1"></a>         <span class="at">region =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb10-16"><a href="building-the-datasets.html#cb10-16" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb10-17"><a href="building-the-datasets.html#cb10-17" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.region.name&quot;</span>),</span>
<span id="cb10-18"><a href="building-the-datasets.html#cb10-18" tabindex="-1"></a>         <span class="at">sub_region =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb10-19"><a href="building-the-datasets.html#cb10-19" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb10-20"><a href="building-the-datasets.html#cb10-20" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.regionsub.name&quot;</span>),</span>
<span id="cb10-21"><a href="building-the-datasets.html#cb10-21" tabindex="-1"></a>         <span class="at">country_en =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb10-22"><a href="building-the-datasets.html#cb10-22" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb10-23"><a href="building-the-datasets.html#cb10-23" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.en&quot;</span>),</span>
<span id="cb10-24"><a href="building-the-datasets.html#cb10-24" tabindex="-1"></a>         <span class="at">country_fr =</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(<span class="at">sourcevar =</span> iso3,</span>
<span id="cb10-25"><a href="building-the-datasets.html#cb10-25" tabindex="-1"></a>                              <span class="at">origin =</span> <span class="st">&quot;iso3c&quot;</span>,</span>
<span id="cb10-26"><a href="building-the-datasets.html#cb10-26" tabindex="-1"></a>                              <span class="at">destination =</span> <span class="st">&quot;un.name.fr&quot;</span>),</span>
<span id="cb10-27"><a href="building-the-datasets.html#cb10-27" tabindex="-1"></a>         <span class="at">.after =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a href="building-the-datasets.html#cb10-28" tabindex="-1"></a>  <span class="co">#Add the description of IUCN from its category</span></span>
<span id="cb10-29"><a href="building-the-datasets.html#cb10-29" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iucn_des_fr =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-30"><a href="building-the-datasets.html#cb10-30" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Réserve naturelle intégrale&quot;</span>,</span>
<span id="cb10-31"><a href="building-the-datasets.html#cb10-31" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Zone de nature sauvage&quot;</span>,</span>
<span id="cb10-32"><a href="building-the-datasets.html#cb10-32" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;Parc national&quot;</span>, </span>
<span id="cb10-33"><a href="building-the-datasets.html#cb10-33" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Monument naturel&quot;</span>,</span>
<span id="cb10-34"><a href="building-the-datasets.html#cb10-34" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. des habitats/espèces&quot;</span>,</span>
<span id="cb10-35"><a href="building-the-datasets.html#cb10-35" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Paysage protégé&quot;</span>,</span>
<span id="cb10-36"><a href="building-the-datasets.html#cb10-36" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Gest. de ress. protégées&quot;</span>,</span>
<span id="cb10-37"><a href="building-the-datasets.html#cb10-37" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb10-38"><a href="building-the-datasets.html#cb10-38" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb10-39"><a href="building-the-datasets.html#cb10-39" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Non catégorisée&quot;</span>,</span>
<span id="cb10-40"><a href="building-the-datasets.html#cb10-40" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Non référencée&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb10-41"><a href="building-the-datasets.html#cb10-41" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">iucn_des_en =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-42"><a href="building-the-datasets.html#cb10-42" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ia&quot;</span> <span class="sc">~</span> <span class="st">&quot;Strict nature reserve&quot;</span>,</span>
<span id="cb10-43"><a href="building-the-datasets.html#cb10-43" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Ib&quot;</span> <span class="sc">~</span> <span class="st">&quot;Wilderness area&quot;</span>,</span>
<span id="cb10-44"><a href="building-the-datasets.html#cb10-44" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;II&quot;</span> <span class="sc">~</span> <span class="st">&quot;National park&quot;</span>,</span>
<span id="cb10-45"><a href="building-the-datasets.html#cb10-45" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;III&quot;</span> <span class="sc">~</span> <span class="st">&quot;Natural monument or feature&quot;</span>,</span>
<span id="cb10-46"><a href="building-the-datasets.html#cb10-46" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;IV&quot;</span> <span class="sc">~</span> <span class="st">&quot; Habitat or species management area&quot;</span>,</span>
<span id="cb10-47"><a href="building-the-datasets.html#cb10-47" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;V&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected landscape or seascape&quot;</span>,</span>
<span id="cb10-48"><a href="building-the-datasets.html#cb10-48" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;VI&quot;</span> <span class="sc">~</span> <span class="st">&quot;Protected area with sust. use of nat. res.&quot;</span>,</span>
<span id="cb10-49"><a href="building-the-datasets.html#cb10-49" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Applicable&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb10-50"><a href="building-the-datasets.html#cb10-50" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Reported&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb10-51"><a href="building-the-datasets.html#cb10-51" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">is.na</span>(wdpaid) <span class="sc">&amp;</span> iucn_cat <span class="sc">==</span> <span class="st">&quot;Not Assigned&quot;</span> <span class="sc">~</span> <span class="st">&quot;Not categorized&quot;</span>,</span>
<span id="cb10-52"><a href="building-the-datasets.html#cb10-52" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;Not referenced&quot;</span>), <span class="at">.after =</span> iucn_cat) <span class="sc">%&gt;%</span></span>
<span id="cb10-53"><a href="building-the-datasets.html#cb10-53" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_funding_first =</span> <span class="cn">NA</span>, <span class="at">year_funding_all =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-54"><a href="building-the-datasets.html#cb10-54" tabindex="-1"></a>  <span class="co">#Finally compute centroid coordindates (to create maps) and dummy for FAPBM funded</span></span>
<span id="cb10-55"><a href="building-the-datasets.html#cb10-55" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coord =</span> <span class="fu">st_centroid</span>(geom),</span>
<span id="cb10-56"><a href="building-the-datasets.html#cb10-56" tabindex="-1"></a>        <span class="at">lon =</span> <span class="fu">unlist</span>(<span class="fu">map</span>(coord,<span class="dv">1</span>)),</span>
<span id="cb10-57"><a href="building-the-datasets.html#cb10-57" tabindex="-1"></a>        <span class="at">lat =</span> <span class="fu">unlist</span>(<span class="fu">map</span>(coord,<span class="dv">2</span>)),</span>
<span id="cb10-58"><a href="building-the-datasets.html#cb10-58" tabindex="-1"></a>         <span class="at">fapbm =</span> wdpaid <span class="sc">%in%</span> data_pa_fapbm<span class="sc">$</span>wdpaid) </span>
<span id="cb10-59"><a href="building-the-datasets.html#cb10-59" tabindex="-1"></a></span>
<span id="cb10-60"><a href="building-the-datasets.html#cb10-60" tabindex="-1"></a></span>
<span id="cb10-61"><a href="building-the-datasets.html#cb10-61" tabindex="-1"></a><span class="co">#Save the dataset</span></span>
<span id="cb10-62"><a href="building-the-datasets.html#cb10-62" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_mdg,</span></span>
<span id="cb10-63"><a href="building-the-datasets.html#cb10-63" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb10-64"><a href="building-the-datasets.html#cb10-64" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb10-65"><a href="building-the-datasets.html#cb10-65" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_MDG.csv&quot;,</span></span>
<span id="cb10-66"><a href="building-the-datasets.html#cb10-66" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb10-67"><a href="building-the-datasets.html#cb10-67" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
</div>
</div>
<div id="datasets-for-confidential-analysis" class="section level3 hasAnchor" number="1.2.7">
<h3><span class="header-section-number">1.2.7</span> Datasets for confidential analysis<a href="building-the-datasets.html#datasets-for-confidential-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The first funding dataset is there to perform descriptive statistics on project funding. Thus we do not need to have one line per PA, as it is not possible to isolate the funding a given WDPAID has received. We simply save the SIOP dataset for project reported as PAs related.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="building-the-datasets.html#cb11-1" tabindex="-1"></a><span class="co">#Listing relevant variables for descriptive statistics</span></span>
<span id="cb11-2"><a href="building-the-datasets.html#cb11-2" tabindex="-1"></a>list_var_fund <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;id_projet&quot;</span>, <span class="st">&quot;name_pa&quot;</span>, <span class="st">&quot;id_concours&quot;</span>,</span>
<span id="cb11-3"><a href="building-the-datasets.html#cb11-3" tabindex="-1"></a>                <span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;country_en&quot;</span>, <span class="st">&quot;country_fr&quot;</span>, <span class="st">&quot;iso3&quot;</span>,</span>
<span id="cb11-4"><a href="building-the-datasets.html#cb11-4" tabindex="-1"></a>                <span class="st">&quot;region_afd&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&quot;sub_region&quot;</span>,</span>
<span id="cb11-5"><a href="building-the-datasets.html#cb11-5" tabindex="-1"></a>                <span class="st">&quot;area_km2&quot;</span>, <span class="st">&quot;rep_area&quot;</span>, <span class="st">&quot;area_afd_km2&quot;</span>,</span>
<span id="cb11-6"><a href="building-the-datasets.html#cb11-6" tabindex="-1"></a>                <span class="st">&quot;cofinanciers&quot;</span>, <span class="st">&quot;cofinanciers_siop&quot;</span>,</span>
<span id="cb11-7"><a href="building-the-datasets.html#cb11-7" tabindex="-1"></a>                  <span class="st">&quot;mt_fin_global_af_d_prevu_devise&quot;</span>,</span>
<span id="cb11-8"><a href="building-the-datasets.html#cb11-8" tabindex="-1"></a>                  <span class="st">&quot;montant_prevu_concours_euro_octroi&quot;</span>,</span>
<span id="cb11-9"><a href="building-the-datasets.html#cb11-9" tabindex="-1"></a>                  <span class="st">&quot;mt_global_projet_prevu_devise&quot;</span>,</span>
<span id="cb11-10"><a href="building-the-datasets.html#cb11-10" tabindex="-1"></a>                  <span class="st">&quot;mt_part_cofinancier_prevu_euro&quot;</span>,</span>
<span id="cb11-11"><a href="building-the-datasets.html#cb11-11" tabindex="-1"></a>                  <span class="st">&quot;libelle_produit&quot;</span>,</span>
<span id="cb11-12"><a href="building-the-datasets.html#cb11-12" tabindex="-1"></a>                  <span class="st">&quot;date_funding&quot;</span>,</span>
<span id="cb11-13"><a href="building-the-datasets.html#cb11-13" tabindex="-1"></a>                  <span class="st">&quot;year_funding&quot;</span>)</span>
<span id="cb11-14"><a href="building-the-datasets.html#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="building-the-datasets.html#cb11-15" tabindex="-1"></a></span>
<span id="cb11-16"><a href="building-the-datasets.html#cb11-16" tabindex="-1"></a><span class="co">#Defining dataset for descriptive statistics on PAs funding. Keep one row for each id_projet/id_concours/cofinanciers of SIOP</span></span>
<span id="cb11-17"><a href="building-the-datasets.html#cb11-17" tabindex="-1"></a>data_fund <span class="ot">=</span> data_tidy <span class="sc">%&gt;%</span></span>
<span id="cb11-18"><a href="building-the-datasets.html#cb11-18" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(list_var_fund)) <span class="sc">%&gt;%</span></span>
<span id="cb11-19"><a href="building-the-datasets.html#cb11-19" tabindex="-1"></a>  <span class="fu">group_by</span>(id_projet, id_concours, cofinanciers_siop) <span class="sc">%&gt;%</span></span>
<span id="cb11-20"><a href="building-the-datasets.html#cb11-20" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb11-21"><a href="building-the-datasets.html#cb11-21" tabindex="-1"></a></span>
<span id="cb11-22"><a href="building-the-datasets.html#cb11-22" tabindex="-1"></a></span>
<span id="cb11-23"><a href="building-the-datasets.html#cb11-23" tabindex="-1"></a><span class="co">#fwrite(data_fund, &quot;data_tidy/BDD_AFD_fund.csv&quot;)</span></span>
<span id="cb11-24"><a href="building-the-datasets.html#cb11-24" tabindex="-1"></a><span class="co"># s3write_using(x = data_fund,</span></span>
<span id="cb11-25"><a href="building-the-datasets.html#cb11-25" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb11-26"><a href="building-the-datasets.html#cb11-26" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb11-27"><a href="building-the-datasets.html#cb11-27" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_fund.csv&quot;,</span></span>
<span id="cb11-28"><a href="building-the-datasets.html#cb11-28" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb11-29"><a href="building-the-datasets.html#cb11-29" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
<p>Then a dataset is built with funding associated to each WDPAID. Note a project can fund several WDPAID, and that AFD funding data do not make it possible to isolate the funding of each PA defined by a WDPAID.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="building-the-datasets.html#cb12-1" tabindex="-1"></a>data_fund_pa <span class="ot">=</span> data_tidy</span>
<span id="cb12-2"><a href="building-the-datasets.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="building-the-datasets.html#cb12-3" tabindex="-1"></a><span class="co">#For PAs with WDPAIDs</span></span>
<span id="cb12-4"><a href="building-the-datasets.html#cb12-4" tabindex="-1"></a>data_fund_wdpa <span class="ot">=</span> data_fund_pa <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="building-the-datasets.html#cb12-5" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="building-the-datasets.html#cb12-6" tabindex="-1"></a>  <span class="co">#We need to manually remove some WDPA_PID not relevant</span></span>
<span id="cb12-7"><a href="building-the-datasets.html#cb12-7" tabindex="-1"></a>  <span class="do">## Remove the marine area with null area of WDPAID 9035</span></span>
<span id="cb12-8"><a href="building-the-datasets.html#cb12-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;9035_A&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-9"><a href="building-the-datasets.html#cb12-9" tabindex="-1"></a>  <span class="do">## 555547861 has 3 marine PAs. The C one is chosen as the size reported by AFD (superficie_km2) matches the area reported by WDPA (https://www.protectedplanet.net/555547861)</span></span>
<span id="cb12-10"><a href="building-the-datasets.html#cb12-10" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;555547861_A&quot;</span>, <span class="st">&quot;555547861_B&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="building-the-datasets.html#cb12-11" tabindex="-1"></a>  <span class="co"># 555705345 : buffer area is also reported. Remove the buffer</span></span>
<span id="cb12-12"><a href="building-the-datasets.html#cb12-12" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;555705345_B&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="building-the-datasets.html#cb12-13" tabindex="-1"></a>  <span class="co">#555547863 : keep the WDPA_PID whose area matches the one reported by AFD employees and WDPA website (https://www.protectedplanet.net/555547863)</span></span>
<span id="cb12-14"><a href="building-the-datasets.html#cb12-14" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(wdpa_pid <span class="sc">==</span> <span class="st">&quot;555547863_A&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-15"><a href="building-the-datasets.html#cb12-15" tabindex="-1"></a>  <span class="co">#Finally, keep for each WDPAID the different funding it get</span></span>
<span id="cb12-16"><a href="building-the-datasets.html#cb12-16" tabindex="-1"></a>  <span class="fu">group_by</span>(id_projet, id_concours, wdpaid, cofinanciers) <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="building-the-datasets.html#cb12-17" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-18"><a href="building-the-datasets.html#cb12-18" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb12-19"><a href="building-the-datasets.html#cb12-19" tabindex="-1"></a></span>
<span id="cb12-20"><a href="building-the-datasets.html#cb12-20" tabindex="-1"></a><span class="co">#For PAs without WDPAIDs but a name_pa : for the PA identified by name_pa, keep id_projet/id_concours/confinanciers</span></span>
<span id="cb12-21"><a href="building-the-datasets.html#cb12-21" tabindex="-1"></a>data_fund_name <span class="ot">=</span> data_fund_pa <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href="building-the-datasets.html#cb12-22" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(name_pa) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-23"><a href="building-the-datasets.html#cb12-23" tabindex="-1"></a>  <span class="fu">group_by</span>(id_projet, id_concours, name_pa, cofinanciers) <span class="sc">%&gt;%</span></span>
<span id="cb12-24"><a href="building-the-datasets.html#cb12-24" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-25"><a href="building-the-datasets.html#cb12-25" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb12-26"><a href="building-the-datasets.html#cb12-26" tabindex="-1"></a></span>
<span id="cb12-27"><a href="building-the-datasets.html#cb12-27" tabindex="-1"></a>  <span class="co">#For PAs without WDPAIDs nor name_pa : for the PA identified by id_projet/iso3, keep id_concours/confinanciers</span></span>
<span id="cb12-28"><a href="building-the-datasets.html#cb12-28" tabindex="-1"></a>data_fund_na <span class="ot">=</span> data_fund_pa <span class="sc">%&gt;%</span></span>
<span id="cb12-29"><a href="building-the-datasets.html#cb12-29" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(wdpaid) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(name_pa) <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-30"><a href="building-the-datasets.html#cb12-30" tabindex="-1"></a>  <span class="fu">group_by</span>(id_projet, iso3, id_concours, cofinanciers) <span class="sc">%&gt;%</span></span>
<span id="cb12-31"><a href="building-the-datasets.html#cb12-31" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="building-the-datasets.html#cb12-32" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb12-33"><a href="building-the-datasets.html#cb12-33" tabindex="-1"></a></span>
<span id="cb12-34"><a href="building-the-datasets.html#cb12-34" tabindex="-1"></a></span>
<span id="cb12-35"><a href="building-the-datasets.html#cb12-35" tabindex="-1"></a>data_fund_pa_nodupl <span class="ot">=</span> <span class="fu">rbind</span>(data_fund_wdpa, data_fund_name, data_fund_na)</span>
<span id="cb12-36"><a href="building-the-datasets.html#cb12-36" tabindex="-1"></a></span>
<span id="cb12-37"><a href="building-the-datasets.html#cb12-37" tabindex="-1"></a><span class="co">#fwrite(data_fund, &quot;data_tidy/BDD_PA_AFD_fund.csv&quot;)</span></span>
<span id="cb12-38"><a href="building-the-datasets.html#cb12-38" tabindex="-1"></a><span class="co"># s3write_using(x = data_fund_pa_nodupl,</span></span>
<span id="cb12-39"><a href="building-the-datasets.html#cb12-39" tabindex="-1"></a><span class="co">#               FUN = readr::write_delim,</span></span>
<span id="cb12-40"><a href="building-the-datasets.html#cb12-40" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb12-41"><a href="building-the-datasets.html#cb12-41" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_AFD_fund_PA.csv&quot;,</span></span>
<span id="cb12-42"><a href="building-the-datasets.html#cb12-42" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb12-43"><a href="building-the-datasets.html#cb12-43" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
<div id="a-polygon-dataset-for-specific-use" class="section level3 hasAnchor" number="1.2.8">
<h3><span class="header-section-number">1.2.8</span> A polygon dataset for specific use<a href="building-the-datasets.html#a-polygon-dataset-for-specific-use" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The funding and non-funding datasets with polygon, for maps creation.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="building-the-datasets.html#cb13-1" tabindex="-1"></a><span class="co">#Loading the datasets</span></span>
<span id="cb13-2"><a href="building-the-datasets.html#cb13-2" tabindex="-1"></a><span class="do">##WDPA data (polygons)</span></span>
<span id="cb13-3"><a href="building-the-datasets.html#cb13-3" tabindex="-1"></a>data_wdpa <span class="ot">=</span></span>
<span id="cb13-4"><a href="building-the-datasets.html#cb13-4" tabindex="-1"></a>  <span class="co">#st_read(&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;) %&gt;%</span></span>
<span id="cb13-5"><a href="building-the-datasets.html#cb13-5" tabindex="-1"></a>  <span class="fu">s3read_using</span>(sf<span class="sc">::</span>st_read,</span>
<span id="cb13-6"><a href="building-the-datasets.html#cb13-6" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_raw/wdpa/wdpa_shp_global_raw.gpkg&quot;</span>,</span>
<span id="cb13-7"><a href="building-the-datasets.html#cb13-7" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-8"><a href="building-the-datasets.html#cb13-8" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="building-the-datasets.html#cb13-9" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-10"><a href="building-the-datasets.html#cb13-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(wdpaid, wdpa_pid, geom)) <span class="sc">%&gt;%</span></span>
<span id="cb13-11"><a href="building-the-datasets.html#cb13-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geom_type =</span> sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(geom))</span>
<span id="cb13-12"><a href="building-the-datasets.html#cb13-12" tabindex="-1"></a></span>
<span id="cb13-13"><a href="building-the-datasets.html#cb13-13" tabindex="-1"></a><span class="do">## Non-confidential dataset</span></span>
<span id="cb13-14"><a href="building-the-datasets.html#cb13-14" tabindex="-1"></a>data_pa_nofund_nodupl <span class="ot">=</span> </span>
<span id="cb13-15"><a href="building-the-datasets.html#cb13-15" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_PA_AFD_nofund_nodupl.csv&quot;)</span></span>
<span id="cb13-16"><a href="building-the-datasets.html#cb13-16" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb13-17"><a href="building-the-datasets.html#cb13-17" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb13-18"><a href="building-the-datasets.html#cb13-18" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-19"><a href="building-the-datasets.html#cb13-19" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_PA_AFD_nofund_nodupl.csv&quot;</span>,</span>
<span id="cb13-20"><a href="building-the-datasets.html#cb13-20" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-21"><a href="building-the-datasets.html#cb13-21" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb13-22"><a href="building-the-datasets.html#cb13-22" tabindex="-1"></a></span>
<span id="cb13-23"><a href="building-the-datasets.html#cb13-23" tabindex="-1"></a><span class="do">## Confidential dataset</span></span>
<span id="cb13-24"><a href="building-the-datasets.html#cb13-24" tabindex="-1"></a>data_pa_fund_nodupl <span class="ot">=</span> </span>
<span id="cb13-25"><a href="building-the-datasets.html#cb13-25" tabindex="-1"></a>  <span class="co">#fread(&quot;data_tidy/BDD_AFD_fund_PA.csv&quot;)</span></span>
<span id="cb13-26"><a href="building-the-datasets.html#cb13-26" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb13-27"><a href="building-the-datasets.html#cb13-27" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb13-28"><a href="building-the-datasets.html#cb13-28" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-29"><a href="building-the-datasets.html#cb13-29" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_AFD_fund_PA.csv&quot;</span>,</span>
<span id="cb13-30"><a href="building-the-datasets.html#cb13-30" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb13-31"><a href="building-the-datasets.html#cb13-31" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb13-32"><a href="building-the-datasets.html#cb13-32" tabindex="-1"></a></span>
<span id="cb13-33"><a href="building-the-datasets.html#cb13-33" tabindex="-1"></a><span class="co">#Creating the dataset of with geospatial information (polygons)</span></span>
<span id="cb13-34"><a href="building-the-datasets.html#cb13-34" tabindex="-1"></a>data_pa_nofund_shp <span class="ot">=</span> data_pa_nofund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb13-35"><a href="building-the-datasets.html#cb13-35" tabindex="-1"></a>  <span class="fu">left_join</span>(data_wdpa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;wdpa_pid&quot;</span>))</span>
<span id="cb13-36"><a href="building-the-datasets.html#cb13-36" tabindex="-1"></a>data_pa_fund_shp <span class="ot">=</span> data_pa_fund_nodupl <span class="sc">%&gt;%</span></span>
<span id="cb13-37"><a href="building-the-datasets.html#cb13-37" tabindex="-1"></a>  <span class="fu">left_join</span>(data_wdpa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;wdpaid&quot;</span>, <span class="st">&quot;wdpa_pid&quot;</span>))</span>
<span id="cb13-38"><a href="building-the-datasets.html#cb13-38" tabindex="-1"></a>data_pa_nofund_polygon_shp <span class="ot">=</span> data_pa_nofund_shp <span class="sc">%&gt;%</span></span>
<span id="cb13-39"><a href="building-the-datasets.html#cb13-39" tabindex="-1"></a>  <span class="fu">filter</span>(geom_type <span class="sc">==</span> <span class="st">&quot;MULTIPOLYGON&quot;</span>)</span>
<span id="cb13-40"><a href="building-the-datasets.html#cb13-40" tabindex="-1"></a></span>
<span id="cb13-41"><a href="building-the-datasets.html#cb13-41" tabindex="-1"></a></span>
<span id="cb13-42"><a href="building-the-datasets.html#cb13-42" tabindex="-1"></a><span class="co">#Saving the datasets </span></span>
<span id="cb13-43"><a href="building-the-datasets.html#cb13-43" tabindex="-1"></a></span>
<span id="cb13-44"><a href="building-the-datasets.html#cb13-44" tabindex="-1"></a><span class="co"># st_write(pa_shp,</span></span>
<span id="cb13-45"><a href="building-the-datasets.html#cb13-45" tabindex="-1"></a><span class="co">#          dsn = &quot;data_tidy/BDD_pa_afd_shp_pub.gpkg&quot;,</span></span>
<span id="cb13-46"><a href="building-the-datasets.html#cb13-46" tabindex="-1"></a><span class="co">#          delete_dsn = TRUE)</span></span>
<span id="cb13-47"><a href="building-the-datasets.html#cb13-47" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_nofund_shp,</span></span>
<span id="cb13-48"><a href="building-the-datasets.html#cb13-48" tabindex="-1"></a><span class="co">#               FUN = sf::st_write,</span></span>
<span id="cb13-49"><a href="building-the-datasets.html#cb13-49" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb13-50"><a href="building-the-datasets.html#cb13-50" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_nofund_shp.geojson&quot;,</span></span>
<span id="cb13-51"><a href="building-the-datasets.html#cb13-51" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb13-52"><a href="building-the-datasets.html#cb13-52" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb13-53"><a href="building-the-datasets.html#cb13-53" tabindex="-1"></a></span>
<span id="cb13-54"><a href="building-the-datasets.html#cb13-54" tabindex="-1"></a><span class="co"># st_write(pa_shp,</span></span>
<span id="cb13-55"><a href="building-the-datasets.html#cb13-55" tabindex="-1"></a><span class="co">#          dsn = &quot;data_tidy/BDD_pa_afd_shp_pub.gpkg&quot;,</span></span>
<span id="cb13-56"><a href="building-the-datasets.html#cb13-56" tabindex="-1"></a><span class="co">#          delete_dsn = TRUE)</span></span>
<span id="cb13-57"><a href="building-the-datasets.html#cb13-57" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_nofund_polygon_shp,</span></span>
<span id="cb13-58"><a href="building-the-datasets.html#cb13-58" tabindex="-1"></a><span class="co">#               FUN = sf::st_write,</span></span>
<span id="cb13-59"><a href="building-the-datasets.html#cb13-59" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb13-60"><a href="building-the-datasets.html#cb13-60" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_nofund_polygon_shp.geojson&quot;,</span></span>
<span id="cb13-61"><a href="building-the-datasets.html#cb13-61" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb13-62"><a href="building-the-datasets.html#cb13-62" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb13-63"><a href="building-the-datasets.html#cb13-63" tabindex="-1"></a>    </span>
<span id="cb13-64"><a href="building-the-datasets.html#cb13-64" tabindex="-1"></a><span class="co"># st_write(pa_shp,</span></span>
<span id="cb13-65"><a href="building-the-datasets.html#cb13-65" tabindex="-1"></a><span class="co">#          dsn = &quot;data_tidy/BDD_pa_afd_shp_pub.gpkg&quot;,</span></span>
<span id="cb13-66"><a href="building-the-datasets.html#cb13-66" tabindex="-1"></a><span class="co">#          delete_dsn = TRUE)</span></span>
<span id="cb13-67"><a href="building-the-datasets.html#cb13-67" tabindex="-1"></a><span class="co"># s3write_using(x = data_pa_fund_shp,</span></span>
<span id="cb13-68"><a href="building-the-datasets.html#cb13-68" tabindex="-1"></a><span class="co">#               FUN = sf::st_write,</span></span>
<span id="cb13-69"><a href="building-the-datasets.html#cb13-69" tabindex="-1"></a><span class="co">#               delim = &quot;;&quot;,</span></span>
<span id="cb13-70"><a href="building-the-datasets.html#cb13-70" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/BDD_PA_AFD_fund_shp.geojson&quot;,</span></span>
<span id="cb13-71"><a href="building-the-datasets.html#cb13-71" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb13-72"><a href="building-the-datasets.html#cb13-72" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>
</div>
</div>
<div id="computing-total-areas-covered-by-pas-in-the-sample" class="section level2 hasAnchor" number="1.3">
<h2><span class="header-section-number">1.3</span> Computing total areas covered by PAs in the sample<a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Knowing the total area covered by PAs at different level of aggregation is interesting per se. It is also necessary to compute several statistics (e.g average funding by unit of area). According to the WDPA documentation, it is likely that some reported polygons overlap. Simply summing the areas would thus lead to a biased estimate of the total area at a given level of aggregation. We follow the procedure of the WDPA (<a href="https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage" class="uri">https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage</a>). Our case is simpler as all of the PAs we consider are given a polygon.</p>
<ol style="list-style-type: decimal">
<li><p>The layer is converted to Mollweide (an equal area projection) and the area of each polygon is calculated, in km2.</p></li>
<li><p>Intersection of polygons and the corresponding area are computed.</p></li>
<li><p>Then the intersection can be aggregated at country, region or world level. Then it is subtracted to the sum of areas at country, region or world level. Note that intersections between PAs whose polygon is unknown won’t be taken into account.</p></li>
</ol>
<p>Note that the following codes are about computing total area at country/region/world level, taking potential intersections into account. It is not about generating a new shape files for the impact analysis. Indeed the overlap should be taken into account in the impact evaluation analysis codes.</p>
<div id="computations-of-polygons-area" class="section level3 hasAnchor" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Computations of polygons’ area<a href="building-the-datasets.html#computations-of-polygons-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="building-the-datasets.html#cb14-1" tabindex="-1"></a><span class="co">#Importing shapefiles</span></span>
<span id="cb14-2"><a href="building-the-datasets.html#cb14-2" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb14-3"><a href="building-the-datasets.html#cb14-3" tabindex="-1"></a>pa_shp <span class="ot">=</span> </span>
<span id="cb14-4"><a href="building-the-datasets.html#cb14-4" tabindex="-1"></a>  <span class="co">#read_sf(&quot;data_tidy/BDD_PA_AFD_shp.gpkg&quot;) %&gt;%</span></span>
<span id="cb14-5"><a href="building-the-datasets.html#cb14-5" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">s3read_using</span>(</span>
<span id="cb14-6"><a href="building-the-datasets.html#cb14-6" tabindex="-1"></a>  <span class="at">FUN =</span> sf<span class="sc">::</span>read_sf,</span>
<span id="cb14-7"><a href="building-the-datasets.html#cb14-7" tabindex="-1"></a>  <span class="co"># Mettre les options de FUN ici</span></span>
<span id="cb14-8"><a href="building-the-datasets.html#cb14-8" tabindex="-1"></a>  <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_PA_AFD_nofund_shp.gpkg&quot;</span>,</span>
<span id="cb14-9"><a href="building-the-datasets.html#cb14-9" tabindex="-1"></a>  <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb14-10"><a href="building-the-datasets.html#cb14-10" tabindex="-1"></a>  <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-11"><a href="building-the-datasets.html#cb14-11" tabindex="-1"></a>  <span class="co">#Take polygons only</span></span>
<span id="cb14-12"><a href="building-the-datasets.html#cb14-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">geom_type =</span> <span class="fu">as.character</span>(<span class="fu">st_geometry_type</span>(geom))) <span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="building-the-datasets.html#cb14-13" tabindex="-1"></a>  <span class="fu">filter</span>(geom_type <span class="sc">==</span> <span class="st">&quot;MULTIPOLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-14"><a href="building-the-datasets.html#cb14-14" tabindex="-1"></a>  <span class="co">#Ensure all geometries are valid</span></span>
<span id="cb14-15"><a href="building-the-datasets.html#cb14-15" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-16"><a href="building-the-datasets.html#cb14-16" tabindex="-1"></a>  <span class="co">#From multipolygon to polygon</span></span>
<span id="cb14-17"><a href="building-the-datasets.html#cb14-17" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="at">to=</span><span class="st">&quot;POLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-18"><a href="building-the-datasets.html#cb14-18" tabindex="-1"></a>  <span class="co">#Select relevant variables</span></span>
<span id="cb14-19"><a href="building-the-datasets.html#cb14-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(wdpaid, area_afd_km2, rep_area, geom, iso3, region_afd, region, sub_region, year_funding_first, year_funding_all)) </span>
<span id="cb14-20"><a href="building-the-datasets.html#cb14-20" tabindex="-1"></a></span>
<span id="cb14-21"><a href="building-the-datasets.html#cb14-21" tabindex="-1"></a><span class="co">#Spatial definition of wdpaid 555547988 overlaps CMR and CAF. Wdpaid 1245 corresponds to the CMR part. The overlap is removed and iso3 redefined so that 555547988 is CAF only. </span></span>
<span id="cb14-22"><a href="building-the-datasets.html#cb14-22" tabindex="-1"></a>geom_555547988_1245 <span class="ot">=</span> <span class="fu">st_difference</span>(pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>geom, pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">1245</span>,]<span class="sc">$</span>geom)</span>
<span id="cb14-23"><a href="building-the-datasets.html#cb14-23" tabindex="-1"></a>pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>geom <span class="ot">=</span> geom_555547988_1245</span>
<span id="cb14-24"><a href="building-the-datasets.html#cb14-24" tabindex="-1"></a>pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">555547988</span>,]<span class="sc">$</span>iso3 <span class="ot">=</span> <span class="st">&quot;CAF&quot;</span></span>
<span id="cb14-25"><a href="building-the-datasets.html#cb14-25" tabindex="-1"></a></span>
<span id="cb14-26"><a href="building-the-datasets.html#cb14-26" tabindex="-1"></a><span class="co">#Define a tidy version of the former dataset, with modifications on wdpaid 555547988</span></span>
<span id="cb14-27"><a href="building-the-datasets.html#cb14-27" tabindex="-1"></a>pa_shp_tidy <span class="ot">=</span> pa_shp <span class="sc">%&gt;%</span></span>
<span id="cb14-28"><a href="building-the-datasets.html#cb14-28" tabindex="-1"></a>  <span class="co">#Project to Mollweide to compute relevant areas in km2</span></span>
<span id="cb14-29"><a href="building-the-datasets.html#cb14-29" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="st">&quot;+proj=moll +datum=WGS84&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-30"><a href="building-the-datasets.html#cb14-30" tabindex="-1"></a>  <span class="co">#Compute areas in km2 from the geometry, in km2. It must be equal to gis_a by definition </span></span>
<span id="cb14-31"><a href="building-the-datasets.html#cb14-31" tabindex="-1"></a>  <span class="co">#Then to take into account potential refinements of the geometries (as for wdpaid 55547988), a variable for relevant area is defined. It takes rep_a value except for modified geometries where area_sf_moll is taken</span></span>
<span id="cb14-32"><a href="building-the-datasets.html#cb14-32" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_sf_moll =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom)<span class="sc">/</span><span class="fl">1e6</span>),</span>
<span id="cb14-33"><a href="building-the-datasets.html#cb14-33" tabindex="-1"></a>         <span class="at">area_afd_km2 =</span> <span class="fu">ifelse</span>(wdpaid <span class="sc">==</span> <span class="dv">555547988</span>, <span class="at">yes =</span> area_sf_moll, <span class="at">no =</span> rep_area))</span></code></pre></div>
</div>
<div id="computing-the-intersection-at-country-region-world-level" class="section level3 hasAnchor" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Computing the intersection at country, region, world level<a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="building-the-datasets.html#cb15-1" tabindex="-1"></a><span class="co">#Compute intersecting areas of polygons</span></span>
<span id="cb15-2"><a href="building-the-datasets.html#cb15-2" tabindex="-1"></a>pa_int <span class="ot">=</span> <span class="fu">st_intersection</span>(pa_shp_tidy, pa_shp_tidy) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="building-the-datasets.html#cb15-3" tabindex="-1"></a>  <span class="co">#Remove intersection of polygons with themselves</span></span>
<span id="cb15-4"><a href="building-the-datasets.html#cb15-4" tabindex="-1"></a>  <span class="fu">subset</span>(wdpaid <span class="sc">!=</span> wdpaid<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="building-the-datasets.html#cb15-5" tabindex="-1"></a>  <span class="co">#If one of the two intersectin polygon have unknwon area, then it is not necessary to subtract the interesction area. Indeed there is no double-counting of the intersection in this case, when both polygon areas are summed.</span></span>
<span id="cb15-6"><a href="building-the-datasets.html#cb15-6" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="fu">is.na</span>(area_afd_km2) <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;</span> <span class="fu">is.na</span>(area_afd_km2<span class="fl">.1</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-7"><a href="building-the-datasets.html#cb15-7" tabindex="-1"></a>  <span class="co">#Compute the intersecting areas (pa_shp already in Mollweide projection) in km2</span></span>
<span id="cb15-8"><a href="building-the-datasets.html#cb15-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_int =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(geom)<span class="sc">/</span><span class="fl">1e6</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-9"><a href="building-the-datasets.html#cb15-9" tabindex="-1"></a>  <span class="co">#Now duplicates need to be removed : intersection of X with Y AND intersection of Y with X are reported. We need only one.</span></span>
<span id="cb15-10"><a href="building-the-datasets.html#cb15-10" tabindex="-1"></a>  <span class="co">#An id_int to identify the intersection of a given pair</span></span>
<span id="cb15-11"><a href="building-the-datasets.html#cb15-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int =</span> <span class="fu">paste0</span>(wdpaid, <span class="st">&quot;_&quot;</span>, wdpaid<span class="fl">.1</span>), <span class="at">.before =</span> wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="building-the-datasets.html#cb15-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int_temp =</span> <span class="fu">paste0</span>(wdpaid, <span class="st">&quot;_&quot;</span>, wdpaid<span class="fl">.1</span>), <span class="at">.before =</span> wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb15-13"><a href="building-the-datasets.html#cb15-13" tabindex="-1"></a>  <span class="co">#create a mirror idX_idY --&gt; idY_idX so that we identify the both member of a pair with the same id</span></span>
<span id="cb15-14"><a href="building-the-datasets.html#cb15-14" tabindex="-1"></a>  <span class="fu">separate</span>(id_int_temp, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;id_temp1&quot;</span>, <span class="st">&quot;id_temp2&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-15"><a href="building-the-datasets.html#cb15-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_int_rev =</span> <span class="fu">case_when</span>(</span>
<span id="cb15-16"><a href="building-the-datasets.html#cb15-16" tabindex="-1"></a>    id_temp1 <span class="sc">&lt;</span> id_temp2 <span class="sc">~</span> <span class="fu">paste</span>(id_temp1, id_temp2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb15-17"><a href="building-the-datasets.html#cb15-17" tabindex="-1"></a>    id_temp1 <span class="sc">&gt;</span> id_temp2 <span class="sc">~</span> <span class="fu">paste</span>(id_temp2, id_temp1, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb15-18"><a href="building-the-datasets.html#cb15-18" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">paste</span>(id_temp1, id_temp2, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)),</span>
<span id="cb15-19"><a href="building-the-datasets.html#cb15-19" tabindex="-1"></a>    <span class="at">.after =</span> id_int) <span class="sc">%&gt;%</span></span>
<span id="cb15-20"><a href="building-the-datasets.html#cb15-20" tabindex="-1"></a>  <span class="co">#finally, get rid of the duplicates (have the same id_int_rev)</span></span>
<span id="cb15-21"><a href="building-the-datasets.html#cb15-21" tabindex="-1"></a>  <span class="fu">group_by</span>(id_int_rev) <span class="sc">%&gt;%</span></span>
<span id="cb15-22"><a href="building-the-datasets.html#cb15-22" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="building-the-datasets.html#cb15-23" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="building-the-datasets.html#cb15-24" tabindex="-1"></a>  <span class="co">#select relevant variables only</span></span>
<span id="cb15-25"><a href="building-the-datasets.html#cb15-25" tabindex="-1"></a>  <span class="fu">select</span>(wdpaid, iso3, region_afd, region, sub_region, year_funding_first, wdpaid<span class="fl">.1</span>, iso3<span class="fl">.1</span>, region_afd<span class="fl">.1</span>, region<span class="fl">.1</span>, sub_region<span class="fl">.1</span>, year_funding_first<span class="fl">.1</span>, geom, area_int)</span>
<span id="cb15-26"><a href="building-the-datasets.html#cb15-26" tabindex="-1"></a></span>
<span id="cb15-27"><a href="building-the-datasets.html#cb15-27" tabindex="-1"></a><span class="co">#Computing the total area of intersections</span></span>
<span id="cb15-28"><a href="building-the-datasets.html#cb15-28" tabindex="-1"></a><span class="co">#At country level ...</span></span>
<span id="cb15-29"><a href="building-the-datasets.html#cb15-29" tabindex="-1"></a>pa_int_ctry <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb15-30"><a href="building-the-datasets.html#cb15-30" tabindex="-1"></a>  <span class="co">#Only overlapping PAs in the same country are considered</span></span>
<span id="cb15-31"><a href="building-the-datasets.html#cb15-31" tabindex="-1"></a>  <span class="fu">subset</span>(iso3 <span class="sc">==</span>  iso3<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-32"><a href="building-the-datasets.html#cb15-32" tabindex="-1"></a>  <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb15-33"><a href="building-the-datasets.html#cb15-33" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_area_int =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb15-34"><a href="building-the-datasets.html#cb15-34" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb15-35"><a href="building-the-datasets.html#cb15-35" tabindex="-1"></a></span>
<span id="cb15-36"><a href="building-the-datasets.html#cb15-36" tabindex="-1"></a><span class="co">#At region level</span></span>
<span id="cb15-37"><a href="building-the-datasets.html#cb15-37" tabindex="-1"></a><span class="co">#AFD regions : not performed as some PAs have multiple DR and only one kept</span></span>
<span id="cb15-38"><a href="building-the-datasets.html#cb15-38" tabindex="-1"></a><span class="co"># pa_int_dr = pa_int %&gt;%</span></span>
<span id="cb15-39"><a href="building-the-datasets.html#cb15-39" tabindex="-1"></a><span class="co">#   #Only overlapping PAs in the same DR are considered</span></span>
<span id="cb15-40"><a href="building-the-datasets.html#cb15-40" tabindex="-1"></a><span class="co">#   subset(region_afd == region_afd.1) %&gt;%</span></span>
<span id="cb15-41"><a href="building-the-datasets.html#cb15-41" tabindex="-1"></a><span class="co">#   group_by(region_afd) %&gt;%</span></span>
<span id="cb15-42"><a href="building-the-datasets.html#cb15-42" tabindex="-1"></a><span class="co">#   summarize(tot_area_int = sum(area_int)) %&gt;%</span></span>
<span id="cb15-43"><a href="building-the-datasets.html#cb15-43" tabindex="-1"></a><span class="co">#   st_drop_geometry()</span></span>
<span id="cb15-44"><a href="building-the-datasets.html#cb15-44" tabindex="-1"></a></span>
<span id="cb15-45"><a href="building-the-datasets.html#cb15-45" tabindex="-1"></a><span class="co">#UN regions</span></span>
<span id="cb15-46"><a href="building-the-datasets.html#cb15-46" tabindex="-1"></a>pa_int_region <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb15-47"><a href="building-the-datasets.html#cb15-47" tabindex="-1"></a>  <span class="co">#Only overlapping PAs in the same DR are considered</span></span>
<span id="cb15-48"><a href="building-the-datasets.html#cb15-48" tabindex="-1"></a>  <span class="fu">subset</span>(region <span class="sc">==</span> region<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-49"><a href="building-the-datasets.html#cb15-49" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb15-50"><a href="building-the-datasets.html#cb15-50" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_area_int =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb15-51"><a href="building-the-datasets.html#cb15-51" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb15-52"><a href="building-the-datasets.html#cb15-52" tabindex="-1"></a><span class="co">#UN sub-regions</span></span>
<span id="cb15-53"><a href="building-the-datasets.html#cb15-53" tabindex="-1"></a>pa_int_subregion <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb15-54"><a href="building-the-datasets.html#cb15-54" tabindex="-1"></a>  <span class="co">#Only overlapping PAs in the same DR are considered</span></span>
<span id="cb15-55"><a href="building-the-datasets.html#cb15-55" tabindex="-1"></a>  <span class="fu">subset</span>(sub_region <span class="sc">==</span> sub_region<span class="fl">.1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-56"><a href="building-the-datasets.html#cb15-56" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_region) <span class="sc">%&gt;%</span></span>
<span id="cb15-57"><a href="building-the-datasets.html#cb15-57" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_area_int =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb15-58"><a href="building-the-datasets.html#cb15-58" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb15-59"><a href="building-the-datasets.html#cb15-59" tabindex="-1"></a></span>
<span id="cb15-60"><a href="building-the-datasets.html#cb15-60" tabindex="-1"></a><span class="do">##At world level : all overlap are considered</span></span>
<span id="cb15-61"><a href="building-the-datasets.html#cb15-61" tabindex="-1"></a>pa_int_wld <span class="ot">=</span> <span class="fu">sum</span>(pa_int<span class="sc">$</span>area_int) </span>
<span id="cb15-62"><a href="building-the-datasets.html#cb15-62" tabindex="-1"></a></span>
<span id="cb15-63"><a href="building-the-datasets.html#cb15-63" tabindex="-1"></a><span class="co">#Compute the total intersection for each year</span></span>
<span id="cb15-64"><a href="building-the-datasets.html#cb15-64" tabindex="-1"></a>pa_int_yr <span class="ot">=</span> pa_int <span class="sc">%&gt;%</span></span>
<span id="cb15-65"><a href="building-the-datasets.html#cb15-65" tabindex="-1"></a>  <span class="co">#Define intersection year : the date ann_c of the later PA in the pair</span></span>
<span id="cb15-66"><a href="building-the-datasets.html#cb15-66" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-67"><a href="building-the-datasets.html#cb15-67" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annee_int =</span> <span class="fu">max</span>(year_funding_first, year_funding_first<span class="fl">.1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-68"><a href="building-the-datasets.html#cb15-68" tabindex="-1"></a>  <span class="fu">group_by</span>(annee_int) <span class="sc">%&gt;%</span></span>
<span id="cb15-69"><a href="building-the-datasets.html#cb15-69" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">tot_int_km2 =</span> <span class="fu">sum</span>(area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb15-70"><a href="building-the-datasets.html#cb15-70" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb15-71"><a href="building-the-datasets.html#cb15-71" tabindex="-1"></a></span>
<span id="cb15-72"><a href="building-the-datasets.html#cb15-72" tabindex="-1"></a><span class="co"># fwrite(pa_int_yr,</span></span>
<span id="cb15-73"><a href="building-the-datasets.html#cb15-73" tabindex="-1"></a><span class="co">#        &quot;data_tidy/area/pa_int_yr.csv&quot;)</span></span>
<span id="cb15-74"><a href="building-the-datasets.html#cb15-74" tabindex="-1"></a><span class="fu">s3write_using</span>(<span class="at">x =</span> pa_int_yr,</span>
<span id="cb15-75"><a href="building-the-datasets.html#cb15-75" tabindex="-1"></a>              <span class="at">FUN =</span> data.table<span class="sc">::</span>fwrite,</span>
<span id="cb15-76"><a href="building-the-datasets.html#cb15-76" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_tidy/area/pa_int_yr.csv&quot;</span>,</span>
<span id="cb15-77"><a href="building-the-datasets.html#cb15-77" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb15-78"><a href="building-the-datasets.html#cb15-78" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span></code></pre></div>
</div>
<div id="computing-total-areas-without-intersection" class="section level3 hasAnchor" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Computing total areas without intersection<a href="building-the-datasets.html#computing-total-areas-without-intersection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="building-the-datasets.html#cb16-1" tabindex="-1"></a>data_pa_afd <span class="ot">=</span> </span>
<span id="cb16-2"><a href="building-the-datasets.html#cb16-2" tabindex="-1"></a>  <span class="co">#fread(&quot;data_raw/BDD_PA_AFD_nofund_nodupl.csv&quot;)</span></span>
<span id="cb16-3"><a href="building-the-datasets.html#cb16-3" tabindex="-1"></a>  <span class="fu">s3read_using</span>(readr<span class="sc">::</span>read_delim,</span>
<span id="cb16-4"><a href="building-the-datasets.html#cb16-4" tabindex="-1"></a>               <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>,</span>
<span id="cb16-5"><a href="building-the-datasets.html#cb16-5" tabindex="-1"></a>               <span class="at">show_col_types =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-6"><a href="building-the-datasets.html#cb16-6" tabindex="-1"></a>               <span class="at">object =</span> <span class="st">&quot;data_tidy/BDD_PA_AFD_nofund_nodupl.csv&quot;</span>,</span>
<span id="cb16-7"><a href="building-the-datasets.html#cb16-7" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb16-8"><a href="building-the-datasets.html#cb16-8" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb16-9"><a href="building-the-datasets.html#cb16-9" tabindex="-1"></a></span>
<span id="cb16-10"><a href="building-the-datasets.html#cb16-10" tabindex="-1"></a><span class="co">#At country level ...</span></span>
<span id="cb16-11"><a href="building-the-datasets.html#cb16-11" tabindex="-1"></a>pa_area_ctry <span class="ot">=</span> data_pa_afd <span class="sc">%&gt;%</span></span>
<span id="cb16-12"><a href="building-the-datasets.html#cb16-12" tabindex="-1"></a>  <span class="co">#Compute total area at country level</span></span>
<span id="cb16-13"><a href="building-the-datasets.html#cb16-13" tabindex="-1"></a>  <span class="fu">group_by</span>(iso3) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="building-the-datasets.html#cb16-14" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">area_tot_km2 =</span> <span class="fu">sum</span>(area_afd_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb16-15"><a href="building-the-datasets.html#cb16-15" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-16"><a href="building-the-datasets.html#cb16-16" tabindex="-1"></a>  <span class="co">#Add information on intersection area in each country. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb16-17"><a href="building-the-datasets.html#cb16-17" tabindex="-1"></a>  <span class="fu">left_join</span>(pa_int_ctry, <span class="at">by =</span> <span class="st">&quot;iso3&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-18"><a href="building-the-datasets.html#cb16-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_area_int =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(tot_area_int) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span>, <span class="cn">TRUE</span> <span class="sc">~</span> tot_area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb16-19"><a href="building-the-datasets.html#cb16-19" tabindex="-1"></a>  <span class="co">#Compute the total area at country level without intersection</span></span>
<span id="cb16-20"><a href="building-the-datasets.html#cb16-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">area_tot_noint_km2 =</span> area_tot_km2 <span class="sc">-</span> tot_area_int) </span>
<span id="cb16-21"><a href="building-the-datasets.html#cb16-21" tabindex="-1"></a></span>
<span id="cb16-22"><a href="building-the-datasets.html#cb16-22" tabindex="-1"></a><span class="co">#fwrite(pa_area_ctry, &quot;data_tidy/area/pa_area_ctry.csv&quot;)</span></span>
<span id="cb16-23"><a href="building-the-datasets.html#cb16-23" tabindex="-1"></a><span class="co"># s3write_using(x = pa_area_ctry,</span></span>
<span id="cb16-24"><a href="building-the-datasets.html#cb16-24" tabindex="-1"></a><span class="co">#               FUN = data.table::fwrite,</span></span>
<span id="cb16-25"><a href="building-the-datasets.html#cb16-25" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/area/pa_area_ctry.csv&quot;,</span></span>
<span id="cb16-26"><a href="building-the-datasets.html#cb16-26" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb16-27"><a href="building-the-datasets.html#cb16-27" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb16-28"><a href="building-the-datasets.html#cb16-28" tabindex="-1"></a></span>
<span id="cb16-29"><a href="building-the-datasets.html#cb16-29" tabindex="-1"></a><span class="co">#At AFD region level ...</span></span>
<span id="cb16-30"><a href="building-the-datasets.html#cb16-30" tabindex="-1"></a><span class="co"># pa_area_dr = data_pa_afd %&gt;%</span></span>
<span id="cb16-31"><a href="building-the-datasets.html#cb16-31" tabindex="-1"></a><span class="co">#   #Compute total area at dr level</span></span>
<span id="cb16-32"><a href="building-the-datasets.html#cb16-32" tabindex="-1"></a><span class="co">#   group_by(region_afd) %&gt;%</span></span>
<span id="cb16-33"><a href="building-the-datasets.html#cb16-33" tabindex="-1"></a><span class="co">#   summarize(area_tot_km2 = sum(area_afd_km2, na.rm = TRUE)) %&gt;% </span></span>
<span id="cb16-34"><a href="building-the-datasets.html#cb16-34" tabindex="-1"></a><span class="co">#   ungroup() %&gt;%</span></span>
<span id="cb16-35"><a href="building-the-datasets.html#cb16-35" tabindex="-1"></a><span class="co">#   #Add information on intersection area in each DR. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb16-36"><a href="building-the-datasets.html#cb16-36" tabindex="-1"></a><span class="co">#   left_join(pa_int_dr, by = &quot;region_afd&quot;) %&gt;%</span></span>
<span id="cb16-37"><a href="building-the-datasets.html#cb16-37" tabindex="-1"></a><span class="co">#   mutate(tot_area_int = case_when(is.na(tot_area_int) == TRUE ~0, TRUE ~tot_area_int)) %&gt;%</span></span>
<span id="cb16-38"><a href="building-the-datasets.html#cb16-38" tabindex="-1"></a><span class="co">#   #Compute the total area at country level without intersection</span></span>
<span id="cb16-39"><a href="building-the-datasets.html#cb16-39" tabindex="-1"></a><span class="co">#     mutate(area_tot_noint_km2 = area_tot_km2 - tot_area_int) %&gt;%</span></span>
<span id="cb16-40"><a href="building-the-datasets.html#cb16-40" tabindex="-1"></a><span class="co">#   st_drop_geometry()</span></span>
<span id="cb16-41"><a href="building-the-datasets.html#cb16-41" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-42"><a href="building-the-datasets.html#cb16-42" tabindex="-1"></a><span class="co"># #fwrite(pa_area_dr, &quot;data_tidy/area/pa_area_dr.csv&quot;)</span></span>
<span id="cb16-43"><a href="building-the-datasets.html#cb16-43" tabindex="-1"></a><span class="co"># s3write_using(x = pa_area_dr,</span></span>
<span id="cb16-44"><a href="building-the-datasets.html#cb16-44" tabindex="-1"></a><span class="co">#               FUN = data.table::fwrite,</span></span>
<span id="cb16-45"><a href="building-the-datasets.html#cb16-45" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/area/pa_area_dr.csv&quot;,</span></span>
<span id="cb16-46"><a href="building-the-datasets.html#cb16-46" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb16-47"><a href="building-the-datasets.html#cb16-47" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb16-48"><a href="building-the-datasets.html#cb16-48" tabindex="-1"></a></span>
<span id="cb16-49"><a href="building-the-datasets.html#cb16-49" tabindex="-1"></a><span class="co">#At UN region level</span></span>
<span id="cb16-50"><a href="building-the-datasets.html#cb16-50" tabindex="-1"></a>pa_area_region <span class="ot">=</span> data_pa_afd <span class="sc">%&gt;%</span></span>
<span id="cb16-51"><a href="building-the-datasets.html#cb16-51" tabindex="-1"></a>  <span class="co">#Compute total area at dr level</span></span>
<span id="cb16-52"><a href="building-the-datasets.html#cb16-52" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">%&gt;%</span></span>
<span id="cb16-53"><a href="building-the-datasets.html#cb16-53" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">area_tot_km2 =</span> <span class="fu">sum</span>(area_afd_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-54"><a href="building-the-datasets.html#cb16-54" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-55"><a href="building-the-datasets.html#cb16-55" tabindex="-1"></a>  <span class="co">#Add information on intersection area in each DR. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb16-56"><a href="building-the-datasets.html#cb16-56" tabindex="-1"></a>  <span class="fu">left_join</span>(pa_int_region, <span class="at">by =</span> <span class="st">&quot;region&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-57"><a href="building-the-datasets.html#cb16-57" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_area_int =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(tot_area_int) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span><span class="dv">0</span>, <span class="cn">TRUE</span> <span class="sc">~</span>tot_area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb16-58"><a href="building-the-datasets.html#cb16-58" tabindex="-1"></a>  <span class="co">#Compute the total area at country level without intersection</span></span>
<span id="cb16-59"><a href="building-the-datasets.html#cb16-59" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area_tot_noint_km2 =</span> area_tot_km2 <span class="sc">-</span> tot_area_int) <span class="sc">%&gt;%</span></span>
<span id="cb16-60"><a href="building-the-datasets.html#cb16-60" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb16-61"><a href="building-the-datasets.html#cb16-61" tabindex="-1"></a></span>
<span id="cb16-62"><a href="building-the-datasets.html#cb16-62" tabindex="-1"></a><span class="co">#fwrite(pa_area_dr, &quot;data_tidy/area/pa_area_dr.csv&quot;)</span></span>
<span id="cb16-63"><a href="building-the-datasets.html#cb16-63" tabindex="-1"></a><span class="co"># s3write_using(x = pa_area_region,</span></span>
<span id="cb16-64"><a href="building-the-datasets.html#cb16-64" tabindex="-1"></a><span class="co">#               FUN = data.table::fwrite,</span></span>
<span id="cb16-65"><a href="building-the-datasets.html#cb16-65" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/area/pa_area_region.csv&quot;,</span></span>
<span id="cb16-66"><a href="building-the-datasets.html#cb16-66" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb16-67"><a href="building-the-datasets.html#cb16-67" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb16-68"><a href="building-the-datasets.html#cb16-68" tabindex="-1"></a></span>
<span id="cb16-69"><a href="building-the-datasets.html#cb16-69" tabindex="-1"></a><span class="co">#At UN sub-region level</span></span>
<span id="cb16-70"><a href="building-the-datasets.html#cb16-70" tabindex="-1"></a>pa_area_subregion <span class="ot">=</span> data_pa_afd <span class="sc">%&gt;%</span></span>
<span id="cb16-71"><a href="building-the-datasets.html#cb16-71" tabindex="-1"></a>  <span class="co">#Compute total area at dr level</span></span>
<span id="cb16-72"><a href="building-the-datasets.html#cb16-72" tabindex="-1"></a>  <span class="fu">group_by</span>(sub_region) <span class="sc">%&gt;%</span></span>
<span id="cb16-73"><a href="building-the-datasets.html#cb16-73" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">area_tot_km2 =</span> <span class="fu">sum</span>(area_afd_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-74"><a href="building-the-datasets.html#cb16-74" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-75"><a href="building-the-datasets.html#cb16-75" tabindex="-1"></a>  <span class="co">#Add information on intersection area in each DR. Modify the variable so that NA value -&gt; 0</span></span>
<span id="cb16-76"><a href="building-the-datasets.html#cb16-76" tabindex="-1"></a>  <span class="fu">left_join</span>(pa_int_subregion, <span class="at">by =</span> <span class="st">&quot;sub_region&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-77"><a href="building-the-datasets.html#cb16-77" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tot_area_int =</span> <span class="fu">case_when</span>(<span class="fu">is.na</span>(tot_area_int) <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span><span class="dv">0</span>, <span class="cn">TRUE</span> <span class="sc">~</span>tot_area_int)) <span class="sc">%&gt;%</span></span>
<span id="cb16-78"><a href="building-the-datasets.html#cb16-78" tabindex="-1"></a>  <span class="co">#Compute the total area at country level without intersection</span></span>
<span id="cb16-79"><a href="building-the-datasets.html#cb16-79" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">area_tot_noint_km2 =</span> area_tot_km2 <span class="sc">-</span> tot_area_int) <span class="sc">%&gt;%</span></span>
<span id="cb16-80"><a href="building-the-datasets.html#cb16-80" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb16-81"><a href="building-the-datasets.html#cb16-81" tabindex="-1"></a></span>
<span id="cb16-82"><a href="building-the-datasets.html#cb16-82" tabindex="-1"></a><span class="co">#fwrite(pa_area_dr, &quot;data_tidy/area/pa_area_dr.csv&quot;)</span></span>
<span id="cb16-83"><a href="building-the-datasets.html#cb16-83" tabindex="-1"></a><span class="co"># s3write_using(x = pa_area_subregion,</span></span>
<span id="cb16-84"><a href="building-the-datasets.html#cb16-84" tabindex="-1"></a><span class="co">#               FUN = data.table::fwrite,</span></span>
<span id="cb16-85"><a href="building-the-datasets.html#cb16-85" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/area/pa_area_subregion.csv&quot;,</span></span>
<span id="cb16-86"><a href="building-the-datasets.html#cb16-86" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb16-87"><a href="building-the-datasets.html#cb16-87" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span>
<span id="cb16-88"><a href="building-the-datasets.html#cb16-88" tabindex="-1"></a></span>
<span id="cb16-89"><a href="building-the-datasets.html#cb16-89" tabindex="-1"></a><span class="co">#At world level</span></span>
<span id="cb16-90"><a href="building-the-datasets.html#cb16-90" tabindex="-1"></a>pa_area_wld <span class="ot">=</span> <span class="fu">sum</span>(data_pa_afd<span class="sc">$</span>area_afd_km2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> pa_int_wld <span class="sc">%&gt;%</span></span>
<span id="cb16-91"><a href="building-the-datasets.html#cb16-91" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-92"><a href="building-the-datasets.html#cb16-92" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;area_tot_noint_km2&quot;</span> <span class="ot">=</span> <span class="st">&quot;.&quot;</span>)</span>
<span id="cb16-93"><a href="building-the-datasets.html#cb16-93" tabindex="-1"></a><span class="co">#fwrite(pa_area_wld, &quot;data_tidy/area/pa_area_wld.csv&quot;)</span></span>
<span id="cb16-94"><a href="building-the-datasets.html#cb16-94" tabindex="-1"></a><span class="co"># s3write_using(x = pa_area_wld,</span></span>
<span id="cb16-95"><a href="building-the-datasets.html#cb16-95" tabindex="-1"></a><span class="co">#               FUN = data.table::fwrite,</span></span>
<span id="cb16-96"><a href="building-the-datasets.html#cb16-96" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/area/pa_area_wld.csv&quot;,</span></span>
<span id="cb16-97"><a href="building-the-datasets.html#cb16-97" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb16-98"><a href="building-the-datasets.html#cb16-98" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;))</span></span></code></pre></div>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="projects-funded-by-the-afd.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vuillota/EVA-impact-aires-protegees/edit/main/00_data_build.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/vuillota/EVA-impact-aires-protegees/raw/main/00_data_build.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"code_folding": "hide"
});
});
</script>

</body>

</html>
