% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility},
  pdfauthor={Antoine Vuillot},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility}
\author{Antoine Vuillot}
\date{2023-07-21}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{building-the-datasets}{%
\chapter{Building the datasets}\label{building-the-datasets}}

\hypertarget{importing-relevant-packages}{%
\section{Importing relevant packages}\label{importing-relevant-packages}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(stargazer)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(data.table)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(splitstackshape) }
\FunctionTok{library}\NormalTok{(janitor)}
\FunctionTok{library}\NormalTok{(stringi)}
\FunctionTok{library}\NormalTok{(sf)}
\FunctionTok{library}\NormalTok{(mapview)}
\end{Highlighting}
\end{Shaded}

\hypertarget{datasets-for-descriptive-statistics}{%
\section{Datasets for descriptive statistics}\label{datasets-for-descriptive-statistics}}

The raw dataset has been built by Léa Poulin. It comes from the merging of SIOP extract, and PAs dataset from ARB covering 2000-2017 period. Majority of PAs had no corresponding WDPA ID, so it was found and reported manually by Léa Poulin and Ingrid Dallmann on WDPA website.

Different datasets are built. First a dataset (data\_PA\_tidy) enriched of information on co-investors and ISO code for the country hosting the PA.

From this dataset are extracted : (1) a dataset with only SIOP variables, to allow future working on PAs; (2) a dataset to perform most descriptive statistics, except confidential ones related to funding; (3) a confidential dataset with funding data.

Then a dataset of PAs polygons is imported from the WDPA, and confidential data removed.

Some statistics need size of PAs at country/region/world level (evolution of area covered by PAs at world level for instance). Datasets with total areas at country/region/world level are created. As many areas overlap (according to WDPA documentation), a sum of reported area would overestimate aggregated area. The computation method of WDPA is followed (\url{https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage}).

\hypertarget{cleaning-the-raw-dataset}{%
\subsection{Cleaning the raw dataset}\label{cleaning-the-raw-dataset}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#import a dataset with country names and corresponding ISO3 code}
\NormalTok{data\_iso }\OtherTok{=} \FunctionTok{fread}\NormalTok{(}\StringTok{"data\_raw/liste{-}197{-}etats{-}2020.csv"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"iso3"} \OtherTok{=} \StringTok{"CODE"}\NormalTok{,}
         \StringTok{"nom\_alpha"} \OtherTok{=} \StringTok{"NOM\_ALPHA"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"nom\_alpha"}\NormalTok{, }\StringTok{"iso3"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#get rid of accentuations and change name by hand to correspond with BDD\_joint}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{nom\_alpha2 =} \FunctionTok{iconv}\NormalTok{(nom\_alpha, }\AttributeTok{to =} \StringTok{"ASCII//TRANSLIT"}\NormalTok{),}
         \AttributeTok{nom\_alpha2 =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{           nom\_alpha2 }\SpecialCharTok{==} \StringTok{"Cook (Iles)"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Cook"}\NormalTok{,}
\NormalTok{           nom\_alpha2 }\SpecialCharTok{==} \StringTok{"Cote d\textquotesingle{}Ivoire"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Cote D Ivoire"}\NormalTok{,}
\NormalTok{           nom\_alpha2 }\SpecialCharTok{==} \StringTok{"Sao Tome{-}et{-}Principe"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Sao Tome"}\NormalTok{,}
\NormalTok{           nom\_alpha2 }\SpecialCharTok{==} \StringTok{"Palaos"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Palau"}\NormalTok{,}
\NormalTok{           nom\_alpha2 }\SpecialCharTok{==} \StringTok{"Guinee{-}Bissao"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Guinee{-}Bissau"}\NormalTok{,}
           \SpecialCharTok{!}\NormalTok{(nom\_alpha }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Cook (Iles)"}\NormalTok{, }\StringTok{"Cote d\textquotesingle{}Ivoire"}\NormalTok{, }\StringTok{"Sao Tome{-}et{-}Principe"}\NormalTok{,}
                              \StringTok{"Palaos"}\NormalTok{, }\StringTok{"Guinée{-}Bissao"}\NormalTok{)) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ nom\_alpha2}
\NormalTok{         ))}

\CommentTok{\#Import the initial BDD\_joint, change the encoding to keep accentuation }
\NormalTok{data\_PA\_raw }\OtherTok{=} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"data\_raw/BDD\_joint.xlsx"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\AttributeTok{.cols =} \FunctionTok{names}\NormalTok{(.), }
                \AttributeTok{.fns =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{stri\_enc\_toutf8}\NormalTok{(.x)))}

\CommentTok{\#Modify errors in the dataset}
\DocumentationTok{\#\#WDPAID 797 in Senegal}
\NormalTok{data\_PA\_raw[data\_PA\_raw}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \StringTok{"797"} \SpecialCharTok{\&}\NormalTok{ data\_PA\_raw}\SpecialCharTok{$}\NormalTok{pays }\SpecialCharTok{==} \StringTok{"Senegal"}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{nom\_ap }\OtherTok{=} \StringTok{"APAC de Kawawana"}
\NormalTok{data\_PA\_raw[data\_PA\_raw}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \StringTok{"797"} \SpecialCharTok{\&}\NormalTok{ data\_PA\_raw}\SpecialCharTok{$}\NormalTok{pays }\SpecialCharTok{==} \StringTok{"Senegal"}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{wdpaid }\OtherTok{=} \ConstantTok{NA}
\DocumentationTok{\#\#4223, 4224, 4226, 4228, 4229 : all in PS{-}N.Caledonie}
\NormalTok{data\_PA\_raw[data\_PA\_raw}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"4223"}\NormalTok{, }\StringTok{"4224"}\NormalTok{, }\StringTok{"4226"}\NormalTok{, }\StringTok{"4228"}\NormalTok{, }\StringTok{"4229"}\NormalTok{) }\SpecialCharTok{\&}\NormalTok{ data\_PA\_raw}\SpecialCharTok{$}\NormalTok{pays }\SpecialCharTok{==} \StringTok{"Fidji"}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{pays }\OtherTok{=} \StringTok{"P{-}S N.Caléd"}
\DocumentationTok{\#\#305082 : Vanuatu instead of Fidji}
\NormalTok{data\_PA\_raw[data\_PA\_raw}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"305082"}\NormalTok{) }\SpecialCharTok{\&}\NormalTok{ data\_PA\_raw}\SpecialCharTok{$}\NormalTok{pays }\SpecialCharTok{==} \StringTok{"Fidji"}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{pays }\OtherTok{=} \StringTok{"Vanuatu"}


\CommentTok{\#Create a clean dataset with relevant variables}
\NormalTok{data\_PA\_tidy }\OtherTok{=}\NormalTok{ data\_PA\_raw }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Get rid of the iso code in the initial dataset, to avoid confusion when merging with data\_iso}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Create dummy variables for main investors}
  \CommentTok{\#AFD is always funder, so no need of a dummy}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# afd\_bin = case\_when((cofinancier\_1 == "AFD" | cofinancier\_2 == "AFD" | cofinancier\_3 == "AFD" |}
    \CommentTok{\#                       cofinancier\_4 == "AFD" | cofinancier\_5 == "AFD" | cofinancier\_6 == "AFD") \textasciitilde{} TRUE,}
    \CommentTok{\#                       (is.na(cofinancier\_1) \& is.na(cofinancier\_2) \& is.na(cofinancier\_3) \& is.na(cofinancier\_4) }
    \CommentTok{\#                       \& is.na(cofinancier\_5) \& is.na(cofinancier\_6)) \textasciitilde{} TRUE,}
    \CommentTok{\#                       TRUE \textasciitilde{} FALSE),}
         \AttributeTok{kfw\_bin =} \FunctionTok{ifelse}\NormalTok{(cofinancier\_1 }\SpecialCharTok{==} \StringTok{"KFW"} \SpecialCharTok{|}\NormalTok{ cofinancier\_2 }\SpecialCharTok{==} \StringTok{"KFW"} \SpecialCharTok{|}\NormalTok{ cofinancier\_3 }\SpecialCharTok{==} \StringTok{"KFW"} \SpecialCharTok{|}
\NormalTok{                          cofinancier\_4 }\SpecialCharTok{==} \StringTok{"KFW"} \SpecialCharTok{|}\NormalTok{ cofinancier\_5 }\SpecialCharTok{==} \StringTok{"KFW"} \SpecialCharTok{|}\NormalTok{ cofinancier\_6 }\SpecialCharTok{==} \StringTok{"KFW"}\NormalTok{,}
                          \AttributeTok{yes =} \ConstantTok{TRUE}\NormalTok{, }
                          \AttributeTok{no =} \ConstantTok{FALSE}\NormalTok{),}
         \AttributeTok{kfw\_bin =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(kfw\_bin), }\AttributeTok{yes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{no =}\NormalTok{ kfw\_bin),}
         \AttributeTok{ffem\_bin =} \FunctionTok{ifelse}\NormalTok{(cofinancier\_1 }\SpecialCharTok{==} \StringTok{"FFEM"} \SpecialCharTok{|}\NormalTok{ cofinancier\_2 }\SpecialCharTok{==} \StringTok{"FFEM"} \SpecialCharTok{|}\NormalTok{ cofinancier\_3 }\SpecialCharTok{==} \StringTok{"FFEM"} \SpecialCharTok{|}
\NormalTok{                          cofinancier\_4 }\SpecialCharTok{==} \StringTok{"FFEM"} \SpecialCharTok{|}\NormalTok{ cofinancier\_5 }\SpecialCharTok{==} \StringTok{"FFEM"} \SpecialCharTok{|}\NormalTok{ cofinancier\_6 }\SpecialCharTok{==} \StringTok{"FFEM"}\NormalTok{,}
                          \AttributeTok{yes =} \ConstantTok{TRUE}\NormalTok{, }
                          \AttributeTok{no =} \ConstantTok{FALSE}\NormalTok{),}
         \AttributeTok{ffem\_bin =} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(ffem\_bin), }\AttributeTok{yes =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{no =}\NormalTok{ ffem\_bin),}
         \AttributeTok{.after =} \StringTok{"cofinancier\_6"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Create a dummy for other co{-}investors}
  \CommentTok{\# mutate(cofin\_unkwn = ifelse(is.na(cofinancier\_1) \& is.na(cofinancier\_1) \& is.na(cofinancier\_1) \& is.na(cofinancier\_1) \& is.na(cofinancier\_1) \& is.na(cofinancier\_1),}
  \CommentTok{\#                         yes = TRUE, }
  \CommentTok{\#                         no = FALSE),}
  \CommentTok{\#        cofin\_unkwn = ifelse(is.na(cofin\_unkwn), yes = FALSE, no = cofin\_unkwn),}
  \CommentTok{\#        .after = "ffem\_bin") \%\textgreater{}\%}
  \CommentTok{\#Create a dummy for investors not AFD, KFW or FFEM}
  \CommentTok{\# mutate(cofin\_other = afd\_bin == FALSE \& }
  \CommentTok{\#       kfw\_bin == FALSE \& ffem\_bin == FALSE \& cofin\_unkwn == FALSE,}
  \CommentTok{\#       .after = "cofin\_unkwn") \%\textgreater{}\%}
  \CommentTok{\#Add the ISO3 code corresponding to the country hosting the PA. Facilitate future mergings}
  \FunctionTok{left\_join}\NormalTok{(data\_iso, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"pays"} \OtherTok{=} \StringTok{"nom\_alpha2"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Some entries in "pays" are French department, DROM{-}COM, "Ocean Indien" or "Multi{-}Pays".}
  \CommentTok{\#French related : assigned to France. Ocen Indien let NA value, Muti{-}pays set to ZZ as in the SIOP }
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iso3 =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    pays }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Mayotte"}\NormalTok{, }\StringTok{"P{-}N N.Caléd"}\NormalTok{, }\StringTok{"P{-}S N.Caléd"}\NormalTok{, }
                \StringTok{"Polynesie Francaise"}\NormalTok{, }\StringTok{"Nlle Caledonie"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"FRA"}\NormalTok{,}
\NormalTok{    pays }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Multi{-}Pays"}\NormalTok{, }\StringTok{"Ocean Indien"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"ZZ"}\NormalTok{,}
    \SpecialCharTok{!}\NormalTok{(pays }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Mayotte"}\NormalTok{, }\StringTok{"P{-}N N.Caléd"}\NormalTok{, }\StringTok{"P{-}S N.Caléd"}\NormalTok{, }
                \StringTok{"Polynesie Francaise"}\NormalTok{, }\StringTok{"Nlle Caledonie"}\NormalTok{, }\StringTok{"Multi{-}Pays"}\NormalTok{)) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ iso3}
\NormalTok{  )) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Add the description of IUCN from its category}
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iucn\_des =} \FunctionTok{case\_when}\NormalTok{(}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"Ia"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Réserve naturelle intégrale"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"Ib"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Zone de nature sauvage"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"II"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Parc national"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"III"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Monument naturel"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"IV"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gest. des habitats/espèces"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"V"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Paysage protégé"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"VI"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gest. de ress. protégées"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"Not Applicable"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non catégorisée"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"Not Reported"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non catégorisée"}\NormalTok{,}
  \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{\&}\NormalTok{ iucn\_cat }\SpecialCharTok{==} \StringTok{"Not Assigned"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non catégorisée"}\NormalTok{,}
  \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non référencée"}\NormalTok{), }\AttributeTok{.after =}\NormalTok{ iucn\_cat) }\SpecialCharTok{\%\textgreater{}\%}
    \CommentTok{\#Modify class of some variables}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\AttributeTok{.cols =} \FunctionTok{c}\NormalTok{(}\StringTok{"wdpaid"}\NormalTok{, }\StringTok{"superficie"}\NormalTok{,}
                          \StringTok{"montant\_prevu\_concours\_euro\_octroi"}\NormalTok{,}
                          \StringTok{"mt\_global\_projet\_prevu\_devise"}\NormalTok{ ,}
                          \StringTok{"engagements\_nets\_euro\_octroi"}\NormalTok{,}
                          \StringTok{"montant\_total\_projet"}\NormalTok{),}
                \AttributeTok{.fns =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{as.numeric}\NormalTok{(.x))) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\AttributeTok{.cols =} \SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"wdpaid"}\NormalTok{, }\StringTok{"superficie"}\NormalTok{,}
                                  \StringTok{"montant\_prevu\_concours\_euro\_octroi"}\NormalTok{,}
                          \StringTok{"mt\_global\_projet\_prevu\_devise"}\NormalTok{ ,}
                          \StringTok{"engagements\_nets\_euro\_octroi"}\NormalTok{,}
                          \StringTok{"montant\_total\_projet"}\NormalTok{), }
                \AttributeTok{.fns =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{stri\_enc\_toutf8}\NormalTok{(.x))) }
\CommentTok{\#fwrite(data\_PA\_tidy, "data\_tidy/BDD\_joint\_tidy.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{dataset-with-only-siop-variables}{%
\subsection{Dataset with only SIOP variables}\label{dataset-with-only-siop-variables}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Select info corresponding to SIOP extract and AP }
\NormalTok{list\_var\_siop\_AP }\OtherTok{=} \FunctionTok{c}\NormalTok{( }\StringTok{"id\_projet"}\NormalTok{, }\StringTok{"nom\_du\_projet"}\NormalTok{, }\StringTok{"nom\_de\_projet\_pour\_les\_instances"}\NormalTok{,}
                      \StringTok{"id\_concours"}\NormalTok{, }\StringTok{"libelle\_du\_concours"}\NormalTok{, }\StringTok{"description\_du\_projet"}\NormalTok{,}
                      \StringTok{"wdpaid"}\NormalTok{, }\StringTok{"wdpaid\_2"}\NormalTok{, }\StringTok{"wdpaid\_3"}\NormalTok{,}
                      \StringTok{"montant\_prevu\_concours\_euro\_octroi"}\NormalTok{, }\StringTok{"mt\_global\_projet\_prevu\_devise"}\NormalTok{, }
                      \StringTok{"engagements\_nets\_euro\_octroi"}\NormalTok{, }\StringTok{"montant\_total\_projet"}\NormalTok{, }\StringTok{"produit"}\NormalTok{, }
                      \StringTok{"libelle\_produit"}\NormalTok{, }\StringTok{"division\_technique"}\NormalTok{, }\StringTok{"libelle\_division\_technique"}\NormalTok{, }\StringTok{"agence"}\NormalTok{, }
                      \StringTok{"libelle\_agence"}\NormalTok{, }\StringTok{"annee\_octroi"}\NormalTok{, }\StringTok{"date\_octroi"}\NormalTok{,}
                      \StringTok{"date\_de\_1er\_versement\_projet"}\NormalTok{, }\StringTok{"dernier\_versement\_en\_date\_projet"}\NormalTok{, }
                      \StringTok{"date\_signature\_convention\_cf"}\NormalTok{, }\StringTok{"duree\_du\_concours\_annee"}\NormalTok{,}
                      \StringTok{"duree\_du\_concours\_annee\_et\_mois"}\NormalTok{, }\StringTok{"id\_pays\_de\_realisation"}\NormalTok{, }\StringTok{"pays"}\NormalTok{, }\StringTok{"iso3"}\NormalTok{,}
                      \StringTok{"direction\_regionale"}\NormalTok{, }\StringTok{"autres\_pays\_de\_realisation"}\NormalTok{, }
                      \StringTok{"etat\_du\_projet"}\NormalTok{, }\StringTok{"libelle\_etat\_du\_projet"}\NormalTok{, }\StringTok{"beneficiaire\_primaire"}\NormalTok{,}
                      \StringTok{"responsable\_equipe\_projet"}\NormalTok{, }\StringTok{"directeur\_trice\_dagence"}\NormalTok{,}
                      \StringTok{"date\_de\_remise\_du\_rapport\_final"}\NormalTok{, }\StringTok{"cofinancier\_1"}\NormalTok{, }\StringTok{"cofinancier\_2"}\NormalTok{, }
                      \StringTok{"cofinancier\_3"}\NormalTok{,}\StringTok{"cofinancier\_4"}\NormalTok{, }\StringTok{"cofinancier\_5"}\NormalTok{, }\StringTok{"cofinancier\_6"}\NormalTok{,}
                      \StringTok{"kfw\_bin"}\NormalTok{, }\StringTok{"ffem\_bin"}\NormalTok{,}
                      \StringTok{"maitrise\_ouvrage"}\NormalTok{, }\StringTok{"superf\_interne"}\NormalTok{, }\StringTok{"nb\_ap\_nombre\_potentiel"}\NormalTok{, }\StringTok{"detail"}\NormalTok{, }\StringTok{"projet"}\NormalTok{, }\StringTok{"commentaires"}\NormalTok{)}

\CommentTok{\#Definining dataset for future analysis : siop and AP but not WDPA }
\NormalTok{data\_siop\_AP }\OtherTok{=}\NormalTok{ data\_PA\_tidy }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(list\_var\_siop\_AP), iso3)}
\CommentTok{\#write\_csv(data\_siop\_AP, "data\_tidy/BDD\_AP\_SIOP\_joint.xlsx")}
\end{Highlighting}
\end{Shaded}

\hypertarget{dataset-for-non-confidential-statistics}{%
\subsection{Dataset for non-confidential statistics}\label{dataset-for-non-confidential-statistics}}

To perform descriptive statistics we want to keep one row per PA, characterized by WDPA ID or a name (if no ID reported). Some PAs can have several lines if they receive funds at different time or by different investors.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Listing relevant variables for descriptive statistics that are NOT confidential (i.e not concern funding)}
\NormalTok{list\_var\_PA\_nofund }\OtherTok{=} 
  \FunctionTok{c}\NormalTok{(}\StringTok{"id\_projet"}\NormalTok{, }\StringTok{"nom\_du\_projet"}\NormalTok{, }\StringTok{"nom\_ap"}\NormalTok{, }\StringTok{"id\_concours"}\NormalTok{, }
    \StringTok{"wdpaid"}\NormalTok{, }
    \StringTok{"pays"}\NormalTok{, }\StringTok{"iso3"}\NormalTok{, }\StringTok{"direction\_regionale"}\NormalTok{,}
    \StringTok{"annee\_octroi"}\NormalTok{, }\StringTok{"nb\_ap\_nombre\_potentiel"}\NormalTok{, }\StringTok{"detail"}\NormalTok{,}
    \StringTok{"iucn\_cat"}\NormalTok{, }\StringTok{"iucn\_des"}\NormalTok{, }\StringTok{"marine"}\NormalTok{, }\StringTok{"superficie"}\NormalTok{,}
    \StringTok{"status"}\NormalTok{, }\StringTok{"status\_yr"}\NormalTok{, }\StringTok{"gov\_type"}\NormalTok{,}\StringTok{"own\_type"}\NormalTok{, }\StringTok{"mang\_auth"}\NormalTok{)}

\CommentTok{\#Defining dataset for descriptive statistics}
\NormalTok{data\_stat\_nofund }\OtherTok{=}\NormalTok{ data\_PA\_tidy }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(list\_var\_PA\_nofund), iso3)}

\CommentTok{\#fwrite(data\_stat\_nofund, "data\_tidy/BDD\_DesStat\_nofund.csv")}

\CommentTok{\#Then to keep only one row per PA, we need to consider separately PAs having WDPA ID and PAs which do not.}

\NormalTok{data\_stat\_nofund\_wdpa }\OtherTok{=}\NormalTok{ data\_stat\_nofund }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{subset}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(wdpaid) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{data\_stat\_nofund\_na }\OtherTok{=}\NormalTok{ data\_stat\_nofund }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{subset}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(wdpaid) }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id1 =} \FunctionTok{paste}\NormalTok{(id\_projet, iso3, nom\_ap, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{),}
       \AttributeTok{.before =}\NormalTok{ id\_projet) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#remove id1 variable, to bind data\_stat\_na and data\_stat\_wdpa by row}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id1)}

\NormalTok{data\_stat\_nofund\_nodupl }\OtherTok{=} \FunctionTok{rbind}\NormalTok{(data\_stat\_nofund\_wdpa, data\_stat\_nofund\_na) }

\CommentTok{\#fwrite(data\_stat\_nofund\_nodupl, "data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{dataset-for-confidential-descriptive-statistics}{%
\subsection{Dataset for confidential descriptive statistics}\label{dataset-for-confidential-descriptive-statistics}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Listing relevant variables for descriptive statistics}
\NormalTok{list\_var\_PA\_fund }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"id\_projet"}\NormalTok{, }\StringTok{"nom\_du\_projet"}\NormalTok{, }\StringTok{"nom\_ap"}\NormalTok{, }\StringTok{"id\_concours"}\NormalTok{, }
                \StringTok{"wdpaid"}\NormalTok{,}
                \StringTok{"pays"}\NormalTok{, }\StringTok{"iso3"}\NormalTok{, }\StringTok{"direction\_regionale"}\NormalTok{,}
                \StringTok{"montant\_prevu\_concours\_euro\_octroi"}\NormalTok{,}
                \StringTok{"mt\_global\_projet\_prevu\_devise"}\NormalTok{,}
                \StringTok{"engagements\_nets\_euro\_octroi"}\NormalTok{,}
                \StringTok{"montant\_total\_projet"}\NormalTok{, }\StringTok{"libelle\_produit"}\NormalTok{, }\StringTok{"annee\_octroi"}\NormalTok{,}
                \StringTok{"cofinancier\_1"}\NormalTok{, }\StringTok{"cofinancier\_2"}\NormalTok{, }\StringTok{"cofinancier\_3"}\NormalTok{, }
                \StringTok{"cofinancier\_4"}\NormalTok{, }\StringTok{"cofinancier\_5"}\NormalTok{, }\StringTok{"cofinancier\_6"}\NormalTok{,}
                 \StringTok{"kfw\_bin"}\NormalTok{, }\StringTok{"ffem\_bin"}\NormalTok{)}

\CommentTok{\#Defining dataset for descriptive statistics}
\CommentTok{\#Duplicates are not revmoved here, as we want the information on the different concours for instance. Peculiar datasets }
\NormalTok{data\_stat\_fund }\OtherTok{=}\NormalTok{ data\_PA\_tidy }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(list\_var\_PA\_fund), iso3)}

\CommentTok{\#fwrite(data\_stat\_fund, "data\_tidy/BDD\_DesStat\_fund.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{a-polygon-dataset-without-confidential-information}{%
\subsection{A polygon dataset without confidential information}\label{a-polygon-dataset-without-confidential-information}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#The confidential information removed concern funding or nominative variables}
\NormalTok{pa\_shp }\OtherTok{=} \FunctionTok{read\_sf}\NormalTok{(}\StringTok{"data\_raw/WDPA\_SHP/BDD\_SHP\_nodupl.shp"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(mntnt, mtglb, e, mnt, prodt, lbllp, dt\_ct, d\_1, d, d\_c, durdcncrs\_a, drdcncrs\_an, atrsp, ett, lbllt, rspns, dr, mtrs, detal, projt, cmmnt, cmmnt\_1))}

\CommentTok{\# st\_write(pa\_shp,}
\CommentTok{\#          dsn = "data\_tidy/BDD\_shp\_pub.gpkg",}
\CommentTok{\#          delete\_dsn = TRUE)}

\FunctionTok{rm}\NormalTok{(pa\_shp)}
\end{Highlighting}
\end{Shaded}

\hypertarget{computing-total-areas-covered-by-pas-in-the-sample}{%
\section{Computing total areas covered by PAs in the sample}\label{computing-total-areas-covered-by-pas-in-the-sample}}

Knowing the total area covered by PAs at different level of aggregation is interesting per se. It is also necessary to compute several statistics (e.g average funding by unit of area). According to the WDPA documentation, it is likely that some reported polygons overlap. Simply summing the areas would thus lead to a biased estimate of the total area at a given level of aggregation. We follow the procedure of the WDPA (\url{https://www.protectedplanet.net/en/resources/calculating-protected-area-coverage}). Our case is simpler as all of the PAs we consider are given a polygon.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  The layer is converted to Mollweide (an equal area projection) and the area of each polygon is calculated, in km2.
\item
  Intersection of polygons and the corresponding area are computed.
\item
  Then the intersection can be aggregated at country, region or world level. Then it is subtracted to the sum of areas at country, region or world level. Note that intersections between PAs whose polygon is unknown won't be taken into account.
\end{enumerate}

Note that the following codes are about computing total area at country/region/world level, taking potential intersections into account. It is not about generating a new shape files for the impact analysis. Indeed the overlap should be taken into account in the impact evaluation analysis codes.

\hypertarget{computations-of-polygons-area}{%
\subsection{Computations of polygons' area}\label{computations-of-polygons-area}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Importing shapefiles}
\FunctionTok{sf\_use\_s2}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{pa\_shp }\OtherTok{=} 
  \FunctionTok{read\_sf}\NormalTok{(}\StringTok{"data\_tidy/BDD\_shp\_raw.gpkg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# aws.s3::s3read\_using(}
  \CommentTok{\# FUN = sf::read\_sf,}
  \CommentTok{\# \# Mettre les options de FUN ici}
  \CommentTok{\# object = "data\_tidy/BDD\_SHP\_nodupl\_pub.gpkg",}
  \CommentTok{\# bucket = "projet{-}afd{-}eva{-}ap",}
  \CommentTok{\# opts = list("region" = "")) \%\textgreater{}\%}
  \CommentTok{\#Ensure all geometries are valid}
  \FunctionTok{st\_make\_valid}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#From multipolygon to polygon}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_cast}\NormalTok{(}\AttributeTok{to=}\StringTok{"POLYGON"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Select relevant variables}
  \CommentTok{\#Note ann\_c = annee\_octroi in the initial database data\_PA\_raw}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(wdpaid, sprfc, rep\_a, gis\_a, geom, iso3, drct, ann\_c)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Variable sprfc corresponds to AFD internal reported size}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"sprfc\_int"} \OtherTok{=} \StringTok{"sprfc"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdpaid =} \FunctionTok{as.numeric}\NormalTok{(wdpaid),}
         \AttributeTok{sprfc\_int =} \FunctionTok{as.numeric}\NormalTok{(sprfc\_int)) }

\CommentTok{\#Spatial definition of wdpaid 555547988 overlaps CMR and CAF. Wdpaid 1245 corresponds to the CMR part. The overlap is removed and iso3 redefined so that 555547988 is CAF only. }
\NormalTok{geom\_555547988\_1245 }\OtherTok{=} \FunctionTok{st\_difference}\NormalTok{(pa\_shp[pa\_shp}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \DecValTok{555547988}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{geom, pa\_shp[pa\_shp}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \DecValTok{1245}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{geom)}
\NormalTok{pa\_shp[pa\_shp}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \DecValTok{555547988}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{geom }\OtherTok{=}\NormalTok{ geom\_555547988\_1245}
\NormalTok{pa\_shp[pa\_shp}\SpecialCharTok{$}\NormalTok{wdpaid }\SpecialCharTok{==} \DecValTok{555547988}\NormalTok{,]}\SpecialCharTok{$}\NormalTok{iso3 }\OtherTok{=} \StringTok{"CAF"}

\CommentTok{\#Define a tidy version of the former dataset, with modifications on wdpaid 555547988}
\NormalTok{pa\_shp\_tidy }\OtherTok{=}\NormalTok{ pa\_shp }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Project to Mollweide to compute relevant areas in km2}
  \FunctionTok{st\_transform}\NormalTok{(}\AttributeTok{crs =} \StringTok{"+proj=moll +datum=WGS84"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute areas in km2 from the geometry, in km2. It must be equal to gis\_a by definition }
  \CommentTok{\#Then to take into account potential refinements of the geometries (as for wdpaid 55547988), a variable for relevant area is defined. It takes rep\_a value except for modified geometries where area\_sf\_moll is taken}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{area\_sf\_moll =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{st\_area}\NormalTok{(geom)}\SpecialCharTok{/}\FloatTok{1e6}\NormalTok{),}
         \AttributeTok{sprfc\_km2 =} \FunctionTok{ifelse}\NormalTok{(wdpaid }\SpecialCharTok{==} \DecValTok{555547988}\NormalTok{, }\AttributeTok{yes =}\NormalTok{ area\_sf\_moll, }\AttributeTok{no =}\NormalTok{ rep\_a))}
\end{Highlighting}
\end{Shaded}

\hypertarget{computing-the-intersection-at-country-region-world-level}{%
\subsection{Computing the intersection at country, region, world level}\label{computing-the-intersection-at-country-region-world-level}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Compute intersecting areas of polygons}
\NormalTok{pa\_int }\OtherTok{=} \FunctionTok{st\_intersection}\NormalTok{(pa\_shp\_tidy, pa\_shp\_tidy) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Remove intersection of polygons with themselves}
  \FunctionTok{subset}\NormalTok{(wdpaid }\SpecialCharTok{!=}\NormalTok{ wdpaid}\FloatTok{.1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#If one of the two intersectin polygon have unknwon area, then it is not necessary to subtract the interesction area. Indeed there is no double{-}counting of the intersection in this case, when both polygon areas are summed.}
  \FunctionTok{subset}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(sprfc\_km2) }\SpecialCharTok{==} \ConstantTok{FALSE} \SpecialCharTok{\&} \FunctionTok{is.na}\NormalTok{(sprfc\_km2}\FloatTok{.1}\NormalTok{) }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute the intersecting areas (pa\_shp already in Mollweide projection) in km2}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{area\_int =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{st\_area}\NormalTok{(geom)}\SpecialCharTok{/}\FloatTok{1e6}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Now duplicates need to be removed : intersection of X with Y AND intersection of Y with X are reported. We need only one.}
  \CommentTok{\#An id\_int to identify the intersection of a given pair}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id\_int =} \FunctionTok{paste0}\NormalTok{(wdpaid, }\StringTok{"\_"}\NormalTok{, wdpaid}\FloatTok{.1}\NormalTok{), }\AttributeTok{.before =}\NormalTok{ wdpaid) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id\_int\_temp =} \FunctionTok{paste0}\NormalTok{(wdpaid, }\StringTok{"\_"}\NormalTok{, wdpaid}\FloatTok{.1}\NormalTok{), }\AttributeTok{.before =}\NormalTok{ wdpaid) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#create a mirror idX\_idY {-}{-}\textgreater{} idY\_idX so that we identify the both member of a pair with the same id}
  \FunctionTok{separate}\NormalTok{(id\_int\_temp, }\AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"id\_temp1"}\NormalTok{, }\StringTok{"id\_temp2"}\NormalTok{), }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id\_int\_rev =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    id\_temp1 }\SpecialCharTok{\textless{}}\NormalTok{ id\_temp2 }\SpecialCharTok{\textasciitilde{}} \FunctionTok{paste}\NormalTok{(id\_temp1, id\_temp2, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{),}
\NormalTok{    id\_temp1 }\SpecialCharTok{\textgreater{}}\NormalTok{ id\_temp2 }\SpecialCharTok{\textasciitilde{}} \FunctionTok{paste}\NormalTok{(id\_temp2, id\_temp1, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{),}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \FunctionTok{paste}\NormalTok{(id\_temp1, id\_temp2, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{)),}
    \AttributeTok{.after =}\NormalTok{ id\_int) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#finally, get rid of the duplicates (have the same id\_int\_rev)}
  \FunctionTok{group\_by}\NormalTok{(id\_int\_rev) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#select relevant variables only}
  \FunctionTok{select}\NormalTok{(wdpaid, iso3, drct, ann\_c, wdpaid}\FloatTok{.1}\NormalTok{, iso3}\FloatTok{.1}\NormalTok{, drct}\FloatTok{.1}\NormalTok{, ann\_c}\FloatTok{.1}\NormalTok{, geom, area\_int)}

\CommentTok{\#Computing the total area of intersections}
\CommentTok{\#At country level ...}
\NormalTok{pa\_int\_ctry }\OtherTok{=}\NormalTok{ pa\_int }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Only overlapping PAs in the same country are considered}
  \FunctionTok{subset}\NormalTok{(iso3 }\SpecialCharTok{==}\NormalTok{  iso3}\FloatTok{.1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{tot\_area\_int =} \FunctionTok{sum}\NormalTok{(area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_drop\_geometry}\NormalTok{()}

\CommentTok{\#At region level}
\NormalTok{pa\_int\_dr }\OtherTok{=}\NormalTok{ pa\_int }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Only overlapping PAs in the same DR are considered}
  \FunctionTok{subset}\NormalTok{(drct }\SpecialCharTok{==}\NormalTok{ drct}\FloatTok{.1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(drct) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{tot\_area\_int =} \FunctionTok{sum}\NormalTok{(area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_drop\_geometry}\NormalTok{()}

\DocumentationTok{\#\#At world level : all overlap are considered}
\NormalTok{pa\_int\_wld }\OtherTok{=} \FunctionTok{sum}\NormalTok{(pa\_int}\SpecialCharTok{$}\NormalTok{area\_int) }

\CommentTok{\#Compute the total intersection for each year}
\NormalTok{pa\_int\_yr }\OtherTok{=}\NormalTok{ pa\_int }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Define intersection year : the date ann\_c of the later PA in the pair}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{annee\_int =} \FunctionTok{max}\NormalTok{(ann\_c, ann\_c}\FloatTok{.1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(annee\_int) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{tot\_int\_km2 =} \FunctionTok{sum}\NormalTok{(area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_drop\_geometry}\NormalTok{()}

\CommentTok{\# fwrite(pa\_int\_yr,}
\CommentTok{\#        "data\_tidy/area/pa\_int\_yr.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{computing-total-areas-without-intersection}{%
\subsection{Computing total areas without intersection}\label{computing-total-areas-without-intersection}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#At country level ...}
\NormalTok{pa\_area\_ctry }\OtherTok{=}\NormalTok{ data\_stat\_nofund\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute total area at country level}
  \FunctionTok{group\_by}\NormalTok{(iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{sprfc\_tot\_km2 =} \FunctionTok{sum}\NormalTok{(superficie)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Add information on intersection area in each country. Modify the variable so that NA value {-}\textgreater{} 0}
  \FunctionTok{left\_join}\NormalTok{(pa\_int\_ctry, }\AttributeTok{by =} \StringTok{"iso3"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{tot\_area\_int =} \FunctionTok{case\_when}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tot\_area\_int) }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \DecValTok{0}\NormalTok{, }\ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ tot\_area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute the total area at country level without intersection}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sprfc\_tot\_noint\_km2 =}\NormalTok{ sprfc\_tot\_km2 }\SpecialCharTok{{-}}\NormalTok{ tot\_area\_int) }

\CommentTok{\#fwrite(pa\_area\_ctry, "data\_tidy/area/pa\_area\_ctry.csv")}

\CommentTok{\#At DR level ...}
\NormalTok{pa\_area\_dr }\OtherTok{=}\NormalTok{ data\_stat\_nofund\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute total area at dr level}
  \FunctionTok{group\_by}\NormalTok{(direction\_regionale) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{sprfc\_tot\_km2 =} \FunctionTok{sum}\NormalTok{(superficie)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Add information on intersection area in each DR. Modify the variable so that NA value {-}\textgreater{} 0}
  \FunctionTok{left\_join}\NormalTok{(pa\_int\_dr, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"direction\_regionale"} \OtherTok{=} \StringTok{"drct"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{tot\_area\_int =} \FunctionTok{case\_when}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tot\_area\_int) }\SpecialCharTok{==} \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{, }\ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{tot\_area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute the total area at country level without intersection}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sprfc\_tot\_noint\_km2 =}\NormalTok{ sprfc\_tot\_km2 }\SpecialCharTok{{-}}\NormalTok{ tot\_area\_int) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_drop\_geometry}\NormalTok{()}

\CommentTok{\#fwrite(pa\_area\_dr, "data\_tidy/area/pa\_area\_dr.csv")}

\CommentTok{\#At world level}
\NormalTok{pa\_area\_wld }\OtherTok{=} \FunctionTok{sum}\NormalTok{(data\_stat\_nofund\_nodupl}\SpecialCharTok{$}\NormalTok{superficie) }\SpecialCharTok{{-}}\NormalTok{ pa\_int\_wld }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"sprfc\_tot\_noint\_km2"} \OtherTok{=} \StringTok{"."}\NormalTok{)}
\CommentTok{\#fwrite(pa\_area\_wld, "data\_tidy/area/pa\_area\_wld.csv")}
\end{Highlighting}
\end{Shaded}

\hypertarget{old-code}{%
\section{Old code}\label{old-code}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Listing variables public or confidential}

\CommentTok{\#Public variables in the PAs dataset}
\NormalTok{list\_var\_PA\_open }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"id\_projet"}\NormalTok{, }\StringTok{"nom\_du\_projet"}\NormalTok{, }\StringTok{"nom\_ap"}\NormalTok{, }\StringTok{"id\_concours"}\NormalTok{, }
                \StringTok{"wdpaid"}\NormalTok{, }\StringTok{"wdpaid\_2"}\NormalTok{, }\StringTok{"wdpaid\_3"}\NormalTok{, }\StringTok{"wdpa\_pid"}\NormalTok{,}
                \StringTok{"pays"}\NormalTok{, }\StringTok{"iso3"}\NormalTok{, }\StringTok{"direction\_regionale"}\NormalTok{, }\StringTok{"annee\_octroi"}\NormalTok{,}
                \StringTok{"cofinancier\_1"}\NormalTok{, }\StringTok{"cofinancier\_2"}\NormalTok{, }\StringTok{"cofinancier\_3"}\NormalTok{, }
                \StringTok{"cofinancier\_4"}\NormalTok{, }\StringTok{"cofinancier\_5"}\NormalTok{, }\StringTok{"cofinancier\_6"}\NormalTok{,}
                \StringTok{"kfw\_bin"}\NormalTok{, }\StringTok{"ffem\_bin"}\NormalTok{, }\StringTok{"nb\_ap\_nombre\_potentiel"}\NormalTok{, }\StringTok{"detail"}\NormalTok{,}
                \StringTok{"iucn\_cat"}\NormalTok{, }\StringTok{"iucn\_des"}\NormalTok{, }\StringTok{"marine"}\NormalTok{, }\StringTok{"superficie"}\NormalTok{,}
                \StringTok{"status"}\NormalTok{, }\StringTok{"status\_yr"}\NormalTok{, }\StringTok{"gov\_type"}\NormalTok{,}\StringTok{"own\_type"}\NormalTok{, }\StringTok{"mang\_auth"}\NormalTok{)}
\CommentTok{\#Confidential variables in the PAs dataset}
\NormalTok{list\_var\_PA\_conf }\OtherTok{=}\NormalTok{ list\_var\_joint\_conf }\OtherTok{=} 
  \FunctionTok{c}\NormalTok{(}\StringTok{"montant\_prevu\_concours\_euro\_octroi"}\NormalTok{, }\StringTok{"mt\_global\_projet\_prevu\_devise"}\NormalTok{,}
    \StringTok{"engagements\_nets\_euro\_octroi"}\NormalTok{ , }\StringTok{"montant\_total\_projet"}\NormalTok{,}
    \StringTok{"produit"}\NormalTok{, }\StringTok{"libelle\_produit"}\NormalTok{,}
    \StringTok{"date\_de\_1er\_versement\_projet"}\NormalTok{, }\StringTok{"dernier\_versement\_en\_date\_projet"}\NormalTok{,}
    \StringTok{"date\_signature\_convention\_cf"}\NormalTok{, }\StringTok{"duree\_du\_concours\_annee"}\NormalTok{,}
    \StringTok{"duree\_du\_concours\_annee\_et\_mois"}\NormalTok{, }\StringTok{"beneficiaire\_primaire"}\NormalTok{,}
    \StringTok{"responsable\_equipe\_projet"}\NormalTok{, }\StringTok{"directeur\_trice\_dagence"}\NormalTok{, }\StringTok{"maitrise\_ouvrage"}
\NormalTok{    )}
\CommentTok{\#Confidential variables among shapefiles}
\NormalTok{list\_var\_shp\_conf }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"mntnt"}\NormalTok{, }\StringTok{"mtglb"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"mnt"}\NormalTok{, }\StringTok{"prodt"}\NormalTok{, }\StringTok{"lbllp"}\NormalTok{,}
                      \StringTok{"rspns"}\NormalTok{, }\StringTok{"dr"}\NormalTok{, }\StringTok{"detal"}\NormalTok{, }\StringTok{"projt"}\NormalTok{, }\StringTok{"cmmnt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{base\_nodupl\_lea }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/base\_nodupl\_lea.xlsx")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nodupl\_lea\_pub.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(}\FunctionTok{names}\NormalTok{(data\_stat\_nodupl)))}
  
\CommentTok{\#import a dataset with country anmes and corresponding ISO3 code}
\NormalTok{data\_iso }\OtherTok{=}\NormalTok{ data\_stat }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(pays, iso3)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{)}

\NormalTok{base\_nodupl\_old }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/base\_nodupl\_old.csv") }
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nodupl\_old\_pub.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(}\FunctionTok{names}\NormalTok{(data\_stat\_nodupl))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(data\_iso, }\AttributeTok{by =} \StringTok{"pays"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{iso3 =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    pays }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Mayotte"}\NormalTok{, }\StringTok{"P{-}N N.Caléd"}\NormalTok{, }\StringTok{"P{-}S N.Caléd"}\NormalTok{, }
                \StringTok{"Polynesie Francaise"}\NormalTok{, }\StringTok{"Nlle Caledonie"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"FRA"}\NormalTok{,}
\NormalTok{    pays }\SpecialCharTok{==} \StringTok{"Multi{-}Pays"} \SpecialCharTok{\textasciitilde{}} \StringTok{"ZZ"}\NormalTok{,}
    \SpecialCharTok{!}\NormalTok{(pays }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Mayotte"}\NormalTok{, }\StringTok{"P{-}N N.Caléd"}\NormalTok{, }\StringTok{"P{-}S N.Caléd"}\NormalTok{, }
                \StringTok{"Polynesie Francaise"}\NormalTok{, }\StringTok{"Nlle Caledonie"}\NormalTok{, }\StringTok{"Multi{-}Pays"}\NormalTok{)) }\SpecialCharTok{\textasciitilde{}}\NormalTok{ iso3}
\NormalTok{  ))}

\CommentTok{\# projet\_nodupl\_old = }
\CommentTok{\#   \#readxl::read\_xlsx("data\_tidy/projet\_nodupl\_old.xlsx")}
\CommentTok{\#   aws.s3::s3read\_using(}
\CommentTok{\#   FUN = readxl::read\_xlsx,}
\CommentTok{\#   \# Mettre les options de FUN ici}
\CommentTok{\#   object = "data\_tidy/projet\_nodupl\_old.xlsx",}
\CommentTok{\#   bucket = "projet{-}afd{-}eva{-}ap",}
\CommentTok{\#   opts = list("region" = ""))}

\NormalTok{bdd\_joint }\OtherTok{=} 
  \CommentTok{\#fread("data\_raw/BDD\_joint.xlsx")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_joint\_tidy\_pub.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{any\_of}\NormalTok{(}\FunctionTok{names}\NormalTok{(data\_stat\_nodupl)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Test : differences between Léa\textquotesingle{}s figures and my results}

\CommentTok{\#PA identified with unique WDPAID. If more than 1 WDPAID, take the earlier annee\_octroi}
\NormalTok{base\_id }\OtherTok{=}\NormalTok{ data\_stat }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(wdpaid)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(wdpaid) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{test }\OtherTok{=}\NormalTok{ base\_id[}\FunctionTok{duplicated}\NormalTok{(base\_id}\SpecialCharTok{$}\NormalTok{wdpaid),]}

\NormalTok{base\_old\_id }\OtherTok{=}\NormalTok{ base\_nodupl\_old }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"NA"}\NormalTok{, wdpaid) }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{)  }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(wdpaid) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{wdpaid =} \FunctionTok{as.numeric}\NormalTok{(wdpaid)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\CommentTok{\#Identify PA in common among them with WDPAID reported}
\NormalTok{test\_id }\OtherTok{=}\NormalTok{ base\_old\_id }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(id\_projet, nom\_du\_projet, nom\_ap, id\_concours, wdpaid)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(}\FunctionTok{select}\NormalTok{(base\_id, }
                   \FunctionTok{c}\NormalTok{(id\_projet, nom\_du\_projet, nom\_ap, id\_concours, wdpaid)),}
            \AttributeTok{by =} \StringTok{"wdpaid"}\NormalTok{)}

\CommentTok{\#PA whose WDPAID is unknown, identified by id1 uniquely}
\CommentTok{\#The duplicates comes from different concours ID, so do not correspond to different PA}
\NormalTok{base\_na }\OtherTok{=}\NormalTok{ data\_stat }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(wdpaid)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id1 =} \FunctionTok{paste}\NormalTok{(id\_projet, iso3, nom\_ap, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{),}
         \AttributeTok{.before =}\NormalTok{ id\_projet) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{base\_old\_na }\OtherTok{=}\NormalTok{ base\_nodupl\_old }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{grepl}\NormalTok{(}\StringTok{"NA"}\NormalTok{, wdpaid) }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{id1 =} \FunctionTok{paste}\NormalTok{(id\_projet, iso3, nom\_ap, }\AttributeTok{sep =} \StringTok{"\_"}\NormalTok{),}
         \AttributeTok{.before =}\NormalTok{ id\_projet) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(id1) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{slice}\NormalTok{(}\DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{test\_na }\OtherTok{=}\NormalTok{ base\_na }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(id1, id\_projet, nom\_du\_projet, nom\_ap, id\_concours)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(}\FunctionTok{select}\NormalTok{(base\_old\_na, }
                   \FunctionTok{c}\NormalTok{(id1, id\_projet, nom\_du\_projet, nom\_ap, id\_concours)),}
            \AttributeTok{by =} \StringTok{"id1"}\NormalTok{)}

\FunctionTok{nrow}\NormalTok{(test\_na }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{subset}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(id\_projet.y) }\SpecialCharTok{==} \ConstantTok{TRUE}\NormalTok{))}

\CommentTok{\#base\_nodupl}

\NormalTok{base\_nodupl }\OtherTok{=} \FunctionTok{rbind}\NormalTok{(}\FunctionTok{select}\NormalTok{(base\_na, }\SpecialCharTok{{-}}\NormalTok{id1), base\_id)}
\end{Highlighting}
\end{Shaded}

\hypertarget{part-descriptive-statistics}{%
\part*{Descriptive statistics}\label{part-descriptive-statistics}}
\addcontentsline{toc}{part}{Descriptive statistics}

\hypertarget{projects-funded-by-the-afd}{%
\chapter{Projects funded by the AFD}\label{projects-funded-by-the-afd}}

In this document are performed and plotted descriptive statistics from the datasets built in buildingDB\_PA\_WDPA. The following statistics are derived :

\begin{itemize}
\tightlist
\item
  Distribution of parcels among IUCN categories, at country, region and world level.
\item
  Distribution in terms of ecosystems
\item
  Distribution of PAs across countries and regions
\end{itemize}

\hypertarget{importing-packages}{%
\section{Importing packages}\label{importing-packages}}

\#\texttt{\{r\ setup,\ include=FALSE,\ eval\ =\ FALSE\}\ \#knitr::opts\_knit\$set(root.dir\ =\ rprojroot::find\_rstudio\_root\_file())\ \#}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(stargazer)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(ggrepel)}
\FunctionTok{library}\NormalTok{(RColorBrewer)}
\FunctionTok{library}\NormalTok{(data.table)}
\CommentTok{\#library(readxl)}
\CommentTok{\#library(splitstackshape) }
\FunctionTok{library}\NormalTok{(janitor)}
\FunctionTok{library}\NormalTok{(xtable)}
\FunctionTok{library}\NormalTok{(questionr)}
\FunctionTok{library}\NormalTok{(tidyterra)}
\FunctionTok{library}\NormalTok{(terra)}
\FunctionTok{library}\NormalTok{(sf)}
\FunctionTok{library}\NormalTok{(mapview)}
\FunctionTok{library}\NormalTok{(aws.s3)}
\end{Highlighting}
\end{Shaded}

\hypertarget{importing-datasets}{%
\section{Importing datasets}\label{importing-datasets}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Both datasets are imported also in UTF8 encoding, for some variables}
\DocumentationTok{\#\#A first dataset with some PA on more than one row (one line per funding for instance)}
\NormalTok{data\_stat }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/BDD\_DesStat\_nofund.csv", encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nofund.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\DocumentationTok{\#\#A second dataset with one line per PA, more suited for some statistics}
\NormalTok{data\_stat\_nodupl }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv" , encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\NormalTok{pa\_area\_ctry }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/area/pa\_area\_ctry.csv", encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/area/pa\_area\_ctry.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\NormalTok{pa\_area\_dr }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/area/pa\_area\_dr.csv", encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/area/pa\_area\_dr.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\NormalTok{pa\_area\_wld }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/area/pa\_area\_wld.csv", encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/area/pa\_area\_wld.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\NormalTok{pa\_int\_yr }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/area/pa\_area\_dr.csv", encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/area/pa\_int\_yr.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{performing-descriptive-statistics}{%
\section{Performing descriptive statistics}\label{performing-descriptive-statistics}}

\hypertarget{iucn-categories}{%
\subsection{IUCN categories}\label{iucn-categories}}

\hypertarget{share-of-pas-by-iucn-categories}{%
\subsubsection{Share of PAs by IUCN categories}\label{share-of-pas-by-iucn-categories}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Building the relevant dataset}
\DocumentationTok{\#\#For all PAs ..}
\NormalTok{data\_cat\_iucn }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iucn\_des) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#number of PAs per IUCN category}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n\_iucn =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Frequency of IUCN categories}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_pa =} \FunctionTok{sum}\NormalTok{(n\_iucn),}
         \AttributeTok{freq\_iucn =} \FunctionTok{round}\NormalTok{(n\_iucn}\SpecialCharTok{/}\NormalTok{n\_pa}\SpecialCharTok{*}\DecValTok{100}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(iucn\_des)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ypos\_iucn =} \FunctionTok{cumsum}\NormalTok{(freq\_iucn) }\SpecialCharTok{{-}} \FloatTok{0.5}\SpecialCharTok{*}\NormalTok{freq\_iucn) }


\DocumentationTok{\#\#... and for referenced PAs only}
\NormalTok{data\_cat\_iucn\_ref }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Remove not referenced PAs}
  \FunctionTok{subset}\NormalTok{(}\SpecialCharTok{!}\NormalTok{(iucn\_des }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Non catégorisée"}\NormalTok{, }\StringTok{"Non référencée"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iucn\_des) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#number of PAs per IUCN category}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n\_iucn =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Frequency of IUCN categories}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_pa =} \FunctionTok{sum}\NormalTok{(n\_iucn),}
         \AttributeTok{freq\_iucn =} \FunctionTok{round}\NormalTok{(n\_iucn}\SpecialCharTok{/}\NormalTok{n\_pa}\SpecialCharTok{*}\DecValTok{100}\NormalTok{, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(freq\_iucn) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ypos\_iucn =} \FunctionTok{cumsum}\NormalTok{(freq\_iucn) }\SpecialCharTok{{-}} \FloatTok{0.5}\SpecialCharTok{*}\NormalTok{freq\_iucn) }

\CommentTok{\#Latex table}
\NormalTok{tbl\_cat\_iucn }\OtherTok{=}\NormalTok{ data\_cat\_iucn }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(iucn\_des, n\_iucn, freq\_iucn))}
\FunctionTok{names}\NormalTok{(tbl\_cat\_iucn) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Catégories IUCN"}\NormalTok{,}\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{, }\StringTok{"Proportion d\textquotesingle{}AP (\%)"}\NormalTok{)}

\NormalTok{tbl\_cat\_iucn\_ref }\OtherTok{=}\NormalTok{ data\_cat\_iucn\_ref }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(iucn\_des, n\_iucn, freq\_iucn))}
\FunctionTok{names}\NormalTok{(tbl\_cat\_iucn\_ref) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Catégories IUCN"}\NormalTok{,}\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{, }\StringTok{"Proportion d\textquotesingle{}AP (\%)"}\NormalTok{)}


\CommentTok{\#Histogram including non{-}referenced PAs}
\NormalTok{hist\_cat\_iucn }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_cat\_iucn, }
                       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(iucn\_des, }\SpecialCharTok{{-}}\NormalTok{freq\_iucn), }
                           \AttributeTok{y =}\NormalTok{ freq\_iucn, }\AttributeTok{fill =}\NormalTok{ iucn\_des)) }\SpecialCharTok{\%\textgreater{}\%} 
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=}\StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n\_iucn, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq\_iucn), }
            \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
            \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par catégorie IUCN"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_cat\_iucn}\SpecialCharTok{$}\NormalTok{n\_iucn), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur les barres."}\NormalTok{),}
          \AttributeTok{x =} \StringTok{"Catégories IUCN"}\NormalTok{, }
          \AttributeTok{y =} \StringTok{"Nombre (\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{9}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_cat\_iucn}

\CommentTok{\#Histogram excluding non{-}referenced PAs}
\NormalTok{hist\_cat\_iucn\_ref }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_cat\_iucn\_ref, }
                       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(iucn\_des, }\SpecialCharTok{{-}}\NormalTok{freq\_iucn), }
                           \AttributeTok{y =}\NormalTok{ freq\_iucn, }\AttributeTok{fill =}\NormalTok{ iucn\_des)) }\SpecialCharTok{\%\textgreater{}\%} 
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=}\StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n\_iucn, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq\_iucn), }
            \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
            \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par catégorie IUCN (hors AP non{-}répertoriées)"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_cat\_iucn\_ref}\SpecialCharTok{$}\NormalTok{n\_iucn), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur les barres."}\NormalTok{),}
          \AttributeTok{x =} \StringTok{"Catégories IUCN"}\NormalTok{, }
          \AttributeTok{y =} \StringTok{"Nombre (\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{9}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_cat\_iucn\_ref}


\CommentTok{\#Pie chart INcluding non{-}referenced PAs}
\NormalTok{pie\_cat\_iucn }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_cat\_iucn, }
                      \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\NormalTok{ freq\_iucn, }\AttributeTok{fill =}\NormalTok{ iucn\_des)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_label\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.2}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{round}\NormalTok{(freq\_iucn, }\DecValTok{1}\NormalTok{), }\StringTok{"\%"}\NormalTok{)), }
             \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }
             \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
             \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# + geom\_label(aes(x=1.4, label = paste0(freq\_iucn, "\%")), }
  \CommentTok{\#              color = "white", }
  \CommentTok{\#              position = position\_stack(vjust = 0.7), size=2.5, }
  \CommentTok{\#              show.legend = FALSE) \%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{,}
         \AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par catégorie IUCN (\%)"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_cat\_iucn}\SpecialCharTok{$}\NormalTok{n\_iucn), }\StringTok{"aires protégées"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Catégories"}\NormalTok{, }\AttributeTok{palette =} \StringTok{"Dark2"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{pie\_cat\_iucn}



\CommentTok{\#Pie chart EXcluding non{-}referenced PAs}
\NormalTok{pie\_cat\_iucn\_ref }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_cat\_iucn\_ref, }
                      \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\NormalTok{ freq\_iucn, }\AttributeTok{fill =}\NormalTok{ iucn\_des)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_label\_repel}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.2}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{round}\NormalTok{(freq\_iucn, }\DecValTok{1}\NormalTok{), }\StringTok{"\%"}\NormalTok{)), }
             \AttributeTok{color =} \StringTok{"white"}\NormalTok{, }
             \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
             \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# + geom\_label(aes(x=1.4, label = paste0(freq\_iucn, "\%")), }
  \CommentTok{\#              color = "white", }
  \CommentTok{\#              position = position\_stack(vjust = 0.7), size=2.5, }
  \CommentTok{\#              show.legend = FALSE) \%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =} \StringTok{""}\NormalTok{,}
         \AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par catégorie IUCN }\SpecialCharTok{\textbackslash{}n}\StringTok{hors aires non répertoriées (\%)"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_cat\_iucn\_ref}\SpecialCharTok{$}\NormalTok{n\_iucn), }\StringTok{"aires protégées"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Catégories"}\NormalTok{, }\AttributeTok{palette =} \StringTok{"Dark2"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{pie\_cat\_iucn\_ref}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_cat\_iucn.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_cat\_iucn,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_cat\_iucn\_ref.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_cat\_iucn\_ref,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"pie\_cat\_iucn.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ pie\_cat\_iucn,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"pie\_cat\_iucn\_ref.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ pie\_cat\_iucn\_ref,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_cat\_iucn, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_cat\_iucn.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_cat\_iucn\_ref, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_cat\_iucn\_ref.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/IUCN"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{iucn-categories-by-countries-and-regions}{%
\subsubsection{IUCN categories by countries and regions}\label{iucn-categories-by-countries-and-regions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Build the distribution of IUCN categories at country level ...}
\NormalTok{data\_iucn\_ctry }\OtherTok{=} \FunctionTok{table}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{iucn\_des,}
\NormalTok{                       data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Create a table with all iucn categories for each country, and compute the frequencies in percent}
  \FunctionTok{prop.table}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Freq =} \FunctionTok{round}\NormalTok{(Freq, }\DecValTok{3}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ Var2, }\AttributeTok{values\_from =}\NormalTok{ Freq) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"iucn\_des"} \OtherTok{=} \StringTok{"Var1"}\NormalTok{)}

\CommentTok{\#... and regional level}
\NormalTok{data\_iucn\_reg }\OtherTok{=} \FunctionTok{table}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{iucn\_des,}
\NormalTok{                       data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{direction\_regionale) }\SpecialCharTok{\%\textgreater{}\%}
    \CommentTok{\#Create a table with all iucn categories for each country, and compute the frequencies in percent}
  \FunctionTok{prop.table}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Freq =} \FunctionTok{round}\NormalTok{(Freq, }\DecValTok{3}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =}\NormalTok{ Var2, }\AttributeTok{values\_from =}\NormalTok{ Freq) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"iucn\_des"} \OtherTok{=} \StringTok{"Var1"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(data\_iucn\_ctry, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_iucn\_ctry.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(data\_iucn\_reg, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_iucn\_reg.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/IUCN"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{ecosystems-excluding-non-referenced-pas}{%
\subsection{Ecosystems (excluding non-referenced PAs)}\label{ecosystems-excluding-non-referenced-pas}}

\hypertarget{proportion-of-pas-by-marine-or-terrestrial-areas}{%
\subsubsection{Proportion of PAs by marine or terrestrial areas}\label{proportion-of-pas-by-marine-or-terrestrial-areas}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Build datasets}
\NormalTok{data\_eco }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#subset non{-}referencded PAs (have NA ecosysteme)}
  \FunctionTok{subset}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(marine) }\SpecialCharTok{==} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{marine =} \FunctionTok{as.factor}\NormalTok{(marine))}
\NormalTok{data\_eco}\SpecialCharTok{$}\NormalTok{ecosyst\_en }\OtherTok{=} \FunctionTok{fct\_recode}\NormalTok{(data\_eco}\SpecialCharTok{$}\NormalTok{marine, }
                              \StringTok{"Terrestrial"}\OtherTok{=}\StringTok{"0"}\NormalTok{, }
                              \StringTok{"Coastal"}\OtherTok{=}\StringTok{"1"}\NormalTok{, }
                              \StringTok{"Marine"}\OtherTok{=}\StringTok{"2"}\NormalTok{)}
\NormalTok{data\_eco}\SpecialCharTok{$}\NormalTok{ecosyst\_fr }\OtherTok{=} \FunctionTok{fct\_recode}\NormalTok{(data\_eco}\SpecialCharTok{$}\NormalTok{marine, }
                              \StringTok{"Terrestre"}\OtherTok{=}\StringTok{"0"}\NormalTok{, }
                              \StringTok{"Côtier"}\OtherTok{=}\StringTok{"1"}\NormalTok{, }
                              \StringTok{"Marin"}\OtherTok{=}\StringTok{"2"}\NormalTok{)}

\NormalTok{data\_eco\_hist }\OtherTok{=}\NormalTok{ data\_eco }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(ecosyst\_en, ecosyst\_fr) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(data\_eco), }\DecValTok{1}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\NormalTok{tbl\_eco\_world\_fr }\OtherTok{=}\NormalTok{ data\_eco\_hist }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(ecosyst\_fr, n, freq)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"Ecosystème"} \OtherTok{=} \StringTok{"ecosyst\_fr"}\NormalTok{,}
         \StringTok{"Nombre d\textquotesingle{}AP"} \OtherTok{=} \StringTok{"n"}\NormalTok{,}
         \StringTok{"Proportion d\textquotesingle{}AP(\%)"} \OtherTok{=} \StringTok{"freq"}\NormalTok{)}

\NormalTok{tbl\_eco\_world\_en }\OtherTok{=}\NormalTok{ data\_eco\_hist }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(ecosyst\_en, n, freq)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\StringTok{"Ecosystem"} \OtherTok{=} \StringTok{"ecosyst\_en"}\NormalTok{,}
         \StringTok{"Number of PAs"} \OtherTok{=} \StringTok{"n"}\NormalTok{,}
         \StringTok{"Share of PAs(\%)"} \OtherTok{=} \StringTok{"freq"}\NormalTok{)}


\CommentTok{\#Histogram in share (in French)}
\NormalTok{hist\_eco\_shr\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ecosyst\_fr, }\AttributeTok{y =}\NormalTok{ freq, }\AttributeTok{fill =}\NormalTok{ ecosyst\_fr)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par type d\textquotesingle{}écosystème }\SpecialCharTok{\textbackslash{}n}\StringTok{(hors AP non{-}référencées)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur les barres."}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Type d\textquotesingle{}écosystème"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_eco\_shr\_fr}
\CommentTok{\# }



\CommentTok{\#Histogram in share (in English)}
\NormalTok{hist\_eco\_shr\_en }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ecosyst\_en, }\AttributeTok{y =}\NormalTok{ freq, }\AttributeTok{fill =}\NormalTok{ ecosyst\_en)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion of protected areas by ecosystem type }\SpecialCharTok{\textbackslash{}n}\StringTok{(excluding non{-}references PAs)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Sample :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"protected areas. Number of areas indicated above."}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Ecosystem type"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion of protected areas(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\CommentTok{\#hist\_eco\_shr\_en}


  
\CommentTok{\#Histogram in number (in French)}
\NormalTok{hist\_eco\_n\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ecosyst\_fr, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ ecosyst\_fr)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par type d\textquotesingle{}écosystème }\SpecialCharTok{\textbackslash{}n}\StringTok{(hors AP non{-}référencées)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Type d\textquotesingle{}écosystème"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_eco\_n\_fr}




\CommentTok{\#Histogram in number (in English)}
\NormalTok{hist\_eco\_n\_en }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ecosyst\_en, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ ecosyst\_en)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion of protected areas by ecosystem type }\SpecialCharTok{\textbackslash{}n}\StringTok{(excluding non{-}referenced PAs)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Sample :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"protected areas"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Ecosystem type"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion of protected areas"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\CommentTok{\#hist\_eco\_n\_en}

\CommentTok{\#Pie chart (in French)}
\NormalTok{pie\_eco\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =}\NormalTok{ freq, }\AttributeTok{fill =}\NormalTok{ ecosyst\_fr)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{,}\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.3}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(freq, }\StringTok{"\%"}\NormalTok{)), }
             \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
             \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par type d\textquotesingle{}écosystème }\SpecialCharTok{\textbackslash{}n}\StringTok{(hors AP non{-}référencées)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Type d\textquotesingle{}écosystème"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Ecosystème"}\NormalTok{, }\AttributeTok{palette=}\StringTok{"Paired"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\CommentTok{\#pie\_eco\_fr}


\CommentTok{\#Histogram in number (in English)}
\NormalTok{pie\_eco\_en }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_eco\_hist, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \StringTok{""}\NormalTok{, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ ecosyst\_en)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{,}\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.3}\NormalTok{, }\AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(freq, }\StringTok{"\%"}\NormalTok{)), }
             \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
             \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion of protected areas by ecosystem type }\SpecialCharTok{\textbackslash{}n}\StringTok{(exluding non{-}referenced PAs)"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Sample :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_eco\_hist}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"protected areas"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Ecosystem type"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion of protected areas"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Ecosystem"}\NormalTok{, }\AttributeTok{palette=}\StringTok{"Paired"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{pie\_eco\_en}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}


\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_eco\_shr\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_eco\_shr\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_eco\_shr\_en.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_eco\_shr\_en,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_eco\_n\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_eco\_n\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_eco\_n\_en.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_eco\_n\_en,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"pie\_eco\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ pie\_eco\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"pie\_eco\_en.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ pie\_eco\_en,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_eco\_world\_fr, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{), }
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_ecosyst\_fr.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_eco\_world\_en, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{), }
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_ecosyst\_en.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/ecosysteme"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{distribution-of-pas-across-countries-and-regions}{%
\subsection{Distribution of PAs across countries and regions}\label{distribution-of-pas-across-countries-and-regions}}

\hypertarget{statistics-at-country-level}{%
\subsubsection{Statistics at country level}\label{statistics-at-country-level}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_distrib\_ctry }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(pays, iso3) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(data\_stat\_nodupl), }\DecValTok{1}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }


\NormalTok{data\_distrib\_ctry\_top }\OtherTok{=}\NormalTok{ data\_distrib\_ctry }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{subset}\NormalTok{(freq }\SpecialCharTok{\textgreater{}=} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Histogram in share (in French) for top countries}
\NormalTok{hist\_distrib\_ctry\_top\_shr\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_distrib\_ctry\_top, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(pays, }\SpecialCharTok{{-}}\NormalTok{freq), }\AttributeTok{y =}\NormalTok{ freq, }\AttributeTok{fill =}\NormalTok{ pays)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Les pays abritant le plus d\textquotesingle{}aires protégées"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_distrib\_ctry}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué à la base du graphique"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Pays"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_distrib\_ctry\_top\_shr\_fr}
\CommentTok{\# }


\CommentTok{\#Histogram in number (in French)}
\NormalTok{hist\_distrib\_ctry\_n\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_distrib\_ctry, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(pays, }\SpecialCharTok{{-}}\NormalTok{n), }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ pays)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ n), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par pays"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_distrib\_ctry}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur chaque barre"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Pays"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_distrib\_ctry\_n\_fr}
\CommentTok{\# }
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_distrib\_ctry\_top\_shr\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_distrib\_ctry\_top\_shr\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_distrib\_ctry\_n\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_distrib\_ctry\_n\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/distribution"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{statistics-at-region-level}{%
\subsubsection{Statistics at region level}\label{statistics-at-region-level}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_distrib\_reg }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(direction\_regionale) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(data\_stat\_nodupl), }\DecValTok{3}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{region =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"Dr "}\NormalTok{, }\StringTok{""}\NormalTok{, direction\_regionale),}
         \AttributeTok{.after =} \StringTok{"direction\_regionale"}\NormalTok{)}


\NormalTok{data\_distrib\_reg\_top }\OtherTok{=}\NormalTok{ data\_distrib\_reg }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{subset}\NormalTok{(freq }\SpecialCharTok{\textgreater{}=} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Histogram in share (in French) for top countries}
\NormalTok{hist\_distrib\_reg\_top\_shr\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_distrib\_reg\_top, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(region, }\SpecialCharTok{{-}}\NormalTok{freq), }\AttributeTok{y =}\NormalTok{ freq, }\AttributeTok{fill =}\NormalTok{ region)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ freq), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Les directions régionales finançant le plus d\textquotesingle{}aires protégées"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_distrib\_reg}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur chaque barre."}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Direction régionale"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{0}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_distrib\_reg\_top\_shr\_fr}
\CommentTok{\# }


\CommentTok{\#Histogram in number (in French)}
\NormalTok{hist\_distrib\_reg\_n\_fr }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_distrib\_reg, }
                     \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{reorder}\NormalTok{(direction\_regionale, }\SpecialCharTok{{-}}\NormalTok{n), }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ direction\_regionale)) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.50}\NormalTok{, }\AttributeTok{fill=} \StringTok{"\#3182BD"}\NormalTok{, }\AttributeTok{stat=}\StringTok{"identity"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{round}\NormalTok{(n, }\DecValTok{1}\NormalTok{), }\AttributeTok{y =}\NormalTok{ n), }
        \AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.1}\NormalTok{, }\AttributeTok{color=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{size=}\FloatTok{3.5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Proportion d\textquotesingle{}aires protégées par région"}\NormalTok{,}
       \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_distrib\_ctry}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées. Nombre d\textquotesingle{}aires indiqué sur chaque barre."}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Direction régionale"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Proportion d\textquotesingle{}aires protégées(\%)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{hist\_distrib\_reg\_n\_fr}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_distrib\_reg\_top\_shr\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_distrib\_reg\_top\_shr\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"hist\_distrib\_reg\_n\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ hist\_distrib\_reg\_n\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/distribution"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{surface-of-pas}{%
\subsection{Surface of PAs}\label{surface-of-pas}}

\hypertarget{distribution-of-surfaces}{%
\subsubsection{Distribution of surfaces}\label{distribution-of-surfaces}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tbl\_distrib\_area\_no0 }\OtherTok{=} \FunctionTok{summary}\NormalTok{(}
  \FunctionTok{filter}\NormalTok{(data\_stat\_nodupl, superficie }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{)}\SpecialCharTok{$}\NormalTok{superficie) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{format}\NormalTok{(}\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.array}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{t}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"1st Qu."}\NormalTok{,}\StringTok{"3rd Qu."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{average-surface-in-countries-and-regions}{%
\subsubsection{Average surface in countries and regions}\label{average-surface-in-countries-and-regions}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Distribution of PA WITH SURFACE \textgreater{}0 across countries and regions}
\DocumentationTok{\#\#Country}
\NormalTok{data\_distrib\_no0\_ctry }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(superficie }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(iso3, pays) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(data\_stat\_nodupl), }\DecValTok{1}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}

\DocumentationTok{\#\#Region}
\NormalTok{data\_distrib\_no0\_dr }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(superficie }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(direction\_regionale) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{(),}
            \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\FunctionTok{nrow}\NormalTok{(data\_stat\_nodupl), }\DecValTok{1}\NormalTok{)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{region =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"Dr "}\NormalTok{, }\StringTok{""}\NormalTok{, direction\_regionale),}
         \AttributeTok{.after =} \StringTok{"direction\_regionale"}\NormalTok{)}

\CommentTok{\#By country..}
\NormalTok{tbl\_area\_avg\_ctry }\OtherTok{=}\NormalTok{ data\_distrib\_no0\_ctry }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(pa\_area\_ctry, }\AttributeTok{by =} \StringTok{"iso3"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(iso3, sprfc\_tot\_km2, tot\_area\_int)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sprfc\_avg\_noint\_km2 =} \FunctionTok{format}\NormalTok{(sprfc\_tot\_noint\_km2}\SpecialCharTok{/}\NormalTok{n, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{1}\NormalTok{),}
         \AttributeTok{sprfc\_tot\_noint\_km2 =} \FunctionTok{format}\NormalTok{(sprfc\_tot\_noint\_km2, }\AttributeTok{big.mark  =} \StringTok{" "}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{1}\NormalTok{),}
\NormalTok{         )}
\FunctionTok{names}\NormalTok{(tbl\_area\_avg\_ctry) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Pays"}\NormalTok{, }\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{, }\StringTok{"Superficie totale (km2)"}\NormalTok{, }\StringTok{"Superficie moyenne (km2)"}\NormalTok{)}

\CommentTok{\#By region}
\NormalTok{tbl\_area\_avg\_dr }\OtherTok{=}\NormalTok{ data\_distrib\_no0\_dr }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(pa\_area\_dr, }\AttributeTok{by =} \StringTok{"direction\_regionale"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{c}\NormalTok{(sprfc\_tot\_km2, tot\_area\_int, direction\_regionale)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sprfc\_avg\_noint\_km2 =} \FunctionTok{format}\NormalTok{(sprfc\_tot\_noint\_km2}\SpecialCharTok{/}\NormalTok{n, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{1}\NormalTok{),}
         \AttributeTok{sprfc\_tot\_noint\_km2 =} \FunctionTok{format}\NormalTok{(sprfc\_tot\_noint\_km2, }\AttributeTok{big.mark  =} \StringTok{" "}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{digits =} \DecValTok{1}\NormalTok{),}
\NormalTok{         )}
\FunctionTok{names}\NormalTok{(tbl\_area\_avg\_dr) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Direction régionale"}\NormalTok{, }\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{, }\StringTok{"Superficie totale (km2)"}\NormalTok{, }\StringTok{"Superficie moyenne (km2)"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_distrib\_area\_no0, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{), }
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_distrib\_area\_no0.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_area\_avg\_ctry, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{), }
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_area\_avg\_ctry.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_area\_avg\_dr, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{), }
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_area\_avg\_dr.tex"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{))}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/surface"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{temporal-evolution}{%
\subsection{Temporal evolution}\label{temporal-evolution}}

In this section is plotted the evolution in the number and surafe of PAs over time (cumulated number/surface and number/surface of PAs funded by year).

\hypertarget{number-of-pas}{%
\subsubsection{Number of PAs}\label{number-of-pas}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_time\_range }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{annee =} 
                              \FunctionTok{c}\NormalTok{(}\FunctionTok{min}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{annee\_octroi)}\SpecialCharTok{:}\FunctionTok{max}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{annee\_octroi))}
\NormalTok{)}


\NormalTok{data\_time\_n }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{full\_join}\NormalTok{(data\_time\_range, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"annee\_octroi"} \OtherTok{=} \StringTok{"annee"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n =} \FunctionTok{case\_when}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(n)}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{, }\ConstantTok{TRUE}\SpecialCharTok{\textasciitilde{}}\NormalTok{n)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_cum =} \FunctionTok{cumsum}\NormalTok{(n)) }

\CommentTok{\#Number of PAs funded by year }
\NormalTok{fig\_n\_pa }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_time\_n,}
                  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(annee\_octroi), }\AttributeTok{y =}\NormalTok{ n)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{\textquotesingle{}identity\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{label =} \FunctionTok{ifelse}\NormalTok{(n }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }\ConstantTok{NA}\NormalTok{, n)), }
              \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size=}\DecValTok{4}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Nombre d\textquotesingle{}aires protégées appuyées par année"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_time\_n}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Année"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Nombre d\textquotesingle{}aires protégées"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{fig\_n\_pa}



\CommentTok{\#Cumulative number over time}
\NormalTok{fig\_ncum\_pa }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_time\_n,}
                  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(annee\_octroi), }\AttributeTok{y =}\NormalTok{ n\_cum)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# + geom\_point(color = "\#3182BD", size = 1.5) \%\textgreater{}\%}
  \CommentTok{\# + geom\_line(color = "\#3182BD", size = 1) \%\textgreater{}\% }
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{\textquotesingle{}identity\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ n\_cum, }\AttributeTok{label =}\NormalTok{ n\_cum), }
              \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size=}\DecValTok{4}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Evolution cumulée du nombre d\textquotesingle{}aires protégées appuyées par l\textquotesingle{}AFD"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_time\_n}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Année"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Nombre d\textquotesingle{}aires protégées"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{fig\_ncum\_pa}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"fig\_n\_pa.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
\NormalTok{       fig\_n\_pa,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"fig\_ncum\_pa.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
\NormalTok{       fig\_ncum\_pa,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}



\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/time\_evolution"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{surface-of-pas-1}{%
\subsubsection{Surface of PAs}\label{surface-of-pas-1}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_time\_range }\OtherTok{=} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{annee =} 
                              \FunctionTok{c}\NormalTok{(}\FunctionTok{min}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{annee\_octroi)}\SpecialCharTok{:}\FunctionTok{max}\NormalTok{(data\_stat\_nodupl}\SpecialCharTok{$}\NormalTok{annee\_octroi))}
\NormalTok{)}


\NormalTok{data\_time\_area }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(annee\_octroi) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{tot\_area\_km2 =} \FunctionTok{sum}\NormalTok{(superficie)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(pa\_int\_yr, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"annee\_octroi"} \OtherTok{=} \StringTok{"annee\_int"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{full\_join}\NormalTok{(data\_time\_range, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"annee\_octroi"} \OtherTok{=} \StringTok{"annee"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{tot\_area\_km2 =} \FunctionTok{case\_when}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tot\_area\_km2)}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{, }\ConstantTok{TRUE}\SpecialCharTok{\textasciitilde{}}\NormalTok{tot\_area\_km2),}
         \AttributeTok{tot\_int\_km2 =} \FunctionTok{case\_when}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(tot\_int\_km2)}\SpecialCharTok{\textasciitilde{}}\DecValTok{0}\NormalTok{, }\ConstantTok{TRUE}\SpecialCharTok{\textasciitilde{}}\NormalTok{tot\_int\_km2),}
         \AttributeTok{tot\_area\_noint\_km2 =}\NormalTok{ tot\_area\_km2 }\SpecialCharTok{{-}}\NormalTok{ tot\_int\_km2) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(annee\_octroi)}

\CommentTok{\#Evolution of area over time}
\NormalTok{fig\_area\_pa }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_time\_area,}
                  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(annee\_octroi), }\AttributeTok{y =}\NormalTok{ tot\_area\_noint\_km2)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{\textquotesingle{}identity\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ tot\_area\_noint\_km2, }
                  \AttributeTok{label =} \FunctionTok{ifelse}\NormalTok{(tot\_area\_noint\_km2 }\SpecialCharTok{!=} \DecValTok{0}\NormalTok{,}
                                 \FunctionTok{format}\NormalTok{(tot\_area\_noint\_km2, }
                                        \AttributeTok{digits =} \DecValTok{2}\NormalTok{, }
                                        \AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{),}
                                 \ConstantTok{NA}\NormalTok{)), }
              \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size=}\DecValTok{3}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Evolution de la superficie des aires protégées"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_time\_n}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées couvrant"}\NormalTok{, }\FunctionTok{format}\NormalTok{(}\FunctionTok{sum}\NormalTok{(data\_time\_area}\SpecialCharTok{$}\NormalTok{tot\_area\_noint\_km2), }\AttributeTok{digits =} \DecValTok{1}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{), }\StringTok{"km2"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Année"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Superficie (km2)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{fig\_area\_pa}



\CommentTok{\#Cumulative area over time}
\NormalTok{fig\_area\_cum\_pa }\OtherTok{=} \FunctionTok{ggplot}\NormalTok{(data\_time\_area,}
                  \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \FunctionTok{factor}\NormalTok{(annee\_octroi),}
                      \AttributeTok{y =} \FunctionTok{cumsum}\NormalTok{(tot\_area\_noint\_km2))) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# + geom\_point(color = "\#3182BD", size = 1.5) \%\textgreater{}\%}
  \CommentTok{\# + geom\_line(color = "\#3182BD", size = 1) \%\textgreater{}\% }
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{stat =} \StringTok{\textquotesingle{}identity\textquotesingle{}}\NormalTok{, }\AttributeTok{fill =} \StringTok{"\#3182BD"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =} \FunctionTok{cumsum}\NormalTok{(tot\_area\_noint\_km2), }
                  \AttributeTok{label =} \FunctionTok{format}\NormalTok{(}\FunctionTok{cumsum}\NormalTok{(tot\_area\_noint\_km2), }
                                 \AttributeTok{digits =} \DecValTok{2}\NormalTok{,}
                                 \AttributeTok{scientific =} \ConstantTok{TRUE}\NormalTok{)), }
              \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }\AttributeTok{size=}\DecValTok{3}\NormalTok{, }\AttributeTok{vjust =} \SpecialCharTok{{-}}\FloatTok{0.3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Evolution cumulée de la superficie des aires protégées"}\NormalTok{,}
          \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_time\_n}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées couvrant"}\NormalTok{, }\FunctionTok{format}\NormalTok{(}\FunctionTok{sum}\NormalTok{(data\_time\_area}\SpecialCharTok{$}\NormalTok{tot\_area\_noint\_km2), }\AttributeTok{digits =} \DecValTok{1}\NormalTok{, }\AttributeTok{scientific =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{big.mark =} \StringTok{" "}\NormalTok{), }\StringTok{"km2"}\NormalTok{),}
         \AttributeTok{x =} \StringTok{"Année"}\NormalTok{,}
         \AttributeTok{y =} \StringTok{"Superficie (km2)"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position =} \StringTok{"bottom"}\NormalTok{,}
      \AttributeTok{legend.key =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"white"}\NormalTok{),}
      \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{size =} \DecValTok{14}\NormalTok{, }\AttributeTok{face =} \StringTok{"bold"}\NormalTok{), }
      \AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{,}\AttributeTok{size=}\DecValTok{10}\NormalTok{, }\AttributeTok{hjust =}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\AttributeTok{vjust =}\NormalTok{ .}\DecValTok{6}\NormalTok{),}
      \AttributeTok{axis.title.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{margin =} \FunctionTok{margin}\NormalTok{(}\AttributeTok{t =} \DecValTok{10}\NormalTok{)),}
      \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }\AttributeTok{colour =} \StringTok{\textquotesingle{}white\textquotesingle{}}\NormalTok{, }
                                      \AttributeTok{linewidth =} \FloatTok{0.5}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.major =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{panel.grid.minor =} \FunctionTok{element\_line}\NormalTok{(}\AttributeTok{colour =} \StringTok{\textquotesingle{}grey90\textquotesingle{}}\NormalTok{, }\AttributeTok{linetype =} \StringTok{\textquotesingle{}solid\textquotesingle{}}\NormalTok{),}
      \AttributeTok{plot.caption =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{\textquotesingle{}grey50\textquotesingle{}}\NormalTok{, }\AttributeTok{size =} \FloatTok{8.5}\NormalTok{, }\AttributeTok{face =} \StringTok{\textquotesingle{}plain\textquotesingle{}}\NormalTok{))}
\NormalTok{fig\_area\_cum\_pa}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"fig\_area\_pa.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
\NormalTok{       fig\_area\_pa,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"fig\_area\_cum\_pa.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
\NormalTok{       fig\_area\_cum\_pa,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/time\_evolution"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{governance}{%
\subsection{Governance}\label{governance}}

Here is plotted the distribution of PAs across governance type.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Table of the governance type distribution}
\DocumentationTok{\#\#English version}
\NormalTok{data\_gov\_en }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gov\_type =} \FunctionTok{case\_when}\NormalTok{(gov\_type }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{\textasciitilde{}} \StringTok{"Not referenced"}\NormalTok{,}
                              \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gov\_type) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_tot =} \FunctionTok{sum}\NormalTok{(n),}
         \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\NormalTok{n\_tot}\SpecialCharTok{*}\DecValTok{100}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{n\_tot) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq)}

\NormalTok{tbl\_gov\_en }\OtherTok{=}\NormalTok{ data\_gov\_en}
\FunctionTok{names}\NormalTok{(tbl\_gov\_en) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Governance"}\NormalTok{,}\StringTok{"Number of PAs"}\NormalTok{,}\StringTok{"Share of PAs (\%)"}\NormalTok{)}


\DocumentationTok{\#\#French Version}
\NormalTok{data\_gov\_fr }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gov\_type =} \FunctionTok{case\_when}\NormalTok{(gov\_type }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non référencée"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Collaborative governance"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gouvernance collaborative"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Federal or national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence, fédérale ou nationale"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Federal or national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence, fédérale ou nationale"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Government{-}delegated management"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gestion déléguée par le gouvernement"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Indigenous peoples"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Peuples indigènes"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Joint governance"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gouvernance conjointe"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Local communities"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Communautés locales"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Non{-}profit organisations"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Organisations non{-}lucratives"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Not Reported"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non rapportée"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Sub{-}national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence sous{-}nationale"}\NormalTok{,}
                              \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gov\_type) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_tot =} \FunctionTok{sum}\NormalTok{(n),}
         \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\NormalTok{n\_tot}\SpecialCharTok{*}\DecValTok{100}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{n\_tot) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq)}

\NormalTok{tbl\_gov\_fr }\OtherTok{=}\NormalTok{ data\_gov\_fr}
\FunctionTok{names}\NormalTok{(tbl\_gov\_fr) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Gouvernance"}\NormalTok{,}\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{,}\StringTok{"Proportion (\%)"}\NormalTok{)}



\CommentTok{\#PAs with nureported or unreferenced governance types are removed}
\DocumentationTok{\#\#Tables}
\DocumentationTok{\#\#\#English}
\NormalTok{data\_gov\_knwn\_en }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gov\_type =} \FunctionTok{case\_when}\NormalTok{(gov\_type }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{\textasciitilde{}} \StringTok{"Not referenced"}\NormalTok{,}
                              \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(gov\_type }\SpecialCharTok{!=} \StringTok{"Not Reported"} \SpecialCharTok{\&}\NormalTok{ gov\_type }\SpecialCharTok{!=} \StringTok{"Not referenced"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gov\_type) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_tot =} \FunctionTok{sum}\NormalTok{(n),}
         \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\NormalTok{n\_tot}\SpecialCharTok{*}\DecValTok{100}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{n\_tot) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq)}

\NormalTok{tbl\_gov\_knwn\_en }\OtherTok{=}\NormalTok{ data\_gov\_knwn\_en}
\FunctionTok{names}\NormalTok{(tbl\_gov\_knwn\_en) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Governance"}\NormalTok{,}\StringTok{"Number of PAs"}\NormalTok{,}\StringTok{"Share of PAs (\%)"}\NormalTok{)}

\DocumentationTok{\#\#\#French}
\NormalTok{data\_gov\_knwn\_fr }\OtherTok{=}\NormalTok{ data\_stat\_nodupl }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{gov\_type =} \FunctionTok{case\_when}\NormalTok{(gov\_type }\SpecialCharTok{==} \StringTok{""} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non référencée"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Collaborative governance"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gouvernance collaborative"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Federal or national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence, fédérale ou nationale"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Federal or national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence, fédérale ou nationale"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Government{-}delegated management"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gestion déléguée par le gouvernement"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Indigenous peoples"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Peuples indigènes"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Joint governance"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Gouvernance conjointe"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Local communities"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Communautés locales"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Non{-}profit organisations"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Organisations non{-}lucratives"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Not Reported"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Non rapportée"}\NormalTok{,}
\NormalTok{                              gov\_type }\SpecialCharTok{==} \StringTok{"Sub{-}national ministry or agency"} \SpecialCharTok{\textasciitilde{}} \StringTok{"Ministère ou agence sous{-}nationale"}\NormalTok{,}
                              \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(gov\_type }\SpecialCharTok{!=} \StringTok{"Non référencée"} \SpecialCharTok{\&}\NormalTok{ gov\_type }\SpecialCharTok{!=} \StringTok{"Non rapportée"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(gov\_type) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{n =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{n\_tot =} \FunctionTok{sum}\NormalTok{(n),}
         \AttributeTok{freq =} \FunctionTok{round}\NormalTok{(n}\SpecialCharTok{/}\NormalTok{n\_tot}\SpecialCharTok{*}\DecValTok{100}\NormalTok{,}\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{n\_tot) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{freq)}

\NormalTok{tbl\_gov\_knwn\_fr }\OtherTok{=}\NormalTok{ data\_gov\_knwn\_fr}
\FunctionTok{names}\NormalTok{(tbl\_gov\_knwn\_fr) }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"Gouvernance"}\NormalTok{,}\StringTok{"Nombre d\textquotesingle{}AP"}\NormalTok{,}\StringTok{"Proportion (\%)"}\NormalTok{)}
 

\DocumentationTok{\#\#Pie charts}
\DocumentationTok{\#\#\#English}
\NormalTok{pie\_gov\_knwn\_en }\OtherTok{=} 
  \FunctionTok{ggplot}\NormalTok{(data\_gov\_knwn\_en, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\NormalTok{ freq, }\AttributeTok{fill=}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.3}\NormalTok{, }
                   \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{format}\NormalTok{(freq, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"\%"}\NormalTok{)), }
               \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }
               \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
               \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Governance type of PAs, except not referenced/reported PAs"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Sample :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_gov\_knwn\_en}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"PAs"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Governance"}\NormalTok{, }\AttributeTok{palette=}\StringTok{"Paired"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}



\DocumentationTok{\#\#\#French}
\NormalTok{pie\_gov\_knwn\_fr }\OtherTok{=}
  \FunctionTok{ggplot}\NormalTok{(data\_gov\_knwn\_fr, }
       \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\StringTok{""}\NormalTok{, }\AttributeTok{y=}\NormalTok{ freq, }\AttributeTok{fill=}\NormalTok{ gov\_type)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{, }\AttributeTok{stat =} \StringTok{"identity"}\NormalTok{, }\AttributeTok{color=}\StringTok{"white"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\FloatTok{1.3}\NormalTok{, }
                   \AttributeTok{label =} \FunctionTok{paste0}\NormalTok{(}\FunctionTok{format}\NormalTok{(freq, }\AttributeTok{digits =} \DecValTok{2}\NormalTok{), }\StringTok{"\%"}\NormalTok{)), }
               \AttributeTok{color =} \StringTok{"black"}\NormalTok{, }
               \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.55}\NormalTok{), }
               \AttributeTok{size=}\FloatTok{2.5}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{coord\_polar}\NormalTok{(}\StringTok{"y"}\NormalTok{, }\AttributeTok{start=}\DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Gouvernance, hors aires protégées avec une gouvernance }\SpecialCharTok{\textbackslash{}n}\StringTok{non{-}rapportée/référencée"}\NormalTok{,}
         \AttributeTok{subtitle =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Echantillon :"}\NormalTok{, }\FunctionTok{sum}\NormalTok{(data\_gov\_knwn\_fr}\SpecialCharTok{$}\NormalTok{n), }\StringTok{"aires protégées"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{scale\_fill\_brewer}\NormalTok{(}\AttributeTok{name =} \StringTok{"Gouvernance"}\NormalTok{, }\AttributeTok{palette=}\StringTok{"Paired"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \SpecialCharTok{+} \FunctionTok{theme\_void}\NormalTok{()}
\NormalTok{pie\_gov\_knwn\_fr}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Saving figures}

\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"fig"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_gov\_en, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_gov\_en.tex"}\NormalTok{, }\AttributeTok{sep  =}\StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_gov\_fr, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_gov\_fr.tex"}\NormalTok{, }\AttributeTok{sep  =}\StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_gov\_knwn\_en, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_gov\_knwn\_en.tex"}\NormalTok{, }\AttributeTok{sep  =}\StringTok{"/"}\NormalTok{))}
\FunctionTok{print}\NormalTok{(}\FunctionTok{xtable}\NormalTok{(tbl\_gov\_knwn\_fr, }\AttributeTok{type =} \StringTok{"latex"}\NormalTok{),}
      \AttributeTok{file =} \FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"tbl\_gov\_knwn\_fr.tex"}\NormalTok{, }\AttributeTok{sep  =}\StringTok{"/"}\NormalTok{))}

\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{" pie\_gov\_knwn\_en.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{  pie\_gov\_knwn\_en,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"pie\_gov\_knwn\_fr.png"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{),}
       \AttributeTok{plot =}\NormalTok{ pie\_gov\_knwn\_fr,}
       \AttributeTok{device =} \StringTok{"png"}\NormalTok{,}
       \AttributeTok{height =} \DecValTok{6}\NormalTok{, }\AttributeTok{width =} \DecValTok{9}\NormalTok{)}

\CommentTok{\#Export to S3 storage}

\DocumentationTok{\#\#List of files to save in the temp folder}
\NormalTok{files }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files) }
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(count, }\StringTok{"/"}\NormalTok{, }\FunctionTok{length}\NormalTok{(files), }\StringTok{" \textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/DesStat/gouvernance"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \}}

\CommentTok{\#Erase the files in the temp directory}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(tmp, }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{biodiversity-in-the-protected-areas}{%
\chapter{Biodiversity in the protected areas}\label{biodiversity-in-the-protected-areas}}

In this document are computed and plotted descriptive statistics for the protected areas (PAs) using the mapme biodiversity package. This package provides an easy access to biodiversity-related data and allow to compute different indicators.

\hypertarget{importing-packages-and-functions}{%
\section{Importing packages and functions}\label{importing-packages-and-functions}}

\#\texttt{\{r\ setup,\ include=FALSE,\ eval\ =\ FALSE\}\ \#knitr::opts\_knit\$set(root.dir\ =\ rprojroot::find\_rstudio\_root\_file())\ \#}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{source}\NormalTok{(}\StringTok{"scripts/Statistics/fns\_DesStat\_biodiv.R"}\NormalTok{, }\AttributeTok{encoding =} \StringTok{"utf{-}8"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#The last version of mapme.biodiversity package is downloaded directly from github}
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"mapme{-}initiative/mapme.biodiversity"}\NormalTok{, }\AttributeTok{upgrade=}\StringTok{"always"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(mapme.biodiversity)}
\FunctionTok{library}\NormalTok{(sf)}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(mapview)}
\FunctionTok{library}\NormalTok{(magrittr)}
\FunctionTok{library}\NormalTok{(stargazer)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(openxlsx)}
\FunctionTok{library}\NormalTok{(writexl)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(questionr)}
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(data.table)}
\FunctionTok{library}\NormalTok{(sp)}
\FunctionTok{library}\NormalTok{(raster)}
\FunctionTok{library}\NormalTok{(terra)}
\FunctionTok{library}\NormalTok{(janitor)}
\FunctionTok{library}\NormalTok{(ARTofR)}
\FunctionTok{library}\NormalTok{(aws.s3)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#A first look at mapme biodiversity indicators}

\NormalTok{resources }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{available\_resources}\NormalTok{())}
\NormalTok{indicators }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(}\FunctionTok{available\_indicators}\NormalTok{())}
\FunctionTok{cat}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"Supported resources:}\SpecialCharTok{\textbackslash{}n}\StringTok{{-}"}\NormalTok{,}
            \FunctionTok{paste}\NormalTok{(resources, }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{{-} "}\NormalTok{),}
          \StringTok{"}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{Supported indicators:}\SpecialCharTok{\textbackslash{}n}\StringTok{{-}"}\NormalTok{,}
            \FunctionTok{paste}\NormalTok{(indicators, }\AttributeTok{collapse =} \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{{-} "}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\hypertarget{setting-the-environment}{%
\section{Setting the environment}\label{setting-the-environment}}

This might be necessary to access SSPCloud storage from mapme.biodiversity functions.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sys.setenv("AWS\_ACCESS\_KEY\_ID" = "GD8CI0UQQPTETOZS65J2",}
\CommentTok{\#            "AWS\_SECRET\_ACCESS\_KEY" = "e0bsXE55qz+xmNeVdwhTb39wKoQuIJFC0Y6eqPoG",}
\CommentTok{\#            "AWS\_DEFAULT\_REGION" = "us{-}east{-}1",}
\CommentTok{\#            "AWS\_SESSION\_TOKEN" = "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJHRDhDSTBVUVFQVEVUT1pTNjVKMiIsImFsbG93ZWQtb3JpZ2lucyI6WyIqIl0sImF1ZCI6WyJtaW5pby1kYXRhbm9kZSIsIm9ueXhpYSIsImFjY291bnQiXSwiYXV0aF90aW1lIjoxNjg4NjUxNjk5LCJhenAiOiJvbnl4aWEiLCJlbWFpbCI6InZ1aWxsb3RhQGFmZC5mciIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJleHAiOjE2ODg3Mzg4NzgsImZhbWlseV9uYW1lIjoiVnVpbGxvdCIsImdpdmVuX25hbWUiOiJBbnRvaW5lIiwiZ3JvdXBzIjpbImFmZC1ldmEtYXAiXSwiaWF0IjoxNjg4NjUxNzAwLCJpc3MiOiJodHRwczovL2F1dGgubGFiLnNzcGNsb3VkLmZyL2F1dGgvcmVhbG1zL3NzcGNsb3VkIiwianRpIjoiN2ZmMjJhNmEtM2IyYS00NWFiLWJmYTItNmVhZDZkNzY5YzBhIiwibmFtZSI6IkFudG9pbmUgVnVpbGxvdCIsIm5vbmNlIjoiYjQzM2E1N2MtMjZiNS00NmE0LTkzOGItOGMyM2FmOTVlYTI5IiwicG9saWN5Ijoic3Rzb25seSIsInByZWZlcnJlZF91c2VybmFtZSI6InZ1aWxsb3RhIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJkZWZhdWx0LXJvbGVzLXNzcGNsb3VkIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBncm91cHMgZW1haWwiLCJzZXNzaW9uUG9saWN5IjoiZXlKV1pYSnphVzl1SWpvaU1qQXhNaTB4TUMweE55SXNJbE4wWVhSbGJXVnVkQ0k2VzNzaVJXWm1aV04wSWpvaVFXeHNiM2NpTENKQlkzUnBiMjRpT2xzaWN6TTZLaUpkTENKU1pYTnZkWEpqWlNJNld5SmhjbTQ2WVhkek9uTXpPam82Y0hKdmFtVjBMV0ZtWkMxbGRtRXRZWEFpTENKaGNtNDZZWGR6T25Nek9qbzZjSEp2YW1WMExXRm1aQzFsZG1FdFlYQXZLaUpkZlN4N0lrVm1abVZqZENJNklrRnNiRzkzSWl3aVFXTjBhVzl1SWpwYkluTXpPa3hwYzNSQ2RXTnJaWFFpWFN3aVVtVnpiM1Z5WTJVaU9sc2lZWEp1T21GM2N6cHpNem82T2lvaVhTd2lRMjl1WkdsMGFXOXVJanA3SWxOMGNtbHVaMHhwYTJVaU9uc2ljek02Y0hKbFptbDRJam9pWkdsbVpuVnphVzl1THlvaWZYMTlMSHNpUldabVpXTjBJam9pUVd4c2IzY2lMQ0pCWTNScGIyNGlPbHNpY3pNNlIyVjBUMkpxWldOMElsMHNJbEpsYzI5MWNtTmxJanBiSW1GeWJqcGhkM002Y3pNNk9qb3FMMlJwWm1aMWMybHZiaThxSWwxOVhYMD0iLCJzZXNzaW9uX3N0YXRlIjoiYWYyMDdlY2UtOWEzNi00OTQyLTllODYtNjA1NTJmNGYxZTg1Iiwic2lkIjoiYWYyMDdlY2UtOWEzNi00OTQyLTllODYtNjA1NTJmNGYxZTg1Iiwic3ViIjoiOTI3N2Y3MzMtNTBmMy00MjM4LWI1YzctNjRjMmU4YTZiNDI0IiwidHlwIjoiQmVhcmVyIn0.40\_wwJeo7HhTJjvPyob96nNEvbCmvohcN7Wnd02ETirLobdTmE7QZZbd9q5P1ZGANkkIkAf8who86ELp1crWfw",}
\CommentTok{\#            "AWS\_S3\_ENDPOINT"= "minio.lab.sspcloud.fr",}
\CommentTok{\#            "AWS\_HTTPS" = "FALSE",}
\CommentTok{\#            "AWS\_VIRTUAL\_HOSTING"="FALSE")}
\end{Highlighting}
\end{Shaded}

\hypertarget{importing-pas-datasets}{%
\section{Importing PAs datasets}\label{importing-pas-datasets}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Load spatial data and transform into polygons (requirement of the mapme package)}

\CommentTok{\#If the function get\_resources used later returns an error "...Loop 0 is not valid: Edge 94 crosses edge 96\textgreater{}...", then the following function might solve it. It works if sf was updated v1.0 and more, and brings back to old way of working. sf uses mostly a flat Earth model instead of s2 spherical geometry in the new versions. }
\FunctionTok{sf\_use\_s2}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}

\CommentTok{\#/!\textbackslash{} : in pa\_shp, variable sprfc is the area reported by AFD members, and is not equal to rep\_a (area reported by WDPA) nor superficie in the BDD\_joint. The latter is a combination of rep\_a and sprfc, where superficie = rep\_a except if rep\_a = 0 or not reported.}
\NormalTok{pa\_shp }\OtherTok{=} 
  \CommentTok{\#read\_sf("data\_tidy/BDD\_SHP\_nodupl\_pub.gpkg") \%\textgreater{}\%}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ sf}\SpecialCharTok{::}\NormalTok{read\_sf,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_shp\_pub.gpkg"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_make\_valid}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_cast}\NormalTok{(}\AttributeTok{to =} \StringTok{"POLYGON"}\NormalTok{)}

\CommentTok{\#From BDD\_joint, that is the combination of the SIOP dataset and the AP dataset from ARB team in AFD. Imported to have the information on the PA area (combination of areas reported by WDPA and ARB)}
\NormalTok{pa\_nodupl }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/BDD\_DesStat\_nodupl.csv") \%\textgreater{}\%}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\FunctionTok{c}\NormalTok{(wdpaid, superficie))}

\CommentTok{\#mapview(pa\_shp)}
\end{Highlighting}
\end{Shaded}

\hypertarget{downloading-data-of-interests-and-compute-relevant-indicators}{%
\section{Downloading data of interests and compute relevant indicators}\label{downloading-data-of-interests-and-compute-relevant-indicators}}

For the moment, mapme.biodiversity functions do not support reading/writing in a S3 server like SSPCloud. Waiting for the new release of the package, the following process is followed :

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Create a sub-folder in the temporary folder (RAM of the R session) to download and store the raw data
\item
  Associate the portfolio to this sub-folder
\item
  Download the raw data and compute the indicators of interest, unnest the data obtained
\item
  Then, a dataframe can be saved.
\end{enumerate}

Note that this solution is not time-optimal : raw data must be downloaded each time.

\hypertarget{creating-the-portfolio}{%
\subsection{Creating the portfolio}\label{creating-the-portfolio}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#The raw data from mapme package are stored in a temporary folder}
\NormalTok{tmp }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"mapme"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}
\CommentTok{\#save\_folder = get\_bucket("projet{-}afd{-}eva{-}ap", region = "")}

\CommentTok{\#Creating the portfolio}
\NormalTok{pa\_pfolio }\OtherTok{=}\NormalTok{ pa\_shp }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{init\_portfolio}\NormalTok{(}\DecValTok{2000}\SpecialCharTok{:}\DecValTok{2020}\NormalTok{,}
                 \AttributeTok{outdir =}\NormalTok{ tmp,}
                 \CommentTok{\#cores = 4,}
                 \AttributeTok{add\_resources =} \ConstantTok{TRUE}\NormalTok{,}
                 \AttributeTok{verbose =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{test-importing-data-from-sspcloud}{%
\subsection{TEST : importing data from SSPCloud}\label{test-importing-data-from-sspcloud}}

data are downloaded from an other script and stored in the SSPCloud. Here : copy these data to the temporary storage of the R session, and use them to compute indicators.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_files }\OtherTok{=}\NormalTok{ aws.s3}\SpecialCharTok{::}\FunctionTok{get\_bucket}\NormalTok{(}\StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
                   \AttributeTok{prefix =} \StringTok{"data\_raw/mapme\_bio\_data/gfw\_treecover/"}\NormalTok{,}
                   \AttributeTok{region =} \StringTok{""}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as.data.frame}\NormalTok{()}
\NormalTok{list\_files }\OtherTok{=}\NormalTok{ df\_files}\SpecialCharTok{$}\NormalTok{Key}
\NormalTok{i }\OtherTok{=}\NormalTok{ list\_files[}\DecValTok{1}\NormalTok{]}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ list\_files) }
\NormalTok{\{}
\NormalTok{  temp\_file }\OtherTok{=} \FunctionTok{s3read\_using}\NormalTok{(}\AttributeTok{FUN =}\NormalTok{ terra}\SpecialCharTok{::}\NormalTok{rast,}
               \AttributeTok{object =}\NormalTok{ i,}
               \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
               \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"}\OtherTok{=}\StringTok{""}\NormalTok{))}
\NormalTok{  terra}\SpecialCharTok{::}\FunctionTok{writeRaster}\NormalTok{(temp\_file, }\FunctionTok{file.path}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"test.tif"}\NormalTok{), }\AttributeTok{overwrite =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}
\FunctionTok{plot}\NormalTok{(temp\_file)}
\end{Highlighting}
\end{Shaded}

\hypertarget{compute-indicators-from-geospatial-data}{%
\subsection{Compute indicators from geospatial data}\label{compute-indicators-from-geospatial-data}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Forests {-}{-}{-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\DocumentationTok{\#\#Downloading data and computing indicators }
\NormalTok{pa\_pfolio\_tcover }\OtherTok{=}
  \FunctionTok{get\_resources}\NormalTok{(pa\_pfolio,}
    \AttributeTok{resources =} \FunctionTok{c}\NormalTok{(}\StringTok{"gfw\_lossyear"}\NormalTok{,}\StringTok{"gfw\_treecover"}\NormalTok{,}\StringTok{"gfw\_emissions"}\NormalTok{),}
    \AttributeTok{vers\_treecover =} \StringTok{"GFC{-}2020{-}v1.8"}\NormalTok{,}
    \AttributeTok{vers\_lossyear =} \StringTok{"GFC{-}2020{-}v1.8"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# FAO forest definition here: Minimum treecover = 10\%, minimum size =1 hectare}
  \FunctionTok{calc\_indicators}\NormalTok{(}\AttributeTok{indicators =} \StringTok{"treecover\_area"}\NormalTok{,}
                \AttributeTok{min\_cover =} \DecValTok{10}\NormalTok{,}
                \AttributeTok{min\_size =} \DecValTok{1}\NormalTok{, }\AttributeTok{overwrite=}\NormalTok{T)}

\CommentTok{\#Unest the sf file into a classic data frame without geometry}
\NormalTok{data\_pfolio\_tcover }\OtherTok{=} \FunctionTok{unnest}\NormalTok{(pa\_pfolio\_tcover, }\AttributeTok{cols=}\StringTok{"treecover\_area"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_drop\_geometry}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(wdpaid, assetid, years,treecover) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{treecover =} \FunctionTok{case\_when}\NormalTok{(treecover }\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\textasciitilde{}} \ConstantTok{NA}\NormalTok{, }\ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ treecover)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(treecover))}

\CommentTok{\#Write the dataframe into the bucket}
\FunctionTok{s3write\_using}\NormalTok{(data\_pfolio\_tcover,}
\NormalTok{              data.table}\SpecialCharTok{::}\NormalTok{fwrite,}
              \AttributeTok{object =} \StringTok{"data\_tidy/mapme\_bio\_data/data\_pfolio\_tcover.csv"}\NormalTok{,}
              \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
              \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)}
\NormalTok{              )}

\CommentTok{\#Copying files to SSPCloud}
\DocumentationTok{\#\#emissions}
\NormalTok{files\_emi }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_emissions"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }
                        \AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files\_emi) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/data\_raw/mapme\_bio\_data/gfw\_emissions"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}

\DocumentationTok{\#\#loss years}
\NormalTok{files\_lossyear }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_lossyear"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }
                        \AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files\_emi) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/data\_raw/mapme\_bio\_data/gfw\_lossyear"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}

\DocumentationTok{\#\#Treecover loss}
\NormalTok{files\_treecover }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_treecover"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }
                        \AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files\_emi) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/data\_raw/mapme\_bio\_data/gfw\_treecover"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}

\CommentTok{\#Removing files from temp}
\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_emissions"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_lossyear"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gfw\_treecover"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Mangroves {-}{-}{-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\DocumentationTok{\#\#Downloading data and computing indicators }
\NormalTok{pa\_pfolio\_mang }\OtherTok{=}
  \FunctionTok{get\_resources}\NormalTok{(pa\_pfolio,}
    \AttributeTok{resources =} \FunctionTok{c}\NormalTok{(}\StringTok{"gmw"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# FAO forest definition here: Minimum treecover = 10\%, minimum size =1      \#hectare}
  \FunctionTok{calc\_indicators}\NormalTok{(}\AttributeTok{indicators =} \StringTok{"mangroves\_area"}\NormalTok{,}
                \AttributeTok{overwrite=}\NormalTok{T)}

\DocumentationTok{\#\#Unest the sf file into a classic data frame without geometry}
\NormalTok{data\_pfolio\_mang }\OtherTok{=} \FunctionTok{unnest}\NormalTok{(pa\_pfolio\_mang, }\AttributeTok{cols=}\StringTok{"mangroves\_area"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  sf}\SpecialCharTok{::}\FunctionTok{st\_drop\_geometry}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(wdpaid, assetid, year,mangrove\_extent)}
\CommentTok{\# s3write\_using(data\_pfolio\_mang,}
\CommentTok{\#               data.table::fwrite,}
\CommentTok{\#               object = "data\_tidy/mapme\_bio\_data/data\_pfolio\_mang.csv",}
\CommentTok{\#               bucket = "projet{-}afd{-}eva{-}ap",}
\CommentTok{\#               opts = list("region" = "")}
\CommentTok{\#               )}

\CommentTok{\# data\_pfolio\_mang = s3read\_using(data.table::fread,}
\CommentTok{\#               object = "data\_tidy/mapme\_bio\_data/data\_pfolio\_mang.csv",}
\CommentTok{\#               bucket = "projet{-}afd{-}eva{-}ap",}
\CommentTok{\#               opts = list("region" = "")}
\CommentTok{\#                                 )}

\CommentTok{\#Removing files from temp}
\DocumentationTok{\#\#emissions}
\NormalTok{files\_mang }\OtherTok{\textless{}{-}} \FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gmw"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }
                        \AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#Add each file in the bucket (same foler for every file in the temp)}
\ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ files\_mang) }
\NormalTok{  \{}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"Uploading file"}\NormalTok{, }\FunctionTok{paste0}\NormalTok{(}\StringTok{"\textquotesingle{}"}\NormalTok{, f, }\StringTok{"\textquotesingle{}"}\NormalTok{), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{put\_object}\NormalTok{(}\AttributeTok{file =}\NormalTok{ f, }
                     \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap/data\_raw/mapme\_bio\_data/gmw"}\NormalTok{, }
                     \AttributeTok{region =} \StringTok{""}\NormalTok{, }\AttributeTok{show\_progress =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{\}}

\FunctionTok{do.call}\NormalTok{(file.remove, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list.files}\NormalTok{(}\FunctionTok{paste}\NormalTok{(tmp, }\StringTok{"gmw"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{), }\AttributeTok{full.names =} \ConstantTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Land cover   {-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\DocumentationTok{\#\#Downloading data and computing indicators }
\NormalTok{pa\_pfolio\_land }\OtherTok{=} 
  \FunctionTok{get\_resources}\NormalTok{(pa\_pfolio,}
    \AttributeTok{resources =} \FunctionTok{c}\NormalTok{(}\StringTok{"esalandcover"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{calc\_indicators}\NormalTok{(}\AttributeTok{indicators =} \StringTok{"landcover"}\NormalTok{,}
                \AttributeTok{overwrite=}\NormalTok{T) }

\DocumentationTok{\#\#Unnest data}
\NormalTok{data\_pfolio\_land }\OtherTok{=} \FunctionTok{unnest}\NormalTok{(pa\_pfolio\_land, }\AttributeTok{cols =} \StringTok{"landcover"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{st\_drop\_geometry}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(wdpaid, assetid, year, area, classes)}
\FunctionTok{s3write\_using}\NormalTok{(data\_pfolio\_land,}
\NormalTok{              data.table}\SpecialCharTok{::}\NormalTok{fwrite,}
              \AttributeTok{object =} \StringTok{"data\_tidy/mapme\_bio\_data/data\_pfolio\_land.csv"}\NormalTok{,}
              \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
              \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{)}
\NormalTok{              )}

\CommentTok{\# data\_pfolio\_land = s3read\_using(data.table::fread,}
\CommentTok{\#               object = "data\_tidy/mapme\_bio\_data/data\_pfolio\_land.csv",}
\CommentTok{\#               bucket = "projet{-}afd{-}eva{-}ap",}
\CommentTok{\#               opts = list("region" = "")}
\CommentTok{\#                                 )}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Emissions  {-}{-}{-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\CommentTok{\# pa\_pfolio\_emi = }
\CommentTok{\#     get\_resources(pa\_pfolio,}
\CommentTok{\#     resources = c("gfw\_lossyear","gfw\_treecover","gfw\_emissions"), }
\CommentTok{\#     vers\_treecover = "GFC{-}2020{-}v1.8",}
\CommentTok{\#     vers\_lossyear = "GFC{-}2020{-}v1.8") \%\textgreater{}\%}
\CommentTok{\#     calc\_indicators(indicators = "treecoverloss\_emissions",}
\CommentTok{\#                   min\_cover = 30,}
\CommentTok{\#                   min\_size = 1, overwrite=T)}

\CommentTok{\# write\_portfolio(pa\_pfolio\_emi,}
\CommentTok{\#       dsn = "data\_tidy/mapme\_bio\_data/pa\_pfolio\_emi.gpkg",}
\CommentTok{\#       overwrite = FALSE)}

\NormalTok{pa\_pfolio\_emi }\OtherTok{=} \FunctionTok{read\_portfolio}\NormalTok{(}\StringTok{"data\_tidy/mapme\_bio\_data/pa\_pfolio\_emi.gpkg"}\NormalTok{)}

\CommentTok{\# data\_pfolio\_emi = unnest(pa\_pfolio\_emi,}
\CommentTok{\#                   cols="treecoverloss\_emissions") \%\textgreater{}\%}
\CommentTok{\#     sf::st\_drop\_geometry() \%\textgreater{}\%}
\CommentTok{\#     dplyr::select(id\_pr,wdpaid,years,emissions)}

\CommentTok{\# fwrite(data\_pfolio\_emi,}
\CommentTok{\#        "data\_tidy/mapme\_bio\_data/data\_pfolio\_emi.csv")}

\NormalTok{data\_pfolio\_emi }\OtherTok{=} \FunctionTok{fread}\NormalTok{(}\StringTok{"data\_tidy/mapme\_bio\_data/data\_pfolio\_emi.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Biome       {-}{-}{-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\DocumentationTok{\#\#Downloading data and computing indicators }
\NormalTok{pa\_pfolio\_biome }\OtherTok{=}
  \FunctionTok{get\_resources}\NormalTok{(pa\_pfolio,}
    \AttributeTok{resources =} \FunctionTok{c}\NormalTok{(}\StringTok{"teow"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{calc\_indicators}\NormalTok{(}\AttributeTok{indicators =} \StringTok{"biome"}\NormalTok{,}
                \AttributeTok{overwrite=}\NormalTok{T)}

\CommentTok{\# write\_portfolio(pa\_pfolio\_biome, }
\CommentTok{\#       dsn = "01\_data\_tidy/mapme\_bio\_data/pa\_pfolio\_biome.gpkg",}
\CommentTok{\#       overwrite = FALSE)}

\DocumentationTok{\#\#Unest the sf file into a classic data frame without geometry}
\CommentTok{\# data\_biome = unnest(pa\_pfolio\_biome, cols="biome") \%\textgreater{}\%}
\CommentTok{\#   sf::st\_drop\_geometry() \%\textgreater{}\%}
\CommentTok{\#   dplyr::select(id\_pr,wdpaid,year,mangrove\_extent)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Soil features {-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\CommentTok{\#/!\textbackslash{} voir quels indicateurs/mesures prendre !!}

\DocumentationTok{\#\#Downloading data and computing indicators }

\NormalTok{pa\_pfolio\_soil }\OtherTok{=} 
  \FunctionTok{get\_resources}\NormalTok{(pa\_pfolio,}
    \AttributeTok{resources =} \FunctionTok{c}\NormalTok{(}\StringTok{"soilgrids"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# FAO forest definition here: Minimum treecover = 10\%, minimum size =1      \#hectare}
  \FunctionTok{calc\_indicators}\NormalTok{(}\AttributeTok{indicators =} \StringTok{"soilproperties"}\NormalTok{,}
                \AttributeTok{overwrite=}\NormalTok{T) }

\CommentTok{\# write\_portfolio(pa\_pfolio\_mang, }
\CommentTok{\#       dsn = "01\_data\_tidy/mapme\_bio\_data/pa\_pfolio\_mang.gpkg",}
\CommentTok{\#       overwrite = FALSE)}

\DocumentationTok{\#\#Unest the sf file into a classic data frame without geometry}
\CommentTok{\# data\_biome = unnest(pa\_pfolio\_biome, cols="biome") \%\textgreater{}\%}
\CommentTok{\#   sf::st\_drop\_geometry() \%\textgreater{}\%}
\CommentTok{\#   dplyr::select(id\_pr,wdpaid,year,mangrove\_extent)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}
\DocumentationTok{\#\#  \textasciitilde{} Accessibility {-}{-}}
\DocumentationTok{\#\#\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}\textasciitilde{}}

\DocumentationTok{\#\#Downloading data and computing indicators }
\NormalTok{pa\_pfolio\_acc }\OtherTok{=} 
  \FunctionTok{get\_resources}\NormalTok{(}\StringTok{"nelson\_et\_al"}\NormalTok{,}
                \AttributeTok{range\_traveltime =} \FunctionTok{c}\NormalTok{(}\StringTok{"5k\_10k"}\NormalTok{, }\StringTok{"100k\_200k"}\NormalTok{, }
                                     \StringTok{"500k\_1mio"}\NormalTok{, }\StringTok{"1mio\_5mio"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{calc\_indicators}\NormalTok{(}\StringTok{"traveltime"}\NormalTok{, }
                  \AttributeTok{stats\_accessibility =} \FunctionTok{c}\NormalTok{(}\StringTok{"min"}\NormalTok{, }\StringTok{"max"}\NormalTok{), }
                  \AttributeTok{engine =} \StringTok{"extract"}\NormalTok{)}

\CommentTok{\# write\_portfolio(pa\_pfolio\_mang, }
\CommentTok{\#       dsn = "01\_data\_tidy/mapme\_bio\_data/pa\_pfolio\_mang.gpkg",}
\CommentTok{\#       overwrite = FALSE)}

\DocumentationTok{\#\#Unest the sf file into a classic data frame without geometry}
\CommentTok{\# data\_biome = unnest(pa\_pfolio\_biome, cols="biome") \%\textgreater{}\%}
\CommentTok{\#   sf::st\_drop\_geometry() \%\textgreater{}\%}
\CommentTok{\#   dplyr::select(id\_pr,wdpaid,year,mangrove\_extent)}
\end{Highlighting}
\end{Shaded}

Faire une fonction pour l'extraction de tout jeu de données ? Répétitif en soit de faire forêts, mangroves, etc.

Warning and errors face and their meaning.

\begin{itemize}
\item
  \emph{although coordinates are longitude/latitude, st\_intersects assumes that they are planar}.

  \begin{itemize}
  \item
    See \url{https://r-spatial.org/r/2020/06/17/s2.html} and \url{https://r-spatial.github.io/sf/articles/sf7.html\#}. Basically I used sf\_use\_s2(FALSE) at the creation of the portfolio. Thus sf uses flat Earth model instead of s2 spherical geometry. The operation st\_intersects assumes the data lie in a flat plane where one degree longitude equals one degree latitude, irrespective where the PA is on the world (equirectangular projection). Thus if the polygons are drawn from coordinates in a spherical geometry, the operation is performed on the wrong projection. Is it a problem in itself ? Well as a projection is a bijection between two coordinate systems, plygons that intersect (or not) in a projection will intersect in the second. However the polygons will be distorded (the more so as they are located closer to the poles), and the areas computed could be wrong. Anyway according to the documentation the WDPA polygons are provided in WGS84 geographic coordinate system, i.e a planar projection (Plate Carree) . No problem should arise from the warning then.
  \item
    So according to Florent Bedecarrats, this warning is related to an other issue. The sphere representing the Earth is transformed into a plane through a cut on a given line. If a polygon is located on this line, the flattened polygon is considered to go around the Earth. To test for this possibility, compare the area of the polygon to the true area of the PA.
  \end{itemize}
\item
  \emph{Avis : TIFFFillStrip:Read error at scanline 4294967295; got 0 bytes, expected 1387 (GDAL error 1)Avis : TIFFReadEncodedStrip() failed. (GDAL error 1).}

  This advice occurs during the computation of indicators (a few tenths for emissions). Fail to read some parts of the raster file ? Is it problematic for the whole process ?

  Best solution : remove the corresponding TIFF and download data again.
\item
  \emph{Avis : D:/projet\_AiresProtegees/00\_data\_raw/mapme\_bio\_data/gfw\_lossyear/Hansen\_GFC-2020-v1.8\_lossyear\_10N\_010E.tif, band 1: IReadBlock failed at X offset 0, Y offset 29995: TIFFReadEncodedStrip() failed. (GDAL error 1)}

  Same as before. Best solution : remove the corresponding TIFF and download data again.
\item
  \emph{Avis : Error : {[}crop{]} incorrect number of values (too many) for writing}

  Check the error in more details.
\end{itemize}

\hypertarget{computing-statistics}{%
\section{Computing statistics}\label{computing-statistics}}

From the datasets obtained, statistics of interest can be computed and plotted.

\hypertarget{forests}{%
\subsection{Forests}\label{forests}}

Variation of forest loss over time :

\begin{itemize}
\tightlist
\item
  Building the figure dataset
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Building the dataset}
\NormalTok{data\_stat\_treeloss }\OtherTok{=}\NormalTok{ data\_pfolio\_forest }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(nm\_ap) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#Comoute variation over time in each PA}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lag\_treecov =} \FunctionTok{lag}\NormalTok{(treecover),}
         \AttributeTok{loss =}\NormalTok{ ((treecover }\SpecialCharTok{{-}}\NormalTok{ lag\_treecov)}\SpecialCharTok{/}\NormalTok{lag\_treecov)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Regroup years for analysis in five years intervals}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{years\_regroup =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{  years }\SpecialCharTok{\textless{}=} \DecValTok{2005} \SpecialCharTok{\textasciitilde{}} \StringTok{"2000{-}2005"}\NormalTok{,}
\NormalTok{  years }\SpecialCharTok{\textless{}=} \DecValTok{2010} \SpecialCharTok{\textasciitilde{}} \StringTok{"2005{-}2010"}\NormalTok{,}
\NormalTok{  years }\SpecialCharTok{\textless{}=} \DecValTok{2015} \SpecialCharTok{\textasciitilde{}} \StringTok{"2010{-}2015"}\NormalTok{,}
\NormalTok{  years }\SpecialCharTok{\textless{}=}\DecValTok{2020} \SpecialCharTok{\textasciitilde{}} \StringTok{"2015{-}2020"}\NormalTok{,}
  \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \ConstantTok{NA}\NormalTok{),}
  \AttributeTok{.after =}\NormalTok{ years) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Remove NA values for loss}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(loss)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#Compute mean loss for five years intervals in each PA}
  \FunctionTok{group\_by}\NormalTok{(nm\_ap, years\_regroup) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{moy\_5 =} \FunctionTok{mean}\NormalTok{(loss)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Statistics at PA level
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Evolution for a given PA}
\DocumentationTok{\#\#Buba}
\NormalTok{stat\_forest\_buba }\OtherTok{=} \FunctionTok{stat\_treeloss\_id}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss,}
                                    \AttributeTok{id =} \StringTok{"317051"}\NormalTok{,}
                                    \AttributeTok{name\_pa =} \StringTok{"AP Buba"}\NormalTok{,}
                                    \AttributeTok{treatment\_yr =} \DecValTok{2007}\NormalTok{)}
\NormalTok{fig\_evo\_buba }\OtherTok{=}\NormalTok{ stat\_forest\_buba[[}\DecValTok{1}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_buba,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_ap\_buba.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{fig\_evo5\_buba }\OtherTok{=}\NormalTok{ stat\_forest\_buba[[}\DecValTok{2}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo5\_buba,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo5\_ap\_buba.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Niumi}
\NormalTok{stat\_forest\_niumi }\OtherTok{=} \FunctionTok{stat\_treeloss\_id}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss,}
                                    \AttributeTok{id =} \StringTok{"109037"}\NormalTok{,}
                                    \AttributeTok{name\_pa =} \StringTok{"AP Niumi"}\NormalTok{,}
                                    \AttributeTok{treatment\_yr =} \DecValTok{2008}\NormalTok{)}
\NormalTok{fig\_evo\_niumi }\OtherTok{=}\NormalTok{ stat\_forest\_niumi[[}\DecValTok{1}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_niumi,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_ap\_niumi.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{fig\_evo5\_niumi }\OtherTok{=}\NormalTok{ stat\_forest\_niumi[[}\DecValTok{2}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo5\_niumi,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo5\_ap\_niumi.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Bamboung}
\NormalTok{stat\_forest\_bamboung }\OtherTok{=} \FunctionTok{stat\_treeloss\_id}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss,}
                                    \AttributeTok{id =} \StringTok{"555651496"}\NormalTok{,}
                                    \AttributeTok{name\_pa =} \StringTok{"AP Bamboung"}\NormalTok{,}
                                    \AttributeTok{treatment\_yr =} \DecValTok{2008}\NormalTok{)}
\NormalTok{fig\_evo\_bamboung }\OtherTok{=}\NormalTok{ stat\_forest\_bamboung[[}\DecValTok{1}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_bamboung,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_ap\_bamboung.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\NormalTok{fig\_evo5\_bamboung }\OtherTok{=}\NormalTok{ stat\_forest\_bamboung[[}\DecValTok{2}\NormalTok{]]}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo5\_bamboung,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo5\_ap\_bamboung.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

/!~Modifier le code précédent pour inclure plusieurs aires ???

\begin{itemize}
\tightlist
\item
  Statistics at region level
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Evolution at region level : dataset}
\NormalTok{data\_stat\_treeloss\_reg }\OtherTok{=}\NormalTok{ data\_stat\_treeloss }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(drct, years) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#For each region and each period, compute average evolution}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{evo\_avg\_reg =} \FunctionTok{mean}\NormalTok{(treecover)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(drct) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\#Variation of the average evolution over time in each region}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lag\_region =} \FunctionTok{lag}\NormalTok{(evo\_avg\_reg),}
         \AttributeTok{loss\_region =}\NormalTok{ ((evo\_avg\_reg }\SpecialCharTok{{-}}\NormalTok{ lag\_region)}\SpecialCharTok{/}\NormalTok{lag\_region)}\SpecialCharTok{*}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\#remove 2001 : either NA, or take value above when two regions are consecutive in the data frame (lag by region not applied) ???}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{loss\_region =} \FunctionTok{case\_when}\NormalTok{(}
    \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(loss\_region) }\SpecialCharTok{\&}\NormalTok{ years }\SpecialCharTok{==} \DecValTok{2001} \SpecialCharTok{\textasciitilde{}} \ConstantTok{NA}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{loss\_region))}

\CommentTok{\#Sahel}
\NormalTok{fig\_evo\_sahel }\OtherTok{=} \FunctionTok{stat\_treeloss\_reg}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss\_reg,}
                                  \AttributeTok{reg =} \StringTok{"Dr Grand Sahel"}\NormalTok{,}
                                  \AttributeTok{name\_reg =} \StringTok{"Sahel"}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_sahel,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_reg\_sahel.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Guinea gulf}
\NormalTok{fig\_evo\_guinee }\OtherTok{=} \FunctionTok{stat\_treeloss\_reg}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss\_reg,}
                                  \AttributeTok{reg =} \StringTok{"Dr Golfe De Guinee"}\NormalTok{,}
                                  \AttributeTok{name\_reg =} \StringTok{"Golfe de Guinée"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_guinee,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_reg\_guinee.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Eastern Africa}
\NormalTok{fig\_evo\_eastAf }\OtherTok{=} \FunctionTok{stat\_treeloss\_reg}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss\_reg,}
                                  \AttributeTok{reg =} \StringTok{"Dr Afrique De L\textquotesingle{}Est"}\NormalTok{,}
                                  \AttributeTok{name\_reg =} \StringTok{"Afrique de l\textquotesingle{}Est"}\NormalTok{)}
\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_eastAf,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_reg\_eastAf.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}

\CommentTok{\#Eastern Africa}
\NormalTok{fig\_evo\_austAf }\OtherTok{=} \FunctionTok{stat\_treeloss\_reg}\NormalTok{(}\AttributeTok{df =}\NormalTok{ data\_stat\_treeloss\_reg,}
                                  \AttributeTok{reg =} \StringTok{"Dr Afrique Australe"}\NormalTok{,}
                                  \AttributeTok{name\_reg =} \StringTok{"Afrique australe"}\NormalTok{)}

\FunctionTok{ggsave}\NormalTok{(}\AttributeTok{plot =}\NormalTok{ fig\_evo\_austAf,}
       \AttributeTok{filename =} \StringTok{"fig\_forest\_loss\_evo\_reg\_austAf.png"}\NormalTok{,}
       \AttributeTok{path =} \StringTok{"05\_StatDes/biodiversity/forest/loss"}\NormalTok{,}
       \AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{mangrove}{%
\subsection{Mangrove}\label{mangrove}}

Summary table of mangrove area in each PA :

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tbl\_mang\_summary }\OtherTok{=}\NormalTok{ data\_mang }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(wdpaid) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{area\_sqkm =} \FunctionTok{sum}\NormalTok{(value))}
\end{Highlighting}
\end{Shaded}

\hypertarget{emissions}{%
\subsection{Emissions}\label{emissions}}

/!~pas clair

Summary table of emissions in each PA :

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# create summary table }
\NormalTok{tbl\_emi\_summary }\OtherTok{=}\NormalTok{ data\_emi }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(name) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{area\_sqkm =} \FunctionTok{sum}\NormalTok{(value))}
\end{Highlighting}
\end{Shaded}

\hypertarget{biometeow}{%
\subsection{Biome/TEOW}\label{biometeow}}

\hypertarget{part-impact-analysis}{%
\part*{Impact analysis}\label{part-impact-analysis}}
\addcontentsline{toc}{part}{Impact analysis}

\hypertarget{matching}{%
\chapter{Matching}\label{matching}}

In this R Markdown are performed the different steps to obtain a matched dataset, i.e a dataset with control and treated observational units to compute the Average Treatment on the Treated (ATT). The treatment here is to be under protected area status, and we look at the impact on deforestation.

The steps are the following

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Pre-processing : in a loop for each country

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \item
    Create a grid of a given country
  \item
    Import geospatial data on PAs from the WDPA dataset, and assign each observation unit/pixel to a group : PA funded by the AFD (treated), PA non-funded by the AFD, buffer (closed to but not a PA), other (so potential control).
  \item
    Compute the covariates and outcome of interest for all pixels thanks to the mapme.biodiversity package
  \item
    Build the matching data frame
  \end{enumerate}
\item
  Post-processing

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \item
    Load the matching dataframe of the given country
  \item
    Perform the matching
  \item
    Plot covariate balance and density plots to ensure relevant matching
  \item
    Panelize the dataframe
  \item
    Perform regressions
  \end{enumerate}
\end{enumerate}

\hypertarget{initial-settings}{%
\section{Initial settings}\label{initial-settings}}

\#\texttt{\{r\ setup,\ include=FALSE,\ eval\ =\ FALSE\}\ \#knitr::opts\_knit\$set(root.dir\ =\ rprojroot::find\_rstudio\_root\_file())\ \#}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Install some libraries}
\FunctionTok{install.packages}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"tictoc"}\NormalTok{, }\StringTok{"geodata"}\NormalTok{, }\StringTok{"wdpar"}\NormalTok{, }\StringTok{"exactextractr"}\NormalTok{, }\StringTok{"MatchIt"}\NormalTok{, }\StringTok{"fixest"}\NormalTok{, }\StringTok{"cobalt"}\NormalTok{))}
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"mapme{-}initiative/mapme.biodiversity"}\NormalTok{, }\AttributeTok{upgrade=}\StringTok{"always"}\NormalTok{)}

\CommentTok{\#Install the river to download wdpa data directly}
\NormalTok{webdriver}\SpecialCharTok{::}\FunctionTok{install\_phantomjs}\NormalTok{()}

\CommentTok{\# Load Libraries}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(tictoc)}
\FunctionTok{library}\NormalTok{(xtable)}
\FunctionTok{library}\NormalTok{(tidyr)}
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(ggplot2) }\CommentTok{\# For plotting}
\FunctionTok{library}\NormalTok{(sf) }\CommentTok{\# For handling vector data}
\FunctionTok{library}\NormalTok{(terra) }\CommentTok{\# For handling raster data}
\FunctionTok{library}\NormalTok{(raster) }\CommentTok{\# For handling raster data}
\FunctionTok{library}\NormalTok{(rgeos)}
\FunctionTok{library}\NormalTok{(geodata) }\CommentTok{\# For getting country files}
\FunctionTok{library}\NormalTok{(wdpar) }\CommentTok{\# For getting protected areas}
\FunctionTok{library}\NormalTok{(exactextractr) }\CommentTok{\# For zonal statistics}
\FunctionTok{library}\NormalTok{(mapme.biodiversity)}
\FunctionTok{library}\NormalTok{(aws.s3)}
\FunctionTok{library}\NormalTok{(MatchIt) }\CommentTok{\#For matching}
\FunctionTok{library}\NormalTok{(fixest) }\CommentTok{\#For estimating the models}
\FunctionTok{library}\NormalTok{(cobalt) }\CommentTok{\#To visualize density plots and covariate balance from MatchIt outcomes}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Import functions}
\FunctionTok{source}\NormalTok{(}\StringTok{"scripts/ImpactAnalysis/fns\_matching.R"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Define the path to a working directory}
\CommentTok{\#wdir\_s3 = file.path("data\_tidy/mapme\_bio\_data/matching")}
\NormalTok{tmp\_pre }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"matching\_pre"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}
\NormalTok{tmp\_post }\OtherTok{=} \FunctionTok{paste}\NormalTok{(}\FunctionTok{tempdir}\NormalTok{(), }\StringTok{"matching\_post"}\NormalTok{, }\AttributeTok{sep =} \StringTok{"/"}\NormalTok{)}

\CommentTok{\# Define the file name of the matching frame}
\NormalTok{name\_output }\OtherTok{=}\NormalTok{ name\_input }\OtherTok{=} \StringTok{"matching\_frame\_10km"}
\NormalTok{ext\_output }\OtherTok{=}\NormalTok{ ext\_input }\OtherTok{=} \StringTok{".gpkg"}

\DocumentationTok{\#\#\#\#\#}
\DocumentationTok{\#\#\#Pre{-}processing}
\DocumentationTok{\#\#\#\#\#}


\DocumentationTok{\#\#Buffer and gridsize : make it depends on the country ? For instance, a typical size of grid such that the smaller PA is sampled with at least N pixels ?}
\CommentTok{\# Specify buffer width in meter}
\NormalTok{buffer\_m }\OtherTok{=} \DecValTok{10000}
\CommentTok{\# Specify the grid cell size in meter}
\NormalTok{gridSize }\OtherTok{=} \DecValTok{10000} 

\CommentTok{\#Load data }
\NormalTok{data\_pa\_full }\OtherTok{=} 
  \CommentTok{\#fread("data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv" , encoding = "UTF{-}8")}
\NormalTok{  aws.s3}\SpecialCharTok{::}\FunctionTok{s3read\_using}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ data.table}\SpecialCharTok{::}\NormalTok{fread,}
  \AttributeTok{encoding =} \StringTok{"UTF{-}8"}\NormalTok{,}
  \CommentTok{\# Mettre les options de FUN ici}
  \AttributeTok{object =} \StringTok{"data\_tidy/BDD\_DesStat\_nofund\_nodupl.csv"}\NormalTok{,}
  \AttributeTok{bucket =} \StringTok{"projet{-}afd{-}eva{-}ap"}\NormalTok{,}
  \AttributeTok{opts =} \FunctionTok{list}\NormalTok{(}\StringTok{"region"} \OtherTok{=} \StringTok{""}\NormalTok{))}

\CommentTok{\#List of countries in the sample}
\CommentTok{\#list\_iso = unique(data\_pa\_full$iso3)}
\NormalTok{list\_iso }\OtherTok{=} \FunctionTok{c}\NormalTok{(}\StringTok{"COM"}\NormalTok{, }\StringTok{"MMR"}\NormalTok{)}
\CommentTok{\# Specify a list of WDPA IDs of funded protected areas (treated areas)}
\CommentTok{\# paid = data\_stat\_nodupl[data\_stat\_nodupl$iso3 == country,]$wdpaid}

\CommentTok{\# Start year}
\NormalTok{y\_first }\OtherTok{=} \DecValTok{2000}
\CommentTok{\# End year}
\NormalTok{y\_last }\OtherTok{=} \DecValTok{2021}

\DocumentationTok{\#\#\#\#\#}
\DocumentationTok{\#\#\#Post{-}processing}
\DocumentationTok{\#\#\#\#\#}

\CommentTok{\# Define Column Names of Covariates}
\NormalTok{colname.travelTime }\OtherTok{=} \StringTok{"minutes\_median\_5k\_110mio"}
\NormalTok{colname.clayContent }\OtherTok{=} \StringTok{"clay\_0.5cm\_mean"}
\CommentTok{\# colname.elevation = "elevation\_mean"}
\CommentTok{\# colname.tri = "tri\_mean"}
\NormalTok{colname.fcIni }\OtherTok{=} \StringTok{"treecover\_2000"}


\CommentTok{\# Prefix of columns for forest cover}
\NormalTok{colfc.prefix }\OtherTok{=} \StringTok{"treecover"}
\CommentTok{\# Separation between prefix and year}
\NormalTok{colfc.bind }\OtherTok{=} \StringTok{"\_"}
\CommentTok{\# Prefix of columns for forest loss}
\NormalTok{colfl.prefix }\OtherTok{=} \StringTok{"treeloss"}
\CommentTok{\#Prefix of columns for average forest loss pre{-}funding}
\NormalTok{colname.flAvg }\OtherTok{=} \StringTok{"avgLoss\_pre\_fund"}

\CommentTok{\# Year of Funding Start}
\NormalTok{funding.start }\OtherTok{=} \DecValTok{2014}
\end{Highlighting}
\end{Shaded}

\hypertarget{matching-process}{%
\section{Matching process}\label{matching-process}}

\hypertarget{pre-processing}{%
\subsection{Pre-processing}\label{pre-processing}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#For each country in the list, the different steps of the pre{-}processing are performed}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\NormalTok{max\_i }\OtherTok{=} \FunctionTok{length}\NormalTok{(list\_iso)}
\NormalTok{tic\_pre }\OtherTok{=} \FunctionTok{tic}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ list\_iso)}
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(i, }\StringTok{" : country "}\NormalTok{, count, }\StringTok{"/"}\NormalTok{, max\_i))}
  
  \CommentTok{\#Generate observation units}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Generating observation units"}\NormalTok{)}
\NormalTok{  output\_pre\_grid }\OtherTok{=} \FunctionTok{fn\_pre\_grid}\NormalTok{(}\AttributeTok{iso =}\NormalTok{ i, }\AttributeTok{path\_tmp =}\NormalTok{ tmp\_pre, }\AttributeTok{gridSize =}\NormalTok{ gridSize)}
  
  \CommentTok{\#Load the outputs }
\NormalTok{  utm\_code }\OtherTok{=}\NormalTok{ output\_pre\_grid}\SpecialCharTok{$}\NormalTok{utm\_code}
\NormalTok{  gadm\_prj }\OtherTok{=}\NormalTok{ output\_pre\_grid}\SpecialCharTok{$}\NormalTok{ctry\_shp\_prj}
\NormalTok{  grid }\OtherTok{=}\NormalTok{ output\_pre\_grid}\SpecialCharTok{$}\NormalTok{grid}
  
  \CommentTok{\#Determining Group IDs and WDPA IDs for all observation units}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Determining Group IDs and WDPA IDs"}\NormalTok{)}
\NormalTok{  grid\_param }\OtherTok{=} \FunctionTok{fn\_pre\_group}\NormalTok{(}\AttributeTok{iso =}\NormalTok{ i, }\AttributeTok{path\_tmp =}\NormalTok{ tmp\_pre, }\AttributeTok{utm\_code =}\NormalTok{ utm\_code,}
                            \AttributeTok{buffer\_m =}\NormalTok{ buffer\_m, }\AttributeTok{data =}\NormalTok{ data\_pa\_full,}
                            \AttributeTok{gadm\_prj =}\NormalTok{ gadm\_prj, }\AttributeTok{grid =}\NormalTok{ grid, }
                            \AttributeTok{gridSize =}\NormalTok{ gridSize)}
  
  \CommentTok{\#Calculating outcome and other covariates for all observation units}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}\#Calculating outcome and other covariates"}\NormalTok{)}
  \FunctionTok{fn\_pre\_mf}\NormalTok{(}\AttributeTok{grid.param =}\NormalTok{ grid\_param, }\AttributeTok{path\_tmp =}\NormalTok{ tmp\_pre, }\AttributeTok{iso =}\NormalTok{ i,}
            \AttributeTok{name\_output =}\NormalTok{ name\_output, }\AttributeTok{ext\_output =}\NormalTok{ ext\_output)}
  
  
\NormalTok{\}}

\NormalTok{toc\_pre }\OtherTok{=} \FunctionTok{toc}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{post-processing}{%
\subsection{Post-processing}\label{post-processing}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#For each country in the list, the different steps of the post{-}processing are performed}
\NormalTok{count }\OtherTok{=} \DecValTok{0}
\NormalTok{max\_i }\OtherTok{=} \FunctionTok{length}\NormalTok{(list\_iso)}
\NormalTok{tic\_post }\OtherTok{=} \FunctionTok{tic}\NormalTok{()}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in}\NormalTok{ list\_iso)}
\NormalTok{\{}
\NormalTok{  count }\OtherTok{=}\NormalTok{ count}\SpecialCharTok{+}\DecValTok{1}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(i, }\StringTok{" : country "}\NormalTok{, count, }\StringTok{"/"}\NormalTok{, max\_i))}
  
  \CommentTok{\#Load the matching frame}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Loading the matching frame"}\NormalTok{)}
\NormalTok{  mf\_ini }\OtherTok{=} \FunctionTok{fn\_post\_load\_mf}\NormalTok{(}\AttributeTok{iso =}\NormalTok{ i)}
  
  
  \CommentTok{\#Add average pre{-}loss}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Add covariate : average tree loss pre{-}funding"}\NormalTok{)}
\NormalTok{  mf }\OtherTok{=} \FunctionTok{fn\_post\_avgLoss\_prefund}\NormalTok{(}\AttributeTok{mf =}\NormalTok{ mf\_ini, }\AttributeTok{yr\_start =}\NormalTok{ funding.start }\SpecialCharTok{{-}} \DecValTok{5}\NormalTok{,}
                               \AttributeTok{yr\_end =}\NormalTok{ funding.start }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{, }\AttributeTok{colfl.prefix =}\NormalTok{ colfl.prefix)}
  
  \CommentTok{\#Define cut{-}offs}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Define cutoffs"}\NormalTok{)}
  \DocumentationTok{\#\#CAREFUL : ADD elevation and TRI when available}
\NormalTok{  lst\_cutoffs }\OtherTok{=} \FunctionTok{fn\_post\_cutoff}\NormalTok{(}\AttributeTok{mf =}\NormalTok{ mf, }
                               \AttributeTok{colname.travelTime =}\NormalTok{ colname.travelTime, }
                               \AttributeTok{colname.clayContent =}\NormalTok{ colname.clayContent,}
                               \AttributeTok{colname.fcIni =}\NormalTok{ colname.fcIni, }
                               \AttributeTok{colname.flAvg =}\NormalTok{ colname.flAvg}
\NormalTok{                               )}
  
  \CommentTok{\#Run Coarsened Exact Matching}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Run CEM"}\NormalTok{)}
\NormalTok{  out.cem }\OtherTok{=} \FunctionTok{fn\_post\_cem}\NormalTok{(}\AttributeTok{mf =}\NormalTok{ mf, }\AttributeTok{iso =}\NormalTok{ i, }\AttributeTok{path\_tmp =}\NormalTok{ tmp\_post,}
                        \AttributeTok{lst\_cutoffs =}\NormalTok{ lst\_cutoffs,}
                       \AttributeTok{colname.travelTime =}\NormalTok{ colname.travelTime, }
                       \AttributeTok{colname.clayContent =}\NormalTok{ colname.clayContent,}
                       \AttributeTok{colname.fcIni =}\NormalTok{ colname.fcIni, }
                       \AttributeTok{colname.flAvg =}\NormalTok{ colname.flAvg)}
  
  \CommentTok{\#Plots : covariates}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}Some plots : covariates"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}{-}{-}Covariate balance"}\NormalTok{)}
  \FunctionTok{fn\_post\_plot\_covbal}\NormalTok{(}\AttributeTok{out.cem =}\NormalTok{ out.cem, }
                      \AttributeTok{colname.travelTime =}\NormalTok{ colname.travelTime, }
                       \AttributeTok{colname.clayContent =}\NormalTok{ colname.clayContent,}
                       \AttributeTok{colname.fcIni =}\NormalTok{ colname.fcIni, }
                       \AttributeTok{colname.flAvg =}\NormalTok{ colname.flAvg,}
                      \AttributeTok{iso =}\NormalTok{ i,}
                      \AttributeTok{path\_tmp =}\NormalTok{ tmp\_post)}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}{-}{-}Density plots"}\NormalTok{)}
  \FunctionTok{fn\_post\_plot\_density}\NormalTok{(}\AttributeTok{out.cem =}\NormalTok{ out.cem, }
                      \AttributeTok{colname.travelTime =}\NormalTok{ colname.travelTime, }
                       \AttributeTok{colname.clayContent =}\NormalTok{ colname.clayContent,}
                       \AttributeTok{colname.fcIni =}\NormalTok{ colname.fcIni, }
                       \AttributeTok{colname.flAvg =}\NormalTok{ colname.flAvg,}
                      \AttributeTok{iso =}\NormalTok{ i,}
                      \AttributeTok{path\_tmp =}\NormalTok{ tmp\_post)}
  
  \CommentTok{\#Panelize dataframes}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}{-}{-}Panelize (Un{-})Matched Dataframe"}\NormalTok{)}
\NormalTok{  output\_post\_panel }\OtherTok{=} \FunctionTok{fn\_post\_panel}\NormalTok{(}\AttributeTok{out.cem =}\NormalTok{ out.cem, }\AttributeTok{mf =}\NormalTok{ mf, }\AttributeTok{colfc.prefix =}\NormalTok{ colfc.prefix, }\AttributeTok{colfc.bind =}\NormalTok{ colfc.bind)}
\NormalTok{  matched.wide }\OtherTok{=}\NormalTok{ output\_post\_panel}\SpecialCharTok{$}\NormalTok{matched.wide}
\NormalTok{  unmatched.wide }\OtherTok{=}\NormalTok{ output\_post\_panel}\SpecialCharTok{$}\NormalTok{unmatched.wide}
\NormalTok{  matched.long }\OtherTok{=}\NormalTok{ output\_post\_panel}\SpecialCharTok{$}\NormalTok{matched.long}
\NormalTok{  unmatched.long }\OtherTok{=}\NormalTok{ output\_post\_panel}\SpecialCharTok{$}\NormalTok{unmatched.long  }
  
  \CommentTok{\#Plots : trend}
  \FunctionTok{print}\NormalTok{(}\StringTok{"{-}{-}{-}{-}Plots again : trend"}\NormalTok{)}
  \FunctionTok{fn\_post\_plot\_trend}\NormalTok{(}\AttributeTok{matched.long =}\NormalTok{ matched.long, }\AttributeTok{unmatched.long =}\NormalTok{ unmatched.long, }\AttributeTok{iso =}\NormalTok{ i)}
  
  
\NormalTok{\}}

\NormalTok{toc\_post }\OtherTok{=} \FunctionTok{toc}\NormalTok{()}

\CommentTok{\#Notes}
\DocumentationTok{\#\# Automate the definition of cutoffs for CEM}
\DocumentationTok{\#\#\# Coder 5.5.3 de Iacus et al. 2012 ? Permet de savoir le gain de matched units pour une modification des seuils d\textquotesingle{}une variable}
\DocumentationTok{\#\# Loop for different treatment years : need to adapt fn\_post\_avgLoss\_prefund function}
\DocumentationTok{\#\# Allow to enter a list of any covariates to perform the matching}
\DocumentationTok{\#\# Function to plot Fig. 3 in Iacus et al. 2012}
\DocumentationTok{\#\# Il faut contrôler le nombre de paired units à la fin ! Typiquement on veut que tous les pixels traités soient retenus, idéalement.}
\DocumentationTok{\#\# On veut ATE ou ATT ?? Je dirai ATT car on ne veut pas estimer l\textquotesingle{}effet de mettre une AP, mais l\textquotesingle{}effet des AP financés par l\textquotesingle{}AFD }
\end{Highlighting}
\end{Shaded}

\hypertarget{appendix-appendix}{%
\appendix}


\hypertarget{appendix-a}{%
\chapter{Appendix A}\label{appendix-a}}

Put here appendix stuff

  \bibliography{biblio.bib,packages.bib}

\end{document}
