<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Biodiversity in the protected areas | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Biodiversity in the protected areas | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="vuillota/EVA-impact-aires-protegees.git" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Biodiversity in the protected areas | Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Antoine Vuillot" />
<meta name="author" content="Ingrid Dallmann" />
<meta name="author" content="Léa Poulin" />
<meta name="author" content="Pierre-Yves Durand" />


<meta name="date" content="2023-09-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="projects-funded-by-the-afd.html"/>
<link rel="next" href="miscellaneous-statistics.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Impact analysis of protected areas funded by the AFD</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this website</a></li>
<li class="chapter" data-level="1" data-path="building-the-datasets.html"><a href="building-the-datasets.html"><i class="fa fa-check"></i><b>1</b> Building the datasets</a>
<ul>
<li class="chapter" data-level="1.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#initial-settings"><i class="fa fa-check"></i><b>1.1</b> Initial settings</a></li>
<li class="chapter" data-level="1.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-analysis"><i class="fa fa-check"></i><b>1.2</b> Datasets for analysis</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-pas-reporting-by-afd-technical-departments"><i class="fa fa-check"></i><b>1.2.1</b> Merge PAs reporting by AFD technical departments</a></li>
<li class="chapter" data-level="1.2.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#merge-the-list-of-pas-to-afd-project-information-and-wdpa"><i class="fa fa-check"></i><b>1.2.2</b> Merge the list of PAs to AFD project information and WDPA</a></li>
<li class="chapter" data-level="1.2.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#correct-errors"><i class="fa fa-check"></i><b>1.2.3</b> Correct errors</a></li>
<li class="chapter" data-level="1.2.4" data-path="building-the-datasets.html"><a href="building-the-datasets.html#tidy-the-datasets"><i class="fa fa-check"></i><b>1.2.4</b> Tidy the datasets</a></li>
<li class="chapter" data-level="1.2.5" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-with-only-afd-project-variables"><i class="fa fa-check"></i><b>1.2.5</b> Dataset with only AFD project variables</a></li>
<li class="chapter" data-level="1.2.6" data-path="building-the-datasets.html"><a href="building-the-datasets.html#dataset-for-non-confidential-analysis"><i class="fa fa-check"></i><b>1.2.6</b> Dataset for non-confidential analysis</a></li>
<li class="chapter" data-level="1.2.7" data-path="building-the-datasets.html"><a href="building-the-datasets.html#datasets-for-confidential-analysis"><i class="fa fa-check"></i><b>1.2.7</b> Datasets for confidential analysis</a></li>
<li class="chapter" data-level="1.2.8" data-path="building-the-datasets.html"><a href="building-the-datasets.html#a-polygon-dataset-for-specific-use"><i class="fa fa-check"></i><b>1.2.8</b> A polygon dataset for specific use</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-covered-by-pas-in-the-sample"><i class="fa fa-check"></i><b>1.3</b> Computing total areas covered by PAs in the sample</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computations-of-polygons-area"><i class="fa fa-check"></i><b>1.3.1</b> Computations of polygons’ area</a></li>
<li class="chapter" data-level="1.3.2" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-the-intersection-at-country-region-world-level"><i class="fa fa-check"></i><b>1.3.2</b> Computing the intersection at country, region, world level</a></li>
<li class="chapter" data-level="1.3.3" data-path="building-the-datasets.html"><a href="building-the-datasets.html#computing-total-areas-without-intersection"><i class="fa fa-check"></i><b>1.3.3</b> Computing total areas without intersection</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Descriptive statistics</b></span></li>
<li class="chapter" data-level="2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html"><i class="fa fa-check"></i><b>2</b> Projects funded by the AFD</a>
<ul>
<li class="chapter" data-level="2.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#initial-settings-1"><i class="fa fa-check"></i><b>2.1</b> Initial settings</a></li>
<li class="chapter" data-level="2.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#importing-the-datasets"><i class="fa fa-check"></i><b>2.2</b> Importing the datasets</a></li>
<li class="chapter" data-level="2.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#performing-descriptive-statistics"><i class="fa fa-check"></i><b>2.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#iucn-categories"><i class="fa fa-check"></i><b>2.3.1</b> IUCN categories</a></li>
<li class="chapter" data-level="2.3.2" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#ecosystems-excluding-non-referenced-pas"><i class="fa fa-check"></i><b>2.3.2</b> Ecosystems (excluding non-referenced PAs)</a></li>
<li class="chapter" data-level="2.3.3" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#distribution-and-surface-of-pas-across-countries-and-regions"><i class="fa fa-check"></i><b>2.3.3</b> Distribution (# and surface) of PAs across countries and regions</a></li>
<li class="chapter" data-level="2.3.4" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#surface-of-pas"><i class="fa fa-check"></i><b>2.3.4</b> Surface of PAs</a></li>
<li class="chapter" data-level="2.3.5" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#temporal-evolution"><i class="fa fa-check"></i><b>2.3.5</b> Temporal evolution</a></li>
<li class="chapter" data-level="2.3.6" data-path="projects-funded-by-the-afd.html"><a href="projects-funded-by-the-afd.html#governance"><i class="fa fa-check"></i><b>2.3.6</b> Governance</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html"><i class="fa fa-check"></i><b>3</b> Biodiversity in the protected areas</a>
<ul>
<li class="chapter" data-level="3.1" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#importing-packages-and-functions"><i class="fa fa-check"></i><b>3.1</b> Importing packages and functions</a></li>
<li class="chapter" data-level="3.2" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#setting-the-environment"><i class="fa fa-check"></i><b>3.2</b> Setting the environment</a></li>
<li class="chapter" data-level="3.3" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#importing-pas-datasets"><i class="fa fa-check"></i><b>3.3</b> Importing PAs datasets</a></li>
<li class="chapter" data-level="3.4" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#downloading-data-of-interests-and-compute-relevant-indicators"><i class="fa fa-check"></i><b>3.4</b> Downloading data of interests and compute relevant indicators</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#creating-the-portfolio"><i class="fa fa-check"></i><b>3.4.1</b> Creating the portfolio</a></li>
<li class="chapter" data-level="3.4.2" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#test-importing-data-from-sspcloud"><i class="fa fa-check"></i><b>3.4.2</b> TEST : importing data from SSPCloud</a></li>
<li class="chapter" data-level="3.4.3" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#compute-indicators-from-geospatial-data"><i class="fa fa-check"></i><b>3.4.3</b> Compute indicators from geospatial data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#computing-statistics"><i class="fa fa-check"></i><b>3.5</b> Computing statistics</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#forests"><i class="fa fa-check"></i><b>3.5.1</b> Forests</a></li>
<li class="chapter" data-level="3.5.2" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#mangrove"><i class="fa fa-check"></i><b>3.5.2</b> Mangrove</a></li>
<li class="chapter" data-level="3.5.3" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#emissions"><i class="fa fa-check"></i><b>3.5.3</b> Emissions</a></li>
<li class="chapter" data-level="3.5.4" data-path="biodiversity-in-the-protected-areas.html"><a href="biodiversity-in-the-protected-areas.html#biometeow"><i class="fa fa-check"></i><b>3.5.4</b> Biome/TEOW</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html"><i class="fa fa-check"></i><b>4</b> Miscellaneous statistics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#initial-settings-2"><i class="fa fa-check"></i><b>4.1</b> Initial settings</a></li>
<li class="chapter" data-level="4.2" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#importing-datasets"><i class="fa fa-check"></i><b>4.2</b> Importing datasets</a></li>
<li class="chapter" data-level="4.3" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#performing-descriptive-statistics-1"><i class="fa fa-check"></i><b>4.3</b> Performing descriptive statistics</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#fapbm-portfolio-and-madagascar"><i class="fa fa-check"></i><b>4.3.1</b> FAPBM portfolio and Madagascar</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="miscellaneous-statistics.html"><a href="miscellaneous-statistics.html#evolution-of-tree-cover-and-deforestation"><i class="fa fa-check"></i><b>4.4</b> Evolution of tree cover and deforestation</a></li>
</ul></li>
<li class="part"><span><b>Impact analysis</b></span></li>
<li class="chapter" data-level="5" data-path="matching.html"><a href="matching.html"><i class="fa fa-check"></i><b>5</b> Matching</a>
<ul>
<li class="chapter" data-level="5.1" data-path="matching.html"><a href="matching.html#initial-settings-3"><i class="fa fa-check"></i><b>5.1</b> Initial settings</a></li>
<li class="chapter" data-level="5.2" data-path="matching.html"><a href="matching.html#datasets-and-critical-parameters"><i class="fa fa-check"></i><b>5.2</b> Datasets and critical parameters</a></li>
<li class="chapter" data-level="5.3" data-path="matching.html"><a href="matching.html#matching-process"><i class="fa fa-check"></i><b>5.3</b> Matching process</a></li>
</ul></li>
<li class="part"><span><b>Impact analysis</b></span></li>
<li class="chapter" data-level="6" data-path="difference-in-difference.html"><a href="difference-in-difference.html"><i class="fa fa-check"></i><b>6</b> Difference-in-difference</a>
<ul>
<li class="chapter" data-level="6.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#initial-settings-4"><i class="fa fa-check"></i><b>6.1</b> Initial settings</a></li>
<li class="chapter" data-level="6.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#load-datasets-and-define-critical-parameters"><i class="fa fa-check"></i><b>6.2</b> Load datasets and define critical parameters</a></li>
<li class="chapter" data-level="6.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#computing-treatment-effects-at-protected-area-level"><i class="fa fa-check"></i><b>6.3</b> Computing treatment effects at protected area level</a></li>
<li class="chapter" data-level="6.4" data-path="difference-in-difference.html"><a href="difference-in-difference.html#compute-aggregated-metrics-at-country-and-region-level"><i class="fa fa-check"></i><b>6.4</b> Compute aggregated metrics at country and region level</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-treatment-effects"><i class="fa fa-check"></i><b>6.4.1</b> Aggregation of treatment effects</a></li>
<li class="chapter" data-level="6.4.2" data-path="difference-in-difference.html"><a href="difference-in-difference.html#aggregation-of-annual-deforestation-rates"><i class="fa fa-check"></i><b>6.4.2</b> Aggregation of annual deforestation rates</a></li>
<li class="chapter" data-level="6.4.3" data-path="difference-in-difference.html"><a href="difference-in-difference.html#average-and-total-forest-loss-on-the-period-at-country-and-region-level"><i class="fa fa-check"></i><b>6.4.3</b> Average and total forest loss on the period, at country and region level</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="difference-in-difference.html"><a href="difference-in-difference.html#display-treatment-effects-in-figures-and-tables"><i class="fa fa-check"></i><b>6.5</b> Display treatment effects in figures and tables</a></li>
<li class="chapter" data-level="6.6" data-path="difference-in-difference.html"><a href="difference-in-difference.html#section"><i class="fa fa-check"></i><b>6.6</b> </a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="functions-for-matching-pre--and-post-processing.html"><a href="functions-for-matching-pre--and-post-processing.html"><i class="fa fa-check"></i><b>A</b> Functions for matching pre- and post-processing</a></li>
<li class="chapter" data-level="B" data-path="functions-for-difference-in-difference-computations.html"><a href="functions-for-difference-in-difference-computations.html"><i class="fa fa-check"></i><b>B</b> Functions for difference-in-difference computations</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Impact analysis of protected areas funded by the AFD : an open-guide for reproductibility</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="biodiversity-in-the-protected-areas" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Biodiversity in the protected areas<a href="biodiversity-in-the-protected-areas.html#biodiversity-in-the-protected-areas" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>THIS SCRIPT IS UNFINISHED</p>
<p>In this document are computed and plotted descriptive statistics for the protected areas (PAs) using the mapme biodiversity package. This package provides an easy access to biodiversity-related data and allow to compute different indicators.</p>
<div id="importing-packages-and-functions" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Importing packages and functions<a href="biodiversity-in-the-protected-areas.html#importing-packages-and-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>#<code>{r setup, include=FALSE, eval = FALSE} #knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())  #</code></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="biodiversity-in-the-protected-areas.html#cb66-1" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;scripts/functions/02_fns_DesStat_biodiv.R&quot;</span>, <span class="at">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="biodiversity-in-the-protected-areas.html#cb67-1" tabindex="-1"></a><span class="co">#The last version of mapme.biodiversity package is downloaded directly from github</span></span>
<span id="cb67-2"><a href="biodiversity-in-the-protected-areas.html#cb67-2" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;mapme-initiative/mapme.biodiversity&quot;, upgrade=&quot;always&quot;)</span></span>
<span id="cb67-3"><a href="biodiversity-in-the-protected-areas.html#cb67-3" tabindex="-1"></a><span class="fu">library</span>(mapme.biodiversity)</span>
<span id="cb67-4"><a href="biodiversity-in-the-protected-areas.html#cb67-4" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb67-5"><a href="biodiversity-in-the-protected-areas.html#cb67-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb67-6"><a href="biodiversity-in-the-protected-areas.html#cb67-6" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb67-7"><a href="biodiversity-in-the-protected-areas.html#cb67-7" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb67-8"><a href="biodiversity-in-the-protected-areas.html#cb67-8" tabindex="-1"></a><span class="fu">library</span>(stargazer)</span>
<span id="cb67-9"><a href="biodiversity-in-the-protected-areas.html#cb67-9" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb67-10"><a href="biodiversity-in-the-protected-areas.html#cb67-10" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb67-11"><a href="biodiversity-in-the-protected-areas.html#cb67-11" tabindex="-1"></a><span class="fu">library</span>(writexl)</span>
<span id="cb67-12"><a href="biodiversity-in-the-protected-areas.html#cb67-12" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-13"><a href="biodiversity-in-the-protected-areas.html#cb67-13" tabindex="-1"></a><span class="fu">library</span>(questionr)</span>
<span id="cb67-14"><a href="biodiversity-in-the-protected-areas.html#cb67-14" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb67-15"><a href="biodiversity-in-the-protected-areas.html#cb67-15" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb67-16"><a href="biodiversity-in-the-protected-areas.html#cb67-16" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb67-17"><a href="biodiversity-in-the-protected-areas.html#cb67-17" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb67-18"><a href="biodiversity-in-the-protected-areas.html#cb67-18" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb67-19"><a href="biodiversity-in-the-protected-areas.html#cb67-19" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb67-20"><a href="biodiversity-in-the-protected-areas.html#cb67-20" tabindex="-1"></a><span class="fu">library</span>(ARTofR)</span>
<span id="cb67-21"><a href="biodiversity-in-the-protected-areas.html#cb67-21" tabindex="-1"></a><span class="fu">library</span>(aws.s3)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="biodiversity-in-the-protected-areas.html#cb68-1" tabindex="-1"></a><span class="co">#A first look at mapme biodiversity indicators</span></span>
<span id="cb68-2"><a href="biodiversity-in-the-protected-areas.html#cb68-2" tabindex="-1"></a></span>
<span id="cb68-3"><a href="biodiversity-in-the-protected-areas.html#cb68-3" tabindex="-1"></a>resources <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">available_resources</span>())</span>
<span id="cb68-4"><a href="biodiversity-in-the-protected-areas.html#cb68-4" tabindex="-1"></a>indicators <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">available_indicators</span>())</span>
<span id="cb68-5"><a href="biodiversity-in-the-protected-areas.html#cb68-5" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">&quot;Supported resources:</span><span class="sc">\n</span><span class="st">-&quot;</span>,</span>
<span id="cb68-6"><a href="biodiversity-in-the-protected-areas.html#cb68-6" tabindex="-1"></a>            <span class="fu">paste</span>(resources, <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">- &quot;</span>),</span>
<span id="cb68-7"><a href="biodiversity-in-the-protected-areas.html#cb68-7" tabindex="-1"></a>          <span class="st">&quot;</span><span class="sc">\n\n</span><span class="st">Supported indicators:</span><span class="sc">\n</span><span class="st">-&quot;</span>,</span>
<span id="cb68-8"><a href="biodiversity-in-the-protected-areas.html#cb68-8" tabindex="-1"></a>            <span class="fu">paste</span>(indicators, <span class="at">collapse =</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">- &quot;</span>)))</span></code></pre></div>
</div>
<div id="setting-the-environment" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Setting the environment<a href="biodiversity-in-the-protected-areas.html#setting-the-environment" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This might be necessary to access SSPCloud storage from mapme.biodiversity functions.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="biodiversity-in-the-protected-areas.html#cb69-1" tabindex="-1"></a><span class="co"># Sys.setenv(&quot;AWS_ACCESS_KEY_ID&quot; = &quot;GD8CI0UQQPTETOZS65J2&quot;,</span></span>
<span id="cb69-2"><a href="biodiversity-in-the-protected-areas.html#cb69-2" tabindex="-1"></a><span class="co">#            &quot;AWS_SECRET_ACCESS_KEY&quot; = &quot;e0bsXE55qz+xmNeVdwhTb39wKoQuIJFC0Y6eqPoG&quot;,</span></span>
<span id="cb69-3"><a href="biodiversity-in-the-protected-areas.html#cb69-3" tabindex="-1"></a><span class="co">#            &quot;AWS_DEFAULT_REGION&quot; = &quot;us-east-1&quot;,</span></span>
<span id="cb69-4"><a href="biodiversity-in-the-protected-areas.html#cb69-4" tabindex="-1"></a><span class="co">#            &quot;AWS_SESSION_TOKEN&quot; = &quot;eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NLZXkiOiJHRDhDSTBVUVFQVEVUT1pTNjVKMiIsImFsbG93ZWQtb3JpZ2lucyI6WyIqIl0sImF1ZCI6WyJtaW5pby1kYXRhbm9kZSIsIm9ueXhpYSIsImFjY291bnQiXSwiYXV0aF90aW1lIjoxNjg4NjUxNjk5LCJhenAiOiJvbnl4aWEiLCJlbWFpbCI6InZ1aWxsb3RhQGFmZC5mciIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJleHAiOjE2ODg3Mzg4NzgsImZhbWlseV9uYW1lIjoiVnVpbGxvdCIsImdpdmVuX25hbWUiOiJBbnRvaW5lIiwiZ3JvdXBzIjpbImFmZC1ldmEtYXAiXSwiaWF0IjoxNjg4NjUxNzAwLCJpc3MiOiJodHRwczovL2F1dGgubGFiLnNzcGNsb3VkLmZyL2F1dGgvcmVhbG1zL3NzcGNsb3VkIiwianRpIjoiN2ZmMjJhNmEtM2IyYS00NWFiLWJmYTItNmVhZDZkNzY5YzBhIiwibmFtZSI6IkFudG9pbmUgVnVpbGxvdCIsIm5vbmNlIjoiYjQzM2E1N2MtMjZiNS00NmE0LTkzOGItOGMyM2FmOTVlYTI5IiwicG9saWN5Ijoic3Rzb25seSIsInByZWZlcnJlZF91c2VybmFtZSI6InZ1aWxsb3RhIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iLCJkZWZhdWx0LXJvbGVzLXNzcGNsb3VkIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgcHJvZmlsZSBncm91cHMgZW1haWwiLCJzZXNzaW9uUG9saWN5IjoiZXlKV1pYSnphVzl1SWpvaU1qQXhNaTB4TUMweE55SXNJbE4wWVhSbGJXVnVkQ0k2VzNzaVJXWm1aV04wSWpvaVFXeHNiM2NpTENKQlkzUnBiMjRpT2xzaWN6TTZLaUpkTENKU1pYTnZkWEpqWlNJNld5SmhjbTQ2WVhkek9uTXpPam82Y0hKdmFtVjBMV0ZtWkMxbGRtRXRZWEFpTENKaGNtNDZZWGR6T25Nek9qbzZjSEp2YW1WMExXRm1aQzFsZG1FdFlYQXZLaUpkZlN4N0lrVm1abVZqZENJNklrRnNiRzkzSWl3aVFXTjBhVzl1SWpwYkluTXpPa3hwYzNSQ2RXTnJaWFFpWFN3aVVtVnpiM1Z5WTJVaU9sc2lZWEp1T21GM2N6cHpNem82T2lvaVhTd2lRMjl1WkdsMGFXOXVJanA3SWxOMGNtbHVaMHhwYTJVaU9uc2ljek02Y0hKbFptbDRJam9pWkdsbVpuVnphVzl1THlvaWZYMTlMSHNpUldabVpXTjBJam9pUVd4c2IzY2lMQ0pCWTNScGIyNGlPbHNpY3pNNlIyVjBUMkpxWldOMElsMHNJbEpsYzI5MWNtTmxJanBiSW1GeWJqcGhkM002Y3pNNk9qb3FMMlJwWm1aMWMybHZiaThxSWwxOVhYMD0iLCJzZXNzaW9uX3N0YXRlIjoiYWYyMDdlY2UtOWEzNi00OTQyLTllODYtNjA1NTJmNGYxZTg1Iiwic2lkIjoiYWYyMDdlY2UtOWEzNi00OTQyLTllODYtNjA1NTJmNGYxZTg1Iiwic3ViIjoiOTI3N2Y3MzMtNTBmMy00MjM4LWI1YzctNjRjMmU4YTZiNDI0IiwidHlwIjoiQmVhcmVyIn0.40_wwJeo7HhTJjvPyob96nNEvbCmvohcN7Wnd02ETirLobdTmE7QZZbd9q5P1ZGANkkIkAf8who86ELp1crWfw&quot;,</span></span>
<span id="cb69-5"><a href="biodiversity-in-the-protected-areas.html#cb69-5" tabindex="-1"></a><span class="co">#            &quot;AWS_S3_ENDPOINT&quot;= &quot;minio.lab.sspcloud.fr&quot;,</span></span>
<span id="cb69-6"><a href="biodiversity-in-the-protected-areas.html#cb69-6" tabindex="-1"></a><span class="co">#            &quot;AWS_HTTPS&quot; = &quot;FALSE&quot;,</span></span>
<span id="cb69-7"><a href="biodiversity-in-the-protected-areas.html#cb69-7" tabindex="-1"></a><span class="co">#            &quot;AWS_VIRTUAL_HOSTING&quot;=&quot;FALSE&quot;)</span></span></code></pre></div>
</div>
<div id="importing-pas-datasets" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Importing PAs datasets<a href="biodiversity-in-the-protected-areas.html#importing-pas-datasets" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="biodiversity-in-the-protected-areas.html#cb70-1" tabindex="-1"></a><span class="co">#Load spatial data and transform into polygons (requirement of the mapme package)</span></span>
<span id="cb70-2"><a href="biodiversity-in-the-protected-areas.html#cb70-2" tabindex="-1"></a></span>
<span id="cb70-3"><a href="biodiversity-in-the-protected-areas.html#cb70-3" tabindex="-1"></a><span class="co">#If the function get_resources used later returns an error &quot;...Loop 0 is not valid: Edge 94 crosses edge 96&gt;...&quot;, then the following function might solve it. It works if sf was updated v1.0 and more, and brings back to old way of working. sf uses mostly a flat Earth model instead of s2 spherical geometry in the new versions. </span></span>
<span id="cb70-4"><a href="biodiversity-in-the-protected-areas.html#cb70-4" tabindex="-1"></a><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span>
<span id="cb70-5"><a href="biodiversity-in-the-protected-areas.html#cb70-5" tabindex="-1"></a></span>
<span id="cb70-6"><a href="biodiversity-in-the-protected-areas.html#cb70-6" tabindex="-1"></a><span class="co">#/!\ : in pa_shp, variable sprfc is the area reported by AFD members, and is not equal to rep_a (area reported by WDPA) nor superficie in the BDD_joint. The latter is a combination of rep_a and sprfc, where superficie = rep_a except if rep_a = 0 or not reported.</span></span>
<span id="cb70-7"><a href="biodiversity-in-the-protected-areas.html#cb70-7" tabindex="-1"></a>pa_shp <span class="ot">=</span> </span>
<span id="cb70-8"><a href="biodiversity-in-the-protected-areas.html#cb70-8" tabindex="-1"></a>  <span class="fu">read_sf</span>(<span class="st">&quot;data_tidy/BDD_SHP_pub.gpkg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-9"><a href="biodiversity-in-the-protected-areas.html#cb70-9" tabindex="-1"></a>  <span class="co"># aws.s3::s3read_using(</span></span>
<span id="cb70-10"><a href="biodiversity-in-the-protected-areas.html#cb70-10" tabindex="-1"></a>  <span class="co"># FUN = sf::read_sf,</span></span>
<span id="cb70-11"><a href="biodiversity-in-the-protected-areas.html#cb70-11" tabindex="-1"></a>  <span class="co"># object = &quot;data_tidy/BDD_shp_pub.gpkg&quot;,</span></span>
<span id="cb70-12"><a href="biodiversity-in-the-protected-areas.html#cb70-12" tabindex="-1"></a>  <span class="co"># bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb70-13"><a href="biodiversity-in-the-protected-areas.html#cb70-13" tabindex="-1"></a>  <span class="co"># opts = list(&quot;region&quot; = &quot;&quot;)) %&gt;%</span></span>
<span id="cb70-14"><a href="biodiversity-in-the-protected-areas.html#cb70-14" tabindex="-1"></a>  <span class="fu">st_make_valid</span>() <span class="sc">%&gt;%</span></span>
<span id="cb70-15"><a href="biodiversity-in-the-protected-areas.html#cb70-15" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="at">to =</span> <span class="st">&quot;POLYGON&quot;</span>)</span>
<span id="cb70-16"><a href="biodiversity-in-the-protected-areas.html#cb70-16" tabindex="-1"></a></span>
<span id="cb70-17"><a href="biodiversity-in-the-protected-areas.html#cb70-17" tabindex="-1"></a><span class="co">#From BDD_joint, that is the combination of the SIOP dataset and the AP dataset from ARB team in AFD. Imported to have the information on the PA area (combination of areas reported by WDPA and ARB)</span></span>
<span id="cb70-18"><a href="biodiversity-in-the-protected-areas.html#cb70-18" tabindex="-1"></a>pa_nodupl <span class="ot">=</span> </span>
<span id="cb70-19"><a href="biodiversity-in-the-protected-areas.html#cb70-19" tabindex="-1"></a>  <span class="fu">fread</span>(<span class="st">&quot;data_tidy/BDD_nofund_nodupl.csv&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-20"><a href="biodiversity-in-the-protected-areas.html#cb70-20" tabindex="-1"></a>  <span class="co"># aws.s3::s3read_using(</span></span>
<span id="cb70-21"><a href="biodiversity-in-the-protected-areas.html#cb70-21" tabindex="-1"></a>  <span class="co"># FUN = data.table::fread,</span></span>
<span id="cb70-22"><a href="biodiversity-in-the-protected-areas.html#cb70-22" tabindex="-1"></a>  <span class="co"># encoding = &quot;UTF-8&quot;,</span></span>
<span id="cb70-23"><a href="biodiversity-in-the-protected-areas.html#cb70-23" tabindex="-1"></a>  <span class="co"># object = &quot;data_tidy/BDD_nofund_nodupl.csv&quot;,</span></span>
<span id="cb70-24"><a href="biodiversity-in-the-protected-areas.html#cb70-24" tabindex="-1"></a>  <span class="co"># bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb70-25"><a href="biodiversity-in-the-protected-areas.html#cb70-25" tabindex="-1"></a>  <span class="co"># opts = list(&quot;region&quot; = &quot;&quot;)) %&gt;%</span></span>
<span id="cb70-26"><a href="biodiversity-in-the-protected-areas.html#cb70-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(wdpaid, superficie))</span>
<span id="cb70-27"><a href="biodiversity-in-the-protected-areas.html#cb70-27" tabindex="-1"></a></span>
<span id="cb70-28"><a href="biodiversity-in-the-protected-areas.html#cb70-28" tabindex="-1"></a><span class="co">#mapview(pa_shp)</span></span></code></pre></div>
</div>
<div id="downloading-data-of-interests-and-compute-relevant-indicators" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Downloading data of interests and compute relevant indicators<a href="biodiversity-in-the-protected-areas.html#downloading-data-of-interests-and-compute-relevant-indicators" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the moment, mapme.biodiversity functions do not support reading/writing in a S3 server like SSPCloud. Waiting for the new release of the package, the following process is followed :</p>
<ol style="list-style-type: decimal">
<li><p>Create a sub-folder in the temporary folder (RAM of the R session) to download and store the raw data</p></li>
<li><p>Associate the portfolio to this sub-folder</p></li>
<li><p>Download the raw data and compute the indicators of interest, unnest the data obtained</p></li>
<li><p>Then, a dataframe can be saved.</p></li>
</ol>
<p>Note that this solution is not time-optimal : raw data must be downloaded each time.</p>
<div id="creating-the-portfolio" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Creating the portfolio<a href="biodiversity-in-the-protected-areas.html#creating-the-portfolio" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="biodiversity-in-the-protected-areas.html#cb71-1" tabindex="-1"></a><span class="co">#The raw data from mapme package are stored in a temporary folder</span></span>
<span id="cb71-2"><a href="biodiversity-in-the-protected-areas.html#cb71-2" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">paste</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;mapme&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>)</span>
<span id="cb71-3"><a href="biodiversity-in-the-protected-areas.html#cb71-3" tabindex="-1"></a><span class="co">#save_folder = get_bucket(&quot;projet-afd-eva-ap&quot;, region = &quot;&quot;)</span></span>
<span id="cb71-4"><a href="biodiversity-in-the-protected-areas.html#cb71-4" tabindex="-1"></a></span>
<span id="cb71-5"><a href="biodiversity-in-the-protected-areas.html#cb71-5" tabindex="-1"></a><span class="co">#Creating the portfolio</span></span>
<span id="cb71-6"><a href="biodiversity-in-the-protected-areas.html#cb71-6" tabindex="-1"></a>pa_pfolio <span class="ot">=</span> pa_shp[pa_shp<span class="sc">$</span>wdpaid <span class="sc">==</span> <span class="dv">1245</span>,] <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="biodiversity-in-the-protected-areas.html#cb71-7" tabindex="-1"></a>  <span class="fu">init_portfolio</span>(<span class="dv">2000</span><span class="sc">:</span><span class="dv">2021</span>,</span>
<span id="cb71-8"><a href="biodiversity-in-the-protected-areas.html#cb71-8" tabindex="-1"></a>                 <span class="at">outdir =</span> <span class="st">&quot;data_raw/mapme_bio_data&quot;</span>,</span>
<span id="cb71-9"><a href="biodiversity-in-the-protected-areas.html#cb71-9" tabindex="-1"></a>                 <span class="co">#cores = 4,</span></span>
<span id="cb71-10"><a href="biodiversity-in-the-protected-areas.html#cb71-10" tabindex="-1"></a>                 <span class="at">add_resources =</span> <span class="cn">TRUE</span>,</span>
<span id="cb71-11"><a href="biodiversity-in-the-protected-areas.html#cb71-11" tabindex="-1"></a>                 <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="test-importing-data-from-sspcloud" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> TEST : importing data from SSPCloud<a href="biodiversity-in-the-protected-areas.html#test-importing-data-from-sspcloud" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>data are downloaded from an other script and stored in the SSPCloud. Here : copy these data to the temporary storage of the R session, and use them to compute indicators.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="biodiversity-in-the-protected-areas.html#cb72-1" tabindex="-1"></a>df_files <span class="ot">=</span> aws.s3<span class="sc">::</span><span class="fu">get_bucket</span>(<span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb72-2"><a href="biodiversity-in-the-protected-areas.html#cb72-2" tabindex="-1"></a>                   <span class="at">prefix =</span> <span class="st">&quot;data_raw/mapme_bio_data/gfw_treecover/&quot;</span>,</span>
<span id="cb72-3"><a href="biodiversity-in-the-protected-areas.html#cb72-3" tabindex="-1"></a>                   <span class="at">region =</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="biodiversity-in-the-protected-areas.html#cb72-4" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb72-5"><a href="biodiversity-in-the-protected-areas.html#cb72-5" tabindex="-1"></a>list_files <span class="ot">=</span> df_files<span class="sc">$</span>Key</span>
<span id="cb72-6"><a href="biodiversity-in-the-protected-areas.html#cb72-6" tabindex="-1"></a>i <span class="ot">=</span> list_files[<span class="dv">1</span>]</span>
<span id="cb72-7"><a href="biodiversity-in-the-protected-areas.html#cb72-7" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> list_files) </span>
<span id="cb72-8"><a href="biodiversity-in-the-protected-areas.html#cb72-8" tabindex="-1"></a>{</span>
<span id="cb72-9"><a href="biodiversity-in-the-protected-areas.html#cb72-9" tabindex="-1"></a>  temp_file <span class="ot">=</span> <span class="fu">s3read_using</span>(<span class="at">FUN =</span> terra<span class="sc">::</span>rast,</span>
<span id="cb72-10"><a href="biodiversity-in-the-protected-areas.html#cb72-10" tabindex="-1"></a>               <span class="at">object =</span> i,</span>
<span id="cb72-11"><a href="biodiversity-in-the-protected-areas.html#cb72-11" tabindex="-1"></a>               <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb72-12"><a href="biodiversity-in-the-protected-areas.html#cb72-12" tabindex="-1"></a>               <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span><span class="ot">=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb72-13"><a href="biodiversity-in-the-protected-areas.html#cb72-13" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">writeRaster</span>(temp_file, <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;test.tif&quot;</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-14"><a href="biodiversity-in-the-protected-areas.html#cb72-14" tabindex="-1"></a>}</span>
<span id="cb72-15"><a href="biodiversity-in-the-protected-areas.html#cb72-15" tabindex="-1"></a><span class="fu">plot</span>(temp_file)</span></code></pre></div>
</div>
<div id="compute-indicators-from-geospatial-data" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Compute indicators from geospatial data<a href="biodiversity-in-the-protected-areas.html#compute-indicators-from-geospatial-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="biodiversity-in-the-protected-areas.html#cb73-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~</span></span>
<span id="cb73-2"><a href="biodiversity-in-the-protected-areas.html#cb73-2" tabindex="-1"></a><span class="do">##  ~ Forests ----</span></span>
<span id="cb73-3"><a href="biodiversity-in-the-protected-areas.html#cb73-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~</span></span>
<span id="cb73-4"><a href="biodiversity-in-the-protected-areas.html#cb73-4" tabindex="-1"></a></span>
<span id="cb73-5"><a href="biodiversity-in-the-protected-areas.html#cb73-5" tabindex="-1"></a><span class="co">#Modifying tile index</span></span>
<span id="cb73-6"><a href="biodiversity-in-the-protected-areas.html#cb73-6" tabindex="-1"></a><span class="do">##Emissions</span></span>
<span id="cb73-7"><a href="biodiversity-in-the-protected-areas.html#cb73-7" tabindex="-1"></a><span class="co"># tileindex_gfw_emissions = read_sf(&quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/gfw_treecover/tileindex_gfw_emissions.gpkg&quot;) %&gt;%</span></span>
<span id="cb73-8"><a href="biodiversity-in-the-protected-areas.html#cb73-8" tabindex="-1"></a><span class="co">#   mutate(location = gsub(&quot;/tmp/Rtmp79IZ3f/mapme/&quot;,</span></span>
<span id="cb73-9"><a href="biodiversity-in-the-protected-areas.html#cb73-9" tabindex="-1"></a><span class="co">#                          &quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/&quot;,</span></span>
<span id="cb73-10"><a href="biodiversity-in-the-protected-areas.html#cb73-10" tabindex="-1"></a><span class="co">#                          location))</span></span>
<span id="cb73-11"><a href="biodiversity-in-the-protected-areas.html#cb73-11" tabindex="-1"></a><span class="co"># write_sf(tileindex_gfw_emissions,</span></span>
<span id="cb73-12"><a href="biodiversity-in-the-protected-areas.html#cb73-12" tabindex="-1"></a><span class="co">#          &quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/gfw_treecover/tileindex_gfw_emissions.gpkg&quot;)</span></span>
<span id="cb73-13"><a href="biodiversity-in-the-protected-areas.html#cb73-13" tabindex="-1"></a></span>
<span id="cb73-14"><a href="biodiversity-in-the-protected-areas.html#cb73-14" tabindex="-1"></a><span class="do">##Treecover</span></span>
<span id="cb73-15"><a href="biodiversity-in-the-protected-areas.html#cb73-15" tabindex="-1"></a><span class="co"># tileindex_gfw_treecover = read_sf(&quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/gfw_treecover/tileindex_gfw_treecover.gpkg&quot;) %&gt;%</span></span>
<span id="cb73-16"><a href="biodiversity-in-the-protected-areas.html#cb73-16" tabindex="-1"></a><span class="co">#   mutate(location = gsub(&quot;/tmp/RtmpYU2AvZ/mapme/&quot;,</span></span>
<span id="cb73-17"><a href="biodiversity-in-the-protected-areas.html#cb73-17" tabindex="-1"></a><span class="co">#                          &quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/&quot;,</span></span>
<span id="cb73-18"><a href="biodiversity-in-the-protected-areas.html#cb73-18" tabindex="-1"></a><span class="co">#                          location))</span></span>
<span id="cb73-19"><a href="biodiversity-in-the-protected-areas.html#cb73-19" tabindex="-1"></a><span class="co"># write_sf(tileindex_gfw_treecover,</span></span>
<span id="cb73-20"><a href="biodiversity-in-the-protected-areas.html#cb73-20" tabindex="-1"></a><span class="co">#          &quot;D:/Documents/Github/EVA-impact-aires-protegees/data_raw/mapme_bio_data/gfw_treecover/tileindex_gfw_treecover.gpkg&quot;)</span></span>
<span id="cb73-21"><a href="biodiversity-in-the-protected-areas.html#cb73-21" tabindex="-1"></a></span>
<span id="cb73-22"><a href="biodiversity-in-the-protected-areas.html#cb73-22" tabindex="-1"></a></span>
<span id="cb73-23"><a href="biodiversity-in-the-protected-areas.html#cb73-23" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb73-24"><a href="biodiversity-in-the-protected-areas.html#cb73-24" tabindex="-1"></a>pa_pfolio_tcover <span class="ot">=</span></span>
<span id="cb73-25"><a href="biodiversity-in-the-protected-areas.html#cb73-25" tabindex="-1"></a>  <span class="fu">get_resources</span>(pa_pfolio,</span>
<span id="cb73-26"><a href="biodiversity-in-the-protected-areas.html#cb73-26" tabindex="-1"></a>    <span class="at">resources =</span> <span class="fu">c</span>(<span class="st">&quot;gfw_lossyear&quot;</span>,<span class="st">&quot;gfw_treecover&quot;</span>,<span class="st">&quot;gfw_emissions&quot;</span>),</span>
<span id="cb73-27"><a href="biodiversity-in-the-protected-areas.html#cb73-27" tabindex="-1"></a>    <span class="at">vers_treecover =</span> <span class="st">&quot;GFC-2020-v1.8&quot;</span>,</span>
<span id="cb73-28"><a href="biodiversity-in-the-protected-areas.html#cb73-28" tabindex="-1"></a>    <span class="at">vers_lossyear =</span> <span class="st">&quot;GFC-2020-v1.8&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-29"><a href="biodiversity-in-the-protected-areas.html#cb73-29" tabindex="-1"></a>  <span class="co"># FAO forest definition here: Minimum treecover = 10%, minimum size =1 hectare</span></span>
<span id="cb73-30"><a href="biodiversity-in-the-protected-areas.html#cb73-30" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="at">indicators =</span> <span class="st">&quot;treecover_area&quot;</span>,</span>
<span id="cb73-31"><a href="biodiversity-in-the-protected-areas.html#cb73-31" tabindex="-1"></a>                <span class="at">min_cover =</span> <span class="dv">10</span>,</span>
<span id="cb73-32"><a href="biodiversity-in-the-protected-areas.html#cb73-32" tabindex="-1"></a>                <span class="at">min_size =</span> <span class="dv">1</span>, <span class="at">overwrite=</span>T)</span>
<span id="cb73-33"><a href="biodiversity-in-the-protected-areas.html#cb73-33" tabindex="-1"></a></span>
<span id="cb73-34"><a href="biodiversity-in-the-protected-areas.html#cb73-34" tabindex="-1"></a></span>
<span id="cb73-35"><a href="biodiversity-in-the-protected-areas.html#cb73-35" tabindex="-1"></a></span>
<span id="cb73-36"><a href="biodiversity-in-the-protected-areas.html#cb73-36" tabindex="-1"></a><span class="co">#Unest the sf file into a classic data frame without geometry</span></span>
<span id="cb73-37"><a href="biodiversity-in-the-protected-areas.html#cb73-37" tabindex="-1"></a>data_pfolio_tcover <span class="ot">=</span> <span class="fu">unnest</span>(pa_pfolio_tcover, <span class="at">cols=</span><span class="st">&quot;treecover_area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-38"><a href="biodiversity-in-the-protected-areas.html#cb73-38" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-39"><a href="biodiversity-in-the-protected-areas.html#cb73-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wdpaid, assetid, years,treecover) <span class="sc">%&gt;%</span></span>
<span id="cb73-40"><a href="biodiversity-in-the-protected-areas.html#cb73-40" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treecover =</span> <span class="fu">case_when</span>(treecover <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="cn">NA</span>, <span class="cn">TRUE</span> <span class="sc">~</span> treecover)) <span class="sc">%&gt;%</span></span>
<span id="cb73-41"><a href="biodiversity-in-the-protected-areas.html#cb73-41" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(treecover))</span>
<span id="cb73-42"><a href="biodiversity-in-the-protected-areas.html#cb73-42" tabindex="-1"></a></span>
<span id="cb73-43"><a href="biodiversity-in-the-protected-areas.html#cb73-43" tabindex="-1"></a><span class="co">#Write the dataframe into the bucket</span></span>
<span id="cb73-44"><a href="biodiversity-in-the-protected-areas.html#cb73-44" tabindex="-1"></a><span class="fu">s3write_using</span>(data_pfolio_tcover,</span>
<span id="cb73-45"><a href="biodiversity-in-the-protected-areas.html#cb73-45" tabindex="-1"></a>              data.table<span class="sc">::</span>fwrite,</span>
<span id="cb73-46"><a href="biodiversity-in-the-protected-areas.html#cb73-46" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_tidy/mapme_bio_data/data_pfolio_tcover.csv&quot;</span>,</span>
<span id="cb73-47"><a href="biodiversity-in-the-protected-areas.html#cb73-47" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb73-48"><a href="biodiversity-in-the-protected-areas.html#cb73-48" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb73-49"><a href="biodiversity-in-the-protected-areas.html#cb73-49" tabindex="-1"></a>              )</span>
<span id="cb73-50"><a href="biodiversity-in-the-protected-areas.html#cb73-50" tabindex="-1"></a></span>
<span id="cb73-51"><a href="biodiversity-in-the-protected-areas.html#cb73-51" tabindex="-1"></a><span class="co">#Copying files to SSPCloud</span></span>
<span id="cb73-52"><a href="biodiversity-in-the-protected-areas.html#cb73-52" tabindex="-1"></a><span class="do">##emissions</span></span>
<span id="cb73-53"><a href="biodiversity-in-the-protected-areas.html#cb73-53" tabindex="-1"></a>files_emi <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_emissions&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), </span>
<span id="cb73-54"><a href="biodiversity-in-the-protected-areas.html#cb73-54" tabindex="-1"></a>                        <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-55"><a href="biodiversity-in-the-protected-areas.html#cb73-55" tabindex="-1"></a><span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb73-56"><a href="biodiversity-in-the-protected-areas.html#cb73-56" tabindex="-1"></a><span class="cf">for</span>(f <span class="cf">in</span> files_emi) </span>
<span id="cb73-57"><a href="biodiversity-in-the-protected-areas.html#cb73-57" tabindex="-1"></a>  {</span>
<span id="cb73-58"><a href="biodiversity-in-the-protected-areas.html#cb73-58" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb73-59"><a href="biodiversity-in-the-protected-areas.html#cb73-59" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb73-60"><a href="biodiversity-in-the-protected-areas.html#cb73-60" tabindex="-1"></a>                     <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap/data_raw/mapme_bio_data/gfw_emissions&quot;</span>, </span>
<span id="cb73-61"><a href="biodiversity-in-the-protected-areas.html#cb73-61" tabindex="-1"></a>                     <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-62"><a href="biodiversity-in-the-protected-areas.html#cb73-62" tabindex="-1"></a>}</span>
<span id="cb73-63"><a href="biodiversity-in-the-protected-areas.html#cb73-63" tabindex="-1"></a></span>
<span id="cb73-64"><a href="biodiversity-in-the-protected-areas.html#cb73-64" tabindex="-1"></a><span class="do">##loss years</span></span>
<span id="cb73-65"><a href="biodiversity-in-the-protected-areas.html#cb73-65" tabindex="-1"></a>files_lossyear <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_lossyear&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), </span>
<span id="cb73-66"><a href="biodiversity-in-the-protected-areas.html#cb73-66" tabindex="-1"></a>                        <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-67"><a href="biodiversity-in-the-protected-areas.html#cb73-67" tabindex="-1"></a><span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb73-68"><a href="biodiversity-in-the-protected-areas.html#cb73-68" tabindex="-1"></a><span class="cf">for</span>(f <span class="cf">in</span> files_emi) </span>
<span id="cb73-69"><a href="biodiversity-in-the-protected-areas.html#cb73-69" tabindex="-1"></a>  {</span>
<span id="cb73-70"><a href="biodiversity-in-the-protected-areas.html#cb73-70" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb73-71"><a href="biodiversity-in-the-protected-areas.html#cb73-71" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb73-72"><a href="biodiversity-in-the-protected-areas.html#cb73-72" tabindex="-1"></a>                     <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap/data_raw/mapme_bio_data/gfw_lossyear&quot;</span>, </span>
<span id="cb73-73"><a href="biodiversity-in-the-protected-areas.html#cb73-73" tabindex="-1"></a>                     <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-74"><a href="biodiversity-in-the-protected-areas.html#cb73-74" tabindex="-1"></a>}</span>
<span id="cb73-75"><a href="biodiversity-in-the-protected-areas.html#cb73-75" tabindex="-1"></a></span>
<span id="cb73-76"><a href="biodiversity-in-the-protected-areas.html#cb73-76" tabindex="-1"></a><span class="do">##Treecover loss</span></span>
<span id="cb73-77"><a href="biodiversity-in-the-protected-areas.html#cb73-77" tabindex="-1"></a>files_treecover <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_treecover&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), </span>
<span id="cb73-78"><a href="biodiversity-in-the-protected-areas.html#cb73-78" tabindex="-1"></a>                        <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-79"><a href="biodiversity-in-the-protected-areas.html#cb73-79" tabindex="-1"></a><span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb73-80"><a href="biodiversity-in-the-protected-areas.html#cb73-80" tabindex="-1"></a><span class="cf">for</span>(f <span class="cf">in</span> files_emi) </span>
<span id="cb73-81"><a href="biodiversity-in-the-protected-areas.html#cb73-81" tabindex="-1"></a>  {</span>
<span id="cb73-82"><a href="biodiversity-in-the-protected-areas.html#cb73-82" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb73-83"><a href="biodiversity-in-the-protected-areas.html#cb73-83" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb73-84"><a href="biodiversity-in-the-protected-areas.html#cb73-84" tabindex="-1"></a>                     <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap/data_raw/mapme_bio_data/gfw_treecover&quot;</span>, </span>
<span id="cb73-85"><a href="biodiversity-in-the-protected-areas.html#cb73-85" tabindex="-1"></a>                     <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-86"><a href="biodiversity-in-the-protected-areas.html#cb73-86" tabindex="-1"></a>}</span>
<span id="cb73-87"><a href="biodiversity-in-the-protected-areas.html#cb73-87" tabindex="-1"></a></span>
<span id="cb73-88"><a href="biodiversity-in-the-protected-areas.html#cb73-88" tabindex="-1"></a><span class="co">#Removing files from temp</span></span>
<span id="cb73-89"><a href="biodiversity-in-the-protected-areas.html#cb73-89" tabindex="-1"></a><span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_emissions&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb73-90"><a href="biodiversity-in-the-protected-areas.html#cb73-90" tabindex="-1"></a><span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_lossyear&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb73-91"><a href="biodiversity-in-the-protected-areas.html#cb73-91" tabindex="-1"></a><span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gfw_treecover&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="biodiversity-in-the-protected-areas.html#cb74-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb74-2"><a href="biodiversity-in-the-protected-areas.html#cb74-2" tabindex="-1"></a><span class="do">##  ~ Mangroves ----</span></span>
<span id="cb74-3"><a href="biodiversity-in-the-protected-areas.html#cb74-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb74-4"><a href="biodiversity-in-the-protected-areas.html#cb74-4" tabindex="-1"></a></span>
<span id="cb74-5"><a href="biodiversity-in-the-protected-areas.html#cb74-5" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb74-6"><a href="biodiversity-in-the-protected-areas.html#cb74-6" tabindex="-1"></a>pa_pfolio_mang <span class="ot">=</span></span>
<span id="cb74-7"><a href="biodiversity-in-the-protected-areas.html#cb74-7" tabindex="-1"></a>  <span class="fu">get_resources</span>(pa_pfolio,</span>
<span id="cb74-8"><a href="biodiversity-in-the-protected-areas.html#cb74-8" tabindex="-1"></a>    <span class="at">resources =</span> <span class="fu">c</span>(<span class="st">&quot;gmw&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb74-9"><a href="biodiversity-in-the-protected-areas.html#cb74-9" tabindex="-1"></a>  <span class="co"># FAO forest definition here: Minimum treecover = 10%, minimum size =1      #hectare</span></span>
<span id="cb74-10"><a href="biodiversity-in-the-protected-areas.html#cb74-10" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="at">indicators =</span> <span class="st">&quot;mangroves_area&quot;</span>,</span>
<span id="cb74-11"><a href="biodiversity-in-the-protected-areas.html#cb74-11" tabindex="-1"></a>                <span class="at">overwrite=</span>T)</span>
<span id="cb74-12"><a href="biodiversity-in-the-protected-areas.html#cb74-12" tabindex="-1"></a></span>
<span id="cb74-13"><a href="biodiversity-in-the-protected-areas.html#cb74-13" tabindex="-1"></a><span class="do">##Unest the sf file into a classic data frame without geometry</span></span>
<span id="cb74-14"><a href="biodiversity-in-the-protected-areas.html#cb74-14" tabindex="-1"></a>data_pfolio_mang <span class="ot">=</span> <span class="fu">unnest</span>(pa_pfolio_mang, <span class="at">cols=</span><span class="st">&quot;mangroves_area&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-15"><a href="biodiversity-in-the-protected-areas.html#cb74-15" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb74-16"><a href="biodiversity-in-the-protected-areas.html#cb74-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wdpaid, assetid, year,mangrove_extent)</span>
<span id="cb74-17"><a href="biodiversity-in-the-protected-areas.html#cb74-17" tabindex="-1"></a><span class="co"># s3write_using(data_pfolio_mang,</span></span>
<span id="cb74-18"><a href="biodiversity-in-the-protected-areas.html#cb74-18" tabindex="-1"></a><span class="co">#               data.table::fwrite,</span></span>
<span id="cb74-19"><a href="biodiversity-in-the-protected-areas.html#cb74-19" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/mapme_bio_data/data_pfolio_mang.csv&quot;,</span></span>
<span id="cb74-20"><a href="biodiversity-in-the-protected-areas.html#cb74-20" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb74-21"><a href="biodiversity-in-the-protected-areas.html#cb74-21" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;)</span></span>
<span id="cb74-22"><a href="biodiversity-in-the-protected-areas.html#cb74-22" tabindex="-1"></a><span class="co">#               )</span></span>
<span id="cb74-23"><a href="biodiversity-in-the-protected-areas.html#cb74-23" tabindex="-1"></a></span>
<span id="cb74-24"><a href="biodiversity-in-the-protected-areas.html#cb74-24" tabindex="-1"></a><span class="co"># data_pfolio_mang = s3read_using(data.table::fread,</span></span>
<span id="cb74-25"><a href="biodiversity-in-the-protected-areas.html#cb74-25" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/mapme_bio_data/data_pfolio_mang.csv&quot;,</span></span>
<span id="cb74-26"><a href="biodiversity-in-the-protected-areas.html#cb74-26" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb74-27"><a href="biodiversity-in-the-protected-areas.html#cb74-27" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;)</span></span>
<span id="cb74-28"><a href="biodiversity-in-the-protected-areas.html#cb74-28" tabindex="-1"></a><span class="co">#                                 )</span></span>
<span id="cb74-29"><a href="biodiversity-in-the-protected-areas.html#cb74-29" tabindex="-1"></a></span>
<span id="cb74-30"><a href="biodiversity-in-the-protected-areas.html#cb74-30" tabindex="-1"></a><span class="co">#Removing files from temp</span></span>
<span id="cb74-31"><a href="biodiversity-in-the-protected-areas.html#cb74-31" tabindex="-1"></a><span class="do">##emissions</span></span>
<span id="cb74-32"><a href="biodiversity-in-the-protected-areas.html#cb74-32" tabindex="-1"></a>files_mang <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gmw&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), </span>
<span id="cb74-33"><a href="biodiversity-in-the-protected-areas.html#cb74-33" tabindex="-1"></a>                        <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-34"><a href="biodiversity-in-the-protected-areas.html#cb74-34" tabindex="-1"></a><span class="do">##Add each file in the bucket (same foler for every file in the temp)</span></span>
<span id="cb74-35"><a href="biodiversity-in-the-protected-areas.html#cb74-35" tabindex="-1"></a><span class="cf">for</span>(f <span class="cf">in</span> files_mang) </span>
<span id="cb74-36"><a href="biodiversity-in-the-protected-areas.html#cb74-36" tabindex="-1"></a>  {</span>
<span id="cb74-37"><a href="biodiversity-in-the-protected-areas.html#cb74-37" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Uploading file&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;&#39;&quot;</span>, f, <span class="st">&quot;&#39;&quot;</span>), <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb74-38"><a href="biodiversity-in-the-protected-areas.html#cb74-38" tabindex="-1"></a>  aws.s3<span class="sc">::</span><span class="fu">put_object</span>(<span class="at">file =</span> f, </span>
<span id="cb74-39"><a href="biodiversity-in-the-protected-areas.html#cb74-39" tabindex="-1"></a>                     <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap/data_raw/mapme_bio_data/gmw&quot;</span>, </span>
<span id="cb74-40"><a href="biodiversity-in-the-protected-areas.html#cb74-40" tabindex="-1"></a>                     <span class="at">region =</span> <span class="st">&quot;&quot;</span>, <span class="at">show_progress =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-41"><a href="biodiversity-in-the-protected-areas.html#cb74-41" tabindex="-1"></a>}</span>
<span id="cb74-42"><a href="biodiversity-in-the-protected-areas.html#cb74-42" tabindex="-1"></a></span>
<span id="cb74-43"><a href="biodiversity-in-the-protected-areas.html#cb74-43" tabindex="-1"></a><span class="fu">do.call</span>(file.remove, <span class="fu">list</span>(<span class="fu">list.files</span>(<span class="fu">paste</span>(tmp, <span class="st">&quot;gmw&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="biodiversity-in-the-protected-areas.html#cb75-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb75-2"><a href="biodiversity-in-the-protected-areas.html#cb75-2" tabindex="-1"></a><span class="do">##  ~ Land cover   --</span></span>
<span id="cb75-3"><a href="biodiversity-in-the-protected-areas.html#cb75-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb75-4"><a href="biodiversity-in-the-protected-areas.html#cb75-4" tabindex="-1"></a></span>
<span id="cb75-5"><a href="biodiversity-in-the-protected-areas.html#cb75-5" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb75-6"><a href="biodiversity-in-the-protected-areas.html#cb75-6" tabindex="-1"></a>pa_pfolio_land <span class="ot">=</span> </span>
<span id="cb75-7"><a href="biodiversity-in-the-protected-areas.html#cb75-7" tabindex="-1"></a>  <span class="fu">get_resources</span>(pa_pfolio,</span>
<span id="cb75-8"><a href="biodiversity-in-the-protected-areas.html#cb75-8" tabindex="-1"></a>    <span class="at">resources =</span> <span class="fu">c</span>(<span class="st">&quot;esalandcover&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb75-9"><a href="biodiversity-in-the-protected-areas.html#cb75-9" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="at">indicators =</span> <span class="st">&quot;landcover&quot;</span>,</span>
<span id="cb75-10"><a href="biodiversity-in-the-protected-areas.html#cb75-10" tabindex="-1"></a>                <span class="at">overwrite=</span>T) </span>
<span id="cb75-11"><a href="biodiversity-in-the-protected-areas.html#cb75-11" tabindex="-1"></a></span>
<span id="cb75-12"><a href="biodiversity-in-the-protected-areas.html#cb75-12" tabindex="-1"></a><span class="do">##Unnest data</span></span>
<span id="cb75-13"><a href="biodiversity-in-the-protected-areas.html#cb75-13" tabindex="-1"></a>data_pfolio_land <span class="ot">=</span> <span class="fu">unnest</span>(pa_pfolio_land, <span class="at">cols =</span> <span class="st">&quot;landcover&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="biodiversity-in-the-protected-areas.html#cb75-14" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb75-15"><a href="biodiversity-in-the-protected-areas.html#cb75-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(wdpaid, assetid, year, area, classes)</span>
<span id="cb75-16"><a href="biodiversity-in-the-protected-areas.html#cb75-16" tabindex="-1"></a><span class="fu">s3write_using</span>(data_pfolio_land,</span>
<span id="cb75-17"><a href="biodiversity-in-the-protected-areas.html#cb75-17" tabindex="-1"></a>              data.table<span class="sc">::</span>fwrite,</span>
<span id="cb75-18"><a href="biodiversity-in-the-protected-areas.html#cb75-18" tabindex="-1"></a>              <span class="at">object =</span> <span class="st">&quot;data_tidy/mapme_bio_data/data_pfolio_land.csv&quot;</span>,</span>
<span id="cb75-19"><a href="biodiversity-in-the-protected-areas.html#cb75-19" tabindex="-1"></a>              <span class="at">bucket =</span> <span class="st">&quot;projet-afd-eva-ap&quot;</span>,</span>
<span id="cb75-20"><a href="biodiversity-in-the-protected-areas.html#cb75-20" tabindex="-1"></a>              <span class="at">opts =</span> <span class="fu">list</span>(<span class="st">&quot;region&quot;</span> <span class="ot">=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb75-21"><a href="biodiversity-in-the-protected-areas.html#cb75-21" tabindex="-1"></a>              )</span>
<span id="cb75-22"><a href="biodiversity-in-the-protected-areas.html#cb75-22" tabindex="-1"></a></span>
<span id="cb75-23"><a href="biodiversity-in-the-protected-areas.html#cb75-23" tabindex="-1"></a><span class="co"># data_pfolio_land = s3read_using(data.table::fread,</span></span>
<span id="cb75-24"><a href="biodiversity-in-the-protected-areas.html#cb75-24" tabindex="-1"></a><span class="co">#               object = &quot;data_tidy/mapme_bio_data/data_pfolio_land.csv&quot;,</span></span>
<span id="cb75-25"><a href="biodiversity-in-the-protected-areas.html#cb75-25" tabindex="-1"></a><span class="co">#               bucket = &quot;projet-afd-eva-ap&quot;,</span></span>
<span id="cb75-26"><a href="biodiversity-in-the-protected-areas.html#cb75-26" tabindex="-1"></a><span class="co">#               opts = list(&quot;region&quot; = &quot;&quot;)</span></span>
<span id="cb75-27"><a href="biodiversity-in-the-protected-areas.html#cb75-27" tabindex="-1"></a><span class="co">#                                 )</span></span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="biodiversity-in-the-protected-areas.html#cb76-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb76-2"><a href="biodiversity-in-the-protected-areas.html#cb76-2" tabindex="-1"></a><span class="do">##  ~ Emissions  ----</span></span>
<span id="cb76-3"><a href="biodiversity-in-the-protected-areas.html#cb76-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb76-4"><a href="biodiversity-in-the-protected-areas.html#cb76-4" tabindex="-1"></a></span>
<span id="cb76-5"><a href="biodiversity-in-the-protected-areas.html#cb76-5" tabindex="-1"></a><span class="co"># pa_pfolio_emi = </span></span>
<span id="cb76-6"><a href="biodiversity-in-the-protected-areas.html#cb76-6" tabindex="-1"></a><span class="co">#     get_resources(pa_pfolio,</span></span>
<span id="cb76-7"><a href="biodiversity-in-the-protected-areas.html#cb76-7" tabindex="-1"></a><span class="co">#     resources = c(&quot;gfw_lossyear&quot;,&quot;gfw_treecover&quot;,&quot;gfw_emissions&quot;), </span></span>
<span id="cb76-8"><a href="biodiversity-in-the-protected-areas.html#cb76-8" tabindex="-1"></a><span class="co">#     vers_treecover = &quot;GFC-2020-v1.8&quot;,</span></span>
<span id="cb76-9"><a href="biodiversity-in-the-protected-areas.html#cb76-9" tabindex="-1"></a><span class="co">#     vers_lossyear = &quot;GFC-2020-v1.8&quot;) %&gt;%</span></span>
<span id="cb76-10"><a href="biodiversity-in-the-protected-areas.html#cb76-10" tabindex="-1"></a><span class="co">#     calc_indicators(indicators = &quot;treecoverloss_emissions&quot;,</span></span>
<span id="cb76-11"><a href="biodiversity-in-the-protected-areas.html#cb76-11" tabindex="-1"></a><span class="co">#                   min_cover = 30,</span></span>
<span id="cb76-12"><a href="biodiversity-in-the-protected-areas.html#cb76-12" tabindex="-1"></a><span class="co">#                   min_size = 1, overwrite=T)</span></span>
<span id="cb76-13"><a href="biodiversity-in-the-protected-areas.html#cb76-13" tabindex="-1"></a></span>
<span id="cb76-14"><a href="biodiversity-in-the-protected-areas.html#cb76-14" tabindex="-1"></a><span class="co"># write_portfolio(pa_pfolio_emi,</span></span>
<span id="cb76-15"><a href="biodiversity-in-the-protected-areas.html#cb76-15" tabindex="-1"></a><span class="co">#       dsn = &quot;data_tidy/mapme_bio_data/pa_pfolio_emi.gpkg&quot;,</span></span>
<span id="cb76-16"><a href="biodiversity-in-the-protected-areas.html#cb76-16" tabindex="-1"></a><span class="co">#       overwrite = FALSE)</span></span>
<span id="cb76-17"><a href="biodiversity-in-the-protected-areas.html#cb76-17" tabindex="-1"></a></span>
<span id="cb76-18"><a href="biodiversity-in-the-protected-areas.html#cb76-18" tabindex="-1"></a>pa_pfolio_emi <span class="ot">=</span> <span class="fu">read_portfolio</span>(<span class="st">&quot;data_tidy/mapme_bio_data/pa_pfolio_emi.gpkg&quot;</span>)</span>
<span id="cb76-19"><a href="biodiversity-in-the-protected-areas.html#cb76-19" tabindex="-1"></a></span>
<span id="cb76-20"><a href="biodiversity-in-the-protected-areas.html#cb76-20" tabindex="-1"></a><span class="co"># data_pfolio_emi = unnest(pa_pfolio_emi,</span></span>
<span id="cb76-21"><a href="biodiversity-in-the-protected-areas.html#cb76-21" tabindex="-1"></a><span class="co">#                   cols=&quot;treecoverloss_emissions&quot;) %&gt;%</span></span>
<span id="cb76-22"><a href="biodiversity-in-the-protected-areas.html#cb76-22" tabindex="-1"></a><span class="co">#     sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb76-23"><a href="biodiversity-in-the-protected-areas.html#cb76-23" tabindex="-1"></a><span class="co">#     dplyr::select(id_pr,wdpaid,years,emissions)</span></span>
<span id="cb76-24"><a href="biodiversity-in-the-protected-areas.html#cb76-24" tabindex="-1"></a></span>
<span id="cb76-25"><a href="biodiversity-in-the-protected-areas.html#cb76-25" tabindex="-1"></a><span class="co"># fwrite(data_pfolio_emi,</span></span>
<span id="cb76-26"><a href="biodiversity-in-the-protected-areas.html#cb76-26" tabindex="-1"></a><span class="co">#        &quot;data_tidy/mapme_bio_data/data_pfolio_emi.csv&quot;)</span></span>
<span id="cb76-27"><a href="biodiversity-in-the-protected-areas.html#cb76-27" tabindex="-1"></a></span>
<span id="cb76-28"><a href="biodiversity-in-the-protected-areas.html#cb76-28" tabindex="-1"></a>data_pfolio_emi <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">&quot;data_tidy/mapme_bio_data/data_pfolio_emi.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="biodiversity-in-the-protected-areas.html#cb77-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb77-2"><a href="biodiversity-in-the-protected-areas.html#cb77-2" tabindex="-1"></a><span class="do">##  ~ Biome       ----</span></span>
<span id="cb77-3"><a href="biodiversity-in-the-protected-areas.html#cb77-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb77-4"><a href="biodiversity-in-the-protected-areas.html#cb77-4" tabindex="-1"></a></span>
<span id="cb77-5"><a href="biodiversity-in-the-protected-areas.html#cb77-5" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb77-6"><a href="biodiversity-in-the-protected-areas.html#cb77-6" tabindex="-1"></a>pa_pfolio_biome <span class="ot">=</span></span>
<span id="cb77-7"><a href="biodiversity-in-the-protected-areas.html#cb77-7" tabindex="-1"></a>  <span class="fu">get_resources</span>(pa_pfolio,</span>
<span id="cb77-8"><a href="biodiversity-in-the-protected-areas.html#cb77-8" tabindex="-1"></a>    <span class="at">resources =</span> <span class="fu">c</span>(<span class="st">&quot;teow&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb77-9"><a href="biodiversity-in-the-protected-areas.html#cb77-9" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="at">indicators =</span> <span class="st">&quot;biome&quot;</span>,</span>
<span id="cb77-10"><a href="biodiversity-in-the-protected-areas.html#cb77-10" tabindex="-1"></a>                <span class="at">overwrite=</span>T)</span>
<span id="cb77-11"><a href="biodiversity-in-the-protected-areas.html#cb77-11" tabindex="-1"></a></span>
<span id="cb77-12"><a href="biodiversity-in-the-protected-areas.html#cb77-12" tabindex="-1"></a><span class="co"># write_portfolio(pa_pfolio_biome, </span></span>
<span id="cb77-13"><a href="biodiversity-in-the-protected-areas.html#cb77-13" tabindex="-1"></a><span class="co">#       dsn = &quot;01_data_tidy/mapme_bio_data/pa_pfolio_biome.gpkg&quot;,</span></span>
<span id="cb77-14"><a href="biodiversity-in-the-protected-areas.html#cb77-14" tabindex="-1"></a><span class="co">#       overwrite = FALSE)</span></span>
<span id="cb77-15"><a href="biodiversity-in-the-protected-areas.html#cb77-15" tabindex="-1"></a></span>
<span id="cb77-16"><a href="biodiversity-in-the-protected-areas.html#cb77-16" tabindex="-1"></a><span class="do">##Unest the sf file into a classic data frame without geometry</span></span>
<span id="cb77-17"><a href="biodiversity-in-the-protected-areas.html#cb77-17" tabindex="-1"></a><span class="co"># data_biome = unnest(pa_pfolio_biome, cols=&quot;biome&quot;) %&gt;%</span></span>
<span id="cb77-18"><a href="biodiversity-in-the-protected-areas.html#cb77-18" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb77-19"><a href="biodiversity-in-the-protected-areas.html#cb77-19" tabindex="-1"></a><span class="co">#   dplyr::select(id_pr,wdpaid,year,mangrove_extent)</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="biodiversity-in-the-protected-areas.html#cb78-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb78-2"><a href="biodiversity-in-the-protected-areas.html#cb78-2" tabindex="-1"></a><span class="do">##  ~ Soil features --</span></span>
<span id="cb78-3"><a href="biodiversity-in-the-protected-areas.html#cb78-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb78-4"><a href="biodiversity-in-the-protected-areas.html#cb78-4" tabindex="-1"></a></span>
<span id="cb78-5"><a href="biodiversity-in-the-protected-areas.html#cb78-5" tabindex="-1"></a><span class="co">#/!\ voir quels indicateurs/mesures prendre !!</span></span>
<span id="cb78-6"><a href="biodiversity-in-the-protected-areas.html#cb78-6" tabindex="-1"></a></span>
<span id="cb78-7"><a href="biodiversity-in-the-protected-areas.html#cb78-7" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb78-8"><a href="biodiversity-in-the-protected-areas.html#cb78-8" tabindex="-1"></a></span>
<span id="cb78-9"><a href="biodiversity-in-the-protected-areas.html#cb78-9" tabindex="-1"></a>pa_pfolio_soil <span class="ot">=</span> </span>
<span id="cb78-10"><a href="biodiversity-in-the-protected-areas.html#cb78-10" tabindex="-1"></a>  <span class="fu">get_resources</span>(pa_pfolio,</span>
<span id="cb78-11"><a href="biodiversity-in-the-protected-areas.html#cb78-11" tabindex="-1"></a>    <span class="at">resources =</span> <span class="fu">c</span>(<span class="st">&quot;soilgrids&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb78-12"><a href="biodiversity-in-the-protected-areas.html#cb78-12" tabindex="-1"></a>  <span class="co"># FAO forest definition here: Minimum treecover = 10%, minimum size =1      #hectare</span></span>
<span id="cb78-13"><a href="biodiversity-in-the-protected-areas.html#cb78-13" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="at">indicators =</span> <span class="st">&quot;soilproperties&quot;</span>,</span>
<span id="cb78-14"><a href="biodiversity-in-the-protected-areas.html#cb78-14" tabindex="-1"></a>                <span class="at">overwrite=</span>T) </span>
<span id="cb78-15"><a href="biodiversity-in-the-protected-areas.html#cb78-15" tabindex="-1"></a></span>
<span id="cb78-16"><a href="biodiversity-in-the-protected-areas.html#cb78-16" tabindex="-1"></a><span class="co"># write_portfolio(pa_pfolio_mang, </span></span>
<span id="cb78-17"><a href="biodiversity-in-the-protected-areas.html#cb78-17" tabindex="-1"></a><span class="co">#       dsn = &quot;01_data_tidy/mapme_bio_data/pa_pfolio_mang.gpkg&quot;,</span></span>
<span id="cb78-18"><a href="biodiversity-in-the-protected-areas.html#cb78-18" tabindex="-1"></a><span class="co">#       overwrite = FALSE)</span></span>
<span id="cb78-19"><a href="biodiversity-in-the-protected-areas.html#cb78-19" tabindex="-1"></a></span>
<span id="cb78-20"><a href="biodiversity-in-the-protected-areas.html#cb78-20" tabindex="-1"></a><span class="do">##Unest the sf file into a classic data frame without geometry</span></span>
<span id="cb78-21"><a href="biodiversity-in-the-protected-areas.html#cb78-21" tabindex="-1"></a><span class="co"># data_biome = unnest(pa_pfolio_biome, cols=&quot;biome&quot;) %&gt;%</span></span>
<span id="cb78-22"><a href="biodiversity-in-the-protected-areas.html#cb78-22" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb78-23"><a href="biodiversity-in-the-protected-areas.html#cb78-23" tabindex="-1"></a><span class="co">#   dplyr::select(id_pr,wdpaid,year,mangrove_extent)</span></span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="biodiversity-in-the-protected-areas.html#cb79-1" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb79-2"><a href="biodiversity-in-the-protected-areas.html#cb79-2" tabindex="-1"></a><span class="do">##  ~ Accessibility --</span></span>
<span id="cb79-3"><a href="biodiversity-in-the-protected-areas.html#cb79-3" tabindex="-1"></a><span class="do">##~~~~~~~~~~~~~~~~~~~~</span></span>
<span id="cb79-4"><a href="biodiversity-in-the-protected-areas.html#cb79-4" tabindex="-1"></a></span>
<span id="cb79-5"><a href="biodiversity-in-the-protected-areas.html#cb79-5" tabindex="-1"></a><span class="do">##Downloading data and computing indicators </span></span>
<span id="cb79-6"><a href="biodiversity-in-the-protected-areas.html#cb79-6" tabindex="-1"></a>pa_pfolio_acc <span class="ot">=</span> </span>
<span id="cb79-7"><a href="biodiversity-in-the-protected-areas.html#cb79-7" tabindex="-1"></a>  <span class="fu">get_resources</span>(<span class="st">&quot;nelson_et_al&quot;</span>,</span>
<span id="cb79-8"><a href="biodiversity-in-the-protected-areas.html#cb79-8" tabindex="-1"></a>                <span class="at">range_traveltime =</span> <span class="fu">c</span>(<span class="st">&quot;5k_10k&quot;</span>, <span class="st">&quot;100k_200k&quot;</span>, </span>
<span id="cb79-9"><a href="biodiversity-in-the-protected-areas.html#cb79-9" tabindex="-1"></a>                                     <span class="st">&quot;500k_1mio&quot;</span>, <span class="st">&quot;1mio_5mio&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb79-10"><a href="biodiversity-in-the-protected-areas.html#cb79-10" tabindex="-1"></a>  <span class="fu">calc_indicators</span>(<span class="st">&quot;traveltime&quot;</span>, </span>
<span id="cb79-11"><a href="biodiversity-in-the-protected-areas.html#cb79-11" tabindex="-1"></a>                  <span class="at">stats_accessibility =</span> <span class="fu">c</span>(<span class="st">&quot;min&quot;</span>, <span class="st">&quot;max&quot;</span>), </span>
<span id="cb79-12"><a href="biodiversity-in-the-protected-areas.html#cb79-12" tabindex="-1"></a>                  <span class="at">engine =</span> <span class="st">&quot;extract&quot;</span>)</span>
<span id="cb79-13"><a href="biodiversity-in-the-protected-areas.html#cb79-13" tabindex="-1"></a></span>
<span id="cb79-14"><a href="biodiversity-in-the-protected-areas.html#cb79-14" tabindex="-1"></a><span class="co"># write_portfolio(pa_pfolio_mang, </span></span>
<span id="cb79-15"><a href="biodiversity-in-the-protected-areas.html#cb79-15" tabindex="-1"></a><span class="co">#       dsn = &quot;01_data_tidy/mapme_bio_data/pa_pfolio_mang.gpkg&quot;,</span></span>
<span id="cb79-16"><a href="biodiversity-in-the-protected-areas.html#cb79-16" tabindex="-1"></a><span class="co">#       overwrite = FALSE)</span></span>
<span id="cb79-17"><a href="biodiversity-in-the-protected-areas.html#cb79-17" tabindex="-1"></a></span>
<span id="cb79-18"><a href="biodiversity-in-the-protected-areas.html#cb79-18" tabindex="-1"></a><span class="do">##Unest the sf file into a classic data frame without geometry</span></span>
<span id="cb79-19"><a href="biodiversity-in-the-protected-areas.html#cb79-19" tabindex="-1"></a><span class="co"># data_biome = unnest(pa_pfolio_biome, cols=&quot;biome&quot;) %&gt;%</span></span>
<span id="cb79-20"><a href="biodiversity-in-the-protected-areas.html#cb79-20" tabindex="-1"></a><span class="co">#   sf::st_drop_geometry() %&gt;%</span></span>
<span id="cb79-21"><a href="biodiversity-in-the-protected-areas.html#cb79-21" tabindex="-1"></a><span class="co">#   dplyr::select(id_pr,wdpaid,year,mangrove_extent)</span></span></code></pre></div>
<p>Faire une fonction pour l’extraction de tout jeu de données ? Répétitif en soit de faire forêts, mangroves, etc.</p>
<p>Warning and errors face and their meaning.</p>
<ul>
<li><p><em>although coordinates are longitude/latitude, st_intersects assumes that they are planar</em>.</p>
<ul>
<li><p>See <a href="https://r-spatial.org/r/2020/06/17/s2.html" class="uri">https://r-spatial.org/r/2020/06/17/s2.html</a> and <a href="https://r-spatial.github.io/sf/articles/sf7.html#" class="uri">https://r-spatial.github.io/sf/articles/sf7.html#</a>. Basically I used sf_use_s2(FALSE) at the creation of the portfolio. Thus sf uses flat Earth model instead of s2 spherical geometry. The operation st_intersects assumes the data lie in a flat plane where one degree longitude equals one degree latitude, irrespective where the PA is on the world (equirectangular projection). Thus if the polygons are drawn from coordinates in a spherical geometry, the operation is performed on the wrong projection. Is it a problem in itself ? Well as a projection is a bijection between two coordinate systems, plygons that intersect (or not) in a projection will intersect in the second. However the polygons will be distorded (the more so as they are located closer to the poles), and the areas computed could be wrong. Anyway according to the documentation the WDPA polygons are provided in WGS84 geographic coordinate system, i.e a planar projection (Plate Carree) . No problem should arise from the warning then.</p></li>
<li><p>So according to Florent Bedecarrats, this warning is related to an other issue. The sphere representing the Earth is transformed into a plane through a cut on a given line. If a polygon is located on this line, the flattened polygon is considered to go around the Earth. To test for this possibility, compare the area of the polygon to the true area of the PA.</p></li>
</ul></li>
<li><p><em>Avis : TIFFFillStrip:Read error at scanline 4294967295; got 0 bytes, expected 1387 (GDAL error 1)Avis : TIFFReadEncodedStrip() failed. (GDAL error 1).</em></p>
<p>This advice occurs during the computation of indicators (a few tenths for emissions). Fail to read some parts of the raster file ? Is it problematic for the whole process ?</p>
<p>Best solution : remove the corresponding TIFF and download data again.</p></li>
<li><p><em>Avis : D:/projet_AiresProtegees/00_data_raw/mapme_bio_data/gfw_lossyear/Hansen_GFC-2020-v1.8_lossyear_10N_010E.tif, band 1: IReadBlock failed at X offset 0, Y offset 29995: TIFFReadEncodedStrip() failed. (GDAL error 1)</em></p>
<p>Same as before. Best solution : remove the corresponding TIFF and download data again.</p></li>
<li><p><em>Avis : Error : [crop] incorrect number of values (too many) for writing</em></p>
<p>Check the error in more details.</p></li>
</ul>
</div>
</div>
<div id="computing-statistics" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Computing statistics<a href="biodiversity-in-the-protected-areas.html#computing-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>From the datasets obtained, statistics of interest can be computed and plotted.</p>
<div id="forests" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Forests<a href="biodiversity-in-the-protected-areas.html#forests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Variation of forest loss over time :</p>
<ul>
<li>Building the figure dataset</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="biodiversity-in-the-protected-areas.html#cb80-1" tabindex="-1"></a><span class="co">#Building the dataset</span></span>
<span id="cb80-2"><a href="biodiversity-in-the-protected-areas.html#cb80-2" tabindex="-1"></a>data_stat_treeloss <span class="ot">=</span> data_pfolio_forest <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="biodiversity-in-the-protected-areas.html#cb80-3" tabindex="-1"></a>  <span class="fu">group_by</span>(nm_ap) <span class="sc">%&gt;%</span> </span>
<span id="cb80-4"><a href="biodiversity-in-the-protected-areas.html#cb80-4" tabindex="-1"></a>  <span class="co">#Comoute variation over time in each PA</span></span>
<span id="cb80-5"><a href="biodiversity-in-the-protected-areas.html#cb80-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_treecov =</span> <span class="fu">lag</span>(treecover),</span>
<span id="cb80-6"><a href="biodiversity-in-the-protected-areas.html#cb80-6" tabindex="-1"></a>         <span class="at">loss =</span> ((treecover <span class="sc">-</span> lag_treecov)<span class="sc">/</span>lag_treecov)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="biodiversity-in-the-protected-areas.html#cb80-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="biodiversity-in-the-protected-areas.html#cb80-8" tabindex="-1"></a>  <span class="co">#Regroup years for analysis in five years intervals</span></span>
<span id="cb80-9"><a href="biodiversity-in-the-protected-areas.html#cb80-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">years_regroup =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-10"><a href="biodiversity-in-the-protected-areas.html#cb80-10" tabindex="-1"></a>  years <span class="sc">&lt;=</span> <span class="dv">2005</span> <span class="sc">~</span> <span class="st">&quot;2000-2005&quot;</span>,</span>
<span id="cb80-11"><a href="biodiversity-in-the-protected-areas.html#cb80-11" tabindex="-1"></a>  years <span class="sc">&lt;=</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="st">&quot;2005-2010&quot;</span>,</span>
<span id="cb80-12"><a href="biodiversity-in-the-protected-areas.html#cb80-12" tabindex="-1"></a>  years <span class="sc">&lt;=</span> <span class="dv">2015</span> <span class="sc">~</span> <span class="st">&quot;2010-2015&quot;</span>,</span>
<span id="cb80-13"><a href="biodiversity-in-the-protected-areas.html#cb80-13" tabindex="-1"></a>  years <span class="sc">&lt;=</span><span class="dv">2020</span> <span class="sc">~</span> <span class="st">&quot;2015-2020&quot;</span>,</span>
<span id="cb80-14"><a href="biodiversity-in-the-protected-areas.html#cb80-14" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span>),</span>
<span id="cb80-15"><a href="biodiversity-in-the-protected-areas.html#cb80-15" tabindex="-1"></a>  <span class="at">.after =</span> years) <span class="sc">%&gt;%</span></span>
<span id="cb80-16"><a href="biodiversity-in-the-protected-areas.html#cb80-16" tabindex="-1"></a>  <span class="co">#Remove NA values for loss</span></span>
<span id="cb80-17"><a href="biodiversity-in-the-protected-areas.html#cb80-17" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(loss)) <span class="sc">%&gt;%</span></span>
<span id="cb80-18"><a href="biodiversity-in-the-protected-areas.html#cb80-18" tabindex="-1"></a>  <span class="co">#Compute mean loss for five years intervals in each PA</span></span>
<span id="cb80-19"><a href="biodiversity-in-the-protected-areas.html#cb80-19" tabindex="-1"></a>  <span class="fu">group_by</span>(nm_ap, years_regroup) <span class="sc">%&gt;%</span></span>
<span id="cb80-20"><a href="biodiversity-in-the-protected-areas.html#cb80-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">moy_5 =</span> <span class="fu">mean</span>(loss)) <span class="sc">%&gt;%</span></span>
<span id="cb80-21"><a href="biodiversity-in-the-protected-areas.html#cb80-21" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<ul>
<li>Statistics at PA level</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="biodiversity-in-the-protected-areas.html#cb81-1" tabindex="-1"></a><span class="co">#Evolution for a given PA</span></span>
<span id="cb81-2"><a href="biodiversity-in-the-protected-areas.html#cb81-2" tabindex="-1"></a><span class="do">##Buba</span></span>
<span id="cb81-3"><a href="biodiversity-in-the-protected-areas.html#cb81-3" tabindex="-1"></a>stat_forest_buba <span class="ot">=</span> <span class="fu">stat_treeloss_id</span>(<span class="at">df =</span> data_stat_treeloss,</span>
<span id="cb81-4"><a href="biodiversity-in-the-protected-areas.html#cb81-4" tabindex="-1"></a>                                    <span class="at">id =</span> <span class="st">&quot;317051&quot;</span>,</span>
<span id="cb81-5"><a href="biodiversity-in-the-protected-areas.html#cb81-5" tabindex="-1"></a>                                    <span class="at">name_pa =</span> <span class="st">&quot;AP Buba&quot;</span>,</span>
<span id="cb81-6"><a href="biodiversity-in-the-protected-areas.html#cb81-6" tabindex="-1"></a>                                    <span class="at">treatment_yr =</span> <span class="dv">2007</span>)</span>
<span id="cb81-7"><a href="biodiversity-in-the-protected-areas.html#cb81-7" tabindex="-1"></a>fig_evo_buba <span class="ot">=</span> stat_forest_buba[[<span class="dv">1</span>]]</span>
<span id="cb81-8"><a href="biodiversity-in-the-protected-areas.html#cb81-8" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_buba,</span>
<span id="cb81-9"><a href="biodiversity-in-the-protected-areas.html#cb81-9" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_ap_buba.png&quot;</span>,</span>
<span id="cb81-10"><a href="biodiversity-in-the-protected-areas.html#cb81-10" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-11"><a href="biodiversity-in-the-protected-areas.html#cb81-11" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb81-12"><a href="biodiversity-in-the-protected-areas.html#cb81-12" tabindex="-1"></a>fig_evo5_buba <span class="ot">=</span> stat_forest_buba[[<span class="dv">2</span>]]</span>
<span id="cb81-13"><a href="biodiversity-in-the-protected-areas.html#cb81-13" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo5_buba,</span>
<span id="cb81-14"><a href="biodiversity-in-the-protected-areas.html#cb81-14" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo5_ap_buba.png&quot;</span>,</span>
<span id="cb81-15"><a href="biodiversity-in-the-protected-areas.html#cb81-15" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-16"><a href="biodiversity-in-the-protected-areas.html#cb81-16" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb81-17"><a href="biodiversity-in-the-protected-areas.html#cb81-17" tabindex="-1"></a></span>
<span id="cb81-18"><a href="biodiversity-in-the-protected-areas.html#cb81-18" tabindex="-1"></a><span class="co">#Niumi</span></span>
<span id="cb81-19"><a href="biodiversity-in-the-protected-areas.html#cb81-19" tabindex="-1"></a>stat_forest_niumi <span class="ot">=</span> <span class="fu">stat_treeloss_id</span>(<span class="at">df =</span> data_stat_treeloss,</span>
<span id="cb81-20"><a href="biodiversity-in-the-protected-areas.html#cb81-20" tabindex="-1"></a>                                    <span class="at">id =</span> <span class="st">&quot;109037&quot;</span>,</span>
<span id="cb81-21"><a href="biodiversity-in-the-protected-areas.html#cb81-21" tabindex="-1"></a>                                    <span class="at">name_pa =</span> <span class="st">&quot;AP Niumi&quot;</span>,</span>
<span id="cb81-22"><a href="biodiversity-in-the-protected-areas.html#cb81-22" tabindex="-1"></a>                                    <span class="at">treatment_yr =</span> <span class="dv">2008</span>)</span>
<span id="cb81-23"><a href="biodiversity-in-the-protected-areas.html#cb81-23" tabindex="-1"></a>fig_evo_niumi <span class="ot">=</span> stat_forest_niumi[[<span class="dv">1</span>]]</span>
<span id="cb81-24"><a href="biodiversity-in-the-protected-areas.html#cb81-24" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_niumi,</span>
<span id="cb81-25"><a href="biodiversity-in-the-protected-areas.html#cb81-25" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_ap_niumi.png&quot;</span>,</span>
<span id="cb81-26"><a href="biodiversity-in-the-protected-areas.html#cb81-26" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-27"><a href="biodiversity-in-the-protected-areas.html#cb81-27" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb81-28"><a href="biodiversity-in-the-protected-areas.html#cb81-28" tabindex="-1"></a>fig_evo5_niumi <span class="ot">=</span> stat_forest_niumi[[<span class="dv">2</span>]]</span>
<span id="cb81-29"><a href="biodiversity-in-the-protected-areas.html#cb81-29" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo5_niumi,</span>
<span id="cb81-30"><a href="biodiversity-in-the-protected-areas.html#cb81-30" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo5_ap_niumi.png&quot;</span>,</span>
<span id="cb81-31"><a href="biodiversity-in-the-protected-areas.html#cb81-31" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-32"><a href="biodiversity-in-the-protected-areas.html#cb81-32" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb81-33"><a href="biodiversity-in-the-protected-areas.html#cb81-33" tabindex="-1"></a></span>
<span id="cb81-34"><a href="biodiversity-in-the-protected-areas.html#cb81-34" tabindex="-1"></a><span class="co">#Bamboung</span></span>
<span id="cb81-35"><a href="biodiversity-in-the-protected-areas.html#cb81-35" tabindex="-1"></a>stat_forest_bamboung <span class="ot">=</span> <span class="fu">stat_treeloss_id</span>(<span class="at">df =</span> data_stat_treeloss,</span>
<span id="cb81-36"><a href="biodiversity-in-the-protected-areas.html#cb81-36" tabindex="-1"></a>                                    <span class="at">id =</span> <span class="st">&quot;555651496&quot;</span>,</span>
<span id="cb81-37"><a href="biodiversity-in-the-protected-areas.html#cb81-37" tabindex="-1"></a>                                    <span class="at">name_pa =</span> <span class="st">&quot;AP Bamboung&quot;</span>,</span>
<span id="cb81-38"><a href="biodiversity-in-the-protected-areas.html#cb81-38" tabindex="-1"></a>                                    <span class="at">treatment_yr =</span> <span class="dv">2008</span>)</span>
<span id="cb81-39"><a href="biodiversity-in-the-protected-areas.html#cb81-39" tabindex="-1"></a>fig_evo_bamboung <span class="ot">=</span> stat_forest_bamboung[[<span class="dv">1</span>]]</span>
<span id="cb81-40"><a href="biodiversity-in-the-protected-areas.html#cb81-40" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_bamboung,</span>
<span id="cb81-41"><a href="biodiversity-in-the-protected-areas.html#cb81-41" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_ap_bamboung.png&quot;</span>,</span>
<span id="cb81-42"><a href="biodiversity-in-the-protected-areas.html#cb81-42" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-43"><a href="biodiversity-in-the-protected-areas.html#cb81-43" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb81-44"><a href="biodiversity-in-the-protected-areas.html#cb81-44" tabindex="-1"></a>fig_evo5_bamboung <span class="ot">=</span> stat_forest_bamboung[[<span class="dv">2</span>]]</span>
<span id="cb81-45"><a href="biodiversity-in-the-protected-areas.html#cb81-45" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo5_bamboung,</span>
<span id="cb81-46"><a href="biodiversity-in-the-protected-areas.html#cb81-46" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo5_ap_bamboung.png&quot;</span>,</span>
<span id="cb81-47"><a href="biodiversity-in-the-protected-areas.html#cb81-47" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb81-48"><a href="biodiversity-in-the-protected-areas.html#cb81-48" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
<p>/! Modifier le code précédent pour inclure plusieurs aires ???</p>
<ul>
<li>Statistics at region level</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="biodiversity-in-the-protected-areas.html#cb82-1" tabindex="-1"></a><span class="co">#Evolution at region level : dataset</span></span>
<span id="cb82-2"><a href="biodiversity-in-the-protected-areas.html#cb82-2" tabindex="-1"></a>data_stat_treeloss_reg <span class="ot">=</span> data_stat_treeloss <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="biodiversity-in-the-protected-areas.html#cb82-3" tabindex="-1"></a>  <span class="fu">group_by</span>(drct, years) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="biodiversity-in-the-protected-areas.html#cb82-4" tabindex="-1"></a>  <span class="co">#For each region and each period, compute average evolution</span></span>
<span id="cb82-5"><a href="biodiversity-in-the-protected-areas.html#cb82-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">evo_avg_reg =</span> <span class="fu">mean</span>(treecover)) <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="biodiversity-in-the-protected-areas.html#cb82-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="biodiversity-in-the-protected-areas.html#cb82-7" tabindex="-1"></a>  <span class="fu">group_by</span>(drct) <span class="sc">%&gt;%</span> </span>
<span id="cb82-8"><a href="biodiversity-in-the-protected-areas.html#cb82-8" tabindex="-1"></a>  <span class="co">#Variation of the average evolution over time in each region</span></span>
<span id="cb82-9"><a href="biodiversity-in-the-protected-areas.html#cb82-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_region =</span> <span class="fu">lag</span>(evo_avg_reg),</span>
<span id="cb82-10"><a href="biodiversity-in-the-protected-areas.html#cb82-10" tabindex="-1"></a>         <span class="at">loss_region =</span> ((evo_avg_reg <span class="sc">-</span> lag_region)<span class="sc">/</span>lag_region)<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-11"><a href="biodiversity-in-the-protected-areas.html#cb82-11" tabindex="-1"></a>  <span class="co">#remove 2001 : either NA, or take value above when two regions are consecutive in the data frame (lag by region not applied) ???</span></span>
<span id="cb82-12"><a href="biodiversity-in-the-protected-areas.html#cb82-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loss_region =</span> <span class="fu">case_when</span>(</span>
<span id="cb82-13"><a href="biodiversity-in-the-protected-areas.html#cb82-13" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(loss_region) <span class="sc">&amp;</span> years <span class="sc">==</span> <span class="dv">2001</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb82-14"><a href="biodiversity-in-the-protected-areas.html#cb82-14" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span>loss_region))</span>
<span id="cb82-15"><a href="biodiversity-in-the-protected-areas.html#cb82-15" tabindex="-1"></a></span>
<span id="cb82-16"><a href="biodiversity-in-the-protected-areas.html#cb82-16" tabindex="-1"></a><span class="co">#Sahel</span></span>
<span id="cb82-17"><a href="biodiversity-in-the-protected-areas.html#cb82-17" tabindex="-1"></a>fig_evo_sahel <span class="ot">=</span> <span class="fu">stat_treeloss_reg</span>(<span class="at">df =</span> data_stat_treeloss_reg,</span>
<span id="cb82-18"><a href="biodiversity-in-the-protected-areas.html#cb82-18" tabindex="-1"></a>                                  <span class="at">reg =</span> <span class="st">&quot;Dr Grand Sahel&quot;</span>,</span>
<span id="cb82-19"><a href="biodiversity-in-the-protected-areas.html#cb82-19" tabindex="-1"></a>                                  <span class="at">name_reg =</span> <span class="st">&quot;Sahel&quot;</span>)</span>
<span id="cb82-20"><a href="biodiversity-in-the-protected-areas.html#cb82-20" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_sahel,</span>
<span id="cb82-21"><a href="biodiversity-in-the-protected-areas.html#cb82-21" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_reg_sahel.png&quot;</span>,</span>
<span id="cb82-22"><a href="biodiversity-in-the-protected-areas.html#cb82-22" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb82-23"><a href="biodiversity-in-the-protected-areas.html#cb82-23" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb82-24"><a href="biodiversity-in-the-protected-areas.html#cb82-24" tabindex="-1"></a></span>
<span id="cb82-25"><a href="biodiversity-in-the-protected-areas.html#cb82-25" tabindex="-1"></a><span class="co">#Guinea gulf</span></span>
<span id="cb82-26"><a href="biodiversity-in-the-protected-areas.html#cb82-26" tabindex="-1"></a>fig_evo_guinee <span class="ot">=</span> <span class="fu">stat_treeloss_reg</span>(<span class="at">df =</span> data_stat_treeloss_reg,</span>
<span id="cb82-27"><a href="biodiversity-in-the-protected-areas.html#cb82-27" tabindex="-1"></a>                                  <span class="at">reg =</span> <span class="st">&quot;Dr Golfe De Guinee&quot;</span>,</span>
<span id="cb82-28"><a href="biodiversity-in-the-protected-areas.html#cb82-28" tabindex="-1"></a>                                  <span class="at">name_reg =</span> <span class="st">&quot;Golfe de Guinée&quot;</span>)</span>
<span id="cb82-29"><a href="biodiversity-in-the-protected-areas.html#cb82-29" tabindex="-1"></a></span>
<span id="cb82-30"><a href="biodiversity-in-the-protected-areas.html#cb82-30" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_guinee,</span>
<span id="cb82-31"><a href="biodiversity-in-the-protected-areas.html#cb82-31" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_reg_guinee.png&quot;</span>,</span>
<span id="cb82-32"><a href="biodiversity-in-the-protected-areas.html#cb82-32" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb82-33"><a href="biodiversity-in-the-protected-areas.html#cb82-33" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb82-34"><a href="biodiversity-in-the-protected-areas.html#cb82-34" tabindex="-1"></a></span>
<span id="cb82-35"><a href="biodiversity-in-the-protected-areas.html#cb82-35" tabindex="-1"></a><span class="co">#Eastern Africa</span></span>
<span id="cb82-36"><a href="biodiversity-in-the-protected-areas.html#cb82-36" tabindex="-1"></a>fig_evo_eastAf <span class="ot">=</span> <span class="fu">stat_treeloss_reg</span>(<span class="at">df =</span> data_stat_treeloss_reg,</span>
<span id="cb82-37"><a href="biodiversity-in-the-protected-areas.html#cb82-37" tabindex="-1"></a>                                  <span class="at">reg =</span> <span class="st">&quot;Dr Afrique De L&#39;Est&quot;</span>,</span>
<span id="cb82-38"><a href="biodiversity-in-the-protected-areas.html#cb82-38" tabindex="-1"></a>                                  <span class="at">name_reg =</span> <span class="st">&quot;Afrique de l&#39;Est&quot;</span>)</span>
<span id="cb82-39"><a href="biodiversity-in-the-protected-areas.html#cb82-39" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_eastAf,</span>
<span id="cb82-40"><a href="biodiversity-in-the-protected-areas.html#cb82-40" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_reg_eastAf.png&quot;</span>,</span>
<span id="cb82-41"><a href="biodiversity-in-the-protected-areas.html#cb82-41" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb82-42"><a href="biodiversity-in-the-protected-areas.html#cb82-42" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span>
<span id="cb82-43"><a href="biodiversity-in-the-protected-areas.html#cb82-43" tabindex="-1"></a></span>
<span id="cb82-44"><a href="biodiversity-in-the-protected-areas.html#cb82-44" tabindex="-1"></a><span class="co">#Eastern Africa</span></span>
<span id="cb82-45"><a href="biodiversity-in-the-protected-areas.html#cb82-45" tabindex="-1"></a>fig_evo_austAf <span class="ot">=</span> <span class="fu">stat_treeloss_reg</span>(<span class="at">df =</span> data_stat_treeloss_reg,</span>
<span id="cb82-46"><a href="biodiversity-in-the-protected-areas.html#cb82-46" tabindex="-1"></a>                                  <span class="at">reg =</span> <span class="st">&quot;Dr Afrique Australe&quot;</span>,</span>
<span id="cb82-47"><a href="biodiversity-in-the-protected-areas.html#cb82-47" tabindex="-1"></a>                                  <span class="at">name_reg =</span> <span class="st">&quot;Afrique australe&quot;</span>)</span>
<span id="cb82-48"><a href="biodiversity-in-the-protected-areas.html#cb82-48" tabindex="-1"></a></span>
<span id="cb82-49"><a href="biodiversity-in-the-protected-areas.html#cb82-49" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">plot =</span> fig_evo_austAf,</span>
<span id="cb82-50"><a href="biodiversity-in-the-protected-areas.html#cb82-50" tabindex="-1"></a>       <span class="at">filename =</span> <span class="st">&quot;fig_forest_loss_evo_reg_austAf.png&quot;</span>,</span>
<span id="cb82-51"><a href="biodiversity-in-the-protected-areas.html#cb82-51" tabindex="-1"></a>       <span class="at">path =</span> <span class="st">&quot;05_StatDes/biodiversity/forest/loss&quot;</span>,</span>
<span id="cb82-52"><a href="biodiversity-in-the-protected-areas.html#cb82-52" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">5</span>)</span></code></pre></div>
</div>
<div id="mangrove" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Mangrove<a href="biodiversity-in-the-protected-areas.html#mangrove" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Summary table of mangrove area in each PA :</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="biodiversity-in-the-protected-areas.html#cb83-1" tabindex="-1"></a>tbl_mang_summary <span class="ot">=</span> data_mang <span class="sc">%&gt;%</span></span>
<span id="cb83-2"><a href="biodiversity-in-the-protected-areas.html#cb83-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(wdpaid) <span class="sc">%&gt;%</span></span>
<span id="cb83-3"><a href="biodiversity-in-the-protected-areas.html#cb83-3" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">area_sqkm =</span> <span class="fu">sum</span>(value))</span></code></pre></div>
</div>
<div id="emissions" class="section level3 hasAnchor" number="3.5.3">
<h3><span class="header-section-number">3.5.3</span> Emissions<a href="biodiversity-in-the-protected-areas.html#emissions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>/! pas clair</p>
<p>Summary table of emissions in each PA :</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="biodiversity-in-the-protected-areas.html#cb84-1" tabindex="-1"></a><span class="co"># create summary table </span></span>
<span id="cb84-2"><a href="biodiversity-in-the-protected-areas.html#cb84-2" tabindex="-1"></a>tbl_emi_summary <span class="ot">=</span> data_emi <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="biodiversity-in-the-protected-areas.html#cb84-3" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="biodiversity-in-the-protected-areas.html#cb84-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">area_sqkm =</span> <span class="fu">sum</span>(value))</span></code></pre></div>
</div>
<div id="biometeow" class="section level3 hasAnchor" number="3.5.4">
<h3><span class="header-section-number">3.5.4</span> Biome/TEOW<a href="biodiversity-in-the-protected-areas.html#biometeow" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="projects-funded-by-the-afd.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="miscellaneous-statistics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/vuillota/EVA-impact-aires-protegees/edit/main/01_stat_biodiv.Rmd",
"text": "Suggest an edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/vuillota/EVA-impact-aires-protegees/raw/main/01_stat_biodiv.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
